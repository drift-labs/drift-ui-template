import{n as C,o as h,p as E,q,r as X}from"./chunk-BSK64RRL.js";import{B,E as _,F as R,H as w,J as K,K as b,M as Q,N as J,O as H,P as W,Q as G,U as Z,V as $,Y as T,b as s,i as S,j as u,y as j}from"./chunk-BHIJKWN7.js";import{M as P,x as L}from"./chunk-QSYOXIBV.js";import{Td as V,X as F,_ as N,ef as U,mc as y}from"./chunk-E2A6YDRV.js";import{h as l,n as c}from"./chunk-64CIGK2X.js";l();c();var ae={Tokens:"fungibles",Collectibles:"collectibles"},x=s({tab:ae.Tokens,nonce:0}),se=u(x,e=>e.tab),ie=s(e=>e(se),(e,t,r)=>{let a=e(x);if(le(a,r)){let o=typeof r=="object"?r.nonce:a.nonce,i=typeof r=="object"?r.defaultTab:r;t(x,{tab:i,nonce:o})}}),z=ie;function le(e,t){return typeof t=="object"&&e.nonce===t.nonce?!1:typeof t=="string"?t!==e.tab:t.nonce>e.nonce}l();c();var ce=S(e=>{let t=e(Z);return t?U(t):{queryKey:["default-mainnet"],queryFn:()=>({isDeveloperMode:!1})}}),ue=s(e=>!e(ce).data?.isDeveloperMode),k=ue;l();c();l();c();async function I({walletCaip19s:e,includeFungibleCaip19s:t,excludeFungibleCaip19s:r}){let a=await F.api().timeout(V({seconds:10})).get("/portfolio/v1/fungibles/value",{params:{walletAddresses:e.join(","),...t.length>0&&{includeFungibleCaip19s:t.join(",")},...r.length>0&&{excludeFungibleCaip19s:r.join(",")}}}).then(o=>{if(N(o))return o.data;throw new Error(o.data?.message||o.data?.error||o.statusText||`Status: ${o.status}`,{cause:o.data?.code})}).catch(o=>{throw y.addBreadcrumb("tokens","getPortfolioValue","error",{message:o.message,cause:o.cause,walletCaip19s:e.join(","),...t.length>0&&{includeFungibleCaip19s:t.join(",")},...r.length>0&&{excludeFungibleCaip19s:r.join(",")}}),y.captureError(o,"tokens"),o}),n=B.parse(a);return n.errors&&n.errors.length>0&&n.errors.forEach(o=>{y.addBreadcrumb("tokens","getPortfolioValue_partialError","info",{code:o.code,message:o.message,chainId:o.details.chainId,address:o.details.address})}),n}var fe=1e3,me=5e3,de=u(s(e=>{let t=e($),a=e(G).reduce((n,o)=>{let i=P(void 0,{key:o.legacyKey??"",spamStatus:o.spamStatus??"NOT_VERIFIED"}),f=P(t,{key:o.legacyKey??"",spamStatus:o.spamStatus??"NOT_VERIFIED"});return i===f?n:i?{...n,exclude:[...n.exclude,o.encodedCaip19]}:{...n,include:[...n.include,o.encodedCaip19]}},{include:[],exclude:[]});return{include:a.include.sort().slice(0,50),exclude:a.exclude.sort().slice(0,50)}}),e=>e,(e,t)=>e.include.join(",")===t.include.join(",")&&e.exclude.join(",")===t.exclude.join(",")),pe=S(e=>{let t=e(K),{include:r,exclude:a}=e(de),n=e(w),o=e(k),i=L.portfolioValue({walletCaip19s:t,include:r,exclude:a,isMainnet:o});return{enabled:t.length>0&&!n&&o,queryKey:i,meta:{fetchCount:0},refetchInterval:m=>{let g=Number(m.meta?.fetchCount??0);return m.meta&&(m.meta.fetchCount=g+1),Math.min(Math.max(g*250,fe),me)},queryFn:async()=>I({walletCaip19s:t,includeFungibleCaip19s:r,excludeFungibleCaip19s:a})}}),p=pe;l();c();l();c();function be(e,t){return h(t,e)===0?0:e/h(t,e)*100}var Y=be;var ee=s(e=>{let t=e(T),r=!1,a=t.reduce((n,o)=>{let i=o.livePrice?.price??o.price?.price,f=o.livePrice?.priceChange24h??o.price?.priceChange24h;i&&(r=!0);let m=X(o,i??0),g=q(m,f??0);return{currentValue:C(n.currentValue,m),priceDifference:C(n.priceDifference,g)}},{currentValue:0,priceDifference:0});return r?{currentValue:a.currentValue,priceDifference:a.priceDifference,totalPercentChange24h:Y(a.priceDifference,a.currentValue)}:{currentValue:void 0,priceDifference:void 0,totalPercentChange24h:void 0}}),Te=R({atomToStoreOffline:p,offlineKey:s(e=>`${e(Q)??""}:portfolio-value`),namespaceKey:"fungible-tokens",ttlMs:V({days:10}),initialValue:{totalValueUsdCentsCurrent:void 0,totalValueUsdStringCurrent:void 0,totalValueUsdCents24h:void 0,totalValueUsdString24h:void 0,totalPercentChange24h:void 0},schema:j}),te=s(e=>{let t=e(Te),r=t?.totalPercentChange24h,a=t?.totalValueUsdCents24h,n=t?.totalValueUsdCentsCurrent;return{currentValue:n!==void 0?n/100:void 0,priceDifference:a!==void 0&&n!==void 0?E(h(n,a),100):void 0,totalPercentChange24h:r}}),Ot=s(e=>{let t=e(ee),r=e(te);return{local:t,remote:r}}),he=s(e=>{let t=e(T),r=e(H),a=t.slice(-15).map(n=>{let o=r[n.encodedCaip19]??n.livePrice??n.price;return o?n.totalQuantity*o.price/10**n.decimals:0}).filter(n=>n>0);return a.length>0?E(a.reduce((n,o)=>C(n,o),0),a.length):void 0}),Ae=u(p,e=>e.status),ge=s(e=>{if(!e(k))return{status:"idle",data:{currentValue:void 0,priceDifference:void 0,totalPercentChange24h:void 0}};let r=e(ee),a=e(Ae),n=e(te),o=!e(W)&&e(b).isSuccess,i=e(he),f=typeof i=="number"&&i<.05;return{status:a,data:o||f?r:n}}),Ft=ge;l();c();var oe=s({start:0,end:0}),A=10,ne=A*.75;function ye(e){let t=Math.max(0,e-ne);return Math.floor(t/A)*A}function Ve(e){let t=e+ne;return Math.ceil(t/A)*A}var D=s(0),M=s(20),Se=s(e=>{let t=e(T),r=e(D),a=e(M);return t.slice(r,a)}),Ce=u(Se,e=>e,(e,t)=>{let r=e.map(n=>n.encodedCaip19).sort().join(","),a=t.map(n=>n.encodedCaip19).sort().join(",");return r===a}),wt=s(e=>e(Ce),(e,t,r)=>{if(e(z)!=="fungibles")return;let n=0,o=0;Array.isArray(r)?(n=Math.min(...r),o=Math.max(...r),t(oe,{start:n,end:o})):(t(oe,r),n=r.start,o=r.end);let i=ye(n),f=Ve(o);i!==e(D)&&t(D,i),f!==e(M)&&t(M,f)});l();c();var v=s(0),re=s(0),ke=u(p,e=>e.status==="success"&&e.data?.errors?e.data.errors:[],(e,t)=>JSON.stringify(e)===JSON.stringify(t)),Pe=u(b,e=>e.status==="success"&&e.data?.pages?e.data.pages.flatMap(r=>r.errors||[]):[],(e,t)=>JSON.stringify(e)===JSON.stringify(t));function O(e,t){let r=u(e,({status:n,isFetching:o})=>({status:n,isFetching:o}),(n,o)=>JSON.stringify(n)===JSON.stringify(o));return _((n,o)=>{let i=n(r);i.isFetching||(i.status==="error"&&o(t,f=>f+1),i.status==="success"&&o(t,0))})}var Ee=O(b,v),xe=O(J,v),Ie=O(p,re),De=s(e=>{e(xe),e(Ee),e(Ie);let t=e(ke),r=e(Pe);return{balanceErrorCount:e(v),priceErrorCount:e(re),partialErrors:[...t,...r]}}),Xt=De;export{k as a,p as b,ae as c,z as d,Ot as e,Ft as f,Xt as g,wt as h};
//# sourceMappingURL=chunk-E6KYSGDB.js.map
