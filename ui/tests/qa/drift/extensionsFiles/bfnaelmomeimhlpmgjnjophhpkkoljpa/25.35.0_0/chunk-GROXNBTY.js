import{d as pe}from"./chunk-OZFKX4E3.js";import{k as de}from"./chunk-TALMQQTZ.js";import{a as se}from"./chunk-WSJ272XI.js";import{a as ae,b as ce}from"./chunk-S32BDL22.js";import{a as I,b as A,c as x,g as l,h as G,i as H,j as J,k as N,l as Y,n as p,o as S,q as Z,r as ee,s as U,t as O,u as B,v as q}from"./chunk-CQIC5IDD.js";import{b as re}from"./chunk-6N4GZCP2.js";import{a as ne,c as oe,d as ie}from"./chunk-ZTFOFBVC.js";import{A as te,db as W,m as h}from"./chunk-FVUSQHVT.js";import{a as b}from"./chunk-HTY647YJ.js";import{Ic as C,Nc as y,mc as X,va as z}from"./chunk-E2A6YDRV.js";import{X as K,c as Q,n as V,ya as $}from"./chunk-BEUYJGED.js";import{f as _,h as i,n as s}from"./chunk-64CIGK2X.js";i();s();i();s();i();s();i();s();i();s();var M=()=>{let n=l.isLedgerSupported();return y({queryKey:n,queryFn:async()=>q().isSupported()})};i();s();var ue=(n,e=[],o=!1,r=!1,a=()=>{})=>{let{defaultTransportTimeout:L}=q(),m=C(),c=Z(z.getAddressType(e[0].pathType)),u=n.isConnected&&e.length>0&&c===n.selectedApp?.app,g=l.ledgerAddresses(e,r);return y({enabled:u,queryKey:g,queryFn:async()=>{let d=await m.getQueryData(l.ledgerTransportState());if(!d)throw new Y;return ee({transportTimeout:L,state:d,derivationPathParams:e,enableDebugLogs:o,enableLedgerXPubDerivation:r,onSuccess:a})},retry:!1})};i();s();i();s();var E=(n=!1,e,o)=>{if(e?.status===o.status)return;let r,a="";switch(o.status){case"connected":r="\u{1F7E2} Connected",a=`, selected app: ${o.selectedApp?S(o.selectedApp.app):"None"}`;break;case"needs-permission":r="\u{1F7E0} Needs Permission";break;case"reconnecting":r="\u{1F7E0} Reconnecting";break;case"waiting-for-approval":r="\u{1F7E0} Waiting For Approval";break;case"not-connected":r="\u26AA\uFE0F Not Connected";break}p(n,`${r}${a}`)};i();s();i();s();var D=_(Q());var le=5,fe=500,j=(n=!0,e=!1,o=2e3)=>{let r=C(),[a,L]=(0,D.useState)(o),m=(0,D.useCallback)(()=>{p(e,"disconnect event received from Ledger transport."),J(r)},[e,r]);(0,D.useEffect)(()=>("hid"in self.navigator&&self.navigator.hid.addEventListener("disconnect",m),()=>"hid"in self.navigator&&self.navigator.hid.removeEventListener("disconnect",m)),[m]);let{data:c=!1}=M(),u=n&&c,g=l.ledgerTransportState();return y({enabled:u,queryKey:g,queryFn:async()=>{if(!u)return A;let d=r.getQueryData(g),T,w=!1,P=0;do{try{T=(await Promise.all([I(O(B(),e,P>0?x:d),o),b(200)]))[0]}catch{T=A}w=!!d?.isConnected&&T.status==="not-connected"&&++P<le,w&&(N(r,x),p(e,"Attempting to reconnect..."),P===1&&E(e,d,x),await b(fe))}while(w);return P>0&&(d=x),E(e,d,T),d?.isConnected&&!T.isConnected&&G(r).then(()=>H(r)),L(T.isConnected?3500:o),T},refetchOnMount:!0,refetchInterval:a,initialData:A})};i();s();var Le=(n=!0,e=!1)=>{let o=B(),r=C(),a=l.requestLedgerPermission();return y({enabled:n,queryKey:a,queryFn:async()=>{let m;try{p(e,"Requesting permission to connect to Ledger..."),m=await o.request()}catch(u){if(p(e,`Received error trying to request permission: ${u}`),typeof u.message=="string"&&u.message?.includes("device is already open")){p(e,"\u2705 Permission granted, device already open. Connecting to device...");let g=l.ledgerTransportState(),v=await r.getQueryData(g),d;try{d=await O(o,e,v)}catch{}return d?.isConnected?(p(e,`\u2705 Permission granted. Connected to Ledger device: ${d.transport.deviceModel?.productName??"Unknown device"}. Selected app: ${d?.selectedApp?.app??"none"}`),await N(r,d),E(e,void 0,d),{type:"granted",transport:d.transport}):(p(e,"\u274C Unable to connect. Try again and make sure device is unlocked."),{type:"unable-to-connect"})}return p(e,"\u274C Permission denied."),{type:"denied"}}if(!m)return p(e,"\u274C Unable to connect to Ledger device. Permission granted, but no Transport received."),{type:"unable-to-connect"};let c={status:"connected",isConnected:!0,transport:m,selectedApp:await U(m,o.defaultTransportTimeout)};return await N(r,c),E(e,void 0,c),p(e,`\u2705 Permission granted. Connected to Ledger device: ${m.deviceModel?.productName??"Unknown device"}`),{type:"granted",transport:m}},gcTime:0,staleTime:0,refetchOnMount:!0})};i();s();var R=_(Q());function Te(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n)+n)}var ye=n=>{let e=[];for(let o=1;o<=n;++o){let r=Te(0,3),a;r===0?a=0:r===1?a=-70:a=-100,e.push({name:`Nano X ${o}`,id:`${o}`,rssi:a})}return e.sort((o,r)=>r.rssi-o.rssi)},Yr=ye(100);var t=_(Q());var Ae=h.div`
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  width: 100%;
`,Ce=h(pe)`
  margin: auto 0px;
  padding-left: 10px;
  padding-right: 10px;
`,Se=h.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,he=h.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 55px;
`,F=h(W).attrs({size:28,lineHeight:34,weight:500})`
  margin-bottom: 8px;
  margin-top: 22px;
`,k=h(W).attrs({size:16,color:$.colors.legacy.textDiminished})`
  max-width: 275px;
  span {
    color: white;
  }
`,Ee={ledgerActionNeedToConfirm:"ledgerActionNeedToConfirm",ledgerActionNeedToConfirmMany:"ledgerActionNeedToConfirmMany",ledgerActionNeedToConfirmBlind:"ledgerActionNeedToConfirmBlind",ledgerActionNeedToConfirmBlindMany:"ledgerActionNeedToConfirmBlindMany",ledgerActionPleaseConnect:"ledgerActionPleaseConnect",ledgerActionConfirm:"ledgerActionConfirm",ledgerActionNeedPermission:"ledgerActionNeedPermission",ledgerActionPleaseConnectAndConfirm:"ledgerActionPleaseConnectAndConfirm",commandContinue:"commandContinue",commandCancel:"commandCancel"},Qt=n=>!!(n&&(n.statusCode===26632||n.statusCode===27013||n.statusCode===27404||n.name==="DisconnectedDeviceDuringOperation")),me=n=>{switch(n){case"Bitcoin":return!1;case"EVM":return!0;case"Solana":return!0;case"Sui":return!1}},ve=n=>{let{data:e=A}=j(!0,V());return(0,t.useMemo)(()=>({status:e.status,isConnected:e.isConnected,isExpectedSelectedAppOpen:e.isConnected&&e.selectedApp?.app===n,transport:e.isConnected?e.transport:void 0}),[n,e])},xe=(n,e,o)=>{let{ledgerApp:r="Solana",ledgerAction:a,numberOfTransactions:L=1,cancel:m=se}=n,{t:c}=K(),u,g;L>1?me(r)?g=c(o.ledgerActionNeedToConfirmBlindMany,{numberOfTransactions:L,chainType:S(r)}):g=c(o.ledgerActionNeedToConfirmMany,{numberOfTransactions:L,chainType:S(r)}):me(r)?g=c(o.ledgerActionNeedToConfirmBlind,{chainType:S(r)}):g=c(o.ledgerActionNeedToConfirm,{chainType:S(r)});let v=c(o.commandCancel),d="default",T=m;switch(e.status){case"not-connected":{u=c(o.ledgerActionPleaseConnect);break}case"reconnecting":case"waiting-for-approval":case"connected":{u=c(o.ledgerActionConfirm);break}case"needs-permission":{u=c(o.ledgerActionNeedPermission),g=c(o.ledgerActionPleaseConnectAndConfirm),d="primary",v=c(o.commandContinue),T=()=>{re({url:"connect_hardware.html?permission=true"}),m()};break}}return(0,t.useEffect)(()=>{if(e.isConnected&&e.transport&&(e.isExpectedSelectedAppOpen===null||e.isExpectedSelectedAppOpen))try{a(e.transport)}catch(w){X.captureError(w,"ledger")}},[e]),{primaryText:u,secondaryText:g,buttonTheme:d,buttonText:v,buttonAction:T}},Ne=t.default.memo(n=>{let{primaryText:e,secondaryText:o,buttonAction:r,buttonTheme:a,buttonText:L}=n;return t.default.createElement(Ae,null,t.default.createElement(Ce,{icon:t.default.createElement(ne,{diameter:75}),primaryText:e,secondaryText:o}),t.default.createElement(oe,{onClick:r,theme:a},L))}),De=n=>{let e=ve(n.ledgerApp??"Solana"),o=xe(n,e,Ee);return t.default.createElement(Ne,{...o})},Kt=n=>t.default.createElement(De,{...n}),It=({ledgerActionError:n,onRetryClick:e,onCancelClick:o})=>{let{t:r}=K();return t.default.createElement(Se,null,t.default.createElement("div",null,t.default.createElement(de,null,r("ledgerActionErrorHeader")),t.default.createElement(he,null,t.default.createElement(ce,{color:ae($.colors.legacy.spotNegative,.1),diameter:94},t.default.createElement(te,{width:32})),n?.statusCode===26632?t.default.createElement(t.default.Fragment,null,t.default.createElement(F,null,r("ledgerActionErrorBlindSignDisabledPrimaryText")),t.default.createElement(k,null,r("ledgerActionErrorBlindSignDisabledSecondaryText"))):t.default.createElement(t.default.Fragment,null),n?.statusCode===27013?t.default.createElement(t.default.Fragment,null,t.default.createElement(F,null,r("ledgerActionErrorUserRejectionPrimaryText")),t.default.createElement(k,null,r("ledgerActionErrorUserRejectionSecondaryText"))):t.default.createElement(t.default.Fragment,null),n?.statusCode===27404?t.default.createElement(t.default.Fragment,null,t.default.createElement(F,null,r("ledgerActionErrorDeviceLockedPrimaryText")),t.default.createElement(k,null,r("ledgerActionErrorDeviceLockedSecondaryText"))):t.default.createElement(t.default.Fragment,null),n?.name==="DisconnectedDeviceDuringOperation"?t.default.createElement(t.default.Fragment,null,t.default.createElement(F,null,r("ledgerActionErrorDeviceDisconnectedDuringOperationPrimaryText")),t.default.createElement(k,null,r("ledgerActionErrorDeviceDisconnectedDuringOperationSecondaryText"))):t.default.createElement(t.default.Fragment,null))),t.default.createElement(ie,{primaryText:r("commandRetry"),secondaryText:r("commandCancel"),onPrimaryClicked:e,onSecondaryClicked:o}))};export{M as a,ue as b,j as c,Le as d,Qt as e,Kt as f,It as g};
//# sourceMappingURL=chunk-GROXNBTY.js.map
