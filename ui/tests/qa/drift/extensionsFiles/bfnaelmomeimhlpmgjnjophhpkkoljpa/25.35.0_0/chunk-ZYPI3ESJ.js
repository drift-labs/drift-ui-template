import{a as Qj}from"./chunk-6EZHAYJL.js";import{a as oA,h as cB}from"./chunk-BRQKCECY.js";import{a as ka}from"./chunk-YOO3KN23.js";import{O as BB,a as Ek,k as yk,t as uB,u as lB,v as us,w as Au,x as De,y as dB}from"./chunk-YITPJN7X.js";import{a as pk,f as Vc}from"./chunk-CQIC5IDD.js";import{b as Wc,c as zk,ca as aB,d as Xk,h as Wk,ha as fB,w as iB,x as Jc,z as Yc}from"./chunk-BHIJKWN7.js";import{a as mB,b as kB}from"./chunk-5OF7XKWY.js";import{$a as Zc,Ba as oB,Ea as Ij,F as la,Fa as dt,Ga as nB,Ha as Fr,Pa as sB,Q as Io,R as eB,Ta as U,V as lt,Va as $j,W as da,Wa as vj,X as jB,Y as ve,_ as tB,aa as ma,b as Ae,ca as cs,hb as pB,ia as rB,ja as cj,jb as Sr,l as ee,m as bj,ma as bA,n as ua,ob as $o,pb as vo,q as Jk,s as Yk,sb as _e,ub as NA,w as Zk,x as AB}from"./chunk-QSYOXIBV.js";import{a as bk,f as Ik,g as $k}from"./chunk-O7KQ5SYD.js";import{c as zc,d as ut,g as Tk,j as Hk,k as ca,m as je}from"./chunk-HUS6FTFG.js";import{a as Xe,b as Me,c as Ot}from"./chunk-NCSBB2TA.js";import{a as Qk}from"./chunk-25TPEQ2Q.js";import{a as nI}from"./chunk-XD32MQ4W.js";import{Mb as Nk,N as hr,O as kA,Ob as Lk,Qb as Kk,S as Mk,Sb as sa,T as Rk,Tb as Uk,U as oa,Ub as wo,Vb as ia,W as _k,a as Bo,bb as Nt,d as Pk,f as Uj,lb as na,mb as So,n as Gk,o as Ck,pc as aa,rc as Hj,s as Ok,tb as Xc,tc as pa,u as Fo,ub as Dk,uc as bo,v as lI}from"./chunk-LHPEWMJX.js";import{V as ta,a as ak,aa as xk,f as fe,o as vk,oa as ra,s as qk,ua as Vk,ya as Lt}from"./chunk-HTY647YJ.js";import{A as Qi,Ab as Zm,Ac as ek,Bb as Pe,Bc as as,Bd as Yi,Bf as dk,C as Dm,Cb as GA,Cf as Eo,D as Nm,Db as M,Dc as Kc,Dd as Uc,E as ue,Eb as Er,Ed as ps,Ef as Aa,Gc as jk,H as Lm,Hb as lo,Hf as mk,I as ao,Ic as pA,J as Km,Jf as kk,Kc as IA,Kf as Bk,L as Um,Lc as Xi,Lf as fk,Mc as tk,Md as Hc,Nc as X,Od as nk,Pe as fo,Qc as Wi,R as Hm,S as BA,Sb as Re,Td as K,Vd as sk,Wb as mo,X as N,Xb as ko,Xe as ck,Xf as ea,_ as AA,_f as yr,aa as co,ab as Wm,ba as Qm,bf as uk,c as oI,ca as Vm,ce as Lj,cg as VA,da as zi,de as oe,df as lk,ec as CA,eg as gk,fd as rk,gc as Rt,ge as Zi,gf as aA,hb as $e,ib as Jm,ic as _A,jc as Be,jf as J,lc as _t,le as ik,mc as b,md as ok,na as zm,nd as Sj,ra as Xm,rb as is,ta as Mt,ua as tA,uf as go,va as gr,vb as Ym,wc as wA,xb as I,xd as Ji,yb as ct,zb as uo,zc as Ak}from"./chunk-E2A6YDRV.js";import{B as _m,R as w,S as H,e as Rm,i as ss,u as io}from"./chunk-4XTMHWN2.js";import{$ as sI,$a as ja,B as PA,Ba as Dt,Ca as fA,D as hj,Da as ge,E as Fj,F as We,Ga as yo,Lb as Fk,Ob as pI,Pb as cI,Qa as aI,Rb as uI,S as T,Ub as ho,Vb as Sk,X as hA,Y as DA,_b as wk,c as P,ca as iI,kb as wj,l as p,n as po,p as Lc,q as Vi,sb as hk,wa as Qc,ya as Kj}from"./chunk-BEUYJGED.js";import{c as yj,d as rI,f as q,h as n,i as d,m as Buffer,n as s}from"./chunk-64CIGK2X.js";var Gh=yj(Ph=>{"use strict";n();s();var Sn=P();function MG(e,A){return e===A&&(e!==0||1/e===1/A)||e!==e&&A!==A}var RG=typeof Object.is=="function"?Object.is:MG,_G=Sn.useState,DG=Sn.useEffect,NG=Sn.useLayoutEffect,LG=Sn.useDebugValue;function KG(e,A){var j=A(),t=_G({inst:{value:j,getSnapshot:A}}),r=t[0].inst,o=t[1];return NG(function(){r.value=j,r.getSnapshot=A,Ud(r)&&o({inst:r})},[e,j,A]),DG(function(){return Ud(r)&&o({inst:r}),e(function(){Ud(r)&&o({inst:r})})},[e]),LG(j),j}function Ud(e){var A=e.getSnapshot;e=e.value;try{var j=A();return!RG(e,j)}catch{return!0}}function UG(e,A){return A()}var HG=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?UG:KG;Ph.useSyncExternalStore=Sn.useSyncExternalStore!==void 0?Sn.useSyncExternalStore:HG});var Oh=yj(Ch=>{"use strict";n();s();d.NODE_ENV!=="production"&&function(){function e(k,f){return k===f&&(k!==0||1/k===1/f)||k!==k&&f!==f}function A(k,f){l||r.startTransition===void 0||(l=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var g=f();if(!m){var E=f();o(g,E)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),m=!0)}E=i({inst:{value:g,getSnapshot:f}});var h=E[0].inst,y=E[1];return u(function(){h.value=g,h.getSnapshot=f,j(h)&&y({inst:h})},[k,g,f]),a(function(){return j(h)&&y({inst:h}),k(function(){j(h)&&y({inst:h})})},[k]),c(g),g}function j(k){var f=k.getSnapshot;k=k.value;try{var g=f();return!o(k,g)}catch{return!0}}function t(k,f){return f()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=P(),o=typeof Object.is=="function"?Object.is:e,i=r.useState,a=r.useEffect,u=r.useLayoutEffect,c=r.useDebugValue,l=!1,m=!1,B=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?t:A;Ch.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:B,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Qd=yj((HcA,Hd)=>{"use strict";n();s();d.NODE_ENV==="production"?Hd.exports=Gh():Hd.exports=Oh()});var Rh=yj(Mh=>{"use strict";n();s();var Z6=P(),QG=Qd();function VG(e,A){return e===A&&(e!==0||1/e===1/A)||e!==e&&A!==A}var zG=typeof Object.is=="function"?Object.is:VG,XG=QG.useSyncExternalStore,WG=Z6.useRef,JG=Z6.useEffect,YG=Z6.useMemo,ZG=Z6.useDebugValue;Mh.useSyncExternalStoreWithSelector=function(e,A,j,t,r){var o=WG(null);if(o.current===null){var i={hasValue:!1,value:null};o.current=i}else i=o.current;o=YG(function(){function u(k){if(!c){if(c=!0,l=k,k=t(k),r!==void 0&&i.hasValue){var f=i.value;if(r(f,k))return m=f}return m=k}if(f=m,zG(l,k))return f;var g=t(k);return r!==void 0&&r(f,g)?(l=k,f):(l=k,m=g)}var c=!1,l,m,B=j===void 0?null:j;return[function(){return u(A())},B===null?void 0:function(){return u(B())}]},[A,j,t,r]);var a=XG(e,o[0],o[1]);return JG(function(){i.hasValue=!0,i.value=a},[a]),ZG(a),a}});var Dh=yj(_h=>{"use strict";n();s();d.NODE_ENV!=="production"&&function(){function e(c,l){return c===l&&(c!==0||1/c===1/l)||c!==c&&l!==l}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var A=P(),j=Qd(),t=typeof Object.is=="function"?Object.is:e,r=j.useSyncExternalStore,o=A.useRef,i=A.useEffect,a=A.useMemo,u=A.useDebugValue;_h.useSyncExternalStoreWithSelector=function(c,l,m,B,k){var f=o(null);if(f.current===null){var g={hasValue:!1,value:null};f.current=g}else g=f.current;f=a(function(){function h(O){if(!y){if(y=!0,F=O,O=B(O),k!==void 0&&g.hasValue){var v=g.value;if(k(v,O))return S=v}return S=O}if(v=S,t(F,O))return v;var D=B(O);return k!==void 0&&k(v,D)?(F=O,v):(F=O,S=D)}var y=!1,F,S,x=m===void 0?null:m;return[function(){return h(l())},x===null?void 0:function(){return h(x())}]},[l,m,B,k]);var E=r(c,f[0],f[1]);return i(function(){g.hasValue=!0,g.value=E},[E]),u(E),E},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Nh=yj((AuA,Vd)=>{"use strict";n();s();d.NODE_ENV==="production"?Vd.exports=Rh():Vd.exports=Dh()});var In=yj(i7=>{"use strict";n();s();Object.defineProperty(i7,"__esModule",{value:!0});var v0=P();function K1(e){var A=v0.useRef();return v0.useEffect(function(){A.current=e}),A.current}i7.default=K1});var Gw=yj((TKA,Pw)=>{n();s();function A8(e,A,j,t){for(var r=-1,o=e==null?0:e.length;++r<o;){var i=e[r];A(t,i,j(i),e)}return t}Pw.exports=A8});var Ow=yj((CKA,Cw)=>{n();s();var e8=cI();function j8(e,A,j,t){return e8(e,function(r,o,i){A(t,r,j(r),i)}),t}Cw.exports=j8});var Rw=yj((RKA,Mw)=>{n();s();var t8=Gw(),r8=Ow(),o8=aI(),n8=iI();function s8(e,A){return function(j,t){var r=n8(j)?t8:r8,o=A?A():{};return r(j,e,o8(t,2),o)}}Mw.exports=s8});var rm=yj((NKA,_w)=>{n();s();var i8=sI(),a8=Rw(),p8=a8(function(e,A,j){i8(e,j,A)});_w.exports=p8});n();s();var qo=q(P()),gB=(0,qo.createContext)(null);function dI({children:e,seedlessRepository:A}){return qo.default.createElement(gB.Provider,{value:{seedlessRepository:A}},e)}function mI(){let e=(0,qo.useContext)(gB);if(!e)throw new Error("useSeedlessContext must be used within a SeedlessProvider");return e}function WA(){return mI().seedlessRepository}n();s();n();s();var kI=p.record(p.string(),p.number()),BI=p.object({type:p.union([p.literal("Buffer"),p.literal("Object")]),data:p.array(p.number())}),fI=p.union([kI,BI]),EB=p.object({seeds:p.array(p.tuple([p.string(),fI]))}),yB=e=>gI(e)?new Uint8Array(Buffer.from(e.data)):new Uint8Array(Object.values(e)),gI=e=>!!e&&typeof e=="object"&&Hc("type",e)&&typeof e.type=="string"&&Hc("data",e)&&Array.isArray(e.data)&&e.data.every(A=>!Number.isNaN(parseInt(A))),hB=p.object({deviceId:p.string(),encryptionKey:p.string().length(44).base64()});n();s();n();s();var Vj="/seedless",EI="https://phantom-wallet.zendesk.com/hc/en-us/articles/32775281256851";var FB="/seedless";n();s();var xo=class extends Error{reasonString;reasonCode;constructor(A){super("Failed to backup share from Juicebox"),this.reasonCode=A,this.reasonString=eu[A]}},To=class extends Error{guessesRemaining;reasonString;reasonCode;constructor(A,j){super("Failed to recover share from Juicebox"),this.guessesRemaining=j,this.reasonCode=A,this.reasonString=Kt[A]}},ls=class extends Error{reasonString;reasonCode;constructor(A){super("Failed to delete share from Juicebox"),this.reasonCode=A,this.reasonString=SB[A]}},eu=(r=>(r[r.InvalidAuth=0]="InvalidAuth",r[r.UpgradeRequired=1]="UpgradeRequired",r[r.Assertion=2]="Assertion",r[r.Transient=3]="Transient",r))(eu||{}),Kt=(a=>(a[a.InvalidPin=0]="InvalidPin",a[a.NotRegistered=1]="NotRegistered",a[a.InvalidAuth=2]="InvalidAuth",a[a.UpgradeRequired=3]="UpgradeRequired",a[a.Assertion=4]="Assertion",a[a.Transient=5]="Transient",a[a.CooldownTimer=6]="CooldownTimer",a))(Kt||{}),SB=(o=>(o[o.InvalidAuth=0]="InvalidAuth",o[o.UpgradeRequired=1]="UpgradeRequired",o[o.RateLimitExceeded=2]="RateLimitExceeded",o[o.Assertion=3]="Assertion",o[o.Transient=4]="Transient",o))(SB||{}),yI=e=>ds(e)||wB(e)||bB(e),ds=e=>e instanceof To,wB=e=>e instanceof xo,bB=e=>e instanceof ls;globalThis.JuiceboxGetAuthToken=async e=>{let A=Buffer.from(e).toString("hex");return globalThis.JuiceboxTokens[A]};var ju=class{encoder;provider;constructor(A){this.encoder=new TextEncoder,this.provider=A}async getJwts(A){let j=await N.api().bearer(A).post(`${FB}/v1/juiceboxtoken`);(AA(j)||j.status===304)&&this.provider.setJuiceboxTokens(j.data)}async sendJuiceboxShare(A,j,t,r){await this.getJwts(r);try{await this.provider.backupShare(A,j,this.encoder.encode(t),this.encoder.encode("phantom"),7),b.addBreadcrumb("se*dless","Successful backup share to Juicebox","debug")}catch(o){b.addBreadcrumb("se*dless","Failed to backup share to Juicebox","error");let i=new xo(o);throw b.captureError(i,"se*dless"),i}return!0}async getJuiceboxShare(A,j,t){await this.getJwts(t);try{let r=await this.provider.recoverShare(A,this.encoder.encode(j),this.encoder.encode("phantom"));return b.addBreadcrumb("se*dless","Successfully recovered share from Juicebox","debug"),r}catch(r){let o=r.reason,i=r.guessesRemaining!==void 0?r.guessesRemaining:r.guesses_remaining;b.addBreadcrumb("se*dless","Failed to recover share from Juicebox","error");let a=new To(o,i);throw b.captureError(a,"se*dless"),a}}async deleteShare(A,j){await this.getJwts(j);try{await this.provider.deleteShare(A),b.addBreadcrumb("se*dless","Successfully deleted share from Juicebox","debug")}catch(t){b.addBreadcrumb("se*dless","Failed to delete share from Juicebox","error");let r=new ls(t);throw b.captureError(r,"se*dless"),r}}};n();s();n();s();var tu="@phantom/seedless",wr={hasSeedlessBundle:["seedless",`${tu}:has_seedless_bundle`],needsBundleUpdate:["seedless",`${tu}:needs_bundle_update`],timeLeftCooldown:["seedless",`${tu}:time_left_cooldown`]};function ru({enabled:e=!0}={}){let A=wr.hasSeedlessBundle,j=WA(),t=Zi();return X({enabled:t&&e,queryKey:A,queryFn:async()=>await j.hasSeedlessBundle()})}n();s();n();s();var Po=async e=>{await e.invalidateQueries({queryKey:wr.hasSeedlessBundle})},Ut=async e=>{await e.invalidateQueries({queryKey:wr.needsBundleUpdate})};function hI(){let e=WA(),A=pA(),j=J();return IA({mutationFn:async({entropy:t,pin:r})=>await e.backup(t,r),onSuccess:async()=>{j.capture("seedlessBackupSuccess"),await Po(A),await Ut(A)},onError:()=>{j.capture("seedlessBackupError")}})}n();s();function ou(){let e=WA(),A=pA(),j=J();return IA({mutationFn:async r=>await e.recover(r),onSuccess:async()=>{j.capture("seedlessRecoverSuccess"),await Ut(A)},onError:()=>{j.capture("seedlessRecoverError")}})}n();s();function IB(){let e=WA(),A=J();return IA({mutationFn:async t=>{await e.verifyPin(t)},onSuccess:()=>{b.addBreadcrumb("se*dless","Successfully verified PIN","info"),A.capture("seedlessVerifyPinSuccess")},onError:()=>{b.addBreadcrumb("se*dless","Failed to verify PIN","error"),A.capture("seedlessVerifyPinError")}})}n();s();function FI(){let e=WA(),A=pA();return IA({mutationFn:async()=>await e.deleteBundle(),onSuccess:async()=>{await Po(A),await Ut(A)}})}n();s();function $B(){let e=WA(),A=J();return IA({mutationFn:async t=>await e.resetBundleFromDevice(t.pin,t.seedlessEntropies),onSuccess:()=>{b.addBreadcrumb("se*dless","Successfully reset bundle from device","info"),A.capture("seedlessResetPinSuccess")},onError:()=>{b.addBreadcrumb("se*dless","Failed to reset bundle from device","error"),A.capture("seedlessResetPinError")}})}n();s();var SI=1e3,wI=500;function nu(){let e=wr.timeLeftCooldown,A=WA(),j=Zi();return X({enabled:j,queryKey:e,queryFn:async()=>await A.timeLeftCooldown(),refetchInterval:SI,refetchOnMount:"always",staleTime:wI})}n();s();var fa=q(P()),vB=1e3,su=()=>{let[e,A]=(0,fa.useState)(0);return(0,fa.useEffect)(()=>{if(!e)return;let j=setInterval(async()=>{A(e-vB)},vB);return()=>clearInterval(j)},[e]),{cooldownTimer:e,setCooldownTimer:A}};n();s();var qB=q(P());var bI=()=>{let e=pA(),A=WA(),j=Lj(),t=Aa(),r=fo();return(0,qB.useCallback)(async()=>{await j.deleteAllAuthFactors(),await t.patchUserProfile({privacyState:"invisible",addresses:r.reduce((o,i)=>(o[i]="",o),{})}),await A.deleteAllBundles(),await A.deleteJuiceboxShare(),await Po(e),await Ut(e)},[A,j,t,e,r])};n();s();var iu=q(P());var II="seedless-pin-verification-timer-in-ms",$I=p.string().transform(e=>Number(e)).pipe(p.number()).nullish().catch(null),au=()=>{let e=WA(),A=(0,iu.useMemo)(()=>Be.getMultivariateAssignment(II,{dependent_flag:"enable-seedless-pin-verification-interstitial",variation_served:"true"}),[]),j=(0,iu.useMemo)(()=>$I.parse(A)??2592e6,[A]),t=async()=>{let{expired:r,timestampInMs:o}=await e.getPinVerificationTimer({pinVerificationExpiryInMs:j});return{expired:r,timestampInMs:o}};return X({queryKey:["seedlessPinVerificationLockTimerInMs"],queryFn:t,refetchInterval:j??2592e6,staleTime:j??2592e6})};n();s();var ks=()=>{let e=pA(),A=WA();return IA({mutationFn:async()=>{b.addBreadcrumb("se*dless","Resetting PIN verification timer","info"),await A.setPinVerificationTimer(Date.now())},onSuccess:async()=>{b.addBreadcrumb("se*dless","Successfully reset PIN verification timer","info"),await e.invalidateQueries({queryKey:["seedlessPinVerificationLockTimerInMs"]})},onError:()=>{b.addBreadcrumb("se*dless","Failed to reset PIN verification timer","error")}})};n();s();var uu=q(P());n();s();var Ht=e=>{let A=pu(e),j=JSON.stringify(A);return co(Wi(j))};function Bs(e){return/^\d+$/.test(e)}var zj=e=>e.length!==4?!1:Bs(e),pu=e=>{if(Array.isArray(e))return e.map(A=>typeof A=="object"?pu(A):A).sort();if(typeof e=="object"&&e!==null){let A={},j=Object.keys(e).sort();for(let t of j)A[t]=pu(e[t]);return A}else return e},cu=e=>{let A=Math.max(0,Math.floor(e/1e3)),j=Math.floor(A/60).toString(),t=A%60>9?`${A%60}`:`0${A%60}`;return{minutes:j,seconds:t}};n();s();var lu=q(P());n();s();var Qt=q(P());n();s();var Go=class extends Error{result;constructor(A){super(`Unable to recover seedless bundle: ${A.type}`),this.result=A}},ga=class extends Error{result;constructor(A){super(`Unable to backup seedless bundle: ${A.type}`),this.result=A}},Co=e=>e instanceof Go,vI=e=>Co(e)&&e.result.type==="unauthorized",du=e=>Co(e)&&e.result.type==="error-juicebox-recover"&&e.result.reason===0,mu=e=>Co(e)&&e.result.type==="cooldown",ku=e=>Co(e)&&e.result.type==="upgrade-required",Bu=e=>Co(e)&&e.result.type==="error-juicebox-recover"&&e.result.reason===1;var qI=({hasEnrolledAuthentication:e,onOnboardingDone:A,onOnboardingProtect:j,onImportAndSyncAccounts:t,onForgot:r,onNotRegisteredError:o})=>{let{t:i}=hA(),a=J(),{refetch:u}=nu(),{mutateAsync:c}=ks(),{mutateAsync:l}=ou(),m=CA("enable-cleanup-on-not-registered-error"),[B,k]=(0,Qt.useState)(!1),[f,g]=(0,Qt.useState)({isInvalidPin:!1,triesLeft:void 0,pin:""}),[E,h]=(0,Qt.useState)(!1),{cooldownTimer:y,setCooldownTimer:F}=su(),{minutes:S,seconds:x}=cu(y),[O,v]=(0,Qt.useState)(null);return(0,Qt.useEffect)(()=>{!f.triesLeft||f.triesLeft>0||r()},[f.triesLeft,r]),(0,Qt.useEffect)(()=>{(async()=>{let{data:_=0}=await u();return _})().then(_=>F(_))},[]),{isLoading:E,isError:B,handleInput:C=>{g(_=>({..._,isInvalidPin:C!==""&&!Bs(C),pin:C}))},onSubmit:async()=>{if(!E){if(!zj(f.pin)){g(C=>({...C,isInvalidPin:!0,triesLeft:void 0,pin:""}));return}try{h(!0),k(!1),g(_=>({..._,isInvalidPin:!1,triesLeft:void 0}));let{entropy:C}=await l(f.pin);await t(C),await c(),a.capture("seedlessEnterPinContinue"),!e&&A?A():j?.()}catch(C){if(du(C)||mu(C)){let _;if("guessesRemaining"in C.result&&(_=C.result.guessesRemaining),_===0){g(L=>({...L,isInvalidPin:!0,triesLeft:_,pin:""})),r();return}let V=!1;"reason"in C.result&&C.result.reason===0&&(V=!0);let{data:z=0}=await u();F(z),a.capture("seedlessPinError",{data:{triesLeft:_,cooldownTimer:z}}),g(L=>({...L,isInvalidPin:V,triesLeft:_,pin:""}))}else if(ku(C))k(!0),v({title:i("seedlessRecoverErrorUpgradeRequiredTitle"),description:i("seedlessRecoverErrorUpgradeRequiredDescription")});else if(Bu(C)&&o&&m){b.captureError(C,"se*dless");try{await o(f.pin)}catch(_){b.captureError(_,"se*dless"),k(!0),v({title:i("seedlessEnterPinUnknownErrorPrimaryText"),description:i("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:i("seedlessTryAgain")})}}else b.captureError(C,"se*dless"),k(!0),v({title:i("seedlessEnterPinUnknownErrorPrimaryText"),description:i("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:i("seedlessTryAgain")})}finally{h(!1)}}},onForgot:r,pinAttemptsLeft:f.triesLeft,isPinError:f.isInvalidPin,hasCooldownTimer:y>0,disabled:y>0||f.isInvalidPin||!f.pin||f.pin.length<4,pin:f.pin,continueButtonText:i("seedlessContinueText"),forgotButtonText:i("seedlessVerifyPinForgotButtonText"),attemptsLeftText:i("seedlessEnterPinNumTriesLeft",{numTries:f.triesLeft}),cooldownTimerText:i("seedlessEnterPinCooldown",{minutesLeft:S,secondsLeft:x}),invalidPinText:i("seedlessEnterPinInvalidPinError"),title:i("seedlessEnterPinPrimaryText"),loadingTitle:i("seedlessLoadingWalletPrimaryText"),loadingDescription:i("seedlessLoadingWalletSecondaryText"),errorTitle:O?O.title:i("seedlessLoadingWalletErrorPrimaryText"),errorDescription:O?O.description:i("seedlessErrorSecondaryText"),tryAgainButtonText:O?O.buttonText:i("seedlessTryAgain")}};n();s();n();s();var XN=new Error("timeout while waiting for mutex to become available"),WN=new Error("mutex already locked"),xI=new Error("request for lock canceled"),TI=function(e,A,j,t){function r(o){return o instanceof j?o:new j(function(i){i(o)})}return new(j||(j=Promise))(function(o,i){function a(l){try{c(t.next(l))}catch(m){i(m)}}function u(l){try{c(t.throw(l))}catch(m){i(m)}}function c(l){l.done?o(l.value):r(l.value).then(a,u)}c((t=t.apply(e,A||[])).next())})},fu=class{constructor(A,j=xI){this._value=A,this._cancelError=j,this._weightedQueues=[],this._weightedWaiters=[]}acquire(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);return new Promise((j,t)=>{this._weightedQueues[A-1]||(this._weightedQueues[A-1]=[]),this._weightedQueues[A-1].push({resolve:j,reject:t}),this._dispatch()})}runExclusive(A,j=1){return TI(this,void 0,void 0,function*(){let[t,r]=yield this.acquire(j);try{return yield A(t)}finally{r()}})}waitForUnlock(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);return new Promise(j=>{this._weightedWaiters[A-1]||(this._weightedWaiters[A-1]=[]),this._weightedWaiters[A-1].push(j),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(A){this._value=A,this._dispatch()}release(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);this._value+=A,this._dispatch()}cancel(){this._weightedQueues.forEach(A=>A.forEach(j=>j.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var A;for(let j=this._value;j>0;j--){let t=(A=this._weightedQueues[j-1])===null||A===void 0?void 0:A.shift();if(!t)continue;let r=this._value,o=j;this._value-=j,j=this._value+1,t.resolve([r,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(A){let j=!1;return()=>{j||(j=!0,this.release(A))}}_drainUnlockWaiters(){for(let A=this._value;A>0;A--)this._weightedWaiters[A-1]&&(this._weightedWaiters[A-1].forEach(j=>j()),this._weightedWaiters[A-1]=[])}},PI=function(e,A,j,t){function r(o){return o instanceof j?o:new j(function(i){i(o)})}return new(j||(j=Promise))(function(o,i){function a(l){try{c(t.next(l))}catch(m){i(m)}}function u(l){try{c(t.throw(l))}catch(m){i(m)}}function c(l){l.done?o(l.value):r(l.value).then(a,u)}c((t=t.apply(e,A||[])).next())})},fs=class{constructor(A){this._semaphore=new fu(1,A)}acquire(){return PI(this,void 0,void 0,function*(){let[,A]=yield this._semaphore.acquire();return A})}runExclusive(A){return this._semaphore.runExclusive(()=>A())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};n();s();n();s();var Ee=[];for(let e=0;e<256;++e)Ee.push((e+256).toString(16).slice(1));function xB(e,A=0){return(Ee[e[A+0]]+Ee[e[A+1]]+Ee[e[A+2]]+Ee[e[A+3]]+"-"+Ee[e[A+4]]+Ee[e[A+5]]+"-"+Ee[e[A+6]]+Ee[e[A+7]]+"-"+Ee[e[A+8]]+Ee[e[A+9]]+"-"+Ee[e[A+10]]+Ee[e[A+11]]+Ee[e[A+12]]+Ee[e[A+13]]+Ee[e[A+14]]+Ee[e[A+15]]).toLowerCase()}n();s();var gu,GI=new Uint8Array(16);function Eu(){if(!gu){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");gu=self.crypto.getRandomValues.bind(self.crypto)}return gu(GI)}n();s();n();s();var CI=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),yu={randomUUID:CI};function OI(e,A,j){if(yu.randomUUID&&!A&&!e)return yu.randomUUID();e=e||{};let t=e.random??e.rng?.()??Eu();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){if(j=j||0,j<0||j+16>A.length)throw new RangeError(`UUID byte range ${j}:${j+15} is out of buffer bounds`);for(let r=0;r<16;++r)A[j+r]=t[r];return A}return xB(t)}var Ea=OI;n();s();async function TB(e,A,j){let t=await e.decryptionKeySharePhantom.foldAsync(async c=>Buffer.from(new Uint8Array(c)).toString("base64")),r=Buffer.from(e.encryptedAccounts,"hex").toString("base64"),o=Buffer.from(e.encryptionKey,"hex").toString("base64"),i={ciphertext:r,encryptionKey:o,share:t,externalId:A,mode:"JUICEBOX"},a=await N.api().bearer(j).headers({"Content-Type":"application/json"}).post(`${Vj}/v1/bundles`,i),u=AA(a);return u||b.addBreadcrumb("se*dless","Failed to backup bundle to backend","error",{status:a.status,statusText:a.statusText}),u}async function Oo(e,A){let j=await N.api().bearer(A).get(`${Vj}/v1/bundles/${e}?mode=JUICEBOX`);if(j.status===404)throw new Error("bundle not found");if(!AA(j)){b.addBreadcrumb("se*dless","Failed to recover bundle from backend","error",{status:j.status,statusText:j.statusText});let t=new Error("Got invalid response from seedless backend: "+j.statusText);throw b.captureError(t,"se*dless"),t}if(!("share"in j.data)){b.addBreadcrumb("se*dless","No share found in bundle","error");let t=new Error("Did not receive share from seedless backend");throw b.captureError(t,"se*dless"),t}try{let t=$e.from(new Uint8Array(Buffer.from(j.data.share,"base64"))),r=Buffer.from(j.data.ciphertext,"base64").toString("hex"),o=Buffer.from(j.data.encryptionKey,"base64").toString("hex");return{id:j.data.externalId,encryptedAccounts:r,encryptionKey:o,decryptionKeyShare1:t}}catch{throw new Error("Unable to parse bundle. Incorrect format.")}}async function PB(e){let A=await N.api().bearer(e).get(`${Vj}/v1/bundles?mode=JUICEBOX`);if(!AA(A))throw b.addBreadcrumb("se*dless","Failed to recover all seedless bundles","error",{status:A.status,statusText:A.statusText}),new Error("Failed to recover all seedless bundles.");try{if(!Array.isArray(A.data))throw new Error("Seedless bundles are not an array.");return A.data.map(j=>{if(typeof j!="object"||j===null||!("externalId"in j))throw new Error("No externalId found in bundle.");let t=j.externalId;if(typeof t!="string")throw new Error("External ID is not a string.");return{id:t}})}catch{throw new Error("Unable to parse seedless bundles. Incorrect format.")}}async function ya(e,A){let j=await N.api().bearer(A).get(`${Vj}/v1/bundles/${e}?mode=JUICEBOX&populate=none`);if(b.addBreadcrumb("se*dless","Checking if user has a se*dless bundle","info"),AA(j))return b.addBreadcrumb("se*dless","A se*dless bundle has been found for this user","info",{status:j.status,statusText:j.statusText}),!0;if(j.status===404)return b.addBreadcrumb("se*dless","No se*dless bundle found for user","info",{status:j.status,statusText:j.statusText}),!1;let t=new Error("Failed to check for se*dless bundle.");throw b.captureError(t,"se*dless"),t}async function ha(e,A){let j=await N.api().bearer(A).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${Vj}/v1/bundles/${e}`,{mode:"JUICEBOX"});if(b.addBreadcrumb("se*dless",`Deleting se*dless bundle: ${e}`,"info"),AA(j))return b.addBreadcrumb("se*dless","A se*dless bundle has been deleted for this user","info",{status:j.status,statusText:j.statusText}),!0;if(j.status===404)return b.addBreadcrumb("se*dless","No se*dless bundle found for user","info",{status:j.status,statusText:j.statusText}),!1;let t=new Error("Failed to delete se*dless bundle.");throw b.captureError(t,"se*dless"),t}async function GB(e){let A=await N.api().bearer(e).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${Vj}/v1/bundles`,{mode:"JUICEBOX"});if(b.addBreadcrumb("se*dless","Deleting se*dless bundle","info"),AA(A))return b.addBreadcrumb("se*dless","All se*dless bundles, if they exist, have been deleted for this user","info",{status:A.status,statusText:A.statusText,data:A.data}),!0;let j=new Error("Failed to delete all se*dless bundles.");throw b.captureError(j,"se*dless"),j}async function hu(e,A){let j=await N.api().bearer(e).get(`${Vj}/v1/device-encryption-keys/${A}`);if(j.status===404)return b.addBreadcrumb("se*dless","No device encryption key found for user","info"),null;if(!AA(j))throw new Error("Unable to get device encryption key.");try{let{encryptionKey:t}=hB.parse(j.data);return $e.from(new Uint8Array(Buffer.from(t,"base64")))}catch{throw new Error("Unable to parse device encryption key from response.")}}async function CB(e,A,j){let t=await N.api().bearer(e).post(`${Vj}/v1/device-encryption-keys`,{deviceId:A,encryptionKey:j.fold(r=>Buffer.from(r).toString("base64"))});if(!AA(t))throw new Error("Unable to set device encryption key.")}async function OB(e,A){let j=await N.api().bearer(e).delete(`${Vj}/v1/device-encryption-keys/${A}`);if(!AA(j))throw new Error("Unable to delete device encryption key.")}n();s();n();s();n();s();n();s();n();s();function Mo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Fu(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Su(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function te(e,...A){if(!Su(e))throw new Error("Uint8Array expected");if(A.length>0&&!A.includes(e.length))throw new Error(`Uint8Array expected of length ${A}, not of length=${e.length}`)}function wu(e,A=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(A&&e.finished)throw new Error("Hash#digest() has already been called")}function MB(e,A){te(e);let j=A.outputLen;if(e.length<j)throw new Error(`digestInto() expects output buffer of length at least ${j}`)}var mt=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),RB=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),MI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!MI)throw new Error("Non little-endian hardware is not supported");function bu(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Fa(e){if(typeof e=="string")e=bu(e);else if(Su(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function _B(...e){let A=0;for(let t=0;t<e.length;t++){let r=e[t];te(r),A+=r.length}let j=new Uint8Array(A);for(let t=0,r=0;t<e.length;t++){let o=e[t];j.set(o,r),r+=o.length}return j}function DB(e,A){if(A==null||typeof A!="object")throw new Error("options must be defined");return Object.assign(e,A)}function NB(e,A){if(e.length!==A.length)return!1;let j=0;for(let t=0;t<e.length;t++)j|=e[t]^A[t];return j===0}var Iu=(e,A)=>(Object.assign(A,e),A);function $u(e,A,j,t){if(typeof e.setBigUint64=="function")return e.setBigUint64(A,j,t);let r=BigInt(32),o=BigInt(4294967295),i=Number(j>>r&o),a=Number(j&o),u=t?4:0,c=t?0:4;e.setUint32(A+u,i,t),e.setUint32(A+c,a,t)}n();s();var ye=(e,A)=>e[A++]&255|(e[A++]&255)<<8,vu=class{constructor(A){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,A=Fa(A),te(A,32);let j=ye(A,0),t=ye(A,2),r=ye(A,4),o=ye(A,6),i=ye(A,8),a=ye(A,10),u=ye(A,12),c=ye(A,14);this.r[0]=j&8191,this.r[1]=(j>>>13|t<<3)&8191,this.r[2]=(t>>>10|r<<6)&7939,this.r[3]=(r>>>7|o<<9)&8191,this.r[4]=(o>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|u<<5)&8065,this.r[8]=(u>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ye(A,16+2*l)}process(A,j,t=!1){let r=t?0:2048,{h:o,r:i}=this,a=i[0],u=i[1],c=i[2],l=i[3],m=i[4],B=i[5],k=i[6],f=i[7],g=i[8],E=i[9],h=ye(A,j+0),y=ye(A,j+2),F=ye(A,j+4),S=ye(A,j+6),x=ye(A,j+8),O=ye(A,j+10),v=ye(A,j+12),D=ye(A,j+14),G=o[0]+(h&8191),C=o[1]+((h>>>13|y<<3)&8191),_=o[2]+((y>>>10|F<<6)&8191),V=o[3]+((F>>>7|S<<9)&8191),z=o[4]+((S>>>4|x<<12)&8191),L=o[5]+(x>>>1&8191),R=o[6]+((x>>>14|O<<2)&8191),W=o[7]+((O>>>11|v<<5)&8191),Q=o[8]+((v>>>8|D<<8)&8191),jA=o[9]+(D>>>5|r),Z=0,mA=Z+G*a+C*(5*E)+_*(5*g)+V*(5*f)+z*(5*k);Z=mA>>>13,mA&=8191,mA+=L*(5*B)+R*(5*m)+W*(5*l)+Q*(5*c)+jA*(5*u),Z+=mA>>>13,mA&=8191;let cA=Z+G*u+C*a+_*(5*E)+V*(5*g)+z*(5*f);Z=cA>>>13,cA&=8191,cA+=L*(5*k)+R*(5*B)+W*(5*m)+Q*(5*l)+jA*(5*c),Z+=cA>>>13,cA&=8191;let rA=Z+G*c+C*u+_*a+V*(5*E)+z*(5*g);Z=rA>>>13,rA&=8191,rA+=L*(5*f)+R*(5*k)+W*(5*B)+Q*(5*m)+jA*(5*l),Z+=rA>>>13,rA&=8191;let Y=Z+G*l+C*c+_*u+V*a+z*(5*E);Z=Y>>>13,Y&=8191,Y+=L*(5*g)+R*(5*f)+W*(5*k)+Q*(5*B)+jA*(5*m),Z+=Y>>>13,Y&=8191;let sA=Z+G*m+C*l+_*c+V*u+z*a;Z=sA>>>13,sA&=8191,sA+=L*(5*E)+R*(5*g)+W*(5*f)+Q*(5*k)+jA*(5*B),Z+=sA>>>13,sA&=8191;let EA=Z+G*B+C*m+_*l+V*c+z*u;Z=EA>>>13,EA&=8191,EA+=L*a+R*(5*E)+W*(5*g)+Q*(5*f)+jA*(5*k),Z+=EA>>>13,EA&=8191;let lA=Z+G*k+C*B+_*m+V*l+z*c;Z=lA>>>13,lA&=8191,lA+=L*u+R*a+W*(5*E)+Q*(5*g)+jA*(5*f),Z+=lA>>>13,lA&=8191;let QA=Z+G*f+C*k+_*B+V*m+z*l;Z=QA>>>13,QA&=8191,QA+=L*c+R*u+W*a+Q*(5*E)+jA*(5*g),Z+=QA>>>13,QA&=8191;let pe=Z+G*g+C*f+_*k+V*B+z*m;Z=pe>>>13,pe&=8191,pe+=L*l+R*c+W*u+Q*a+jA*(5*E),Z+=pe>>>13,pe&=8191;let ce=Z+G*E+C*g+_*f+V*k+z*B;Z=ce>>>13,ce&=8191,ce+=L*m+R*l+W*c+Q*u+jA*a,Z+=ce>>>13,ce&=8191,Z=(Z<<2)+Z|0,Z=Z+mA|0,mA=Z&8191,Z=Z>>>13,cA+=Z,o[0]=mA,o[1]=cA,o[2]=rA,o[3]=Y,o[4]=sA,o[5]=EA,o[6]=lA,o[7]=QA,o[8]=pe,o[9]=ce}finalize(){let{h:A,pad:j}=this,t=new Uint16Array(10),r=A[1]>>>13;A[1]&=8191;for(let a=2;a<10;a++)A[a]+=r,r=A[a]>>>13,A[a]&=8191;A[0]+=r*5,r=A[0]>>>13,A[0]&=8191,A[1]+=r,r=A[1]>>>13,A[1]&=8191,A[2]+=r,t[0]=A[0]+5,r=t[0]>>>13,t[0]&=8191;for(let a=1;a<10;a++)t[a]=A[a]+r,r=t[a]>>>13,t[a]&=8191;t[9]-=8192;let o=(r^1)-1;for(let a=0;a<10;a++)t[a]&=o;o=~o;for(let a=0;a<10;a++)A[a]=A[a]&o|t[a];A[0]=(A[0]|A[1]<<13)&65535,A[1]=(A[1]>>>3|A[2]<<10)&65535,A[2]=(A[2]>>>6|A[3]<<7)&65535,A[3]=(A[3]>>>9|A[4]<<4)&65535,A[4]=(A[4]>>>12|A[5]<<1|A[6]<<14)&65535,A[5]=(A[6]>>>2|A[7]<<11)&65535,A[6]=(A[7]>>>5|A[8]<<8)&65535,A[7]=(A[8]>>>8|A[9]<<5)&65535;let i=A[0]+j[0];A[0]=i&65535;for(let a=1;a<8;a++)i=(A[a]+j[a]|0)+(i>>>16)|0,A[a]=i&65535}update(A){wu(this);let{buffer:j,blockLen:t}=this;A=Fa(A);let r=A.length;for(let o=0;o<r;){let i=Math.min(t-this.pos,r-o);if(i===t){for(;t<=r-o;o+=t)this.process(A,o);continue}j.set(A.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===t&&(this.process(j,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(A){wu(this),MB(A,this),this.finished=!0;let{buffer:j,h:t}=this,{pos:r}=this;if(r){for(j[r++]=1;r<16;r++)j[r]=0;this.process(j,0,!0)}this.finalize();let o=0;for(let i=0;i<8;i++)A[o++]=t[i]>>>0,A[o++]=t[i]>>>8;return A}digest(){let{buffer:A,outputLen:j}=this;this.digestInto(A);let t=A.slice(0,j);return this.destroy(),t}};function RI(e){let A=(t,r)=>e(r).update(Fa(t)).digest(),j=e(new Uint8Array(32));return A.outputLen=j.outputLen,A.blockLen=j.blockLen,A.create=t=>e(t),A}var LB=RI(e=>new vu(e));n();s();var UB=e=>Uint8Array.from(e.split("").map(A=>A.charCodeAt(0))),_I=UB("expand 16-byte k"),DI=UB("expand 32-byte k"),NI=mt(_I),HB=mt(DI),NL=HB.slice();function eA(e,A){return e<<A|e>>>32-A}function qu(e){return e.byteOffset%4===0}var Sa=64,LI=16,QB=2**32-1,KB=new Uint32Array;function KI(e,A,j,t,r,o,i,a){let u=r.length,c=new Uint8Array(Sa),l=mt(c),m=qu(r)&&qu(o),B=m?mt(r):KB,k=m?mt(o):KB;for(let f=0;f<u;i++){if(e(A,j,t,l,i,a),i>=QB)throw new Error("arx: counter overflow");let g=Math.min(Sa,u-f);if(m&&g===Sa){let E=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let h=0,y;h<LI;h++)y=E+h,k[y]=B[y]^l[h];f+=Sa;continue}for(let E=0,h;E<g;E++)h=f+E,o[h]=r[h]^c[E];f+=g}}function xu(e,A){let{allowShortKeys:j,extendNonceFn:t,counterLength:r,counterRight:o,rounds:i}=DB({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},A);if(typeof e!="function")throw new Error("core must be a function");return Mo(r),Mo(i),Fu(o),Fu(j),(a,u,c,l,m=0)=>{te(a),te(u),te(c);let B=c.length;if(l||(l=new Uint8Array(B)),te(l),Mo(m),m<0||m>=QB)throw new Error("arx: counter overflow");if(l.length<B)throw new Error(`arx: output (${l.length}) is shorter than data (${B})`);let k=[],f=a.length,g,E;if(f===32)g=a.slice(),k.push(g),E=HB;else if(f===16&&j)g=new Uint8Array(32),g.set(a),g.set(a,16),E=NI,k.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);qu(u)||(u=u.slice(),k.push(u));let h=mt(g);if(t){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(E,h,mt(u.subarray(0,16)),h),u=u.subarray(16)}let y=16-r;if(y!==u.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){let S=new Uint8Array(12);S.set(u,o?0:12-u.length),u=S,k.push(u)}let F=mt(u);for(KI(e,E,h,F,c,l,m,i);k.length>0;)k.pop().fill(0);return l}}function XB(e,A,j,t,r,o=20){let i=e[0],a=e[1],u=e[2],c=e[3],l=A[0],m=A[1],B=A[2],k=A[3],f=A[4],g=A[5],E=A[6],h=A[7],y=r,F=j[0],S=j[1],x=j[2],O=i,v=a,D=u,G=c,C=l,_=m,V=B,z=k,L=f,R=g,W=E,Q=h,jA=y,Z=F,mA=S,cA=x;for(let Y=0;Y<o;Y+=2)O=O+C|0,jA=eA(jA^O,16),L=L+jA|0,C=eA(C^L,12),O=O+C|0,jA=eA(jA^O,8),L=L+jA|0,C=eA(C^L,7),v=v+_|0,Z=eA(Z^v,16),R=R+Z|0,_=eA(_^R,12),v=v+_|0,Z=eA(Z^v,8),R=R+Z|0,_=eA(_^R,7),D=D+V|0,mA=eA(mA^D,16),W=W+mA|0,V=eA(V^W,12),D=D+V|0,mA=eA(mA^D,8),W=W+mA|0,V=eA(V^W,7),G=G+z|0,cA=eA(cA^G,16),Q=Q+cA|0,z=eA(z^Q,12),G=G+z|0,cA=eA(cA^G,8),Q=Q+cA|0,z=eA(z^Q,7),O=O+_|0,cA=eA(cA^O,16),W=W+cA|0,_=eA(_^W,12),O=O+_|0,cA=eA(cA^O,8),W=W+cA|0,_=eA(_^W,7),v=v+V|0,jA=eA(jA^v,16),Q=Q+jA|0,V=eA(V^Q,12),v=v+V|0,jA=eA(jA^v,8),Q=Q+jA|0,V=eA(V^Q,7),D=D+z|0,Z=eA(Z^D,16),L=L+Z|0,z=eA(z^L,12),D=D+z|0,Z=eA(Z^D,8),L=L+Z|0,z=eA(z^L,7),G=G+C|0,mA=eA(mA^G,16),R=R+mA|0,C=eA(C^R,12),G=G+C|0,mA=eA(mA^G,8),R=R+mA|0,C=eA(C^R,7);let rA=0;t[rA++]=i+O|0,t[rA++]=a+v|0,t[rA++]=u+D|0,t[rA++]=c+G|0,t[rA++]=l+C|0,t[rA++]=m+_|0,t[rA++]=B+V|0,t[rA++]=k+z|0,t[rA++]=f+L|0,t[rA++]=g+R|0,t[rA++]=E+W|0,t[rA++]=h+Q|0,t[rA++]=y+jA|0,t[rA++]=F+Z|0,t[rA++]=S+mA|0,t[rA++]=x+cA|0}function UI(e,A,j,t){let r=e[0],o=e[1],i=e[2],a=e[3],u=A[0],c=A[1],l=A[2],m=A[3],B=A[4],k=A[5],f=A[6],g=A[7],E=j[0],h=j[1],y=j[2],F=j[3];for(let x=0;x<20;x+=2)r=r+u|0,E=eA(E^r,16),B=B+E|0,u=eA(u^B,12),r=r+u|0,E=eA(E^r,8),B=B+E|0,u=eA(u^B,7),o=o+c|0,h=eA(h^o,16),k=k+h|0,c=eA(c^k,12),o=o+c|0,h=eA(h^o,8),k=k+h|0,c=eA(c^k,7),i=i+l|0,y=eA(y^i,16),f=f+y|0,l=eA(l^f,12),i=i+l|0,y=eA(y^i,8),f=f+y|0,l=eA(l^f,7),a=a+m|0,F=eA(F^a,16),g=g+F|0,m=eA(m^g,12),a=a+m|0,F=eA(F^a,8),g=g+F|0,m=eA(m^g,7),r=r+c|0,F=eA(F^r,16),f=f+F|0,c=eA(c^f,12),r=r+c|0,F=eA(F^r,8),f=f+F|0,c=eA(c^f,7),o=o+l|0,E=eA(E^o,16),g=g+E|0,l=eA(l^g,12),o=o+l|0,E=eA(E^o,8),g=g+E|0,l=eA(l^g,7),i=i+m|0,h=eA(h^i,16),B=B+h|0,m=eA(m^B,12),i=i+m|0,h=eA(h^i,8),B=B+h|0,m=eA(m^B,7),a=a+u|0,y=eA(y^a,16),k=k+y|0,u=eA(u^k,12),a=a+u|0,y=eA(y^a,8),k=k+y|0,u=eA(u^k,7);let S=0;t[S++]=r,t[S++]=o,t[S++]=i,t[S++]=a,t[S++]=E,t[S++]=h,t[S++]=y,t[S++]=F}var HI=xu(XB,{counterRight:!1,counterLength:4,allowShortKeys:!1}),QI=xu(XB,{counterRight:!1,counterLength:8,extendNonceFn:UI,allowShortKeys:!1});var VI=new Uint8Array(16),VB=(e,A)=>{e.update(A);let j=A.length%16;j&&e.update(VI.subarray(j))},zI=new Uint8Array(32);function zB(e,A,j,t,r){let o=e(A,j,zI),i=LB.create(o);r&&VB(i,r),VB(i,t);let a=new Uint8Array(16),u=RB(a);$u(u,0,BigInt(r?r.length:0),!0),$u(u,8,BigInt(t.length),!0),i.update(a);let c=i.digest();return o.fill(0),c}var WB=e=>(A,j,t)=>(te(A,32),te(j),{encrypt:(o,i)=>{let a=o.length,u=a+16;i?te(i,u):i=new Uint8Array(u),e(A,j,o,i,1);let c=zB(e,A,j,i.subarray(0,-16),t);return i.set(c,a),i},decrypt:(o,i)=>{let a=o.length,u=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");i?te(i,u):i=new Uint8Array(u);let c=o.subarray(0,-16),l=o.subarray(-16),m=zB(e,A,j,c,t);if(!NB(l,m))throw new Error("invalid tag");return e(A,j,c,i,1),i}}),XL=Iu({blockSize:64,nonceLength:12,tagLength:16},WB(HI)),Tu=Iu({blockSize:64,nonceLength:24,tagLength:16},WB(QI));n();s();n();s();var br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function JB(e=32){if(br&&typeof br.getRandomValues=="function")return br.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Pu(){if(br&&typeof br.subtle=="object"&&br.subtle!=null)return br.subtle;throw new Error("crypto.subtle must be defined")}function Gu(e){return Mo(e.nonceLength),(A,...j)=>({encrypt:(t,...r)=>{let{nonceLength:o}=e,i=JB(o),a=e(A,i,...j).encrypt(t,...r),u=_B(i,a);return a.fill(0),u},decrypt:(t,...r)=>{let{nonceLength:o}=e,i=t.subarray(0,o),a=t.subarray(o);return e(A,i,...j).decrypt(a,...r)}})}var YB={async encrypt(e,A,j,t){let r=Pu(),o=await r.importKey("raw",e,A,!0,["encrypt"]),i=await r.encrypt(j,o,t);return new Uint8Array(i)},async decrypt(e,A,j,t){let r=Pu(),o=await r.importKey("raw",e,A,!0,["decrypt"]),i=await r.decrypt(j,o,t);return new Uint8Array(i)}},Xj={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function XI(e,A,j){if(e===Xj.CBC)return{name:Xj.CBC,iv:A};if(e===Xj.CTR)return{name:Xj.CTR,counter:A,length:64};if(e===Xj.GCM)return j?{name:Xj.GCM,iv:A,additionalData:j}:{name:Xj.GCM,iv:A};throw new Error("unknown aes block mode")}function Cu(e){return(A,j,t)=>{te(A),te(j);let r={name:e,length:A.length*8},o=XI(e,j,t);return{encrypt(i){return te(i),YB.encrypt(A,r,o,i)},decrypt(i){return te(i),YB.decrypt(A,r,o,i)}}}}var oK=Cu(Xj.CBC),nK=Cu(Xj.CTR),sK=Cu(Xj.GCM);n();s();n();s();function Ou(e){return self.crypto.getRandomValues(new Uint8Array(e))}var ba=new Uint8Array([0,255,200,8,145,16,208,54,90,62,216,67,153,119,254,24,35,32,7,112,161,108,12,127,98,139,64,70,199,75,224,14,235,22,232,173,207,205,57,83,106,39,53,147,212,78,72,195,43,121,84,40,9,120,15,33,144,135,20,42,169,156,214,116,180,124,222,237,177,134,118,164,152,226,150,143,2,50,28,193,51,238,239,129,253,48,92,19,157,41,23,196,17,68,140,128,243,115,66,30,29,181,240,18,209,91,65,162,215,44,233,213,89,203,80,168,220,252,242,86,114,166,101,47,159,155,61,186,125,194,69,130,167,87,182,163,122,117,79,174,63,55,109,71,97,190,171,211,95,176,88,175,202,94,250,133,228,77,138,5,251,96,183,123,184,38,74,103,198,26,248,105,37,179,219,189,102,221,241,210,223,3,141,52,217,146,13,99,85,170,73,236,188,149,60,132,11,245,230,231,229,172,126,110,185,249,218,142,154,201,36,225,10,21,107,58,160,81,244,234,178,151,158,93,34,136,148,206,25,1,113,76,165,227,197,49,187,204,31,45,59,82,111,246,46,137,247,192,104,27,100,4,6,191,131,56]),ZB=new Uint8Array([1,229,76,181,251,159,252,18,3,52,212,196,22,186,31,54,5,92,103,87,58,213,33,90,15,228,169,249,78,100,99,238,17,55,224,16,210,172,165,41,51,89,59,48,109,239,244,123,85,235,77,80,183,42,7,141,255,38,215,240,194,126,9,140,26,106,98,11,93,130,27,143,46,190,166,29,231,157,45,138,114,217,241,39,50,188,119,133,150,112,8,105,86,223,153,148,161,144,24,187,250,122,176,167,248,171,40,214,21,142,203,242,19,230,120,97,63,137,70,13,53,49,136,163,65,128,202,23,95,83,131,254,195,155,69,57,225,245,158,25,94,182,207,75,56,4,185,43,226,193,74,221,72,12,208,125,61,88,222,124,216,20,107,135,71,232,121,132,115,60,189,146,201,35,139,151,149,68,220,173,64,101,134,162,164,204,127,236,192,175,145,253,247,79,129,47,91,234,168,28,2,209,152,113,237,37,227,36,6,104,179,147,44,111,62,108,10,184,206,174,116,177,66,180,30,211,73,233,156,200,198,199,34,110,219,32,191,67,81,82,102,178,118,96,218,197,243,246,170,205,154,160,117,84,14,1]);function wa(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");return e^A}function WI(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(A===0)throw new Error("cannot divide by zero");let j=ba[e],t=ba[A],r=(j-t+255)%255,o=ZB[r];return e===0?0:o}function Mu(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");let j=ba[e],t=ba[A],r=(j+t)%255,o=ZB[r];return e===0||A===0?0:o}function JI(e,A,j){if(e.length!==A.length)throw new Error("sample length mistmatch");let t=e.length,r=0,o=0;for(let i=0;i<t;i++){r=1;for(let a=0;a<t;++a){if(i===a)continue;let u=wa(j,e[a]),c=wa(e[i],e[a]),l=WI(u,c);r=Mu(r,l)}o=wa(o,Mu(A[i],r))}return o}function YI(e,A,j){if(A===0)throw new Error("cannot evaluate secret polynomial at zero");let t=e[j];for(let r=j-1;r>=0;r--){let o=e[r];t=wa(Mu(t,A),o)}return t}function Af(){return Ou(1)[0]}function ZI(){for(;;){let e=Af();if(e>0)return e}}function A$(e,A){let j=new Uint8Array(A+1);j[0]=e;for(let t=1;t<=A;t++){let r=t===A;j[t]=r?ZI():Af()}return j}function e$(){let e=new Uint8Array(255);for(let j=0;j<255;j++)e[j]=j+1;let A=Ou(255);for(let j=0;j<255;j++){let t=A[j]%255,r=e[j];e[j]=e[t],e[t]=r}return e}var Je={instanceOf(e,A,j){if(e.constructor!==A)throw new TypeError(j)},inRange(e,A,j,t){if(!(A<j&&e>=A&&e<j))throw new RangeError(t)},greaterThanOrEqualTo(e,A,j){if(e<A)throw new Error(j)},equalTo(e,A,j){if(e!==A)throw new Error(j)}};async function ef(e,A,j){Je.instanceOf(e,Uint8Array,"secret must be a Uint8Array"),Je.greaterThanOrEqualTo(e.byteLength,1,"secret cannot be empty"),Je.instanceOf(A,Number,"shares must be a number"),Je.inRange(A,2,256,"shares must be at least 2 and at most 255"),Je.instanceOf(j,Number,"threshold must be a number"),Je.inRange(j,2,256,"threshold must be at least 2 and at most 255"),Je.greaterThanOrEqualTo(A,j,"shares cannot be less than threshold");let t=[],r=e.byteLength,o=e$();for(let a=0;a<A;a++){let u=new Uint8Array(r+1);u[r]=o[a],t.push(u)}let i=j-1;for(let a=0;a<r;a++){let u=e[a],c=A$(u,i);for(let l=0;l<A;++l){let m=o[l],B=YI(c,m,i);t[l][a]=B}}return t}async function jf(e){Je.instanceOf(e,Array,"shares must be an Array"),Je.inRange(e.length,2,256,"shares must have at least 2 and at most 255 elements");let A=e[0];Je.instanceOf(A,Uint8Array,"each share must be a Uint8Array");for(let c of e)Je.instanceOf(c,Uint8Array,"each share must be a Uint8Array"),Je.greaterThanOrEqualTo(c.byteLength,2,"each share must be at least 2 bytes"),Je.equalTo(c.byteLength,A.byteLength,"all shares must have the same byte length");let j=e.length,t=A.byteLength,r=t-1,o=new Uint8Array(r),i=new Uint8Array(j),a=new Uint8Array(j),u=new Set;for(let c=0;c<j;c++){let m=e[c][t-1];if(u.has(m))throw new Error("shares must contain unique values but a duplicate was found");u.add(m),i[c]=m}for(let c=0;c<r;c++){for(let l=0;l<j;++l)a[l]=e[l][c];o[c]=JI(i,a,0)}return o}var tf=async(e,A)=>{if(e.length!==32)throw new Error("encryption key must be 32 bytes");t$(e);let j={seeds:[]};for(let c of A){let l="unused",m=c.fold(B=>new Uint8Array(B));j.seeds.push([l,m])}let t=Gu(Tu)(e),r=bu(JSON.stringify(j)),o=t.encrypt(r),[i,a]=await ef(e,2,2);return{encryptedAccounts:co(o),decryptionKeySharePhantom:$e.from(i),decryptionKeyShareExternal:$e.from(a),encryptionKey:"unused"}},Vt=class extends Error{reason;constructor(A){super(`Unable to decrypt seedless bundle: ${A}`),this.reason=A}},Ia=async e=>{let A;try{A=await j$(e.decryptionKeySharePhantom,e.decryptionKeyShareExternal)}catch{throw new Vt("incompatible-shares")}let j;try{j=Gu(Tu)(A).decrypt(Qm(e.encryptedAccounts))}catch{throw new Vt("incorrect-decryption-key")}let t;try{t=JSON.parse(Buffer.from(j).toString())}catch{throw new Vt("invalid-json")}let r=EB.safeParse(t);if(!r.success)throw new Vt("invalid-format");return r.data.seeds.map(a=>{let u=a[1],c=yB(u);return $e.from(c)})},j$=async(e,A)=>{let j=e.fold(o=>new Uint8Array(o)),t=A.fold(o=>new Uint8Array(o));return await jf([j,t])},t$=e=>{if(e.every(A=>A===0))throw new Error("encryption key must not be all zeros")};n();s();var rf={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var of={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var nf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var sf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev/"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var af={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f76005fd-80e5-483e-9d84-c09ef7c60ba3",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var pf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"153ebe7b-400c-4d27-be76-139248bb3acd",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var cf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f577175c-3f1e-4f4a-91d1-cb30aaa0d5d4",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var uf=[rf,of],c$=uf.reduce((e,A)=>(e[Ht(A)]=A,e),{}),lf=[nf,sf,af,pf,cf],u$=lf.reduce((e,A)=>(e[Ht(A)]=A,e),{});function $a(){return Lc()?c$:u$}function Ir(){let e=Lc()?uf:lf;return e[e.length-1]}var xj={success:{type:"success",didBackup:!0},unauthorized:{type:"unauthorized",didBackup:!1},bundleAlreadyExists:{type:"bundle-already-exists",didBackup:!1},errorBackendCheck:{type:"error-backend-check",didBackup:!1},invalidPin:{type:"invalid-pin-format",didBackup:!1},errorEncryptionFailed:{type:"error-encryption-failed",didBackup:!1},errorBackendUpload:{type:"error-backend-upload",didBackup:!1},errorJuiceboxUpload:{type:"error-juicebox-upload",didBackup:!1},recoveredFromJuiceboxError:{type:"recovered-juicebox-error",didBackup:!1},errorBackendDelete:{type:"error-backend-delete",didBackup:!1}},Ro=async(e,{pin:A,entropy:j})=>{if(!zj(A))return xj.invalidPin;let t;try{if(t=await e.authRepository.getUser(),!t)return xj.unauthorized}catch{return xj.unauthorized}let r=Ir(),o=Ht(r);try{if(await ya(o,t.accessToken))return xj.bundleAlreadyExists}catch{return xj.errorBackendCheck}let i;try{let l=zi(32);i=await tf(l,[j])}catch{return xj.errorEncryptionFailed}try{if(!await TB(i,o,t.accessToken))return xj.errorBackendUpload}catch{return xj.errorBackendUpload}let a=i.decryptionKeyShareExternal.fold(l=>new Uint8Array(l)),u=await e.juiceboxClient(),c=!0;try{c=await u.sendJuiceboxShare(Ir(),a,A,t.accessToken)}catch{c=!1}if(!c)try{return await ha(o,t.accessToken),xj.recoveredFromJuiceboxError}catch{return xj.errorBackendDelete}return xj.success};n();s();var mf="seedlessJuiceboxPinCooldownTimer",Ru=".phantom.seedless.juiceboxPinCooldownTimer",gs=async e=>{let A=await e.get(mf),j=await e.get(Ru),t=j?.timeRemaining||A,r=j?.guessesRemaining;return!t||t<0?{timeRemaining:0,guessesRemaining:r}:{timeRemaining:t-Date.now(),guessesRemaining:r}},kf=async(e,A)=>{let j=d$(e);if(!j)return;let t=Date.now()+j*1e3;A.set(Ru,{version:2,timeRemaining:t,guessesRemaining:e})},Bf=async e=>{await e.remove(mf),await e.remove(Ru)},d$=e=>m$[e],m$={[7]:0,[6]:0,[5]:30,[4]:60,[3]:120,[2]:300,[1]:300};n();s();n();s();var ff=async(e,A,j)=>{let t=[];try{t=await PB(e)}catch{return{status:"error-fetch-all-seedless-bundles"}}let r=t.filter(o=>o.id!==j).map(o=>o.id);if(r.length===0)return{status:"no-other-bundles-found"};for(let o of r)try{let i=await Oo(o,e),a=await Ia({encryptedAccounts:i.encryptedAccounts,encryptionKey:i.encryptionKey,decryptionKeySharePhantom:i.decryptionKeyShare1,decryptionKeyShareExternal:$e.from(A)});if(a.length===0)continue;return{status:"found-valid-bundle",entropies:a}}catch{continue}return{status:"error-no-decryptable-accounts"}};var k$=e=>{let A="unknown";return e instanceof Error&&(e.message.includes("bundle not found")?A="bundle-not-found":e.message.includes("Got invalid response from seedless backend")?A="non-ok-response":e.message.includes("Did not receive share from seedless backend")?A="no-share-in-bundle":e.message.includes("Unable to parse bundle. Incorrect format.")&&(A="incorrect-format")),{type:"error-backend-recover",reason:A}},Ef=async(e,A,{pin:j,ignoreCooldown:t=!1})=>{let{authRepository:r,juiceboxClient:o,storage:i}=e,{timeRemaining:a,guessesRemaining:u}=await gs(i);if(a>0&&!t)return{type:"cooldown",timeRemaining:a,guessesRemaining:u};if(!zj(j))return{type:"invalid-pin-format"};let c=await r.getUser();if(!c)return{type:"unauthorized"};let{accessToken:l}=c,m;try{m=await Oo("latest",l)}catch(y){return k$(y)}let B=$a()[m.id];if(!B)return{type:"upgrade-required"};let k=await o(),f;try{f=new Uint8Array(await k.getJuiceboxShare(B,j,l)),await Bf(i)}catch(y){let F=y?.reasonCode,S=y?.guessesRemaining;if(ds(y))if(!t&&S&&S<=5){await kf(S,i);let{timeRemaining:O}=await gs(i);return{type:"cooldown",timeRemaining:O,guessesRemaining:S}}else return{type:"error-juicebox-recover",reason:F,guessesRemaining:S};else return{type:"error-juicebox-recover",reason:F||"unknown"}}if(f.every(y=>y===0))return{type:"error-juicebox-share-zero"};let E;try{E=await Ia({encryptedAccounts:m.encryptedAccounts,encryptionKey:m.encryptionKey,decryptionKeySharePhantom:m.decryptionKeyShare1,decryptionKeyShareExternal:$e.from(f)})}catch(y){let F;y instanceof Vt?F=y.reason:F="unknown";let S=await ff(l,f,m.id);if(S.status==="found-valid-bundle")b.addBreadcrumb("se*dless","Recovered from older bundle","info"),E=S.entropies;else return S.status==="no-other-bundles-found"?{type:"error-decrypt-accounts",reason:F}:{type:"error-decrypt-accounts",reason:S.status}}if(E.length===0)return{type:"error-no-entropies"};let h=await Ro(e,{entropy:E[0],pin:j});return A.emitRotationResult(h),{type:"success",entropy:E[0]}};n();s();var va=class extends sk{emitRotationResult(A){this.emitEvent("seedlessRotationResult",{type:A.type,didRotate:A.didBackup})}emitRecoverResult(A){let j=A.type,t;"reason"in A&&(typeof A.reason=="string"?t=A.reason:t=Kt[A.reason]),this.emitEvent("seedlessRecoverResult",{type:j,reason:t})}emitBackupResult(A){this.emitEvent("seedlessBackupResult",{type:A.type,didBackup:A.didBackup})}};var g$=e=>{let A=new va,j=new fs,t={backup:(i,a)=>j.runExclusive(async()=>await y$(e,i,a,A)),recover:i=>j.runExclusive(async()=>await yf(e,i,!1,A)),verifyPin:i=>j.runExclusive(async()=>await h$(e,i,!0,A)),resetBundleFromDevice:(i,a)=>j.runExclusive(async()=>await E$(e,i,a))},r=new fs;return{...t,hasSeedlessBundle:i=>S$(e,i),deleteBundle:()=>Du(e,"latest"),deleteAllBundles:()=>Du(e,"all"),deleteJuiceboxShare:()=>w$(e),needsBundleUpdate:()=>F$(e),timeLeftCooldown:()=>b$(e),getPinVerificationTimer:({pinVerificationExpiryInMs:i})=>I$({...e,pinVerificationExpiryInMs:i}),setPinVerificationTimer:i=>$$(e,i),...{getDeviceEncryptionKey:()=>r.runExclusive(async()=>await v$(e))},generateDeviceEncryptionKey:Ff,setDeviceEncryptionKey:i=>wf(e,i),deleteDeviceEncryptionKey:()=>q$(e),getOrCreateSeedlessDeviceID:()=>Sf(e),subscribe:(i,a)=>A.subscribe(i,a)}},_u={},E$=async(e,A,j)=>{if(!zj(A))throw new Error("Invalid PIN provided. Only numbers are accepted.");await Du(e);let t=await Ro(e,{pin:A,entropy:j[0]});if(t.type!=="success"&&t.type!=="bundle-already-exists")throw new Error(`Failed to backup bundle: ${t.type}`);return{entropy:j[0]}},y$=async(e,A,j,t)=>{let r=await Ro(e,{pin:j,entropy:A});if(t.emitBackupResult(r),r.type!=="success")throw new ga(r)},yf=async(e,A,j=!1,t)=>{let r=await Ef(e,t,{pin:A,ignoreCooldown:j});if(t.emitRecoverResult(r),r.type!=="success")throw new Go(r);return{entropy:r.entropy}},h$=async(e,A,j=!0,t)=>{await yf(e,A,j,t)},F$=async({authRepository:e})=>{let A=await e.getUser();if(!A)throw new Error("User is not logged in, cannot check for seedless bundle update");let{accessToken:j}=A,t,r=Ht(Ir());try{t=await Oo("latest",j)}catch(i){if(i instanceof Error&&i.message==="bundle not found")return!1;throw i}return!!$a()[t.id]&&t.id!==r},S$=async(e,A="latest")=>{let j=await e.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot check for se*dless bundle");let{accessToken:t}=j;return await ya(A,t)},Du=async(e,A="latest")=>{let j=await e.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot delete se*dless bundle");let{accessToken:t}=j;if(A==="all")return await GB(t);let r=Ht(Ir());return await ha(r,t)},w$=async e=>{let A=await e.authRepository.getUser();if(!A)throw new Error("User is not logged in, cannot delete juicebox share");let{accessToken:j}=A;await(await e.juiceboxClient()).deleteShare(Ir(),j)},b$=async({storage:e})=>{let{timeRemaining:A}=await gs(e);return A},I$=async({storage:e,pinVerificationExpiryInMs:A})=>{let j=Date.now(),t=await e.get("seedlessPinVerificationLockTimerInMs")??Date.now();return{expired:j>=t+(A??2592e6),timestampInMs:t}},$$=async({storage:e},A)=>{await e.set("seedlessPinVerificationLockTimerInMs",A)},Nu=async e=>(await e.get("seedlessDeviceID"))?.deviceID??null,hf=async(e,A)=>{await e.set("seedlessDeviceID",{version:1,deviceID:A})},Ff=()=>{let e=zi(32);try{return Promise.resolve($e.from(e))}finally{e.fill(0)}},Sf=async({storage:e})=>{let A=await Nu(e);return A||(A=Ea(),await hf(e,A)),A},v$=async e=>{let{authRepository:A}=e,j=await A.getUser();if(!j)throw new Error("User not logged in, cannot retrieve device encryption key.");let t=await Sf(e),r=_u[t];if(r)return r;let o=await hu(j.accessToken,t);return o||(o=await Ff(),await wf(e,o)),_u[t]=o,o},wf=async({authRepository:e,storage:A},j)=>{let t=await e.getUser();if(!t)throw new Error("User not logged in, cannot set device encryption key.");let r=await Nu(A);return r||(r=Ea(),await hf(A,r)),await CB(t.accessToken,r,j),_u[r]=j,j},q$=async({authRepository:e,storage:A})=>{let j=await e.getUser();if(!j)throw new Error("User not logged in, cannot delete device encryption key.");let t=await Nu(A);if(!t)return null;let r=await hu(j.accessToken,t);return r?(await OB(j.accessToken,t),r):null};n();s();n();s();var Lu={};rI(Lu,{default:()=>Ku});var Ku="./juicebox-sdk_bg-LUYFYBUJ.wasm";bk(Lu);var bf=!1,T$=async()=>{if(bf)return;let e=await import("./juicebox-sdk_bg-6JCKZIO4.js"),A=await WebAssembly.instantiateStreaming(fetch(Ku),{"./juicebox-sdk_bg.js":e});e.__wbg_set_wasm(A.instance.exports),bf=!0};function If(e){globalThis.JuiceboxTokens=e}If({});var Uu=class{setJuiceboxTokens(A){If(A)}async backupShare(A,j,t,r,o){await(await this.client(A)).register(t,j,r,o)}async recoverShare(A,j,t){return await(await this.client(A)).recover(j,t)}async deleteShare(A){await(await this.client(A)).delete()}async client(A){return await T$(),new Ik(new $k(A),[])}};n();s();n();s();n();s();var P$=p.object({balance:p.boolean(),history:p.boolean()}),R5=p.record(p.string(),P$),Es=class extends Error{constructor(A){super(A),this.name="SetTermsAcknowledgementError"}};var $f=async(e,A)=>{try{return await e.set("termsHaveBeenAcknowledgedLastSeenVersion",A)}catch{throw new Es("Error Setting Terms Acknowledgement")}},vf=async e=>{try{return await e.remove("termsHaveBeenAcknowledgedLastSeenVersion")}catch{throw new Es("Error Clearing Terms Acknowledgement")}};async function G$(e){return(await e.get("onboardedAt"))?.onboardedAt}async function qf(e,A=Date.now()){A&&!await G$(e)?await e.set("onboardedAt",{onboardedAt:A}):A||await e.remove("onboardedAt")}n();s();var xf=p.enum(["Native","Fungible","SemiFungible","NonFungible","Unknown"]),kt=p.object({id:p.string(),displayName:p.string().optional(),logoURI:p.union([p.string(),p.null()]).optional(),tokenType:xf,decimals:p.number().optional(),symbol:p.string().optional(),isSpam:p.boolean().optional()}),Tf=p.object({id:ct,displayName:p.string(),logoURI:p.union([p.string(),p.null()]).optional()}),qa=p.object({token:kt,amount:p.string(),to:ct,from:ct}),Vu=p.literal("UNCLASSIFIED_APP_INTERACTION"),zu=p.literal("TOKEN_SEND"),Xu=p.literal("TOKEN_BURN"),Wu=p.literal("TOKEN_SWAP"),Ju=p.literal("TOKEN_UNWRAP"),Yu=p.literal("WITHDRAW_STAKE"),Zu=p.literal("DEACTIVATE_STAKE"),Al=p.literal("STAKE"),el=p.literal("COLLECTIBLE_LIST"),jl=p.literal("COLLECTIBLE_BUY_ITEM"),tl=p.literal("COLLECTIBLE_CANCEL_BID"),rl=p.literal("COLLECTIBLE_BID_ITEM"),ol=p.literal("COLLECTIBLE_UNLIST"),nl=p.literal("COLLECTIBLE_SELL_ITEM"),sl=p.literal("CANCEL_TX"),il=p.literal("TOKEN_APPROVAL"),al=p.literal("CANCEL_ORDER"),pl=p.literal("COLLECTION_APPROVAL"),cl=p.literal("BRIDGE_INIT"),C$=p.union([Vu,zu,Xu,Wu,Ju,Yu,Zu,Al,el,jl,tl,rl,ol,nl,sl,il,al,pl,cl]),Pf=p.object({transactionType:Vu,balanceChanges:p.array(qa),dapp:p.union([Uj,p.null()]).optional()}),Gf=p.object({transactionType:zu,balanceChanges:p.array(qa).nonempty(),dapp:p.union([Uj,p.null()]).optional()}),Cf=p.object({transactionType:Xu,dapp:p.union([Uj,p.null()]).optional(),token:kt,amount:p.string()}),Of=p.object({transactionType:Wu,dapp:p.union([Uj,p.null()]).optional(),receiveToken:kt,sendToken:kt,receiveAmount:p.string(),sendAmount:p.string()}),Mf=p.object({transactionType:Ju,token:kt,amount:p.string()}),Rf=p.object({transactionType:Yu,stakeAccount:ct,amount:p.string()}),_f=p.object({transactionType:Zu,stakeAccount:ct,amount:p.string()}),Df=p.object({transactionType:Al,stakeAccount:ct,amount:p.string(),validatorName:p.string().optional(),validatorWebsite:p.string().optional(),keybaseUsername:p.string().optional()}),Nf=p.object({transactionType:sl}),_o=p.object({dapp:p.union([Uj,p.null()]),itemAmount:p.string().optional(),item:kt,forAmount:p.string(),forAsset:kt,listingUrl:p.string().optional()}),Lf=_o.merge(p.object({transactionType:el})),Kf=_o.merge(p.object({transactionType:jl})),Uf=_o.merge(p.object({transactionType:tl})),Hf=_o.merge(p.object({transactionType:rl})),Qf=_o.merge(p.object({transactionType:ol})),Vf=_o.merge(p.object({transactionType:nl})),zf=p.object({transactionType:il,dapp:p.union([Uj,p.null()]).optional(),token:kt,value:p.string().optional(),isApproved:p.boolean()}),Xf=p.object({transactionType:al,dapp:p.union([Uj,p.null()]).optional(),orderId:p.string()}),Wf=p.object({transactionType:pl,collection:Tf,dapp:p.union([Uj,p.null()]).optional(),isApproved:p.boolean()}),Jf=p.object({transactionType:cl,dapp:p.union([Uj,p.null()]).optional(),balanceChanges:p.array(qa).nonempty(),explorerUrl:p.string().optional()}),Yf=p.enum(["success","failed"]),Zf=p.object({networkFee:p.string().optional(),networkFeePayer:p.string().optional(),status:Yf,errorMessage:p.union([p.string(),p.null()]),blockNumber:p.string(),chainId:Mt,transactionId:p.string()}),xa=p.object({timestamp:p.number(),owner:ct,id:ct,interactionData:p.union([Pf,Gf,Cf,Of,Mf,Rf,_f,Df,Lf,Kf,Uf,Hf,Qf,Vf,Nf,zf,Xf,Wf,Jf]),chainMeta:Zf}),qe=e=>e.split("/")[1]?.split(":").slice(1).join(":");n();s();var Ne=(e,A)=>{let j=new w(e).div(hr(A)).toNumber();return ka(j)};n();s();var $r=e=>{switch(e){case"SemiFungible":case"NonFungible":return!0;default:return!1}},ul=(e,A)=>{let j=qe(e.to),t=qe(e.from),r=A.some(i=>i.address.toLowerCase()===j.toLowerCase()),o=A.some(i=>i.address.toLowerCase()===t.toLowerCase());return r&&!o};n();s();var ll=q(P());n();s();var Ag=({interactionData:e,isError:A,selectedAccountAddresses:j,getKnownAddressLabel:t,start:r,networkID:o})=>{let a=e.balanceChanges[0],{token:{symbol:u,displayName:c,tokenType:l,decimals:m},amount:B}=a,k=ul(a,j),f=$r(l),E=O$({isCollectible:f,sign:k?"+":"-",amount:B,decimals:m,tokenSymbol:u,tokenType:l,isError:A});if(k){let F=qe(a.from),S=Uc(F,void 0,t(F,o));return{topLeft:{text:`${T.t("transactionsReceived")} ${f?c||T.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${E}`,color:"spotPositive"},bottomLeft:{text:T.t("transactionsFromParagraphInterpolated",{from:S,defaultValue:`From ${S}`})},start:r}}let h=qe(a.to),y=Uc(h,void 0,t(h,o));return{topLeft:{text:A?T.t("transactionsSendFailed"):`${T.t("transactionsSent")} ${f?c||T.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${E}`,color:"textBase"},bottomLeft:{text:T.t("transactionsToParagraphInterpolated",{to:y,defaultValue:`To ${y}`})},start:r}};function O$({isCollectible:e,sign:A,amount:j,decimals:t,tokenSymbol:r,tokenType:o,isError:i}){return i||t===void 0||o==="NonFungible"?"":e?`${A}${Ne(j,t)}`:`${A}${Ne(j,t)}${r?` ${Qj(r,6)}`:""}`}var M$=["So11111111111111111111111111111111111111112","501"],R$=(e,A,j,t,r)=>{let{interactionData:o,chainMeta:i}=e,{transactionType:a}=o,u=i.status==="failed",c=i.chainId,l=I.getTokenSymbol(c),m=I.getTokenDecimals(c),B=A("historyUnknownDappName"),k=ll.default.createElement(j,{activityItem:e,size:"small",isDetailViewOrSvg:!1});switch(a){case"TOKEN_SEND":return Ag({interactionData:o,isError:u,selectedAccountAddresses:r,getKnownAddressLabel:t,start:k,networkID:c});case"TOKEN_BURN":{let{amount:f,token:g}=o,E="";return g.displayName?f==="1"?E=g.displayName:E=`${g.displayName} (${f})`:E=A("richTransactionDetailUnknownNFT"),{topLeft:{text:u?`${A("transactionsFailedBurn")}`:`${A("transactionsBurned")}`},bottomLeft:{text:E},start:k}}case"TOKEN_UNWRAP":{let{amount:f,token:g}=o;return{topLeft:{text:u?`${A("transactionsUnwrappedFailed")}`:`${A("transactionsUnwrapped")}`},topRight:{text:u?"":`${Ne(f,g.decimals??0)} ${g.symbol}`,color:"textBase"},start:k}}case"TOKEN_SWAP":{let{receiveAmount:f,receiveToken:g,sendAmount:E,sendToken:h,dapp:y}=o,F=y?y.displayName:A("historyUnknownDappName"),S=ps(qe(h.id)||""),x=ps(qe(g.id)||""),O="";!u&&g.decimals!==void 0&&(O=`+${Ne(f,g.decimals)} ${Qj(g.symbol||x,6)}`);let v="";return!u&&h.decimals!==void 0&&(v=`-${Ne(E,h.decimals)} ${Qj(h.symbol||S,6)}`),{topLeft:{text:A(u?"transactionsFailedSwap":"transactionsSwapped")},topRight:{text:O,color:"spotPositive"},bottomLeft:{text:F},bottomRight:{text:v,color:"textBase"},start:k}}case"BRIDGE_INIT":{let f=o.dapp?o.dapp.displayName:B,E=o.balanceChanges[0],{token:{symbol:h,decimals:y},amount:F}=E,S=h?` ${Qj(h,6)}`:"";if(!u&&y!==void 0){let x=`-${Ne(F,y)}${S}`;return{topLeft:{text:u?A("transactionBridgeInitiatedFailed"):`${A("transactionBridgeInitiated")}`},bottomLeft:{text:f},topRight:{text:`${x}`,color:"textBase"},start:k}}return{topLeft:{text:u?A("transactionBridgeInitiatedFailed"):`${A("transactionBridgeInitiated")}`},bottomLeft:{text:f},start:k}}case"WITHDRAW_STAKE":{let{amount:f,stakeAccount:g}=o,E=qe(g),h=I.getTokenSymbol(c);return{topLeft:{text:A(u?"transactionsWithdrawStakeFailed":"transactionsWithdrawStake")},topRight:{text:u?"":`${Ne(f,m)} ${Qj(h,6)}`,color:"textBase"},bottomLeft:{text:Yi(E,4)},start:k}}case"DEACTIVATE_STAKE":{let{stakeAccount:f}=o,g=qe(f);return{topLeft:{text:A(u?"transactionsDeactivateStakeFailed":"transactionsDeactivateStake")},bottomLeft:{text:Yi(g,4)},start:k}}case"STAKE":{let{amount:f,stakeAccount:g,validatorName:E}=o,h=qe(g);return{topLeft:{text:A(u?"transactionsStakedFailed":"transactionsStaked")},topRight:{text:u?"":`${Ne(f,m)} ${Qj(l,6)}`,color:"textBase"},bottomLeft:{text:E||Yi(h,4)},start:k}}case"COLLECTIBLE_LIST":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsListedFailed"):A("transactionsListedInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_BUY_ITEM":{let{dapp:f,itemAmount:g,item:E,forAsset:h,forAmount:y}=o,F=f?f.displayName:A("historyUnknownDappName"),S=eg(y,h.decimals,Qj(h.symbol||"",6)),x=E.symbol||ps(qe(E.id)),O=g&&E.tokenType==="SemiFungible"?`+${g} ${x}`:`+${x}`;return{topLeft:{text:A(u?"transactionsBuyFailed":"transactionsBoughtCollectible")},topRight:{text:u?"":O,color:"spotPositive"},bottomRight:{text:u?"":`${S}`,color:"textBase"},bottomLeft:{text:F},start:k}}case"COLLECTIBLE_CANCEL_BID":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsCancelBidOnFailed"):A("transactionsCancelBidOnInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_BID_ITEM":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsBidFailed"):A("transactionsBidOnInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_UNLIST":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsUnlistedFailed"):A("transactionsUnlistedInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_SELL_ITEM":{let{dapp:f,itemAmount:g,item:E,forAsset:h,forAmount:y}=o,F=f?f.displayName:A("historyUnknownDappName"),S=h.decimals!==void 0?`+${Ne(y,h.decimals)} ${Qj(h.symbol||"",6)}`:A("transactionsUnknownAmount"),x=E.symbol||ps(qe(E.id)),O=g&&E.tokenType==="SemiFungible"?`-${g} ${x}`:`-${x}`;return{topLeft:{text:A(u?"transactionsSoldFailed":"transactionsSoldCollectible")},topRight:{text:u?"":`${S}`,color:"spotPositive"},bottomRight:{text:u?"":O,color:"textBase"},bottomLeft:{text:F},start:k}}case"CANCEL_TX":return{topLeft:{text:A(u?"transactionCancelledFailed":"transactionCancelled")},start:k};case"TOKEN_APPROVAL":{let{dapp:f,token:g,isApproved:E}=o,h=$r(g.tokenType)?g.displayName:g.symbol,y;return u?E?$r(g.tokenType)?y=A("transactionApproveTokenFailed",{tokenSymbol:h}):y=A("transactionApprovalFailed"):$r(g.tokenType)?y=A("transactionRevokeApproveTokenFailed",{tokenSymbol:h}):y=A("transactionRevokeFailed"):E?y=A("transactionApproveToken",{tokenSymbol:h}):y=A("transactionRevokeApproveToken",{tokenSymbol:h}),{topLeft:{text:y},bottomLeft:{text:f?f.displayName:B,color:"textIncidental"},start:k}}case"COLLECTION_APPROVAL":{let{collection:f,isApproved:g,dapp:E}=o,h=f.displayName,y;return u?g?y=A("transactionApproveTokenFailed",{tokenSymbol:h}):y=A("transactionRevokeApproveTokenFailed",{tokenSymbol:h}):g?y=A("transactionApproveToken",{tokenSymbol:h}):y=A("transactionRevokeApproveToken",{tokenSymbol:h}),{topLeft:{text:y},bottomLeft:{text:E?E.displayName:B,color:"textIncidental"},start:k}}case"CANCEL_ORDER":{let{dapp:f}=o;return{topLeft:{text:A(u?"transactionCancelOrderFailed":"transactionCancelOrder")},bottomLeft:{text:f?.displayName||A("historyUnknownDappName"),color:"textIncidental"},start:k}}case"UNCLASSIFIED_APP_INTERACTION":{let{dapp:f}=o,g=f?f.displayName:B;return{topLeft:{text:A(u?"transactionsFailedAppInteraction":"transactionsAppInteraction")},bottomLeft:{text:g},start:k}}}},_$=(e,A)=>{let{display:j,type:t}=e,{topLeft:r,topRight:o,bottomLeft:i,bottomRight:a}=j.summary,u=ll.default.createElement(A,{logoUri:j.summary.logoUri,pendingTransactionType:t,size:"small"});return{topLeft:r,topRight:o,bottomLeft:i,bottomRight:a,start:u}},dl=(e,A,j)=>{let t=(e??[]).map(Dk);if(A){let r=t.find(o=>o.chainId===A)?.address;if(r){let o={chainId:A,address:r};j&&(o.filters=[{type:"token",value:j}]),t=[o]}}return t},ml=e=>{if(!e)return;let A=U(e);if(A.resourceType!=="nativeToken")return e.type==="SPL"?e.data.splTokenAccountPubkey:A.address},D$=(e,A)=>{let j=qe(e.id);return M$.includes(j)&&(e.tokenType="Native"),e.tokenType==="Native"?{chainId:A,slip44:I.getSlip44(A),resourceType:"nativeToken"}:{chainId:A,address:j,resourceType:"address"}},eg=(e,A,j)=>{if(!e||!A)return T.t("transactionsUnknownAmount");let t=kA(e,A),r=t.abs(),o=t.isZero()?"":t.isPositive()?"-":"+",i=_e(r);return`${o}${i} ${j}`};n();s();var ys=q(P());var N$=p.object({orderIds:p.array(p.object({bytesValue:p.string(),bytesArrayValue:p.string(),stringValue:p.string()}))}),L$=async(e,A)=>{if(A==="LI.FI")return{label:T.t("transactionBridgeStatusLink",{dappName:"LI.FI"}),value:`https://explorer.li.fi/tx/${e}`};if(A==="deBridge")try{let j=await N.get(`https://stats-api.dln.trade/api/Transaction/${e}/orderIds`),t=N$.safeParse(j.data);if(!t.success){b.captureError(new Error("Failed to parse deBridge response"),"history");return}let r=t.data.orderIds[0]?.stringValue;if(!r){b.captureError(new Error("No orderId found in deBridge response"),"history");return}return{label:T.t("transactionBridgeStatusLink",{dappName:"DeBridge"}),value:`https://app.debridge.finance/order?orderId=${r}`}}catch(j){b.captureError(new Error(`Could not fetch bridge explorer url: ${j}`),"history");return}},K$=(e,A)=>{let[j,t]=(0,ys.useState)(),[r,o]=(0,ys.useState)(!1);return(0,ys.useEffect)(()=>{e&&A&&(async()=>{o(!0);try{let a=await L$(e,A);t(a)}finally{o(!1)}})()},[e,A]),{bridgeUrl:j,isLoading:r}};n();s();n();s();n();s();var uj={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!0};var jg={...uj};n();s();var tg={...uj};n();s();var rg={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};n();s();var og={...uj,showTimeToMineRowInPendingTransactionDetail:!0};n();s();var ng={...uj};n();s();var sg={...uj};n();s();var ig={...uj};n();s();var ag={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};n();s();var pg={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};var U$=new ko({solana:ag,ethereum:og,polygon:ig,monad:sg,base:tg,arbitrum:jg,bitcoin:rg,sui:pg,hypercore:ng}),cg=mo(U$);n();s();n();s();n();s();n();s();var lg=q(P(),1);var ug=new WeakMap;function dg(e,A){let j=zk(A),t=H$(j);for(let[r,o]of e)(!t.has(r)||A?.dangerouslyForceHydrate)&&(t.add(r),j.set(r,o))}var H$=e=>{let A=ug.get(e);return A||(A=new WeakSet,ug.set(e,A)),A};var Eg=q(P());n();s();var fg=q(P());n();s();var Q$=10,V$="/history/v2",Do=class extends Error{message="406: Cache bust!"},Fs=class extends Error{message="Server response malformed."},Ta=class extends Error{},Pa=class extends Error{},kl=p.object({next:p.union([p.null(),p.string()]),results:p.array(xa)}),mg=async e=>{let A=await N.api().retry(3,2e3).post(`${V$}`,e);if(A.status===406)throw new Do;if(A.status>=400&&A.status<500)throw new Pa(`FetchActivityItem: Status code: ${A.status}`);if(A.status>=500)throw new Ta(`FetchActivityItem: Status code: ${A.status}`);return A.data},kg=e=>!Array.isArray(e.results)||typeof e.next!="string"&&e.next!==null,Ga=async e=>{let A=await mg(e);if(kg(A))throw new Fs;for(;A.results?.length<Q$&&A.next;){if(kg(A))throw new Fs;let j=await mg({next:A.next,isSpam:e.isSpam});A.next=j.next,A.results=[...A.results,...j.results]}try{return kl.parse(A)}catch(j){let t=j,r=[],o=t.issues;for(let u=0;u<o.length;++u){let c=o[u].path;if(c[0]!=="results")throw b.captureError(t,"history"),t;let l=c[1];if(typeof l!="number")throw b.captureError(t,"history"),t;r.push(l)}r.sort(function(u,c){return c-u});let i=r.map(u=>A.results[u]).map(u=>u.interactionData?.transactionType||""),a=[];for(let u=0;u<r.length;++u){let c=r[u],l=A.results[c],m={timestamp:l?.timestamp,owner:l?.owner,id:l?.id,chainMeta:l?.chainMeta,interactionData:{transactionType:"UNCLASSIFIED_APP_INTERACTION",balanceChanges:[]}};try{xa.parse(m),A.results[c]=m,a.push(c)}catch{}}for(let u=0;u<r.length;++u){let c=r[u];a.indexOf(c)===-1&&A.results.splice(c,1)}r.length&&console.error(`Removed history items, ${i.join(",")}`);try{return kl.parse(A)}catch(u){let c=u;throw b.captureError(c,"history"),c}}};var z$=3e5,Ss="fetch-infinite-activity-items",gg=({accounts:e,isSpam:A})=>[Ss,e,A],X$=(e,A)=>{e.removeQueries({queryKey:A})},Bl=({accounts:e,isSpam:A})=>{let j=pA();(0,fg.useEffect)(()=>()=>{j.cancelQueries({queryKey:[Ss],exact:!1})},[j]);let t=gg({accounts:e,isSpam:A});return Xi({queryKey:t,queryFn:async({pageParam:i})=>{try{let a;i&&i!==""?a=await Ga({next:i,isSpam:A}):a=await Ga({accounts:e||[],isSpam:A});let u=a.results.map(c=>(c.interactionData.transactionType==="TOKEN_SEND"&&c.interactionData.balanceChanges.sort(W$(e)),c));return{...a,results:u}}catch(a){a instanceof Do&&X$(j,t),b.captureError(a,"history")}},getNextPageParam:i=>i?.next,staleTime:z$,retry:!1,enabled:!!e?.length&&e.every(i=>!I.isLocalNetworkID(i.chainId)),initialPageParam:""})};function W$(e){return(A,j)=>{let t=Bg(A,e),r=Bg(j,e);return t?-1:r?1:0}}function Bg(e,A){let j=e.to.split("/address:")[1],t=e.from.split("/address:")[1];return A.some(r=>r.address.toLowerCase()===j.toLowerCase()||r.address.toLowerCase()===t.toLowerCase())}var J$=({fungible:e,isSpam:A=!1})=>{let{data:j=rk,status:t}=lk(),r=j.isDeveloperMode,o=ml(e),{data:i}=yr({address:e?.data.walletAddress,networkID:e?.data.chain.id}),a=(0,Eg.useMemo)(()=>dl(i?[i]:[],e?.data.chain.id,o),[i,e?.data.chain.id,o]),u=Bl({accounts:a,isSpam:A}),c=u.isPending||t==="pending";return{activityItemsData:u,isLoadingHistory:c,isDeveloperMode:r}};n();s();var fl=e=>e.replace(/^(^[\w-_]*:\/\/)?(?:www\.)?/i,"").split("/")[0];n();s();n();s();var xe="Auto";var qA={buyFungible:void 0,buyUsdValue:void 0,sellFungible:void 0,sellUsdValue:void 0,sellAmount:"",uiSellAmountCryptoInput:"",amountType:"sell",quoteResponse:void 0,selectedProviderIndex:0,selectedBaseProvider:xe,gasEstimation:{isFetching:!1,estimate:void 0,estimateWithBuffer:void 0},hasNoRoutes:!1,isFetchingQuote:!1,error:null,searchQuery:"",numSearchResults:0,primaryCurrency:"crypto",uiSellAmountLocalFiatInput:"",uiBuyAmountCryptoInput:"",uiBuyAmountLocalFiatInput:"",canInputFiatSellAmount:!1,swapFilter:void 0},$=VA(e=>({...qA,resetQuote:()=>e({quoteResponse:qA.quoteResponse,isFetchingQuote:qA.isFetchingQuote,hasNoRoutes:qA.hasNoRoutes,selectedProviderIndex:qA.selectedProviderIndex,error:qA.error,uiSellAmountLocalFiatInput:qA.uiSellAmountLocalFiatInput,selectedBaseProvider:qA.selectedBaseProvider}),resetSwapper:()=>e({quoteResponse:qA.quoteResponse,gasEstimation:qA.gasEstimation,error:qA.error,sellAmount:"",uiSellAmountCryptoInput:"",uiBuyAmountCryptoInput:qA.uiBuyAmountCryptoInput,swapFilter:qA.swapFilter,selectedBaseProvider:qA.selectedBaseProvider,selectedProviderIndex:qA.selectedProviderIndex}),setBuyFungible:A=>e({buyFungible:A}),setBuyUsdValue:A=>e({buyUsdValue:A}),setHasNoRoutes:A=>e({hasNoRoutes:A}),setIsFetchingQuote:A=>e({isFetchingQuote:A}),setQuoteResponse:A=>e({quoteResponse:A,hasNoRoutes:!1}),setSelectedProviderIndex:A=>e({selectedProviderIndex:A}),setSelectedBaseProvider:A=>e({selectedBaseProvider:A}),setGasEstimation:({estimate:A,estimateWithBuffer:j,isFetching:t})=>e(r=>({gasEstimation:{...r.gasEstimation,...A!==void 0&&{estimate:A},...j!==void 0&&{estimateWithBuffer:j},...t!==void 0&&{isFetching:t}}})),setSellAmount:A=>e({sellAmount:A}),setAmountType:A=>e({amountType:A}),setSellUsdValue:A=>e({sellUsdValue:A}),setSellFungible:A=>e({sellFungible:A}),setUiSellAmountCryptoInput:A=>e({uiSellAmountCryptoInput:A}),setError:A=>e({error:A}),setSearchQuery:A=>e({searchQuery:A}),setNumSearchResults:A=>e({numSearchResults:A}),setPrimaryCurrency:A=>e({primaryCurrency:A}),setUiSellAmountLocalFiatInput:A=>e({uiSellAmountLocalFiatInput:A}),setUiBuyAmountCryptoInput:A=>e({uiBuyAmountCryptoInput:A}),setUiBuyAmountLocalFiatInput:A=>e({uiBuyAmountLocalFiatInput:A}),setCanInputFiatSellAmount:A=>e({canInputFiatSellAmount:A}),setSwapFilter:A=>e({swapFilter:A}),switchTokensForSell:()=>{e(A=>{let j=A.sellFungible??A.buyFungible,t=A.buyFungible??A.sellFungible,r=A.uiBuyAmountCryptoInput,o=A.uiBuyAmountLocalFiatInput;return{sellFungible:t,buyFungible:j,uiSellAmountCryptoInput:r,uiSellAmountLocalFiatInput:o,uiBuyAmountCryptoInput:qA.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:qA.uiBuyAmountLocalFiatInput,sellAmount:r,swapFilter:void 0,selectedBaseProvider:A.selectedBaseProvider}})},switchTokensForBuy:()=>{e(A=>{let j=A.sellFungible??A.buyFungible,t=A.buyFungible??A.sellFungible,r=A.uiSellAmountCryptoInput,o=A.uiSellAmountLocalFiatInput;return{sellFungible:t,buyFungible:j,uiSellAmountCryptoInput:qA.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:qA.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:r,uiBuyAmountLocalFiatInput:o,sellAmount:r,swapFilter:void 0,selectedBaseProvider:A.selectedBaseProvider}})},resetUiAmounts:()=>e({uiSellAmountCryptoInput:qA.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:qA.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:qA.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:qA.uiBuyAmountLocalFiatInput,sellAmount:qA.sellAmount,selectedBaseProvider:qA.selectedBaseProvider}),setPairAndAmount:({sell:A,buy:j,swapAmount:t})=>e(r=>{let o="uiSellAmountCryptoInput";return t.perspective==="sell"?r.primaryCurrency==="crypto"?o="uiSellAmountCryptoInput":o="uiSellAmountLocalFiatInput":r.primaryCurrency==="crypto"?o="uiBuyAmountCryptoInput":o="uiBuyAmountLocalFiatInput",{...r,sellFungible:A,buyFungible:j,[o]:t.amount,sellAmount:t.amount}})}));n();s();n();s();var Ca=p.object({name:p.string(),message:p.string()}),hg=p.object({chainId:Mt,name:p.string(),symbol:p.string(),decimals:p.number(),logoURI:p.optional(p.string()),includesBridge:p.optional(p.boolean())}),Y$=hg.extend({address:p.string(),resourceType:p.literal("address")}),Z$=hg.extend({slip44:p.string(),resourceType:p.literal("nativeToken")}),LH=p.union([Y$,Z$]),Fg=p.object({id:p.string(),name:p.string(),logoUri:p.string()}),Av=p.union([p.enum(["network","phantom","gasless","ata","gasless_network","tips","priority_fee"]),p.string()]),ev=p.object({name:p.string(),percentage:p.number(),amount:p.number(),type:Av}),jv=p.object({name:p.string(),proportion:p.string()}),Sg=p.object({sellAmount:p.string(),buyAmount:p.string(),rfqProps:p.optional(p.object({expireAt:p.number(),quoteId:p.string()})),analyticsContext:p.optional(p.string())}),gl=Sg.extend({priceImpact:p.number(),sources:p.array(jv),fees:p.array(ev),slippageTolerance:p.optional(p.number()),baseProvider:Fg}),tv=p.object({success:p.boolean(),error:p.string().optional(),data:p.object({ataFeeUSD:p.number().optional(),networkFeeUSD:p.number().optional(),totalAmountUSD:p.number().optional()}).optional()}),Oa=gl.extend({transactionData:p.array(p.string()),gaslessSignature:p.optional(p.string()),gaslessSwapFeeResult:p.optional(tv)}),rv=Oa,El=gl.extend({allowanceTarget:p.string(),exchangeAddress:p.string(),gas:p.number(),value:p.string(),transactionData:p.string()}),yl=gl.extend({transactionData:p.array(p.string())}),yg=p.object({name:p.string(),amount:p.string(),token:Pe,percentage:p.string(),included:p.boolean(),amountUSD:p.optional(p.string())}),ov=p.object({name:p.string(),key:p.string(),logoURI:p.string()}),wg=p.object({name:p.string(),symbol:p.string()}),nv=p.object({transactionData:p.string(),buyToken:Pe,sellToken:Pe,nonIncludedNonGasFees:p.string(),feeCosts:p.array(yg),chainId:Mt,tool:ov,value:p.optional(p.string()),allowanceTarget:p.optional(p.string()),approvalMetadata:p.optional(wg),approvalExactAmount:p.optional(p.string()),exchangeAddress:p.optional(p.string()),gasCosts:p.optional(p.array(p.number())),includedFeeCosts:p.optional(p.array(yg))}),hl=Sg.extend({baseProvider:Fg,executionDuration:p.number(),tags:p.array(p.string()),steps:p.array(nv)}),sv=p.union([Oa,El,yl,hl,rv]),ws=p.enum(["solana","eip155","sui","xchain"]),bs=p.object({type:ws,taker:Pe,buyToken:Pe,sellToken:Pe,slippageTolerance:p.number(),simulationTolerance:p.optional(p.number()),gasBuffer:p.optional(p.number()),quotes:p.array(sv),tradeFee:p.optional(p.array(p.number())),estimateGasFee:p.optional(p.array(p.number())),includesAllProviders:p.optional(p.boolean())}),iv=p.enum(["swap-approval","swap","bridge-approval","bridge"]),av=p.enum(["swap","bridge"]),pv=p.enum(["swap","bridge"]),Fl=p.object({sellToken:Pe,buyToken:Pe,approvalMetadata:p.optional(wg)}),cv=p.object({type:p.literal("solana"),transactions:p.array(p.string()),transactionTypes:p.array(av),transactionPairs:p.optional(p.array(Fl))});var uv=p.object({type:p.literal("evm"),transactions:p.array(io),transactionTypes:p.array(iv),transactionPairs:p.optional(p.array(Fl))}),lv=p.object({type:p.literal("sui"),transactions:p.array(p.string()),transactionTypes:p.array(pv),transactionPairs:p.optional(p.array(Fl))}),KH=p.union([cv,uv,lv]);var Sl=p.object({name:p.string(),amount:p.string()}).strict(),Ma=p.object({name:p.string(),feeUsd:p.number().nullish(),amount:p.string(),time:p.object({text:p.string(),isFast:p.boolean()}),logoURI:p.string()}),UH=p.union([Sl,Ma]);var dv=e=>Ma.safeParse(e).success;n();s();function dA(e){return hl.safeParse(e).success}var Le=e=>Oa.safeParse(e).success,bg=e=>Le(e);function Ze(e){return El.safeParse(e).success}function Bt(e){return yl.safeParse(e).success}function Ig(e){return e?"gaslessSignature"in e:!1}function Wj(e){return Le(e)||Ze(e)||Bt(e)}n();s();var vg=q(P());n();s();var Is=q(P());var $g=()=>{let[e,A]=(0,Is.useState)(!1),j=$(u=>u.selectedProviderIndex),t=$(u=>u.selectedBaseProvider),r=$(u=>u.quoteResponse),o=(0,Is.useMemo)(()=>r?r.quotes:[],[r]),i=(0,Is.useMemo)(()=>{if(Fj){if(!r||r.quotes.length===0)return 0;let u=mv(r,t);return u===-1?(A(t!==xe),0):(A(!1),u)}return j},[r,t,j]),a=o.length>0?o[i]:void 0;return{selectedQuoteIndex:i,selectedBaseProvider:Fj?t:"",currentQuote:a,hasDefaultedToBestQuote:e}},mv=(e,A)=>e.quotes.findIndex(j=>j.baseProvider.id===A);function iA(){let e=$(c=>c.quoteResponse),A=$(c=>c.hasNoRoutes),j=$(c=>c.isFetchingQuote),t=(0,vg.useMemo)(()=>e?e.quotes:[],[e]),r=t[0]?.buyAmount??"",{selectedQuoteIndex:o,selectedBaseProvider:i,currentQuote:a,hasDefaultedToBestQuote:u}=$g();return{bestBuyAmount:r,currentQuote:a,hasNoRoutes:A,quoteResponse:e,quotes:t,selectedProviderIndex:o,selectedBaseProvider:i,isFetchingQuote:j,hasDefaultedToBestQuote:u}}n();s();n();s();n();s();n();s();n();s();var No="cash-account",kv="grouped-balances",Lo=[No,kv],vr={account:(e,A)=>[No,"account",{userId:e,isCashEnabled:A}],cashKMSAccount:(e,A)=>[No,"kms-account",{user:e,isCashEnabled:A}],bankDetails:(e,A)=>[No,"bankDetails",{user:e,isCashEnabled:A}],enrollment:(e,A)=>[No,"enrollment",{userId:e,isCashEnabled:A}],groupedBalances:(e,A)=>[...Lo,{userID:e,addresses:A}]};var wl=(e,A)=>{let j=Be.isFeatureEnabled("enable-cash");return e.invalidateQueries({queryKey:vr.account(A,j)})},bl=e=>e.invalidateQueries({queryKey:Lo});n();s();n();s();n();s();function qg(e){return e.toLowerCase().replace(/(^|\s|\.)(\w)/g,(A,j,t)=>j+t.toUpperCase())}n();s();var Ra=(o=>(o.NotEnrolled="not_enrolled",o.Unverified="unverified",o.Verified="verified",o.Suspended="suspended",o.Closed="closed",o))(Ra||{}),Il=(a=>(a.Crypto="crypto",a.CryptoRecover="crypto_recover",a.Banking="banking",a.Fiat="fiat",a.Cards="cards",a.PaymentLinks="payment_links",a.AccountManagement="account_management",a))(Il||{}),$l=(t=>(t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified",t))($l||{}),qr=(u=>(u.PhantomUsername="phantom_username",u.Signup="signup",u.Tos="tos",u.Kyc="kyc",u.EmailVerification="email_verification",u.DataSharingConsent="data_sharing_consent",u.L1KycVerification="l1_kyc_verification",u.L2DocumentVerification="l2_document_verification",u))(qr||{}),$s=(u=>(u.Pending="pending",u.Completed="completed",u.Verified="verified",u.Failed="failed",u.Rejected="rejected",u.NotStarted="not_started",u.Expired="expired",u.NotApplicable="not_applicable",u))($s||{}),xg=p.nativeEnum(Ra),Bv=p.nativeEnum(Il),Tg=p.nativeEnum($l),fv=p.nativeEnum(qr),gv=p.nativeEnum($s),Ev=p.object({type:fv,status:gv,description:p.string().nullish().transform(oA),url:p.string().nullish().transform(oA),errorMessage:p.string().nullish().transform(oA),metadata:p.record(p.string(),p.any()).nullish().transform(oA)}),yv=p.object({type:p.string(),required:p.boolean(),description:p.string().nullish().transform(oA)}),Pg=p.object({type:p.nativeEnum(qr),required:p.boolean(),description:p.string(),data:p.object({type:p.union([p.literal("data_sharing_consent"),p.literal("l1_kyc_verification"),p.literal("l2_document_verification")]).nullish().transform(oA),currentStatus:p.nativeEnum($s).nullish().transform(oA),authIntentId:p.string().nullish().transform(oA),consentRequired:p.boolean().nullish().transform(oA)}).nullish().transform(oA)}),_a=p.object({accountStatus:xg,features:p.array(Bv).optional().default([]),availableTransitions:p.array(xg).optional().default([]),canAdvance:p.boolean().optional().default(!1),currentTier:Tg.nullish().transform(oA),nextTier:Tg.nullish().transform(oA),nextTierDescription:p.string().nullish().transform(oA),nextTierRequirements:p.array(Ev).optional().default([]),nextTierRequiredFields:p.record(p.string(),yv).nullish().transform(oA),nextSteps:p.array(Pg).optional().default([])});var vl=(t=>(t.NotSubmitted="not_submitted",t.Accepted="accepted",t.NotAccepted="not_accepted",t))(vl||{}),ql=(o=>(o.NotSubmitted="not_submitted",o.Incomplete="incomplete",o.PendingReview="pending",o.Approved="approved",o.Rejected="rejected",o))(ql||{}),xl=(a=>(a.Crypto="crypto",a.CryptoRecover="crypto_recover",a.Banking="banking",a.Fiat="fiat",a.Cards="cards",a.PaymentLinks="payment_links",a.AccountManagement="account_management",a))(xl||{}),hv=e=>Object.values(xl).includes(e),xr=(i=>(i.Pending="pending",i.Processing="processing",i.Completed="completed",i.Failed="failed",i.Canceled="canceled",i.Unknown="unknown",i))(xr||{});var Ko=class extends Error{constructor(A){super(`Cash account not found for user ${A}. User is not enrolled in cash account.`),this.name="CashAccountNotFoundError"}},Da=class extends Error{zodError;responseData;constructor(A,j){let t=A.issues.map(r=>`${r.path.length>0?r.path.join("."):"root"}: ${r.message}`).join("; ");super(`Cash account validation failed: ${t}`),this.name="CashAccountValidationError",this.zodError=A,this.responseData=j}},Na=p.object({id:p.string(),balance:p.string(),primaryEmail:p.string().nullish().transform(oA),accountStatus:p.string().nullish().transform(oA),addressDetails:p.object({address:p.string()}),features:p.array(p.string()).transform(e=>e.filter(hv)),limits:p.object({dailyFiatTransfer:p.string().nullish().transform(oA),monthlyFiatTransfer:p.string().nullish().transform(oA)}).nullish().transform(oA),waitlistDetails:p.object({waitlist:p.boolean(),priorityWaitlist:p.boolean()}).nullish().transform(oA)});var Fv=p.object({sourceCurrency:p.string().nullish().transform(oA),destinationCurrency:p.string().nullish().transform(oA),destinationBlockchain:p.string().nullish().transform(oA),destinationAddress:p.string().nullish().transform(oA),accountNumber:p.string().nullish().transform(oA),routingNumber:p.string().nullish().transform(oA),accountType:p.string().nullish().transform(oA),bankName:p.string().nullish().transform(oA),bankAddress:p.string().nullish().transform(oA),bankBeneficiaryName:p.string().transform(qg).nullish().transform(oA),bankBeneficiaryAddress:p.string().nullish().transform(oA)}),Sv=p.object({price:p.number(),priceChange24h:p.number(),lastUpdatedAt:p.string().transform(e=>new Date(e))}),wv=p.object({account:p.string(),quantity:p.number(),quantityString:p.string()}),bv=p.object({address:p.string(),quantity:p.number(),quantityString:p.string(),lastTransferredDate:p.string().nullish().transform(oA),subaccounts:p.array(wv).nullish().transform(oA)}),Iv=p.object({isMutable:p.boolean().nullish().transform(oA),creators:p.array(p.string()).nullish().transform(oA),tokenProgram:p.string().nullish().transform(oA),extensions:p.array(p.any()).nullish().transform(oA),compression:p.record(p.any()).nullish().transform(oA)}),Cg=p.object({caip19:p.string(),name:p.string(),symbol:p.string(),decimals:p.number(),spamStatus:p.string().nullish().default(""),logoUri:p.string().nullish().default(""),totalQuantity:p.number(),totalQuantityString:p.string(),price:Sv.nullish().transform(oA),queriedWalletBalances:p.array(bv),extraMetadata:Iv}),$v=p.object({email:p.string().email(),cashAccountAddress:p.string(),idempotencyKey:p.string()}),vv=p.object({enrollmentDetails:p.object({kycStatus:p.nativeEnum(ql),kycUrl:p.string(),tosStatus:p.nativeEnum(vl),tosUrl:p.string()})});var qv=p.object({account:p.string(),quantity:p.number(),quantityString:p.string()}),xv=p.object({address:p.string(),quantity:p.number(),quantityString:p.string(),lastTransferredDate:p.string().nullish().transform(oA),subaccounts:p.array(qv).nullish().transform(oA)}),Tv=p.object({isMutable:p.boolean().nullish().default(null),creators:p.array(p.unknown()).nullish().transform(oA),tokenProgram:p.string().nullish().transform(oA),extensions:p.array(p.unknown()).nullish().transform(oA)}),Gg=p.object({caip19:p.string(),name:p.string(),symbol:p.string(),decimals:p.number(),logoUri:p.string(),spamStatus:p.string(),totalQuantity:p.number(),totalQuantityString:p.string(),queriedWalletBalances:p.array(xv),extraMetadata:Tv.nullish().transform(oA),price:p.object({price:p.number(),priceChange24h:p.number().nullish().transform(oA),lastUpdatedAt:p.coerce.date(),marketCap:p.number().nullish().transform(oA)}).nullish()}),Pv=p.object({stablecoins:p.array(Gg),otherTokens:p.array(Gg),totalStablecoinsValueUsd:p.string().nullish().transform(oA),totalOtherTokensValueUsd:p.string().nullish().transform(oA)}),La=(j=>(j.UNVERIFIED="unverified",j.VERIFIED="verified",j))(La||{}),Tl=(r=>(r.AlreadyExists="already_exists",r.InProgress="in_progress",r.Pending="pending",r.Completed="completed",r))(Tl||{}),Gv=p.object({targetState:p.nativeEnum(La),data:p.object({email:p.string().email().optional(),cashAccountAddress:p.string().optional()}),idempotencyKey:p.string().optional()}),Cv=p.object({currentState:p.nativeEnum(La).nullish().transform(oA),status:p.nativeEnum(Tl),nextSteps:_a.shape.nextSteps.nullish().transform(oA),account:Na.nullish().transform(oA)}),Ov=p.object({requirementType:p.nativeEnum(qr),evidence:p.object({authIntentId:p.string(),providerCustomerId:p.string(),dataSharing:p.object({consented:p.boolean()})})}),Mv=p.object({nextSteps:_a.shape.nextSteps,account:Na});var vs=e=>{let{data:A}=oe(),{userID:j}=A??{},{data:[t],isLoading:r}=_A(["enable-cash"]);return X({...e,queryKey:vr.account(j,t),queryFn:j&&!r&&t&&e?.enabled!==!1?async()=>{try{let o=await N.api().bearer(!0).get(`/cash/v1/users/${j}/cash-account`);if(o.status===404||o.status===403)throw new Ko(j);let i=Na.safeParse(o.data);if(!i.success)throw new Da(i.error,o.data);return i.data}catch(o){throw o instanceof Ko||b.captureError(o,"cashAccount"),o}}:as})};n();s();n();s();n();s();n();s();n();s();var _v=q(P());n();s();n();s();var Dv=q(P());var Nv=(e,A,j)=>{let t=i=>{if(i.caip19!==A)return i;let u=new w(i.totalQuantity).plus(j),c=u.isLessThan(0)?new w(0):u;return{...i,totalQuantity:c.toNumber(),totalQuantityString:c.toString(),queriedWalletBalances:i.queriedWalletBalances}},r=e.stablecoins.some(i=>i.caip19===A),o=e.otherTokens.some(i=>i.caip19===A);return!r&&!o?e:{...e,stablecoins:r?e.stablecoins.map(t):e.stablecoins,otherTokens:o?e.otherTokens.map(t):e.otherTokens}};function Gl(e,A,j){e.getQueriesData({queryKey:Lo,exact:!1}).forEach(([r,o])=>{if(o){let i=Nv(o,A,j);e.setQueryData(r,i)}})}var ot=q(P());n();s();n();s();n();s();var Uv=["SwapperNoQuotes","UnsupportedCountry","UnknownError"],Rg=(e,A,j,t)=>{e instanceof DA&&Uv.includes(e.code)||(!A||A>=400&&A<500)&&b.addBreadcrumb(j,JSON.stringify(t),"info")};n();s();var _g=async(e,A,j=void 0)=>{if(AA(e))return Promise.resolve();let t;try{t=e.data}catch{throw new DA({key:j})}let r=Ca.safeParse(t);throw r.success?(b.addBreadcrumb(A,JSON.stringify(r.data),"info"),new DA({key:r.data.name})):new DA({key:j})};n();s();var Dg=e=>{let A=new DA({key:"SwapperNoQuotes"});if(ws.safeParse(e?.type).success===!1)throw b.captureError(new Error("Failed to parse a valid quote type."),"swapper"),new Error("Invalid input");let j=bs.safeParse(e);if(!j.success)throw b.captureError(new Error("Failed to parse a valid swap quotes response."),"swapper"),A;if(j.data.quotes.length===0)throw A;return j.data};var Ng="swap-quotes";async function Ka({sellTokenCaip19:e,buyTokenCaip19:A,taker:j,takerDestination:t,exactOut:r,sellAmount:o,sellAmountUsd:i,slippageTolerance:a,signal:u,enableAutoSlippage:c,priorityFee:l,tipAmount:m,phantomCashAccount:B}){let k;try{Er(j)&&(j.address=j.address.toLowerCase()),t&&Er(t)&&(t.address=t.address.toLowerCase()),Er(A)&&(A.address=A.address.toLowerCase()),Er(e)&&(e.address=e.address.toLowerCase());let f="/swap/v2/quotes",g={sellToken:e,buyToken:A,taker:j,takerDestination:t,exactOut:r,sellAmount:o,sellAmountUsd:i,slippageTolerance:a,autoSlippage:c,priorityFee:l,tipAmount:m,phantomCashAccount:B},E=await N.api().post(f,g,{signal:u});return k=E.status,await _g(E,Ng,"SwapperNoQuotes"),Dg(E.data)}catch(f){let g=f instanceof DA?f:new DA;throw Rg(g,k,Ng,{sellToken:e,buyToken:A,sellAmount:o,sellAmountUsd:i,slippageTolerance:a}),g}}var Ua=class{getQuotes(A){return Ka({sellTokenCaip19:A.sell,buyTokenCaip19:A.buy,taker:A.taker,takerDestination:A.takerDestination,sellAmount:A.amount,sellAmountUsd:A.amountUsd,slippageTolerance:A.slippageTolerance,signal:A.signal,exactOut:A.exactOutEnabled,priorityFee:A.priorityFee,tipAmount:A.tipAmount,enableAutoSlippage:A.autoSlippageEnabled,phantomCashAccount:A.phantomCashAccount})}};n();s();n();s();n();s();var he=[];for(let e=0;e<256;++e)he.push((e+256).toString(16).slice(1));function Lg(e,A=0){return(he[e[A+0]]+he[e[A+1]]+he[e[A+2]]+he[e[A+3]]+"-"+he[e[A+4]]+he[e[A+5]]+"-"+he[e[A+6]]+he[e[A+7]]+"-"+he[e[A+8]]+he[e[A+9]]+"-"+he[e[A+10]]+he[e[A+11]]+he[e[A+12]]+he[e[A+13]]+he[e[A+14]]+he[e[A+15]]).toLowerCase()}n();s();var Cl,Hv=new Uint8Array(16);function Ol(){if(!Cl){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Cl=self.crypto.getRandomValues.bind(self.crypto)}return Cl(Hv)}n();s();n();s();var Qv=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),Ml={randomUUID:Qv};function Vv(e,A,j){if(Ml.randomUUID&&!A&&!e)return Ml.randomUUID();e=e||{};let t=e.random??e.rng?.()??Ol();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){if(j=j||0,j<0||j+16>A.length)throw new RangeError(`UUID byte range ${j}:${j+15} is out of buffer bounds`);for(let r=0;r<16;++r)A[j+r]=t[r];return A}return Lg(t)}var Aj=Vv;n();s();n();s();n();s();n();s();n();s();n();s();n();s();n();s();n();s();function Xv(e){if(e.length>=255)throw new TypeError("Alphabet too long");let A=new Uint8Array(256);for(let c=0;c<A.length;c++)A[c]=255;for(let c=0;c<e.length;c++){let l=e.charAt(c),m=l.charCodeAt(0);if(A[m]!==255)throw new TypeError(l+" is ambiguous");A[m]=c}let j=e.length,t=e.charAt(0),r=Math.log(j)/Math.log(256),o=Math.log(256)/Math.log(j);function i(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let l=0,m=0,B=0,k=c.length;for(;B!==k&&c[B]===0;)B++,l++;let f=(k-B)*o+1>>>0,g=new Uint8Array(f);for(;B!==k;){let y=c[B],F=0;for(let S=f-1;(y!==0||F<m)&&S!==-1;S--,F++)y+=256*g[S]>>>0,g[S]=y%j>>>0,y=y/j>>>0;if(y!==0)throw new Error("Non-zero carry");m=F,B++}let E=f-m;for(;E!==f&&g[E]===0;)E++;let h=t.repeat(l);for(;E<f;++E)h+=e.charAt(g[E]);return h}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let l=0,m=0,B=0;for(;c[l]===t;)m++,l++;let k=(c.length-l)*r+1>>>0,f=new Uint8Array(k);for(;c[l];){let y=A[c.charCodeAt(l)];if(y===255)return;let F=0;for(let S=k-1;(y!==0||F<B)&&S!==-1;S--,F++)y+=j*f[S]>>>0,f[S]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");B=F,l++}let g=k-B;for(;g!==k&&f[g]===0;)g++;let E=new Uint8Array(m+(k-g)),h=m;for(;g!==k;)E[h++]=f[g++];return E}function u(c){let l=a(c);if(l)return l;throw new Error("Non-base"+j+" character")}return{encode:i,decodeUnsafe:a,decode:u}}var Kg=Xv;var Wv="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Ha=Kg(Wv);n();s();var Jv=p.object({id:p.string(),state:p.nativeEnum(xr)}).passthrough(),Rl=class extends Error{constructor(j,t,r){super(j);this.activityId=t;this.userId=r;this.name="CashActivityError"}},qs=class extends Error{constructor(A,j){super(`Cash activity ${A} not found for user ${j}`),this.name="CashActivityNotFoundError"}},Ug=async({userID:e,activityId:A,accessToken:j})=>{let t=await N.api().bearer(j).get(`/cash/v1/users/${e}/cash-activity/${A}`);if(t.status===404)throw new qs(A,e);let r=Jv.safeParse(t.data);if(!r.success)throw new Rl(`Failed to parse cash activity response: ${r.error.message}`,A,e);return r.data};n();s();var Yv=p.object({activityId:p.string(),transactionId:p.string()}),Zv=3,Aq=1e3,Hg=async({accessToken:e,userID:A,idempotencyKey:j,signedTransaction:t,skipActivityRecording:r,skipNotification:o,swapInfo:i})=>{if(!e)throw new Error("Access token is required");if(!A)throw new Error("User ID is required");return Bo(async()=>{let a=await N.api().bearer(e).post(`/cash/v1/users/${A}/cash-account/send`,{idempotencyKey:j,chainId:"solana:101",signedTransaction:Ha.encode(Dm(t)?t.serialize():t.serialize({requireAllSignatures:!1,verifySignatures:!1})),encoding:"base58",skipActivityRecording:r,skipNotification:o,...i&&{swapInfo:i}}),u=Yv.safeParse(a.data);if(!u.success)throw new Error("Failed to parse transaction response");return u.data},()=>!0,Zv,Aq)};var eq=8,jq=K({seconds:1.5}),tq=e=>e==="failed"||e==="canceled"||e==="completed",rq=e=>e==="completed";var xs=async({unsignedTransaction:e,vaultProxy:A,accountIdentifier:j,signerAddress:t,idempotencyKey:r,isCash:o=!0,accessToken:i,userID:a,skipActivityRecording:u,skipNotification:c,swapInfo:l})=>{let m;typeof e=="string"?m=ue(e,"bs58"):m=e;let B=await oq(A,t);b.addBreadcrumb("cashTransfer","Signing transaction ...","info"),b.addBreadcrumb("cashTransfer",`Using vault proxy signing (isCash: ${o}, isCashKMS: ${B})`,"info");let k;o&&B?k={isCash:o,isCashKMS:B,data:{chainType:"solana",signingType:"transaction",message:new Uint8Array(Qi(m))}}:o?k={isCash:o,data:{chainType:"solana",signingType:"transaction",message:new Uint8Array(Qi(m))}}:k={chainType:"solana",signingType:"transaction",message:new Uint8Array(Qi(m))};let f=await A.sign(j,k);if(f.status==="error")throw new Error(f.message);let{signature:g}=f;if(!g)throw new Error("Failed to sign transaction: No signature returned");m.addSignature(new BA.PublicKey(t),Ha.decode(g));let E=m;b.addBreadcrumb("cashTransfer","Signed transaction","info"),b.addBreadcrumb("cashTransfer","Broadcasting transaction ...","info");let{activityId:h,transactionId:y}=await Hg({accessToken:i,userID:a,idempotencyKey:r,signedTransaction:E,skipActivityRecording:u,skipNotification:c,swapInfo:l});b.addBreadcrumb("cashTransfer","Polling for cash activity...","info");try{await Bo(async()=>{let F=await Ug({userID:a,activityId:h,accessToken:i});if(tq(F.state)){if(rq(F.state))return b.addBreadcrumb("cashTransfer",`Activity reached success terminal state: ${F.state}`,"info"),F;{let S=`Activity reached failed terminal state: ${F.state}.`;throw b.addBreadcrumb("cashTransfer",S,"info"),new Error(S)}}else throw new Error(`Activity state is ${F.state}, waiting for a terminal state.`)},F=>F instanceof qs||!!(F instanceof Error&&F.message.includes("waiting for")),eq,jq,!0)}catch(F){throw b.addBreadcrumb("cashTransfer",`Failed to poll for cash activity: ${F}`,"error"),new Error(`Transaction broadcast succeeded but activity confirmation failed: ${F}`)}return b.addBreadcrumb("cashTransfer","Broadcasted transaction","info"),y};async function oq(e,A){try{let t=(await e.getCashKMSAccount()).account.address;return A===t}catch{return b.addBreadcrumb("cashTransfer","Unable to get Cash-KMS account.","error"),!1}}n();s();var AE=q(P());n();s();var Qg=q(P());n();s();function vA(e){let A=e.reduce((j,t)=>j.add(t.name),new Set);return Array.from(A).join(" + ")}function Uo(e){return(0,Qg.useMemo)(()=>vA(e),[e])}n();s();n();s();var Ke="swapper";var Vg=[Ke,"quotes"],uA={quotesScope:()=>Vg,quotes:({sellTokenCaip19:e,buyTokenCaip19:A,taker:j,amountValue:t,amountType:r,slippageTolerance:o,priorityFee:i,tipAmount:a,takerDestination:u,enableAutoSlippage:c,preferredProvider:l,phantomCashAccount:m})=>[...Vg,{sellToken:e,buyToken:A,taker:j,takerDestination:u,amountValue:t,amountType:r,slippageTolerance:o,priorityFee:i,tipAmount:a,enableAutoSlippage:c,preferredProvider:l,phantomCashAccount:m}],transactions:e=>[Ke,"transactions",e],presence:e=>[Ke,"presence",e],slippageTolerance:()=>[Ke,"slippageTolerance"],priorityFee:()=>[Ke,"priorityFee"],tipAmount:()=>[Ke,"tipAmount"],lastSubmittedPairs:()=>[Ke,"lastSubmittedPairsV2"],lastSelectedTokens:()=>[Ke,"lastSelectedTokens"],slippageSettings:()=>[Ke,"slippageSettings"],priorityFeeSettings:()=>[Ke,"priorityFeeSettings"],tipSettings:()=>[Ke,"tipSettings"],hasViewedAutoSlippageOptIn:()=>[Ke,"hasViewedAutoSlippageOptIn"],optimisticUpdates:()=>[Ke,"optimisticUpdates"],autoSlippageMigrationVersion:()=>[Ke,"autoSlippageMigrationVersion"]};n();s();var _l=(r=>(r[r.Always=1/0]="Always",r[r.Short=K({days:1})]="Short",r[r.Medium=K({days:3})]="Medium",r[r.Long=K({days:7})]="Long",r))(_l||{}),zg=(o=>(o[o.Immediate=0]="Immediate",o[o.Short=K({minutes:1})]="Short",o[o.Medium=K({minutes:2.5})]="Medium",o[o.Long=K({minutes:60})]="Long",o[o.Never=1/0]="Never",o))(zg||{}),Ts=(t=>(t[t.Short=K({seconds:20})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:5})]="Long",t))(Ts||{});var Wg=async({callerAddress:e,contractAddress:A,networkId:j,sellAmount:t,allowanceTarget:r,approvalExactAmount:o,exchangeAddress:i,value:a,transactionData:u,type:c})=>{let l=[],m=[];if(A&&(await Nk({callerAddress:e,spender:r,networkId:j,contractAddress:A})).lt(o??t.toString())){let f=await Lk({callerAddress:e,spender:r,networkId:j,contractAddress:A,exactAmount:o});l.push(f),m.push(`${c}-approval`)}let B=io.parse({type:"0x2",from:e,data:u,chainId:I.getEVMNetworkIDValue(j),to:i,...a==="0"?{}:{value:`0x${new H(a).toString(16)}`}});return l.push(B),m.push(c),{transactions:l,transactionTypes:m}},Ps=async({networkId:e,callerAddress:A,quote:j})=>{let{sellAmount:t,steps:r}=j,o=[],i=[],a=[];for(let u of r){let{allowanceTarget:c,exchangeAddress:l,value:m,transactionData:B,sellToken:k,buyToken:f,approvalMetadata:g}=u,E=k.resourceType==="address"?k.address:null,h=I.compareNetworkID(k.chainId,f.chainId)===0?"swap":"bridge";if(!c||!l||!B||!m)throw new Error("Missing bridge step data for EVM bridge quote.");let y=await Wg({callerAddress:A,contractAddress:E,networkId:e,sellAmount:t,allowanceTarget:c,approvalExactAmount:u.approvalExactAmount,exchangeAddress:l,value:m,transactionData:B,type:h});o.push(...y.transactions),i.push(...y.transactionTypes),a.push({sellToken:k,buyToken:f,approvalMetadata:g}),y.transactionTypes.length==2&&y.transactionTypes.find(F=>F.includes("approval"))&&a.push({sellToken:k,buyToken:f,approvalMetadata:g})}return{type:"evm",transactions:o,transactionTypes:i,transactionPairs:a}},Gs=async({quote:e,connection:A})=>{let j=[],t=[],r=[];for(let o of e.steps){let{transactionData:i,sellToken:a,buyToken:u}=o,c=I.compareNetworkID(a.chainId,u.chainId)===0?"swap":"bridge",l=await Jg(i,A);j.push(Xc.serialize(l).transaction),t.push(c),r.push({sellToken:a,buyToken:u})}return{type:"solana",transactions:j,transactionTypes:t,transactionPairs:r}},Cs=async({networkId:e,callerAddress:A,quote:j,sellFungible:t})=>{let r=t.type==="ERC20"&&t?.data.tokenAddress?t.data.tokenAddress:null,{allowanceTarget:o,exchangeAddress:i,sellAmount:a,value:u}=j;return{type:"evm",...await Wg({callerAddress:A,contractAddress:r,networkId:e,sellAmount:a,allowanceTarget:o,exchangeAddress:i,value:u,transactionData:j.transactionData,type:"swap"})}},Os=async({quote:e})=>{let A=[],j=[],t=[];for(let r of e.steps){let{transactionData:o,sellToken:i,buyToken:a}=r,u=I.compareNetworkID(i.chainId,a.chainId)===0?"swap":"bridge";A.push(o),j.push(u),t.push({sellToken:i,buyToken:a})}return{type:"sui",transactions:A,transactionTypes:j,transactionPairs:t}},Jg=async(e,A)=>{let j=ue(e,"bs58");return await So(j,{connection:A,transactionType:"Swap"})},Ho=async({quote:e,connection:A})=>{let j=e.transactionData.map(i=>Jg(i,A)),r=(await Promise.all(j)).map(i=>Xc.serialize(i).transaction);return{type:"solana",transactionTypes:r.map(()=>"swap"),transactions:r}},Yg=async({quote:e,connection:A})=>Ho({quote:e,connection:A}),Ms=async({quote:e})=>({type:"sui",transactionTypes:Array(e.transactionData.length).fill("swap"),transactions:e.transactionData}),Jj=({callerAddress:e,sellFungible:A,quote:j})=>{let{connection:t}=cj(),r=uA.transactions(j);return X({queryKey:r,enabled:!!j&&!!A,gcTime:0,staleTime:0,refetchInterval:Ts.Short,async queryFn(){try{if(!j)throw new Error("Missing quote");if(!A)throw new Error("Missing sell token");let o=A.data.chain.id;if(Wj(j)){if(I.isEVMNetworkID(o)&&Ze(j))return await Cs({networkId:o,callerAddress:e,quote:j,sellFungible:A});if(I.isSolanaNetworkID(o)&&Le(j))return Ho({quote:j,connection:t});if(I.isSuiNetworkID(o)&&Bt(j))return Ms({quote:j});throw new Error(`Single network swap quote not supported for network ID ${o}`)}if(dA(j)){if(I.isEVMNetworkID(o))return await Ps({networkId:o,callerAddress:e,quote:j});if(I.isSolanaNetworkID(o))return await Gs({quote:j,connection:t});if(I.isSuiNetworkID(o))return await Os({quote:j});throw new Error(`Bridge quote not supported for network ID ${o}`)}throw new Error("Swap quote type not supported")}catch(o){throw o instanceof Error&&b.captureError(o,"swapper"),o}}})};n();s();n();s();var Qo=e=>e.steps.map(A=>A.tool);var OA=e=>e?dA(e)?Qo(e):e?.sources??[]:[];function eE({sender:e}){let{t:A}=hA(),{currentQuote:j}=iA(),t=$(m=>m.buyFungible),r=$(m=>m.sellFungible),o=Uo(OA(j)),{data:i}=Jj({callerAddress:e,quote:j,sellFungible:r}),a=i?.transactionPairs?.flatMap(m=>[...Fr(m.sellToken)??[],...Fr(m.buyToken)??[]])??[],u=[...new Set(a)],{fungibles:c}=$j({keys:u});return{pendingActivityRows:(0,AE.useMemo)(()=>ft({swapTransactions:i,sellFungible:r,buyFungible:t,fungibles:c,t:A,currentQuote:j,provider:o}),[i,r,t,c,A,j,o])}}function ft({swapTransactions:e,sellFungible:A,buyFungible:j,fungibles:t,currentQuote:r,provider:o,t:i}){let a={pendingSwapActivityRows:[],pendingApprovalActivityRows:[]};return e?e.type==="evm"?e.transactionTypes.reduce((u,c,l)=>{let m=A,B=j,k,f=e.transactionPairs;if(f&&f[l]){let g=f[l];m=Qa(g.sellToken,t)??A,B=Qa(g.buyToken,t)??j,k=g.approvalMetadata}if(c.includes("approval")){let g=m?.data.symbol??"";u.pendingApprovalActivityRows.push({topLeft:k?{text:`${i("transactionsPendingApproving")} ${k.symbol}`}:{text:`${i("transactionsPendingApproving")} ${g}`}})}else m&&B&&u.pendingSwapActivityRows.push(Zg({sellFungible:m,buyFungible:B,sellAmount:r?.sellAmount,buyAmount:r?.buyAmount,provider:o,isBridge:c.includes("bridge"),t:i}));return u},a):e.transactionTypes.reduce((u,c,l)=>{let m=A,B=j,k=e.transactionPairs;if(k&&k[l]){let f=k[l];m=Qa(f.sellToken,t)??A,B=Qa(f.buyToken,t)??j}return m&&B&&u.pendingSwapActivityRows.push(Zg({sellFungible:m,buyFungible:B,sellAmount:r?.sellAmount,buyAmount:r?.buyAmount,provider:o,isBridge:c.includes("bridge"),t:i})),u},a):a}var Zg=({sellFungible:e,buyFungible:A,sellAmount:j,buyAmount:t,provider:r,isBridge:o,t:i})=>{let a=e.data.symbol,u=A.data.symbol,c=kA(j??0,e.data.decimals??0),l=kA(t??0,A.data.decimals??0);return{topLeft:{text:`${i(o?"transactionsPendingBridging":"transactionsPendingSwapping")} on ${r}`},topRight:{text:`${l} ${u}`,color:"spotPositive"},bottomLeft:{text:`${a} \u2192 ${u}`},bottomRight:{text:`${c} ${a}`}}},Qa=(e,A)=>A.find(j=>(Fr(e)??[]).includes(j.data.key));var Va=class{constructor(A,j,t,r,o,i,a,u){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i;this.authRepository=a;this.cashAccount=u}async createTransaction(){return Yg({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){let i=j.transactions[0],a=ue(i,"bs58"),u=Um(a),c=a.message.header.numRequiredSignatures,l=u.slice(0,c),m=this.cashAccount?.addressDetails.address;if(!m)throw new Error("Cash account address not found");let B=l.some(y=>y.toBase58()===m),k=B?m:this.takerAddress,f=await this.authRepository?.getUser();if(!f)throw new Error("User not found for swap");let{accessToken:g,userID:E}=f,h=await xs({unsignedTransaction:i,vaultProxy:r,accountIdentifier:A,signerAddress:k,idempotencyKey:this.executionId,isCash:B,accessToken:g,userID:E,skipActivityRecording:!1,swapInfo:this.getSwapInfo(this.executingQuote,this.quote),waitForActivityState:"completed"});return b.addBreadcrumb("cashTransfer","Broadcasted transaction","info"),{id:h,networkID:this.networkId}}async waitForConfirmation(A){let j=Nt(A.networkID);await Hj({connection:j,signature:A.id})}parsePendingActivity(A,j){let t=vA(OA(A.quote));return ft({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}getSwapInfo(A,j){let t=A.sell,r=A.buy,o=A.quoteInput,i=t.data.walletAddress,a=r.data.walletAddress;if(!i&&o?.taker){let u=GA(o?.taker);u.resourceType==="address"&&(i=u.address)}if(!a&&o?.takerDestination){let u=GA(o?.takerDestination);u.resourceType==="address"&&(a=u.address)}return{input:{owner:i,mint:t.data.tokenAddress??"",amount:j.sellAmount,symbol:t.data.symbol??void 0,name:t.data.name??void 0,decimals:t.data.decimals,logoUri:t.data.logoUri??void 0},output:{owner:a,mint:r.data.tokenAddress??"",amount:j.buyAmount,symbol:r.data.symbol??void 0,name:r.data.name??void 0,decimals:r.data.decimals,logoUri:r.data.logoUri??void 0}}}};n();s();var za=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.evmSwapCommand=i}createTransaction(){return Ps({networkId:this.networkId,callerAddress:this.takerAddress,quote:this.quote})}async swap(A,j,t,r,o){return this.evmSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.evmSwapCommand.waitForConfirmation(A)}};n();s();n();s();var nq=1.3,sq=e=>{switch(e){case tA.Ethereum.Mainnet:case tA.Ethereum.Sepolia:return 8e5;case tA.Polygon.Mainnet:case tA.Polygon.Amoy:return 5e5;case tA.Base.Mainnet:case tA.Base.Sepolia:return 5e5;case tA.Arbitrum.Mainnet:case tA.Arbitrum.Sepolia:return 5e5;default:return 0}},iq=e=>{switch(e){case tA.Ethereum.Mainnet:case tA.Ethereum.Sepolia:return 6e4;case tA.Polygon.Mainnet:case tA.Polygon.Amoy:return 6e4;case tA.Base.Mainnet:case tA.Base.Sepolia:return 6e4;case tA.Arbitrum.Mainnet:case tA.Arbitrum.Sepolia:return 6e4;default:return 0}},aq=(e,A)=>e.steps.flatMap(t=>t.gasCosts??[sq(A)]),pq=(e,A,j)=>{let t=Ze(A)?[A.gas]:aq(A,j);return e?e.transactionTypes.map(r=>r.includes("approval")?iq(j):t.shift()??0):t},Wt={estimateGas:({swapTransactions:e,evmGasEstimation:A,currentQuote:j,scanResult:t,networkID:r,includeGasBuffer:o,gasBuffer:i})=>{let{maxFeePerGas:a,maxPriorityFeePerGas:u}=A,c=pq(e,j,r),l=t?.advancedDetails?.gas;return t?.advancedDetails?.gasLimit>0&&(c=l),c.map(B=>({maxFeePerGas:a,maxPriorityFeePerGas:u,networkID:r,gasLimit:new w(B).multipliedBy(o?i??nq:1).integerValue(w.ROUND_CEIL)}))}};n();s();var cq=({networkID:e,unsignedTransaction:A,pendingActivityRows:j,accountIdentifier:t,accountSigner:r,storage:o,includeCallPayload:i})=>({accountSigner:r,accountIdentifier:t,networkID:e,unsignedTransaction:A,...i&&{callPayload:{from:A.from,to:A.to,data:A.data,value:A.value}},pendingTransactionInput:{ownerAddress:A.from,networkID:e,data:{nonce:"",unsignedTransaction:A,hash:""},type:"swap",display:{summary:j}},storage:o}),Xa=async({transactions:e,transactionTypes:A,networkID:j,gasEstimation:t,pendingApprovalActivityRows:r,pendingSwapActivityRows:o,accountIdentifier:i,accountSigner:a,storage:u})=>{let c=!0,l="";for(let[m,B]of e.entries()){let k=t[m],f={gas:`0x${k.gasLimit.toString(16)}`,maxFeePerGas:`0x${k.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${k.maxPriorityFeePerGas.toString(16)}`},g=io.parse({...B,...f}),h=A[m].includes("approval")?r:o,y=cq({networkID:j,accountIdentifier:i,pendingActivityRows:h.shift(),accountSigner:a,storage:u,unsignedTransaction:g,includeCallPayload:c});try{l="",l=await Kk(y)}catch(F){return{signature:l,error:F instanceof Error?F:new Error("Failed to process EVM swap transaction")}}c&&(c=!1)}return{signature:l}};var jE="standard",Wa=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.gasEstimation=i}createTransaction(){return Cs({quote:this.quote,callerAddress:this.takerAddress,networkId:this.networkId,sellFungible:this.executingQuote.sell})}async swap(A,j,t,r,o){let i=this.gasEstimation??await this.estimateGas(this.quote,this.executingQuote.response,jE,j,t);if(!i)throw new Error(`No gas estimation found for ${jE}`);let a=this.parsePendingActivity(this.executingQuote,j),{signature:u,error:c}=await b.startSpan("Process EVM Swap Txns",()=>Xa({transactions:j.transactions,transactionTypes:j.transactionTypes,networkID:this.networkId,gasEstimation:i,pendingSwapActivityRows:a.pendingSwapActivityRows,pendingApprovalActivityRows:a.pendingApprovalActivityRows,accountIdentifier:A,accountSigner:r,storage:o}));if(c)throw c;return{networkID:this.networkId,id:u}}async waitForConfirmation(A){await Ok(A.networkID,A.id)}async estimateGas(A,j,t,r,o){let i=await Fo(this.networkId,!0);if(!i)return;let a=i[t];if(!a)return;let u={networkID:this.networkId,gasLimit:new H(1),maxFeePerGas:a.maxFeePerGas,maxPriorityFeePerGas:a.maxPriorityFeePerGas};return Wt.estimateGas({swapTransactions:r,evmGasEstimation:u,currentQuote:A,scanResult:o??void 0,includeGasBuffer:!0,networkID:this.networkId,gasBuffer:j.gasBuffer})}parsePendingActivity(A,j){let t=vA(OA(A.quote));return ft({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};n();s();var tE=q(Rm());n();s();n();s();var uq=({networkID:e,transaction:A,feePayer:j,connection:t,pendingActivityRows:r,accountIdentifier:o,accountSigner:i,storage:a})=>({accountSigner:i,accountIdentifier:o,transaction:A,feePayer:j,connection:t,opts:{skipPreflight:!0},pendingTransactionInput:{ownerAddress:j.toBase58(),networkID:e,data:{signature:""},type:"swap",display:{summary:r}},storage:a}),Ya=async({callerAddress:e,connection:A,networkID:j,transactions:t,pendingSwapActivityRows:r,accountIdentifier:o,accountSigner:i,storage:a})=>{let u=new BA.PublicKey(e),c="";for(let[l,m]of t.entries()){let B=ue(m,"bs58"),k=uq({networkID:j,transaction:B,feePayer:u,connection:A,pendingActivityRows:r[l],accountIdentifier:o,accountSigner:i,storage:a});try{c="",c=await bo(k),l!==t.length-1&&await Hj({connection:A,signature:c})}catch(f){return{signature:c??"",error:f instanceof Error?f:new Error("Failed to process solana swap transaction")}}}return{signature:c??""}};var Yj=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i}async createTransaction(){return Ho({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){let i=this.parsePendingActivity(this.executingQuote,j),{signature:a,error:u}=await Ya({callerAddress:this.takerAddress,connection:this.connection,networkID:this.networkId,transactions:j.transactions,pendingSwapActivityRows:i.pendingSwapActivityRows,accountIdentifier:A,accountSigner:r,storage:o});if(u)throw u;return{networkID:this.networkId,id:a}}async waitForConfirmation(A){let j=Nt(A.networkID);await Hj({connection:j,signature:A.id})}parsePendingActivity(A,j){let t=vA(OA(A.quote));return ft({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};var lq=p.object({signature:p.string()}),Za=class extends Yj{constructor(j,t,r,o,i,a,u){super(j,t,r,o,i,a);this.executingQuote=j;this.takerAddress=t;this.networkId=r;this.quote=o;this.executionId=i;this.connection=a;this.gaslessSignature=u}async swap(j,t,r,o,i){let a=this.quote.transactionData[0];if(!a)throw new Error("No transaction data found in quote");let u=new BA.PublicKey(this.takerAddress),l=this.parsePendingActivity(this.executingQuote,t).pendingSwapActivityRows[0];if(!l)throw new Error("Unable to create pending activity for gasless");let m=await pa({accountIdentifier:j,feePayer:u,connection:this.connection,accountSigner:o,transaction:ue(a,"bs58"),pendingTransactionInput:{ownerAddress:u.toBase58(),networkID:this.networkId,data:{signature:this.gaslessSignature},type:"swap",display:{summary:l}},storage:i,opts:{}});return{id:(await this.submitGaslessSwap(this.gaslessSignature,m)).signature,networkID:this.networkId}}async submitGaslessSwap(j,t){let r=await N.api().post("/gasless-swap/v1/submit",{quoteSignature:j,encoding:"bs58",chainId:this.networkId,transaction:tE.default.encode(t.serialize())}),o=lq.safeParse(r.data);if(!o.success)throw new Error("Failed to submit gasless swap");return o.data}};n();s();var dq=p.object({quoteId:p.string(),transactionId:p.string()}),A6=class extends Yj{constructor(j,t,r,o,i,a){super(j,t,r,o,i,a);this.executingQuote=j;this.takerAddress=t;this.networkId=r;this.quote=o;this.executionId=i;this.connection=a}async swap(j,t,r,o,i){let a=this.quote.transactionData[0];if(!a)throw new Error("No transaction data found in quote");let u=new BA.PublicKey(this.takerAddress),l=this.parsePendingActivity(this.executingQuote,t).pendingSwapActivityRows[0];if(!l)throw new Error("Unable to create pending activity for rfq");let m=await pa({accountIdentifier:j,feePayer:u,connection:this.connection,accountSigner:o,transaction:ue(a,"bs58"),pendingTransactionInput:{ownerAddress:u.toBase58(),networkID:this.networkId,data:{signature:""},type:"swap",display:{summary:l}},storage:i,opts:{}});return{id:(await this.submitRFQSwap(m)).transactionId,networkID:this.networkId}}async submitRFQSwap(j){let t=Buffer.from(j.serialize()).toString("base64"),r=await N.api().post("/v0/rfq/swap",{chainId:this.networkId,quoteId:this.quote.rfqProps?.quoteId,signedPayload:t},{headers:{"X-Request-Id":this.executionId}}),o=dq.safeParse(r.data);if(!o.success)throw new Error("Failed to submit rfq swap");return o.data}};n();s();var e6=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i;this.solanaSwapCommand=new Yj(A,j,t,A.quote,o,i)}solanaSwapCommand;createTransaction(){return Gs({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){return this.solanaSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.solanaSwapCommand.waitForConfirmation(A)}};n();s();n();s();n();s();var mq=({networkID:e,transaction:A,feePayer:j,pendingActivityRows:t,accountIdentifier:r,accountSigner:o,storage:i})=>({accountSigner:o,accountIdentifier:r,transaction:A,pendingTransactionInput:{ownerAddress:j,networkID:e,data:{digest:""},type:"swap",display:{summary:t}},storage:i}),j6=async({callerAddress:e,networkID:A,transactions:j,pendingSwapActivityRows:t,accountIdentifier:r,accountSigner:o,storage:i})=>{let a="";for(let[u,c]of j.entries()){let l=mq({networkID:A,transaction:wo.deserializeTransactionString(c),feePayer:e,pendingActivityRows:t[u],accountIdentifier:r,accountSigner:o,storage:i});try{a=(await Uk(l)).digest,u!==j.length-1&&await ia(A,a)}catch(m){return{signature:a??"",error:m instanceof Error?m:new Error("Failed to process sui swap transaction")}}}return{signature:a??""}};var zo=class{constructor(A,j,t,r,o){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o}async createTransaction(){return Ms({quote:this.quote})}async swap(A,j,t,r,o){let i=this.parsePendingActivity(this.executingQuote,j),{signature:a,error:u}=await j6({callerAddress:this.takerAddress,networkID:this.networkId,transactions:j.transactions,pendingSwapActivityRows:i.pendingSwapActivityRows,accountIdentifier:A,accountSigner:r,storage:o});if(u)throw u;return{networkID:this.networkId,id:a}}async waitForConfirmation(A){await ia(this.networkId,A.id)}parsePendingActivity(A,j){let t=vA(OA(A.quote));return ft({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};var t6=class{constructor(A,j,t,r,o){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.suiSwapCommand=new zo(A,j,t,A.quote,o)}suiSwapCommand;async createTransaction(){return Os({quote:this.quote})}async swap(A,j,t,r,o){return this.suiSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.suiSwapCommand.waitForConfirmation(A)}};var r6=class{create(A,j,t,r,o,i,a){if(bg(A.quote)&&(NA(A.buy)||NA(A.sell)))return new Va(A,j,t,A.quote,Aj(),r,o,i);if(I.isSolanaNetworkID(t)&&Le(A.quote)){let u=new Yj(A,j,t,A.quote,Aj(),r);return A.quote.rfqProps?new A6(A,j,t,A.quote,Aj(),r):A.quote.gaslessSignature?new Za(A,j,t,A.quote,Aj(),r,A.quote.gaslessSignature):u}else{if(I.isEVMNetworkID(t)&&Ze(A.quote))return this.createEvmSwapCommand(A,j,t,a);if(I.isSuiNetworkID(t)&&Bt(A.quote))return new zo(A,j,t,A.quote,Aj());if(dA(A.quote)){if(I.isSolanaNetworkID(t))return new e6(A,j,t,A.quote,Aj(),r);if(I.isEVMNetworkID(t)){let u=this.createEvmSwapCommand(A,j,t,a);return new za(A,j,t,A.quote,Aj(),u)}else if(I.isSuiNetworkID(t))return new t6(A,j,t,A.quote,Aj())}}throw new Error("Unsupported SwapQuote}")}createEvmSwapCommand(A,j,t,r){let o=r?r.filter(oa):void 0;return o&&o.length===0&&(o=void 0),new Wa(A,j,t,A.quote,Aj(),o)}};n();s();n();s();var Rs={name:"SwapperNoQuotes",message:"No quotes found"},Xo=class extends jB{createStreamUrl({amount:A,amountUsd:j,buy:t,sell:r,taker:o,takerDestination:i,slippageTolerance:a,exactOut:u,autoSlippage:c,priorityFee:l,tipAmount:m,isLedger:B,phantomCashAccount:k}){let f=new URLSearchParams({taker:o,takerDestination:i,buyToken:M(U(t)),sellToken:M(U(r)),sellAmount:A,sellAmountUsd:j??"",exactOut:u?"true":"false",autoSlippage:c?"true":"false",clientEnableGaslessSwap:"true",phantomCashAccount:k?"true":"false"});return a&&f.set("slippageTolerance",String(a)),l&&f.set("priorityFee",String(l)),m&&f.set("tipAmount",String(m)),B!==void 0&&f.set("isLedger",String(B)),`${this.getApiEnvironment()}/swap/v2/stream/quotes?${f.toString()}`}handleNewQuoteResponse(A,j){let t=this.safeJsonParse(A);if(!t.success||!t.data){j({type:"error",errorResponse:Rs});return}try{let r=this.parseSwapQuotesResponse(t.data);j({type:"newQuoteResponse",quoteResponse:r})}catch{j({type:"error",errorResponse:Rs})}}handleErrorQuoteResponse(A,j){let t=this.safeJsonParse(A);if(!t.success||!t.data){j({type:"error",errorResponse:Rs});return}try{let r=Ca.safeParse(t.data);j({type:"error",errorResponse:r.success?r.data:Rs})}catch{j({type:"error",errorResponse:Rs})}}parseSwapQuotesResponse(A){let j=new DA({key:"SwapperNoQuotes"});if(ws.safeParse(A?.type).success===!1)throw b.captureError(new Error("Failed to parse a valid quote type."),"swapper"),new Error("Invalid input");let t=bs.safeParse(A);if(!t.success)throw b.captureError(new Error("Failed to parse a valid swap quotes response."),"swapper"),j;if(t.data.includesAllProviders&&t.data.quotes.length===0)throw j;return t.data}};var o6=class extends Xo{eventSource;open(A,j){this.close();let t=this.createStreamUrl(A);this.eventSource=new da(t,this.getOptionsWithAuth(t));let r=o=>{switch(o.type){case"new-quote-response":this.handleNewQuoteResponse(o.data,j);break;case"error-quote-response":this.handleErrorQuoteResponse(o.data,j);break;case"open":j({type:"open"});break;case"error":j({type:"error",errorResponse:{name:"UnknownError",message:o.message}});break;case"close":j({type:"close"});break}};this.eventSource.addEventListener("new-quote-response",r),this.eventSource.addEventListener("error-quote-response",r),this.eventSource.addEventListener("open",r),this.eventSource.addEventListener("error",r),this.eventSource.addEventListener("close",r)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};n();s();var n6=class extends Xo{eventSource;open(A,j){this.close();let t=this.createStreamUrl(A);this.eventSource=new da(t,this.getOptionsWithAuth(t));let r=o=>{switch(o.type){case"new-quote-response":this.handleNewQuoteResponse(o.data,j);break;case"error-quote-response":this.handleErrorQuoteResponse(o.data,j);break;case"open":j({type:"open"});break;case"error":j({type:"error",errorResponse:{name:"UnknownError",message:o.message}});break;case"close":j({type:"close"});break}};this.eventSource.addEventListener("new-quote-response",r),this.eventSource.addEventListener("error-quote-response",r),this.eventSource.addEventListener("open",r),this.eventSource.addEventListener("error",r),this.eventSource.addEventListener("close",r)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};n();s();var s6=class{constructor(A){this.producer=A}listeners=new Set;openStream(A){this.listeners.forEach(j=>j.onEvent({type:"openRequested"})),this.producer.close(),this.producer.open(A,j=>{this.listeners.forEach(t=>t.onEvent(j)),j.type==="error"&&this.closeStream()})}closeStream(){this.producer.close()}subscribe(A){this.listeners.add(A)}unsubscribe(A){this.listeners.delete(A)}};n();s();n();s();var xA=(e,A)=>!!e&&!!A&&I.compareNetworkID(e,A)!==0;n();s();n();s();var rE=q(P());n();s();function ne({key:e,queryKey:A,defaultValue:j=null}){let t=wA();return X({enabled:!0,queryKey:A,gcTime:_l.Long,staleTime:1/0,async queryFn(){try{return await t.get(e)}catch(r){return r instanceof Error&&b.captureError(r,"swapper"),j}}})}function le({key:e,queryKey:A}){let j=wA(),t=pA();return IA({async mutationFn(r){try{return await j.set(e,r)}catch(o){o instanceof Error&&b.captureError(o,"swapper");return}},async onMutate(r){await t.cancelQueries({queryKey:A});let o=t.getQueryData(A);return t.setQueryData(A,r),{previousValue:o}},onError(r,o,i){t.setQueryData(A,i?.previousValue)}})}var kq={type:"auto"},MA=()=>{let{slippageSetting:e,isFetched:A,save:j}=Bq();return{isFetched:A,selectedSetting:e??kq,setSlippageSetting:j}},Bq=()=>{let{data:e,isFetched:A}=ne({key:"slippageSettings",queryKey:uA.slippageSettings()}),{mutateAsync:j}=le({key:"slippageSettings",queryKey:uA.slippageSettings()}),t=(0,rE.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,slippageSetting:e,save:t}};n();s();async function Wo({transactions:e,locale:A,url:j,deviceId:t,takerAddress:r,networkId:o,slippageType:i,quote:a,quoteResponse:u,isSimulationKilled:c}){try{return c?{status:"skipped"}:{status:"success",result:await ca(A,t,{type:"transaction",userAccount:r,params:fq(e),url:j,networkID:o,context:dA(a)?"bridge":Ig(a)?"gaslessSwap":"swap",provider:gq(a),slippageType:i,metadata:{swapper:{quoteOutputAmount:a.buyAmount,quoteOutputToken:M(u.buyToken),quoteInputAmount:a.sellAmount,quoteInputToken:M(u.sellToken)}}})}}catch(l){return{status:"error",error:l}}}var fq=e=>{switch(e.type){case"evm":return{transactions:e.transactions};case"solana":return{transactions:e.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}};case"sui":return{transactions:e.transactions,method:"signAndSendTransaction"}}},gq=e=>{let A=dA(e)?Qo(e):e?.sources??[];return vA(A)};n();s();n();s();function ej(e,A,j){if(A.lte(0))return null;let t=M({chainId:e,resourceType:"nativeToken",slip44:I.getSlip44(e)}),r=I.getTokenDecimals(e),o=I.getTokenSymbol(e);if(!t||!r||!o)return null;let i=A.div(hr(r)),a=j[t];return a?.usd?i.times(a.usd).toNumber():null}var Eq={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"};function yq(e,A){return{type:e,amountUsd:new w(A.amountUSD??0),amount:new w(A.amount??0)}}function Jo(e){return e.steps.flatMap(j=>j.includedFeeCosts).reduce((j,t)=>{if(!t)return j;let r=Eq[t.name];return r&&new w(t.amount).gt(0)&&j.push(yq(r,t)),j},[])}function Yo(e,A,j){let t=e.steps.reduce((r,o)=>r.plus(o.nonIncludedNonGasFees),new w(0));return t.isZero()?[]:[{type:"nonIncludedNonGas",amountUsd:new w(ej(A,t,j)??0),amount:t}]}var i6=class{constructor(A,j,t,r,o){this.networkID=A;this.account=j;this.priceClient=t;this.quoteInput=r;this.quoteResponse=o}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.calculateNetworkFee(t,A,r,j),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}createSwapTransactions(A){return Ps({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:A})}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new w(t.percentage),amountUsd:new w(0),amount:new w(0)}]:A}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}async calculateNetworkFee(A,j,t,r){let o=await this.estimateGas(j,A,r);if(!o)throw new Error("Unable to estimate gas");if(!t.usd)throw new Error("Price data not found");let i=o[0],a=I.getTokenDecimals(this.networkID),u=i.gasLimit.times(i.maxFeePerGas);return{type:"evmGas",amountUsd:new w(u).shiftedBy(-a).times(t.usd),amount:u}}async estimateGas(A,j,t){let r=await Fo(this.networkID,!0);if(!r)return;let o=r.standard;if(!o)return;let i={networkID:this.networkID,gasLimit:new w(1),maxFeePerGas:o.maxFeePerGas,maxPriorityFeePerGas:o.maxPriorityFeePerGas},a=await Wo({transactions:j,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?"auto":"fixed",quote:A,quoteResponse:this.quoteResponse,isSimulationKilled:t});return Wt.estimateGas({swapTransactions:j,evmGasEstimation:i,currentQuote:A,scanResult:a.status==="success"?a.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let A=this.account.addresses.find(t=>t.networkID===this.networkID);if(!A)throw new Error(`No address found for chain ${this.networkID}`);let j={...A};return lo(j)&&(j.address=j.address.toLowerCase()),j}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};n();s();var a6=class{constructor(A,j,t,r,o){this.networkID=A;this.account=j;this.priceClient=t;this.quoteInput=r;this.quoteResponse=o}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.calculateNetworkFee(t,A,j),o=this.appendPhantomFee([r],A);return{quote:A,fees:{totalFees:this.sumFees(o),fees:o},swapTransactions:t}}createSwapTransactions(A){return Cs({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:A,sellFungible:this.quoteInput.sell})}appendPhantomFee(A,j){let t=j.fees.find(r=>r.type==="phantom");return t?[...A,{type:"phantom",percentage:new w(t.percentage),amountUsd:new w(0),amount:new w(0)}]:A}async calculateNetworkFee(A,j,t){let r=await this.estimateGas(j,A,t);if(!r)throw new Error("Unable to estimate gas");let o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let i=r[0],a=I.getTokenDecimals(this.networkID),u=i.gasLimit.times(i.maxFeePerGas);return{type:"evmGas",amountUsd:new w(u).shiftedBy(-a).times(o.usd),amount:u}}async estimateGas(A,j,t){let r=await Fo(this.networkID,!0);if(!r)return;let o=r.standard;if(!o)return;let i={networkID:this.networkID,gasLimit:new w(1),maxFeePerGas:o.maxFeePerGas,maxPriorityFeePerGas:o.maxPriorityFeePerGas},a=await Wo({transactions:j,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?"auto":"fixed",quote:A,quoteResponse:this.quoteResponse,isSimulationKilled:t});return Wt.estimateGas({swapTransactions:j,evmGasEstimation:i,currentQuote:A,scanResult:a.status==="success"?a.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let A=this.account.addresses.find(t=>t.networkID===this.networkID);if(!A)throw new Error(`No address found for chain ${this.networkID}`);let j={...A};return lo(j)&&(j.address=j.address.toLowerCase()),j}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};n();s();var p6=class{constructor(A,j,t){this.networkID=A;this.priceClient=j;this.connection=t}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.calculateNetworkFee(t,r),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}createSwapTransactions(A){return Gs({quote:A,connection:this.connection})}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new w(t.percentage),amountUsd:new w(0),amount:new w(0)}]:A}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}async calculateNetworkFee(A,j){if(!j.usd)throw new Error("Price data not found");let t=A.transactions.map(c=>this.processEncodedTx(c,this.networkID,this.connection)),o=(await Promise.all(t)).map(c=>c.networkFeeEstimation.value),i=new w(o[0]);return{type:"solanaNetwork",amountUsd:i.div(new w(BA.LAMPORTS_PER_SOL)).times(j.usd),amount:i}}async processEncodedTx(A,j,t){let r=ue(A,"bs58");return await ao(r,t),{networkFeeEstimation:await aa(j,[r.message])}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};n();s();n();s();function oE(e,A){return hq(e.fees,j=>{switch(j.type){case"gasless":return{type:"gasless",amountUsd:new w(0),amount:new w(0),percentage:new w(j.percentage)};case"phantom":return{type:"phantom",percentage:new w(j.percentage),amountUsd:new w(0),amount:new w(0)};case"ata":return new w(j.amount).isZero()?void 0:{type:"ata",amountUsd:new w(j.amount),amount:new w(0)};case"gasless_network":return{type:"solanaGaslessNetwork",amountUsd:new w(j.amount),amount:new w(0)};case"network":{let{amountUsd:t,amount:r}=Dl(j,A);return{type:"solanaNetwork",amountUsd:t,amount:r}}case"tips":{let{amountUsd:t,amount:r}=Dl(j,A);return{type:"tips",amountUsd:t,amount:r}}case"priority_fee":{let{amountUsd:t,amount:r}=Dl(j,A);return{type:"priorityFee",amountUsd:t,amount:r}}default:return}})}function Dl(e,A){let j=new w(e.amount);return{amountUsd:j.div(new w(BA.LAMPORTS_PER_SOL)).times(A),amount:j}}function hq(e,A){return e.reduce((j,t,r)=>{let o=A(t,r,e);return o!=null&&j.push(o),j},[])}var nE=["solanaNetwork","tips","priorityFee"],c6=class{constructor(A,j,t){this.networkID=A;this.priceClient=j;this.connection=t}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let r=(await this.priceClient.getPrice(this.getNativeTokenCaip19())).usd;if(!r)throw new Error(`Price data not found for native token ${this.getNativeTokenCaip19()}`);let o=await this.createSwapTransactions(A),i=oE(A,r),a=await this.processParsedFees(i,r);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:o}}async processParsedFees(A,j){if(A.find(u=>u.type==="solanaGaslessNetwork"))return A;let t=A.filter(u=>!nE.includes(u.type)),r=A.filter(u=>nE.includes(u.type)),o=A.find(u=>u.type==="priorityFee"),i=await this.calculateNetworkFee(o,j),a=this.sumNetworkFees(i,r);return[...t,a]}sumNetworkFees(A,j){return j.reduce((t,r)=>({...t,amount:t.amount.plus(r.amount),amountUsd:t.amountUsd.plus(r.amountUsd)}),A)}createSwapTransactions(A){return Ho({quote:A,connection:this.connection})}getAmountsFromNativeAmount(A,j){let t=new w(A.amount);return{amountUsd:t.div(new w(BA.LAMPORTS_PER_SOL)).times(j),amount:t}}async calculateNetworkFee(A,j){let t=new w(A?.amount??0);return{type:"solanaNetwork",amountUsd:t.div(new w(BA.LAMPORTS_PER_SOL)).times(j),amount:t}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};n();s();n();s();var Zo=class{constructor(A,j){this.networkID=A;this.priceClient=j}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.calculateNetworkFee(t),o=this.appendPhantomFee([r],A);return{quote:A,fees:{totalFees:this.sumFees(o),fees:o},swapTransactions:t}}createSwapTransactions(A){return Ms({quote:A})}appendPhantomFee(A,j){let t=j.fees.find(r=>r.type==="phantom");return t?[...A,{type:"phantom",percentage:new w(t.percentage),amountUsd:new w(0),amount:new w(0)}]:A}async calculateNetworkFee(A){let j=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!j.usd)throw new Error("Price data not found");let t=new w(0),r=new w(0);try{let o=await Promise.all(A.transactions.map(i=>sa({networkID:this.networkID,transaction:wo.deserializeTransactionString(i)})));r=new w(o.reduce((i,a)=>i+a.gasBudget.toNumber(),0)),t=r.dividedBy(1e9).multipliedBy(j.usd)}catch{return{type:"suiNetwork",amountUsd:new w(0),amount:new w(0)}}return{type:"suiNetwork",amountUsd:t,amount:r}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};var u6=class{constructor(A,j){this.networkID=A;this.priceClient=j;this.suiProcessQuoteCommand=new Zo(A,j)}suiProcessQuoteCommand;getNativeTokenCaip19(){return this.suiProcessQuoteCommand.getNativeTokenCaip19()}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.suiProcessQuoteCommand.calculateNetworkFee(t),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new w(t.percentage),amountUsd:new w(0),amount:new w(0)}]:A}createSwapTransactions(A){return Os({quote:A})}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new w(0))}};var l6=class{create(A,j,t,r){let o=j.sell.data.chain.id,i=j.buy.data.chain.id,a=xA(o,i);if(I.isSolanaNetworkID(o)){let u=rB(A).connection;return a?new p6(o,this.priceClient,u):new c6(o,this.priceClient,u)}else{if(I.isEVMNetworkID(o))return a?new i6(o,A,this.priceClient,j,t):new a6(o,A,this.priceClient,j,t);if(I.isSuiNetworkID(o))return a?new u6(o,this.priceClient):new Zo(o,this.priceClient)}throw new Error(`Unsupported network ID: ${o}`)}priceClient={getPrice:async A=>(await ua({tokens:[GA(A)]}))[A]};isSupportedNetwork(A){return I.isSolanaNetworkID(A)||I.isEVMNetworkID(A)}},d6=class{create(A,j,t,r){return{processQuote:async(o,i)=>({quote:o,fees:{totalFees:new w(0),fees:[]}})}}};n();s();n();s();n();s();var An=e=>e.reduce((A,j)=>{if(!j||j.type!=="SPL")return A;let t;return j.type==="SPL"&&(t=Sq(j)),t?{fees:[...A.fees,t],totalPercentFees:A.totalPercentFees+t.percentFee}:A},{fees:[],totalPercentFees:0}),Sq=e=>{if(e.type!=="SPL")return;let j=(e.data.mintExtensions??[]).find(t=>t.extension==="transferFeeConfig");if(j)return{caip19:M(U(e)),fungibleKey:e.data.key,symbol:e.data.symbol??"",name:e.data.name??"",percentFee:j.state.newerTransferFee.transferFeeBasisPoints/100}};n();s();var wq=e=>e.isGreaterThanOrEqualTo(1)?"0,0.[00]":"0,0.[00000]",Tr=e=>{let A=w(e);return ka(e,wq(A))};var bq=.05,Iq=5,$q=.5;function Nl(e,A,j,t){let{priceImpact:r,quoteSlippageTolerance:o}=vq(e),i=A.autoSlippage?o??j.slippageTolerance:j.slippageTolerance,a={type:"slippage",slippage:i,slippageType:A.autoSlippage?"auto":"fixed",alert:i&&i>=Iq?"highSlippage":void 0},u={type:"priceImpact",priceImpactPercentage:r.gt(0)?us(r.toNumber()):"-",alert:r&&r.gte(bq)?"highPriceImpact":void 0,warning:r&&r.gte($q)?"veryHighPriceImpact":void 0},l=[Ll(e,A.buy,A.sell),a,u],m=An([A.sell,A.buy]);return m.fees.length>0&&l.push({type:"transferFees",transferFees:m.totalPercentFees,transferTokenSymbol:A.sell.data.symbol??"",alert:"transferFees"}),t&&l.push({type:"fees",quoteFees:t}),l}function vq(e){return Le(e)?{priceImpact:e.priceImpact?w(e.priceImpact):w(0),quoteSlippageTolerance:e.slippageTolerance}:Ze(e)?{priceImpact:e.priceImpact?w(e.priceImpact):w(0),quoteSlippageTolerance:e.slippageTolerance}:Bt(e)?{priceImpact:e.priceImpact?w(e.priceImpact):w(0),quoteSlippageTolerance:e.slippageTolerance}:{priceImpact:w(0),quoteSlippageTolerance:void 0}}function Ll(e,A,j){let{buyAmount:t,sellAmount:r}=e,o=new w(t).shiftedBy(-A.data.decimals).dividedBy(new w(r).shiftedBy(-j.data.decimals));return{type:"pricing",ratio:o,exchangeRate:`1 ${j.data.symbol} \u2248 ${Tr(o)} ${A.data.symbol}`,exchangeRateFlipped:`1 ${A.data.symbol} \u2248 ${Tr(w(1).dividedBy(o))} ${j.data.symbol}`}}n();s();var m6=class{queue=[];processing=!1;enqueue(A){this.queue.push(A),this.processNext()}clearQueue(){this.queue=[],this.processing=!1}async processNext(){if(this.processing||this.queue.length===0)return;this.processing=!0;let A=this.queue.shift();if(A)try{await A()}catch(j){console.error("Error processing task:",j)}this.processing=!1,this.processNext()}};n();s();var _s=class{constructor(A){this.entries=A;for(let j of A)j.alert&&this.alerts.push(j.alert),j.warning&&this.warnings.push(j.warning)}alerts=[];warnings=[]};n();s();var sE=(l=>(l.SwapperNoQuotes="SwapperNoQuotes",l.InsufficientSellAmount="InsufficientSellAmount",l.CrossChainUnavailable="CrossChainUnavailable",l.TokenNotTradable="TokenNotTradable",l.NotEnoughSuiObjects="NotEnoughSuiObjects",l.FromTokenIsHoneyPotToken="FromTokenIsHoneyPotToken",l.ToTokenIsHoneyPotToken="ToTokenIsHoneyPotToken",l.InsufficientLiquidity="InsufficientLiquidity",l.SwapInitializationFailed="SwapInitializationFailed",l.pSolHighImpactError="pSolHighImpactError",l))(sE||{}),Ds=class e extends Error{name;type;constructor(A,j,t){super(j),this.name=A,this.type=t}static fromErrorResponse(A,j){return(r=>Object.values(sE).includes(r))(A)?new e(A,j,A):new e(A,j)}};var qq="swap-quotes",k6=class{constructor(A,j){this.quoteStreamer=A;this.commandFactory=j}state={type:"idle"};listeners=[];swapTransactionQueue=new m6;start(A,j){this.setState({type:"starting",input:A,account:j}),this.quoteStreamer.subscribe(this.quoteStreamListener),this.quoteStreamer.openStream(A)}stop(){this.swapTransactionQueue.clearQueue(),this.setState({type:"idle"}),this.quoteStreamer.closeStream(),this.quoteStreamer.unsubscribe(this.quoteStreamListener)}quoteStreamListener={onEvent:A=>{switch(A.type){case"newQuoteResponse":switch(this.state.type){case"starting":let r=this.findPreferredQuote(this.state.input,A.quoteResponse);this.setState({type:"firstQuoteReceived",input:this.state.input,quote:r,response:A.quoteResponse,account:this.state.account,quoteDetails:new _s(Nl(r,this.state.input,A.quoteResponse))}),this.enqueueQuoteToProcess(this.state.input,A.quoteResponse,this.state.account);break;case"quoteProcessed":this.enqueueQuoteToProcess(this.state.input,A.quoteResponse,this.state.account,this.state.prevProcessedQuote);break}break;case"error":let j=Ds.fromErrorResponse(A.errorResponse.name,A.errorResponse.message),t=new DA({key:j.name});switch(b.addBreadcrumb(qq,JSON.stringify(j.name),"info"),this.state.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"error",error:t,quoteError:j,account:this.state.account,input:this.state.input});break}break;case"openRequested":break;case"close":this.setState({type:"idle"});break}}};enqueueQuoteToProcess(A,j,t,r){this.swapTransactionQueue.enqueue(()=>this.processQuote(j,A,t,r))}async processQuote(A,j,t,r){try{let o=this.findPreferredQuote(j,A),a=await this.commandFactory.create(t,j,A,j.isSimulationKilled).processQuote(o,j.isSimulationKilled);switch(this.state.type){case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"quoteProcessed",input:j,response:A,quote:o,prevProcessedQuote:r,nextProcessedQuote:a,account:t,quoteDetails:new _s(Nl(o,j,A,a.fees))});break}return a}catch(o){throw b.captureError(o,"swapper"),o}}subscribe(A){this.listeners.push(A)}unsubscribe(A){this.listeners=this.listeners.filter(j=>j!==A)}getState(){return this.state}findPreferredQuote(A,j){let t=A.preferredProvider;return t&&j.quotes.find(r=>r.baseProvider.id===t)||j.quotes[0]}setState(A){let j=this.state;this.state=A,this.listeners.forEach(t=>t.onStateChange(j,A))}};n();s();n();s();n();s();n();s();function nn(e){let A=e.length;for(;--A>=0;)e[A]=0}var xq=0,QE=1,Tq=2,Pq=3,Gq=258,ud=29,ei=256,Vs=ei+1+ud,tn=30,ld=19,VE=2*Vs+1,Pr=15,Kl=16,Cq=7,dd=256,zE=16,XE=17,WE=18,td=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),h6=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Oq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),JE=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Mq=512,Et=new Array((Vs+2)*2);nn(Et);var Us=new Array(tn*2);nn(Us);var zs=new Array(Mq);nn(zs);var Xs=new Array(Gq-Pq+1);nn(Xs);var md=new Array(ud);nn(md);var F6=new Array(tn);nn(F6);function Ul(e,A,j,t,r){this.static_tree=e,this.extra_bits=A,this.extra_base=j,this.elems=t,this.max_length=r,this.has_stree=e&&e.length}var YE,ZE,Ay;function Hl(e,A){this.dyn_tree=e,this.max_code=0,this.stat_desc=A}var ey=e=>e<256?zs[e]:zs[256+(e>>>7)],Ws=(e,A)=>{e.pending_buf[e.pending++]=A&255,e.pending_buf[e.pending++]=A>>>8&255},Ue=(e,A,j)=>{e.bi_valid>Kl-j?(e.bi_buf|=A<<e.bi_valid&65535,Ws(e,e.bi_buf),e.bi_buf=A>>Kl-e.bi_valid,e.bi_valid+=j-Kl):(e.bi_buf|=A<<e.bi_valid&65535,e.bi_valid+=j)},et=(e,A,j)=>{Ue(e,j[A*2],j[A*2+1])},jy=(e,A)=>{let j=0;do j|=e&1,e>>>=1,j<<=1;while(--A>0);return j>>>1},Rq=e=>{e.bi_valid===16?(Ws(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},_q=(e,A)=>{let j=A.dyn_tree,t=A.max_code,r=A.stat_desc.static_tree,o=A.stat_desc.has_stree,i=A.stat_desc.extra_bits,a=A.stat_desc.extra_base,u=A.stat_desc.max_length,c,l,m,B,k,f,g=0;for(B=0;B<=Pr;B++)e.bl_count[B]=0;for(j[e.heap[e.heap_max]*2+1]=0,c=e.heap_max+1;c<VE;c++)l=e.heap[c],B=j[j[l*2+1]*2+1]+1,B>u&&(B=u,g++),j[l*2+1]=B,!(l>t)&&(e.bl_count[B]++,k=0,l>=a&&(k=i[l-a]),f=j[l*2],e.opt_len+=f*(B+k),o&&(e.static_len+=f*(r[l*2+1]+k)));if(g!==0){do{for(B=u-1;e.bl_count[B]===0;)B--;e.bl_count[B]--,e.bl_count[B+1]+=2,e.bl_count[u]--,g-=2}while(g>0);for(B=u;B!==0;B--)for(l=e.bl_count[B];l!==0;)m=e.heap[--c],!(m>t)&&(j[m*2+1]!==B&&(e.opt_len+=(B-j[m*2+1])*j[m*2],j[m*2+1]=B),l--)}},ty=(e,A,j)=>{let t=new Array(Pr+1),r=0,o,i;for(o=1;o<=Pr;o++)r=r+j[o-1]<<1,t[o]=r;for(i=0;i<=A;i++){let a=e[i*2+1];a!==0&&(e[i*2]=jy(t[a]++,a))}},Dq=()=>{let e,A,j,t,r,o=new Array(Pr+1);for(j=0,t=0;t<ud-1;t++)for(md[t]=j,e=0;e<1<<td[t];e++)Xs[j++]=t;for(Xs[j-1]=t,r=0,t=0;t<16;t++)for(F6[t]=r,e=0;e<1<<h6[t];e++)zs[r++]=t;for(r>>=7;t<tn;t++)for(F6[t]=r<<7,e=0;e<1<<h6[t]-7;e++)zs[256+r++]=t;for(A=0;A<=Pr;A++)o[A]=0;for(e=0;e<=143;)Et[e*2+1]=8,e++,o[8]++;for(;e<=255;)Et[e*2+1]=9,e++,o[9]++;for(;e<=279;)Et[e*2+1]=7,e++,o[7]++;for(;e<=287;)Et[e*2+1]=8,e++,o[8]++;for(ty(Et,Vs+1,o),e=0;e<tn;e++)Us[e*2+1]=5,Us[e*2]=jy(e,5);YE=new Ul(Et,td,ei+1,Vs,Pr),ZE=new Ul(Us,h6,0,tn,Pr),Ay=new Ul(new Array(0),Oq,0,ld,Cq)},ry=e=>{let A;for(A=0;A<Vs;A++)e.dyn_ltree[A*2]=0;for(A=0;A<tn;A++)e.dyn_dtree[A*2]=0;for(A=0;A<ld;A++)e.bl_tree[A*2]=0;e.dyn_ltree[dd*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},oy=e=>{e.bi_valid>8?Ws(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},iE=(e,A,j,t)=>{let r=A*2,o=j*2;return e[r]<e[o]||e[r]===e[o]&&t[A]<=t[j]},Ql=(e,A,j)=>{let t=e.heap[j],r=j<<1;for(;r<=e.heap_len&&(r<e.heap_len&&iE(A,e.heap[r+1],e.heap[r],e.depth)&&r++,!iE(A,t,e.heap[r],e.depth));)e.heap[j]=e.heap[r],j=r,r<<=1;e.heap[j]=t},aE=(e,A,j)=>{let t,r,o=0,i,a;if(e.sym_next!==0)do t=e.pending_buf[e.sym_buf+o++]&255,t+=(e.pending_buf[e.sym_buf+o++]&255)<<8,r=e.pending_buf[e.sym_buf+o++],t===0?et(e,r,A):(i=Xs[r],et(e,i+ei+1,A),a=td[i],a!==0&&(r-=md[i],Ue(e,r,a)),t--,i=ey(t),et(e,i,j),a=h6[i],a!==0&&(t-=F6[i],Ue(e,t,a)));while(o<e.sym_next);et(e,dd,A)},rd=(e,A)=>{let j=A.dyn_tree,t=A.stat_desc.static_tree,r=A.stat_desc.has_stree,o=A.stat_desc.elems,i,a,u=-1,c;for(e.heap_len=0,e.heap_max=VE,i=0;i<o;i++)j[i*2]!==0?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):j[i*2+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,j[c*2]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=t[c*2+1]);for(A.max_code=u,i=e.heap_len>>1;i>=1;i--)Ql(e,j,i);c=o;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ql(e,j,1),a=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=a,j[c*2]=j[i*2]+j[a*2],e.depth[c]=(e.depth[i]>=e.depth[a]?e.depth[i]:e.depth[a])+1,j[i*2+1]=j[a*2+1]=c,e.heap[1]=c++,Ql(e,j,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],_q(e,A),ty(j,u,e.bl_count)},pE=(e,A,j)=>{let t,r=-1,o,i=A[0*2+1],a=0,u=7,c=4;for(i===0&&(u=138,c=3),A[(j+1)*2+1]=65535,t=0;t<=j;t++)o=i,i=A[(t+1)*2+1],!(++a<u&&o===i)&&(a<c?e.bl_tree[o*2]+=a:o!==0?(o!==r&&e.bl_tree[o*2]++,e.bl_tree[zE*2]++):a<=10?e.bl_tree[XE*2]++:e.bl_tree[WE*2]++,a=0,r=o,i===0?(u=138,c=3):o===i?(u=6,c=3):(u=7,c=4))},cE=(e,A,j)=>{let t,r=-1,o,i=A[0*2+1],a=0,u=7,c=4;for(i===0&&(u=138,c=3),t=0;t<=j;t++)if(o=i,i=A[(t+1)*2+1],!(++a<u&&o===i)){if(a<c)do et(e,o,e.bl_tree);while(--a!==0);else o!==0?(o!==r&&(et(e,o,e.bl_tree),a--),et(e,zE,e.bl_tree),Ue(e,a-3,2)):a<=10?(et(e,XE,e.bl_tree),Ue(e,a-3,3)):(et(e,WE,e.bl_tree),Ue(e,a-11,7));a=0,r=o,i===0?(u=138,c=3):o===i?(u=6,c=3):(u=7,c=4)}},Nq=e=>{let A;for(pE(e,e.dyn_ltree,e.l_desc.max_code),pE(e,e.dyn_dtree,e.d_desc.max_code),rd(e,e.bl_desc),A=ld-1;A>=3&&e.bl_tree[JE[A]*2+1]===0;A--);return e.opt_len+=3*(A+1)+5+5+4,A},Lq=(e,A,j,t)=>{let r;for(Ue(e,A-257,5),Ue(e,j-1,5),Ue(e,t-4,4),r=0;r<t;r++)Ue(e,e.bl_tree[JE[r]*2+1],3);cE(e,e.dyn_ltree,A-1),cE(e,e.dyn_dtree,j-1)},Kq=e=>{let A=4093624447,j;for(j=0;j<=31;j++,A>>>=1)if(A&1&&e.dyn_ltree[j*2]!==0)return 0;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return 1;for(j=32;j<ei;j++)if(e.dyn_ltree[j*2]!==0)return 1;return 0},uE=!1,Uq=e=>{uE||(Dq(),uE=!0),e.l_desc=new Hl(e.dyn_ltree,YE),e.d_desc=new Hl(e.dyn_dtree,ZE),e.bl_desc=new Hl(e.bl_tree,Ay),e.bi_buf=0,e.bi_valid=0,ry(e)},ny=(e,A,j,t)=>{Ue(e,(xq<<1)+(t?1:0),3),oy(e),Ws(e,j),Ws(e,~j),j&&e.pending_buf.set(e.window.subarray(A,A+j),e.pending),e.pending+=j},Hq=e=>{Ue(e,QE<<1,3),et(e,dd,Et),Rq(e)},Qq=(e,A,j,t)=>{let r,o,i=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=Kq(e)),rd(e,e.l_desc),rd(e,e.d_desc),i=Nq(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=j+5,j+4<=r&&A!==-1?ny(e,A,j,t):e.strategy===4||o===r?(Ue(e,(QE<<1)+(t?1:0),3),aE(e,Et,Us)):(Ue(e,(Tq<<1)+(t?1:0),3),Lq(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),aE(e,e.dyn_ltree,e.dyn_dtree)),ry(e),t&&oy(e)},Vq=(e,A,j)=>(e.pending_buf[e.sym_buf+e.sym_next++]=A,e.pending_buf[e.sym_buf+e.sym_next++]=A>>8,e.pending_buf[e.sym_buf+e.sym_next++]=j,A===0?e.dyn_ltree[j*2]++:(e.matches++,A--,e.dyn_ltree[(Xs[j]+ei+1)*2]++,e.dyn_dtree[ey(A)*2]++),e.sym_next===e.sym_end),zq=Uq,Xq=ny,Wq=Qq,Jq=Vq,Yq=Hq,Zq={_tr_init:zq,_tr_stored_block:Xq,_tr_flush_block:Wq,_tr_tally:Jq,_tr_align:Yq},Ax=(e,A,j,t)=>{let r=e&65535|0,o=e>>>16&65535|0,i=0;for(;j!==0;){i=j>2e3?2e3:j,j-=i;do r=r+A[t++]|0,o=o+r|0;while(--i);r%=65521,o%=65521}return r|o<<16|0},Js=Ax,ex=()=>{let e,A=[];for(var j=0;j<256;j++){e=j;for(var t=0;t<8;t++)e=e&1?3988292384^e>>>1:e>>>1;A[j]=e}return A},jx=new Uint32Array(ex()),tx=(e,A,j,t)=>{let r=jx,o=t+j;e^=-1;for(let i=t;i<o;i++)e=e>>>8^r[(e^A[i])&255];return e^-1},de=tx,Or={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_r={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:rx,_tr_stored_block:od,_tr_flush_block:ox,_tr_tally:Zt,_tr_align:nx}=Zq,{Z_NO_FLUSH:Ar,Z_PARTIAL_FLUSH:sx,Z_FULL_FLUSH:ix,Z_FINISH:lj,Z_BLOCK:lE,Z_OK:Fe,Z_STREAM_END:dE,Z_STREAM_ERROR:jt,Z_DATA_ERROR:ax,Z_BUF_ERROR:Vl,Z_DEFAULT_COMPRESSION:px,Z_FILTERED:cx,Z_HUFFMAN_ONLY:B6,Z_RLE:ux,Z_FIXED:lx,Z_DEFAULT_STRATEGY:dx,Z_UNKNOWN:mx,Z_DEFLATED:b6}=_r,kx=9,Bx=15,fx=8,gx=29,Ex=256,nd=Ex+1+gx,yx=30,hx=19,Fx=2*nd+1,Sx=15,yA=3,Yt=258,tt=Yt+yA+1,wx=32,rn=42,kd=57,sd=69,id=73,ad=91,pd=103,Gr=113,Ls=666,Ce=1,sn=2,Mr=3,an=4,bx=3,Cr=(e,A)=>(e.msg=Or[A],A),mE=e=>e*2-(e>4?9:0),Jt=e=>{let A=e.length;for(;--A>=0;)e[A]=0},Ix=e=>{let A,j,t,r=e.w_size;A=e.hash_size,t=A;do j=e.head[--t],e.head[t]=j>=r?j-r:0;while(--A);A=r,t=A;do j=e.prev[--t],e.prev[t]=j>=r?j-r:0;while(--A)},$x=(e,A,j)=>(A<<e.hash_shift^j)&e.hash_mask,er=$x,jj=e=>{let A=e.state,j=A.pending;j>e.avail_out&&(j=e.avail_out),j!==0&&(e.output.set(A.pending_buf.subarray(A.pending_out,A.pending_out+j),e.next_out),e.next_out+=j,A.pending_out+=j,e.total_out+=j,e.avail_out-=j,A.pending-=j,A.pending===0&&(A.pending_out=0))},tj=(e,A)=>{ox(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,A),e.block_start=e.strstart,jj(e.strm)},FA=(e,A)=>{e.pending_buf[e.pending++]=A},Ns=(e,A)=>{e.pending_buf[e.pending++]=A>>>8&255,e.pending_buf[e.pending++]=A&255},cd=(e,A,j,t)=>{let r=e.avail_in;return r>t&&(r=t),r===0?0:(e.avail_in-=r,A.set(e.input.subarray(e.next_in,e.next_in+r),j),e.state.wrap===1?e.adler=Js(e.adler,A,r,j):e.state.wrap===2&&(e.adler=de(e.adler,A,r,j)),e.next_in+=r,e.total_in+=r,r)},sy=(e,A)=>{let j=e.max_chain_length,t=e.strstart,r,o,i=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-tt?e.strstart-(e.w_size-tt):0,c=e.window,l=e.w_mask,m=e.prev,B=e.strstart+Yt,k=c[t+i-1],f=c[t+i];e.prev_length>=e.good_match&&(j>>=2),a>e.lookahead&&(a=e.lookahead);do if(r=A,!(c[r+i]!==f||c[r+i-1]!==k||c[r]!==c[t]||c[++r]!==c[t+1])){t+=2,r++;do;while(c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&t<B);if(o=Yt-(B-t),t=B-Yt,o>i){if(e.match_start=A,i=o,o>=a)break;k=c[t+i-1],f=c[t+i]}}while((A=m[A&l])>u&&--j!==0);return i<=e.lookahead?i:e.lookahead},on=e=>{let A=e.w_size,j,t,r;do{if(t=e.window_size-e.lookahead-e.strstart,e.strstart>=A+(A-tt)&&(e.window.set(e.window.subarray(A,A+A-t),0),e.match_start-=A,e.strstart-=A,e.block_start-=A,e.insert>e.strstart&&(e.insert=e.strstart),Ix(e),t+=A),e.strm.avail_in===0)break;if(j=cd(e.strm,e.window,e.strstart+e.lookahead,t),e.lookahead+=j,e.lookahead+e.insert>=yA)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=er(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=er(e,e.ins_h,e.window[r+yA-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<yA)););}while(e.lookahead<tt&&e.strm.avail_in!==0)},iy=(e,A)=>{let j=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,t,r,o,i=0,a=e.strm.avail_in;do{if(t=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,r=e.strstart-e.block_start,t>r+e.strm.avail_in&&(t=r+e.strm.avail_in),t>o&&(t=o),t<j&&(t===0&&A!==lj||A===Ar||t!==r+e.strm.avail_in)))break;i=A===lj&&t===r+e.strm.avail_in?1:0,od(e,0,0,i),e.pending_buf[e.pending-4]=t,e.pending_buf[e.pending-3]=t>>8,e.pending_buf[e.pending-2]=~t,e.pending_buf[e.pending-1]=~t>>8,jj(e.strm),r&&(r>t&&(r=t),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,t-=r),t&&(cd(e.strm,e.strm.output,e.strm.next_out,t),e.strm.next_out+=t,e.strm.avail_out-=t,e.strm.total_out+=t)}while(i===0);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?an:A!==Ar&&A!==lj&&e.strm.avail_in===0&&e.strstart===e.block_start?sn:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(cd(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,j=o>e.w_size?e.w_size:o,r=e.strstart-e.block_start,(r>=j||(r||A===lj)&&A!==Ar&&e.strm.avail_in===0&&r<=o)&&(t=r>o?o:r,i=A===lj&&e.strm.avail_in===0&&t===r?1:0,od(e,e.block_start,t,i),e.block_start+=t,jj(e.strm)),i?Mr:Ce)},zl=(e,A)=>{let j,t;for(;;){if(e.lookahead<tt){if(on(e),e.lookahead<tt&&A===Ar)return Ce;if(e.lookahead===0)break}if(j=0,e.lookahead>=yA&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+yA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),j!==0&&e.strstart-j<=e.w_size-tt&&(e.match_length=sy(e,j)),e.match_length>=yA)if(t=Zt(e,e.strstart-e.match_start,e.match_length-yA),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=yA){e.match_length--;do e.strstart++,e.ins_h=er(e,e.ins_h,e.window[e.strstart+yA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=er(e,e.ins_h,e.window[e.strstart+1]);else t=Zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(t&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=e.strstart<yA-1?e.strstart:yA-1,A===lj?(tj(e,!0),e.strm.avail_out===0?Mr:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},en=(e,A)=>{let j,t,r;for(;;){if(e.lookahead<tt){if(on(e),e.lookahead<tt&&A===Ar)return Ce;if(e.lookahead===0)break}if(j=0,e.lookahead>=yA&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+yA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=yA-1,j!==0&&e.prev_length<e.max_lazy_match&&e.strstart-j<=e.w_size-tt&&(e.match_length=sy(e,j),e.match_length<=5&&(e.strategy===cx||e.match_length===yA&&e.strstart-e.match_start>4096)&&(e.match_length=yA-1)),e.prev_length>=yA&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-yA,t=Zt(e,e.strstart-1-e.prev_match,e.prev_length-yA),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=er(e,e.ins_h,e.window[e.strstart+yA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=yA-1,e.strstart++,t&&(tj(e,!1),e.strm.avail_out===0))return Ce}else if(e.match_available){if(t=Zt(e,0,e.window[e.strstart-1]),t&&tj(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Ce}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(t=Zt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<yA-1?e.strstart:yA-1,A===lj?(tj(e,!0),e.strm.avail_out===0?Mr:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},vx=(e,A)=>{let j,t,r,o,i=e.window;for(;;){if(e.lookahead<=Yt){if(on(e),e.lookahead<=Yt&&A===Ar)return Ce;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=yA&&e.strstart>0&&(r=e.strstart-1,t=i[r],t===i[++r]&&t===i[++r]&&t===i[++r])){o=e.strstart+Yt;do;while(t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&r<o);e.match_length=Yt-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=yA?(j=Zt(e,1,e.match_length-yA),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(j=Zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),j&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=0,A===lj?(tj(e,!0),e.strm.avail_out===0?Mr:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},qx=(e,A)=>{let j;for(;;){if(e.lookahead===0&&(on(e),e.lookahead===0)){if(A===Ar)return Ce;break}if(e.match_length=0,j=Zt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,j&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=0,A===lj?(tj(e,!0),e.strm.avail_out===0?Mr:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn};function At(e,A,j,t,r){this.good_length=e,this.max_lazy=A,this.nice_length=j,this.max_chain=t,this.func=r}var Ks=[new At(0,0,0,0,iy),new At(4,4,8,4,zl),new At(4,5,16,8,zl),new At(4,6,32,32,zl),new At(4,4,16,16,en),new At(8,16,32,32,en),new At(8,16,128,128,en),new At(8,32,128,256,en),new At(32,128,258,1024,en),new At(32,258,258,4096,en)],xx=e=>{e.window_size=2*e.w_size,Jt(e.head),e.max_lazy_match=Ks[e.level].max_lazy,e.good_match=Ks[e.level].good_length,e.nice_match=Ks[e.level].nice_length,e.max_chain_length=Ks[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=yA-1,e.match_available=0,e.ins_h=0};function Tx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b6,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Fx*2),this.dyn_dtree=new Uint16Array((2*yx+1)*2),this.bl_tree=new Uint16Array((2*hx+1)*2),Jt(this.dyn_ltree),Jt(this.dyn_dtree),Jt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Sx+1),this.heap=new Uint16Array(2*nd+1),Jt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*nd+1),Jt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ji=e=>{if(!e)return 1;let A=e.state;return!A||A.strm!==e||A.status!==rn&&A.status!==kd&&A.status!==sd&&A.status!==id&&A.status!==ad&&A.status!==pd&&A.status!==Gr&&A.status!==Ls?1:0},ay=e=>{if(ji(e))return Cr(e,jt);e.total_in=e.total_out=0,e.data_type=mx;let A=e.state;return A.pending=0,A.pending_out=0,A.wrap<0&&(A.wrap=-A.wrap),A.status=A.wrap===2?kd:A.wrap?rn:Gr,e.adler=A.wrap===2?0:1,A.last_flush=-2,rx(A),Fe},py=e=>{let A=ay(e);return A===Fe&&xx(e.state),A},Px=(e,A)=>ji(e)||e.state.wrap!==2?jt:(e.state.gzhead=A,Fe),cy=(e,A,j,t,r,o)=>{if(!e)return jt;let i=1;if(A===px&&(A=6),t<0?(i=0,t=-t):t>15&&(i=2,t-=16),r<1||r>kx||j!==b6||t<8||t>15||A<0||A>9||o<0||o>lx||t===8&&i!==1)return Cr(e,jt);t===8&&(t=9);let a=new Tx;return e.state=a,a.strm=e,a.status=rn,a.wrap=i,a.gzhead=null,a.w_bits=t,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+yA-1)/yA),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=A,a.strategy=o,a.method=j,py(e)},Gx=(e,A)=>cy(e,A,b6,Bx,fx,dx),Cx=(e,A)=>{if(ji(e)||A>lE||A<0)return e?Cr(e,jt):jt;let j=e.state;if(!e.output||e.avail_in!==0&&!e.input||j.status===Ls&&A!==lj)return Cr(e,e.avail_out===0?Vl:jt);let t=j.last_flush;if(j.last_flush=A,j.pending!==0){if(jj(e),e.avail_out===0)return j.last_flush=-1,Fe}else if(e.avail_in===0&&mE(A)<=mE(t)&&A!==lj)return Cr(e,Vl);if(j.status===Ls&&e.avail_in!==0)return Cr(e,Vl);if(j.status===rn&&j.wrap===0&&(j.status=Gr),j.status===rn){let r=b6+(j.w_bits-8<<4)<<8,o=-1;if(j.strategy>=B6||j.level<2?o=0:j.level<6?o=1:j.level===6?o=2:o=3,r|=o<<6,j.strstart!==0&&(r|=wx),r+=31-r%31,Ns(j,r),j.strstart!==0&&(Ns(j,e.adler>>>16),Ns(j,e.adler&65535)),e.adler=1,j.status=Gr,jj(e),j.pending!==0)return j.last_flush=-1,Fe}if(j.status===kd){if(e.adler=0,FA(j,31),FA(j,139),FA(j,8),j.gzhead)FA(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),FA(j,j.gzhead.time&255),FA(j,j.gzhead.time>>8&255),FA(j,j.gzhead.time>>16&255),FA(j,j.gzhead.time>>24&255),FA(j,j.level===9?2:j.strategy>=B6||j.level<2?4:0),FA(j,j.gzhead.os&255),j.gzhead.extra&&j.gzhead.extra.length&&(FA(j,j.gzhead.extra.length&255),FA(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(e.adler=de(e.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=sd;else if(FA(j,0),FA(j,0),FA(j,0),FA(j,0),FA(j,0),FA(j,j.level===9?2:j.strategy>=B6||j.level<2?4:0),FA(j,bx),j.status=Gr,jj(e),j.pending!==0)return j.last_flush=-1,Fe}if(j.status===sd){if(j.gzhead.extra){let r=j.pending,o=(j.gzhead.extra.length&65535)-j.gzindex;for(;j.pending+o>j.pending_buf_size;){let a=j.pending_buf_size-j.pending;if(j.pending_buf.set(j.gzhead.extra.subarray(j.gzindex,j.gzindex+a),j.pending),j.pending=j.pending_buf_size,j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex+=a,jj(e),j.pending!==0)return j.last_flush=-1,Fe;r=0,o-=a}let i=new Uint8Array(j.gzhead.extra);j.pending_buf.set(i.subarray(j.gzindex,j.gzindex+o),j.pending),j.pending+=o,j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex=0}j.status=id}if(j.status===id){if(j.gzhead.name){let r=j.pending,o;do{if(j.pending===j.pending_buf_size){if(j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r)),jj(e),j.pending!==0)return j.last_flush=-1,Fe;r=0}j.gzindex<j.gzhead.name.length?o=j.gzhead.name.charCodeAt(j.gzindex++)&255:o=0,FA(j,o)}while(o!==0);j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex=0}j.status=ad}if(j.status===ad){if(j.gzhead.comment){let r=j.pending,o;do{if(j.pending===j.pending_buf_size){if(j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r)),jj(e),j.pending!==0)return j.last_flush=-1,Fe;r=0}j.gzindex<j.gzhead.comment.length?o=j.gzhead.comment.charCodeAt(j.gzindex++)&255:o=0,FA(j,o)}while(o!==0);j.gzhead.hcrc&&j.pending>r&&(e.adler=de(e.adler,j.pending_buf,j.pending-r,r))}j.status=pd}if(j.status===pd){if(j.gzhead.hcrc){if(j.pending+2>j.pending_buf_size&&(jj(e),j.pending!==0))return j.last_flush=-1,Fe;FA(j,e.adler&255),FA(j,e.adler>>8&255),e.adler=0}if(j.status=Gr,jj(e),j.pending!==0)return j.last_flush=-1,Fe}if(e.avail_in!==0||j.lookahead!==0||A!==Ar&&j.status!==Ls){let r=j.level===0?iy(j,A):j.strategy===B6?qx(j,A):j.strategy===ux?vx(j,A):Ks[j.level].func(j,A);if((r===Mr||r===an)&&(j.status=Ls),r===Ce||r===Mr)return e.avail_out===0&&(j.last_flush=-1),Fe;if(r===sn&&(A===sx?nx(j):A!==lE&&(od(j,0,0,!1),A===ix&&(Jt(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),jj(e),e.avail_out===0))return j.last_flush=-1,Fe}return A!==lj?Fe:j.wrap<=0?dE:(j.wrap===2?(FA(j,e.adler&255),FA(j,e.adler>>8&255),FA(j,e.adler>>16&255),FA(j,e.adler>>24&255),FA(j,e.total_in&255),FA(j,e.total_in>>8&255),FA(j,e.total_in>>16&255),FA(j,e.total_in>>24&255)):(Ns(j,e.adler>>>16),Ns(j,e.adler&65535)),jj(e),j.wrap>0&&(j.wrap=-j.wrap),j.pending!==0?Fe:dE)},Ox=e=>{if(ji(e))return jt;let A=e.state.status;return e.state=null,A===Gr?Cr(e,ax):Fe},Mx=(e,A)=>{let j=A.length;if(ji(e))return jt;let t=e.state,r=t.wrap;if(r===2||r===1&&t.status!==rn||t.lookahead)return jt;if(r===1&&(e.adler=Js(e.adler,A,j,0)),t.wrap=0,j>=t.w_size){r===0&&(Jt(t.head),t.strstart=0,t.block_start=0,t.insert=0);let u=new Uint8Array(t.w_size);u.set(A.subarray(j-t.w_size,j),0),A=u,j=t.w_size}let o=e.avail_in,i=e.next_in,a=e.input;for(e.avail_in=j,e.next_in=0,e.input=A,on(t);t.lookahead>=yA;){let u=t.strstart,c=t.lookahead-(yA-1);do t.ins_h=er(t,t.ins_h,t.window[u+yA-1]),t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++;while(--c);t.strstart=u,t.lookahead=yA-1,on(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=yA-1,t.match_available=0,e.next_in=i,e.input=a,e.avail_in=o,t.wrap=r,Fe},Rx=Gx,_x=cy,Dx=py,Nx=ay,Lx=Px,Kx=Cx,Ux=Ox,Hx=Mx,Qx="pako deflate (from Nodeca project)",Hs={deflateInit:Rx,deflateInit2:_x,deflateReset:Dx,deflateResetKeep:Nx,deflateSetHeader:Lx,deflate:Kx,deflateEnd:Ux,deflateSetDictionary:Hx,deflateInfo:Qx},Vx=(e,A)=>Object.prototype.hasOwnProperty.call(e,A),zx=function(e){let A=Array.prototype.slice.call(arguments,1);for(;A.length;){let j=A.shift();if(j){if(typeof j!="object")throw new TypeError(j+"must be non-object");for(let t in j)Vx(j,t)&&(e[t]=j[t])}}return e},Xx=e=>{let A=0;for(let t=0,r=e.length;t<r;t++)A+=e[t].length;let j=new Uint8Array(A);for(let t=0,r=0,o=e.length;t<o;t++){let i=e[t];j.set(i,r),r+=i.length}return j},I6={assign:zx,flattenChunks:Xx},uy=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{uy=!1}var Ys=new Uint8Array(256);for(let e=0;e<256;e++)Ys[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ys[254]=Ys[254]=1;var Wx=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let A,j,t,r,o,i=e.length,a=0;for(r=0;r<i;r++)j=e.charCodeAt(r),(j&64512)===55296&&r+1<i&&(t=e.charCodeAt(r+1),(t&64512)===56320&&(j=65536+(j-55296<<10)+(t-56320),r++)),a+=j<128?1:j<2048?2:j<65536?3:4;for(A=new Uint8Array(a),o=0,r=0;o<a;r++)j=e.charCodeAt(r),(j&64512)===55296&&r+1<i&&(t=e.charCodeAt(r+1),(t&64512)===56320&&(j=65536+(j-55296<<10)+(t-56320),r++)),j<128?A[o++]=j:j<2048?(A[o++]=192|j>>>6,A[o++]=128|j&63):j<65536?(A[o++]=224|j>>>12,A[o++]=128|j>>>6&63,A[o++]=128|j&63):(A[o++]=240|j>>>18,A[o++]=128|j>>>12&63,A[o++]=128|j>>>6&63,A[o++]=128|j&63);return A},Jx=(e,A)=>{if(A<65534&&e.subarray&&uy)return String.fromCharCode.apply(null,e.length===A?e:e.subarray(0,A));let j="";for(let t=0;t<A;t++)j+=String.fromCharCode(e[t]);return j},Yx=(e,A)=>{let j=A||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,A));let t,r,o=new Array(j*2);for(r=0,t=0;t<j;){let i=e[t++];if(i<128){o[r++]=i;continue}let a=Ys[i];if(a>4){o[r++]=65533,t+=a-1;continue}for(i&=a===2?31:a===3?15:7;a>1&&t<j;)i=i<<6|e[t++]&63,a--;if(a>1){o[r++]=65533;continue}i<65536?o[r++]=i:(i-=65536,o[r++]=55296|i>>10&1023,o[r++]=56320|i&1023)}return Jx(o,r)},Zx=(e,A)=>{A=A||e.length,A>e.length&&(A=e.length);let j=A-1;for(;j>=0&&(e[j]&192)===128;)j--;return j<0||j===0?A:j+Ys[e[j]]>A?j:A},Zs={string2buf:Wx,buf2string:Yx,utf8border:Zx};function AT(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ly=AT,dy=Object.prototype.toString,{Z_NO_FLUSH:eT,Z_SYNC_FLUSH:jT,Z_FULL_FLUSH:tT,Z_FINISH:rT,Z_OK:S6,Z_STREAM_END:oT,Z_DEFAULT_COMPRESSION:nT,Z_DEFAULT_STRATEGY:sT,Z_DEFLATED:iT}=_r;function ti(e){this.options=I6.assign({level:nT,method:iT,chunkSize:16384,windowBits:15,memLevel:8,strategy:sT},e||{});let A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ly,this.strm.avail_out=0;let j=Hs.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(j!==S6)throw new Error(Or[j]);if(A.header&&Hs.deflateSetHeader(this.strm,A.header),A.dictionary){let t;if(typeof A.dictionary=="string"?t=Zs.string2buf(A.dictionary):dy.call(A.dictionary)==="[object ArrayBuffer]"?t=new Uint8Array(A.dictionary):t=A.dictionary,j=Hs.deflateSetDictionary(this.strm,t),j!==S6)throw new Error(Or[j]);this._dict_set=!0}}ti.prototype.push=function(e,A){let j=this.strm,t=this.options.chunkSize,r,o;if(this.ended)return!1;for(A===~~A?o=A:o=A===!0?rT:eT,typeof e=="string"?j.input=Zs.string2buf(e):dy.call(e)==="[object ArrayBuffer]"?j.input=new Uint8Array(e):j.input=e,j.next_in=0,j.avail_in=j.input.length;;){if(j.avail_out===0&&(j.output=new Uint8Array(t),j.next_out=0,j.avail_out=t),(o===jT||o===tT)&&j.avail_out<=6){this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;continue}if(r=Hs.deflate(j,o),r===oT)return j.next_out>0&&this.onData(j.output.subarray(0,j.next_out)),r=Hs.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===S6;if(j.avail_out===0){this.onData(j.output);continue}if(o>0&&j.next_out>0){this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;continue}if(j.avail_in===0)break}return!0};ti.prototype.onData=function(e){this.chunks.push(e)};ti.prototype.onEnd=function(e){e===S6&&(this.result=I6.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Bd(e,A){let j=new ti(A);if(j.push(e,!0),j.err)throw j.msg||Or[j.err];return j.result}function aT(e,A){return A=A||{},A.raw=!0,Bd(e,A)}function pT(e,A){return A=A||{},A.gzip=!0,Bd(e,A)}var cT=ti,uT=Bd,lT=aT,dT=pT,mT=_r,kT={Deflate:cT,deflate:uT,deflateRaw:lT,gzip:dT,constants:mT},f6=16209,BT=16191,fT=function(A,j){let t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y,F,S,x,O,v,D,G,C,_=A.state;t=A.next_in,G=A.input,r=t+(A.avail_in-5),o=A.next_out,C=A.output,i=o-(j-A.avail_out),a=o+(A.avail_out-257),u=_.dmax,c=_.wsize,l=_.whave,m=_.wnext,B=_.window,k=_.hold,f=_.bits,g=_.lencode,E=_.distcode,h=(1<<_.lenbits)-1,y=(1<<_.distbits)-1;A:do{f<15&&(k+=G[t++]<<f,f+=8,k+=G[t++]<<f,f+=8),F=g[k&h];e:for(;;){if(S=F>>>24,k>>>=S,f-=S,S=F>>>16&255,S===0)C[o++]=F&65535;else if(S&16){x=F&65535,S&=15,S&&(f<S&&(k+=G[t++]<<f,f+=8),x+=k&(1<<S)-1,k>>>=S,f-=S),f<15&&(k+=G[t++]<<f,f+=8,k+=G[t++]<<f,f+=8),F=E[k&y];j:for(;;){if(S=F>>>24,k>>>=S,f-=S,S=F>>>16&255,S&16){if(O=F&65535,S&=15,f<S&&(k+=G[t++]<<f,f+=8,f<S&&(k+=G[t++]<<f,f+=8)),O+=k&(1<<S)-1,O>u){A.msg="invalid distance too far back",_.mode=f6;break A}if(k>>>=S,f-=S,S=o-i,O>S){if(S=O-S,S>l&&_.sane){A.msg="invalid distance too far back",_.mode=f6;break A}if(v=0,D=B,m===0){if(v+=c-S,S<x){x-=S;do C[o++]=B[v++];while(--S);v=o-O,D=C}}else if(m<S){if(v+=c+m-S,S-=m,S<x){x-=S;do C[o++]=B[v++];while(--S);if(v=0,m<x){S=m,x-=S;do C[o++]=B[v++];while(--S);v=o-O,D=C}}}else if(v+=m-S,S<x){x-=S;do C[o++]=B[v++];while(--S);v=o-O,D=C}for(;x>2;)C[o++]=D[v++],C[o++]=D[v++],C[o++]=D[v++],x-=3;x&&(C[o++]=D[v++],x>1&&(C[o++]=D[v++]))}else{v=o-O;do C[o++]=C[v++],C[o++]=C[v++],C[o++]=C[v++],x-=3;while(x>2);x&&(C[o++]=C[v++],x>1&&(C[o++]=C[v++]))}}else if(S&64){A.msg="invalid distance code",_.mode=f6;break A}else{F=E[(F&65535)+(k&(1<<S)-1)];continue j}break}}else if(S&64)if(S&32){_.mode=BT;break A}else{A.msg="invalid literal/length code",_.mode=f6;break A}else{F=g[(F&65535)+(k&(1<<S)-1)];continue e}break}}while(t<r&&o<a);x=f>>3,t-=x,f-=x<<3,k&=(1<<f)-1,A.next_in=t,A.next_out=o,A.avail_in=t<r?5+(r-t):5-(t-r),A.avail_out=o<a?257+(a-o):257-(o-a),_.hold=k,_.bits=f},jn=15,kE=852,BE=592,fE=0,Xl=1,gE=2,gT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ET=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),yT=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),hT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),FT=(e,A,j,t,r,o,i,a)=>{let u=a.bits,c=0,l=0,m=0,B=0,k=0,f=0,g=0,E=0,h=0,y=0,F,S,x,O,v,D=null,G,C=new Uint16Array(jn+1),_=new Uint16Array(jn+1),V=null,z,L,R;for(c=0;c<=jn;c++)C[c]=0;for(l=0;l<t;l++)C[A[j+l]]++;for(k=u,B=jn;B>=1&&C[B]===0;B--);if(k>B&&(k=B),B===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,a.bits=1,0;for(m=1;m<B&&C[m]===0;m++);for(k<m&&(k=m),E=1,c=1;c<=jn;c++)if(E<<=1,E-=C[c],E<0)return-1;if(E>0&&(e===fE||B!==1))return-1;for(_[1]=0,c=1;c<jn;c++)_[c+1]=_[c]+C[c];for(l=0;l<t;l++)A[j+l]!==0&&(i[_[A[j+l]]++]=l);if(e===fE?(D=V=i,G=20):e===Xl?(D=gT,V=ET,G=257):(D=yT,V=hT,G=0),y=0,l=0,c=m,v=o,f=k,g=0,x=-1,h=1<<k,O=h-1,e===Xl&&h>kE||e===gE&&h>BE)return 1;for(;;){z=c-g,i[l]+1<G?(L=0,R=i[l]):i[l]>=G?(L=V[i[l]-G],R=D[i[l]-G]):(L=96,R=0),F=1<<c-g,S=1<<f,m=S;do S-=F,r[v+(y>>g)+S]=z<<24|L<<16|R|0;while(S!==0);for(F=1<<c-1;y&F;)F>>=1;if(F!==0?(y&=F-1,y+=F):y=0,l++,--C[c]===0){if(c===B)break;c=A[j+i[l]]}if(c>k&&(y&O)!==x){for(g===0&&(g=k),v+=m,f=c-g,E=1<<f;f+g<B&&(E-=C[f+g],!(E<=0));)f++,E<<=1;if(h+=1<<f,e===Xl&&h>kE||e===gE&&h>BE)return 1;x=y&O,r[x]=k<<24|f<<16|v-o|0}}return y!==0&&(r[v+y]=c-g<<24|64<<16|0),a.bits=k,0},Qs=FT,ST=0,my=1,ky=2,{Z_FINISH:EE,Z_BLOCK:wT,Z_TREES:g6,Z_OK:Rr,Z_STREAM_END:bT,Z_NEED_DICT:IT,Z_STREAM_ERROR:dj,Z_DATA_ERROR:By,Z_MEM_ERROR:fy,Z_BUF_ERROR:$T,Z_DEFLATED:yE}=_r,$6=16180,hE=16181,FE=16182,SE=16183,wE=16184,bE=16185,IE=16186,$E=16187,vE=16188,qE=16189,w6=16190,gt=16191,Wl=16192,xE=16193,Jl=16194,TE=16195,PE=16196,GE=16197,CE=16198,E6=16199,y6=16200,OE=16201,ME=16202,RE=16203,_E=16204,DE=16205,Yl=16206,NE=16207,LE=16208,RA=16209,gy=16210,Ey=16211,vT=852,qT=592,xT=15,TT=xT,KE=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function PT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Dr=e=>{if(!e)return 1;let A=e.state;return!A||A.strm!==e||A.mode<$6||A.mode>Ey?1:0},yy=e=>{if(Dr(e))return dj;let A=e.state;return e.total_in=e.total_out=A.total=0,e.msg="",A.wrap&&(e.adler=A.wrap&1),A.mode=$6,A.last=0,A.havedict=0,A.flags=-1,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new Int32Array(vT),A.distcode=A.distdyn=new Int32Array(qT),A.sane=1,A.back=-1,Rr},hy=e=>{if(Dr(e))return dj;let A=e.state;return A.wsize=0,A.whave=0,A.wnext=0,yy(e)},Fy=(e,A)=>{let j;if(Dr(e))return dj;let t=e.state;return A<0?(j=0,A=-A):(j=(A>>4)+5,A<48&&(A&=15)),A&&(A<8||A>15)?dj:(t.window!==null&&t.wbits!==A&&(t.window=null),t.wrap=j,t.wbits=A,hy(e))},Sy=(e,A)=>{if(!e)return dj;let j=new PT;e.state=j,j.strm=e,j.window=null,j.mode=$6;let t=Fy(e,A);return t!==Rr&&(e.state=null),t},GT=e=>Sy(e,TT),UE=!0,Zl,Ad,CT=e=>{if(UE){Zl=new Int32Array(512),Ad=new Int32Array(32);let A=0;for(;A<144;)e.lens[A++]=8;for(;A<256;)e.lens[A++]=9;for(;A<280;)e.lens[A++]=7;for(;A<288;)e.lens[A++]=8;for(Qs(my,e.lens,0,288,Zl,0,e.work,{bits:9}),A=0;A<32;)e.lens[A++]=5;Qs(ky,e.lens,0,32,Ad,0,e.work,{bits:5}),UE=!1}e.lencode=Zl,e.lenbits=9,e.distcode=Ad,e.distbits=5},wy=(e,A,j,t)=>{let r,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),t>=o.wsize?(o.window.set(A.subarray(j-o.wsize,j),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>t&&(r=t),o.window.set(A.subarray(j-t,j-t+r),o.wnext),t-=r,t?(o.window.set(A.subarray(j-t,j),0),o.wnext=t,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},OT=(e,A)=>{let j,t,r,o,i,a,u,c,l,m,B,k,f,g,E=0,h,y,F,S,x,O,v,D,G=new Uint8Array(4),C,_,V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Dr(e)||!e.output||!e.input&&e.avail_in!==0)return dj;j=e.state,j.mode===gt&&(j.mode=Wl),i=e.next_out,r=e.output,u=e.avail_out,o=e.next_in,t=e.input,a=e.avail_in,c=j.hold,l=j.bits,m=a,B=u,D=Rr;A:for(;;)switch(j.mode){case $6:if(j.wrap===0){j.mode=Wl;break}for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&2&&c===35615){j.wbits===0&&(j.wbits=15),j.check=0,G[0]=c&255,G[1]=c>>>8&255,j.check=de(j.check,G,2,0),c=0,l=0,j.mode=hE;break}if(j.head&&(j.head.done=!1),!(j.wrap&1)||(((c&255)<<8)+(c>>8))%31){e.msg="incorrect header check",j.mode=RA;break}if((c&15)!==yE){e.msg="unknown compression method",j.mode=RA;break}if(c>>>=4,l-=4,v=(c&15)+8,j.wbits===0&&(j.wbits=v),v>15||v>j.wbits){e.msg="invalid window size",j.mode=RA;break}j.dmax=1<<j.wbits,j.flags=0,e.adler=j.check=1,j.mode=c&512?qE:gt,c=0,l=0;break;case hE:for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.flags=c,(j.flags&255)!==yE){e.msg="unknown compression method",j.mode=RA;break}if(j.flags&57344){e.msg="unknown header flags set",j.mode=RA;break}j.head&&(j.head.text=c>>8&1),j.flags&512&&j.wrap&4&&(G[0]=c&255,G[1]=c>>>8&255,j.check=de(j.check,G,2,0)),c=0,l=0,j.mode=FE;case FE:for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.head&&(j.head.time=c),j.flags&512&&j.wrap&4&&(G[0]=c&255,G[1]=c>>>8&255,G[2]=c>>>16&255,G[3]=c>>>24&255,j.check=de(j.check,G,4,0)),c=0,l=0,j.mode=SE;case SE:for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.head&&(j.head.xflags=c&255,j.head.os=c>>8),j.flags&512&&j.wrap&4&&(G[0]=c&255,G[1]=c>>>8&255,j.check=de(j.check,G,2,0)),c=0,l=0,j.mode=wE;case wE:if(j.flags&1024){for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.length=c,j.head&&(j.head.extra_len=c),j.flags&512&&j.wrap&4&&(G[0]=c&255,G[1]=c>>>8&255,j.check=de(j.check,G,2,0)),c=0,l=0}else j.head&&(j.head.extra=null);j.mode=bE;case bE:if(j.flags&1024&&(k=j.length,k>a&&(k=a),k&&(j.head&&(v=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(t.subarray(o,o+k),v)),j.flags&512&&j.wrap&4&&(j.check=de(j.check,t,k,o)),a-=k,o+=k,j.length-=k),j.length))break A;j.length=0,j.mode=IE;case IE:if(j.flags&2048){if(a===0)break A;k=0;do v=t[o+k++],j.head&&v&&j.length<65536&&(j.head.name+=String.fromCharCode(v));while(v&&k<a);if(j.flags&512&&j.wrap&4&&(j.check=de(j.check,t,k,o)),a-=k,o+=k,v)break A}else j.head&&(j.head.name=null);j.length=0,j.mode=$E;case $E:if(j.flags&4096){if(a===0)break A;k=0;do v=t[o+k++],j.head&&v&&j.length<65536&&(j.head.comment+=String.fromCharCode(v));while(v&&k<a);if(j.flags&512&&j.wrap&4&&(j.check=de(j.check,t,k,o)),a-=k,o+=k,v)break A}else j.head&&(j.head.comment=null);j.mode=vE;case vE:if(j.flags&512){for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&4&&c!==(j.check&65535)){e.msg="header crc mismatch",j.mode=RA;break}c=0,l=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),e.adler=j.check=0,j.mode=gt;break;case qE:for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}e.adler=j.check=KE(c),c=0,l=0,j.mode=w6;case w6:if(j.havedict===0)return e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,IT;e.adler=j.check=1,j.mode=gt;case gt:if(A===wT||A===g6)break A;case Wl:if(j.last){c>>>=l&7,l-=l&7,j.mode=Yl;break}for(;l<3;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}switch(j.last=c&1,c>>>=1,l-=1,c&3){case 0:j.mode=xE;break;case 1:if(CT(j),j.mode=E6,A===g6){c>>>=2,l-=2;break A}break;case 2:j.mode=PE;break;case 3:e.msg="invalid block type",j.mode=RA}c>>>=2,l-=2;break;case xE:for(c>>>=l&7,l-=l&7;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if((c&65535)!==(c>>>16^65535)){e.msg="invalid stored block lengths",j.mode=RA;break}if(j.length=c&65535,c=0,l=0,j.mode=Jl,A===g6)break A;case Jl:j.mode=TE;case TE:if(k=j.length,k){if(k>a&&(k=a),k>u&&(k=u),k===0)break A;r.set(t.subarray(o,o+k),i),a-=k,o+=k,u-=k,i+=k,j.length-=k;break}j.mode=gt;break;case PE:for(;l<14;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.nlen=(c&31)+257,c>>>=5,l-=5,j.ndist=(c&31)+1,c>>>=5,l-=5,j.ncode=(c&15)+4,c>>>=4,l-=4,j.nlen>286||j.ndist>30){e.msg="too many length or distance symbols",j.mode=RA;break}j.have=0,j.mode=GE;case GE:for(;j.have<j.ncode;){for(;l<3;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.lens[V[j.have++]]=c&7,c>>>=3,l-=3}for(;j.have<19;)j.lens[V[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,C={bits:j.lenbits},D=Qs(ST,j.lens,0,19,j.lencode,0,j.work,C),j.lenbits=C.bits,D){e.msg="invalid code lengths set",j.mode=RA;break}j.have=0,j.mode=CE;case CE:for(;j.have<j.nlen+j.ndist;){for(;E=j.lencode[c&(1<<j.lenbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(F<16)c>>>=h,l-=h,j.lens[j.have++]=F;else{if(F===16){for(_=h+2;l<_;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(c>>>=h,l-=h,j.have===0){e.msg="invalid bit length repeat",j.mode=RA;break}v=j.lens[j.have-1],k=3+(c&3),c>>>=2,l-=2}else if(F===17){for(_=h+3;l<_;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=h,l-=h,v=0,k=3+(c&7),c>>>=3,l-=3}else{for(_=h+7;l<_;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=h,l-=h,v=0,k=11+(c&127),c>>>=7,l-=7}if(j.have+k>j.nlen+j.ndist){e.msg="invalid bit length repeat",j.mode=RA;break}for(;k--;)j.lens[j.have++]=v}}if(j.mode===RA)break;if(j.lens[256]===0){e.msg="invalid code -- missing end-of-block",j.mode=RA;break}if(j.lenbits=9,C={bits:j.lenbits},D=Qs(my,j.lens,0,j.nlen,j.lencode,0,j.work,C),j.lenbits=C.bits,D){e.msg="invalid literal/lengths set",j.mode=RA;break}if(j.distbits=6,j.distcode=j.distdyn,C={bits:j.distbits},D=Qs(ky,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,C),j.distbits=C.bits,D){e.msg="invalid distances set",j.mode=RA;break}if(j.mode=E6,A===g6)break A;case E6:j.mode=y6;case y6:if(a>=6&&u>=258){e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,fT(e,B),i=e.next_out,r=e.output,u=e.avail_out,o=e.next_in,t=e.input,a=e.avail_in,c=j.hold,l=j.bits,j.mode===gt&&(j.back=-1);break}for(j.back=0;E=j.lencode[c&(1<<j.lenbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(y&&!(y&240)){for(S=h,x=y,O=F;E=j.lencode[O+((c&(1<<S+x)-1)>>S)],h=E>>>24,y=E>>>16&255,F=E&65535,!(S+h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=S,l-=S,j.back+=S}if(c>>>=h,l-=h,j.back+=h,j.length=F,y===0){j.mode=DE;break}if(y&32){j.back=-1,j.mode=gt;break}if(y&64){e.msg="invalid literal/length code",j.mode=RA;break}j.extra=y&15,j.mode=OE;case OE:if(j.extra){for(_=j.extra;l<_;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.length+=c&(1<<j.extra)-1,c>>>=j.extra,l-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=ME;case ME:for(;E=j.distcode[c&(1<<j.distbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(!(y&240)){for(S=h,x=y,O=F;E=j.distcode[O+((c&(1<<S+x)-1)>>S)],h=E>>>24,y=E>>>16&255,F=E&65535,!(S+h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=S,l-=S,j.back+=S}if(c>>>=h,l-=h,j.back+=h,y&64){e.msg="invalid distance code",j.mode=RA;break}j.offset=F,j.extra=y&15,j.mode=RE;case RE:if(j.extra){for(_=j.extra;l<_;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.offset+=c&(1<<j.extra)-1,c>>>=j.extra,l-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){e.msg="invalid distance too far back",j.mode=RA;break}j.mode=_E;case _E:if(u===0)break A;if(k=B-u,j.offset>k){if(k=j.offset-k,k>j.whave&&j.sane){e.msg="invalid distance too far back",j.mode=RA;break}k>j.wnext?(k-=j.wnext,f=j.wsize-k):f=j.wnext-k,k>j.length&&(k=j.length),g=j.window}else g=r,f=i-j.offset,k=j.length;k>u&&(k=u),u-=k,j.length-=k;do r[i++]=g[f++];while(--k);j.length===0&&(j.mode=y6);break;case DE:if(u===0)break A;r[i++]=j.length,u--,j.mode=y6;break;case Yl:if(j.wrap){for(;l<32;){if(a===0)break A;a--,c|=t[o++]<<l,l+=8}if(B-=u,e.total_out+=B,j.total+=B,j.wrap&4&&B&&(e.adler=j.check=j.flags?de(j.check,r,B,i-B):Js(j.check,r,B,i-B)),B=u,j.wrap&4&&(j.flags?c:KE(c))!==j.check){e.msg="incorrect data check",j.mode=RA;break}c=0,l=0}j.mode=NE;case NE:if(j.wrap&&j.flags){for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&4&&c!==(j.total&4294967295)){e.msg="incorrect length check",j.mode=RA;break}c=0,l=0}j.mode=LE;case LE:D=bT;break A;case RA:D=By;break A;case gy:return fy;case Ey:default:return dj}return e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,(j.wsize||B!==e.avail_out&&j.mode<RA&&(j.mode<Yl||A!==EE))&&wy(e,e.output,e.next_out,B-e.avail_out),m-=e.avail_in,B-=e.avail_out,e.total_in+=m,e.total_out+=B,j.total+=B,j.wrap&4&&B&&(e.adler=j.check=j.flags?de(j.check,r,B,e.next_out-B):Js(j.check,r,B,e.next_out-B)),e.data_type=j.bits+(j.last?64:0)+(j.mode===gt?128:0)+(j.mode===E6||j.mode===Jl?256:0),(m===0&&B===0||A===EE)&&D===Rr&&(D=$T),D},MT=e=>{if(Dr(e))return dj;let A=e.state;return A.window&&(A.window=null),e.state=null,Rr},RT=(e,A)=>{if(Dr(e))return dj;let j=e.state;return j.wrap&2?(j.head=A,A.done=!1,Rr):dj},_T=(e,A)=>{let j=A.length,t,r,o;return Dr(e)||(t=e.state,t.wrap!==0&&t.mode!==w6)?dj:t.mode===w6&&(r=1,r=Js(r,A,j,0),r!==t.check)?By:(o=wy(e,A,j,j),o?(t.mode=gy,fy):(t.havedict=1,Rr))},DT=hy,NT=Fy,LT=yy,KT=GT,UT=Sy,HT=OT,QT=MT,VT=RT,zT=_T,XT="pako inflate (from Nodeca project)",yt={inflateReset:DT,inflateReset2:NT,inflateResetKeep:LT,inflateInit:KT,inflateInit2:UT,inflate:HT,inflateEnd:QT,inflateGetHeader:VT,inflateSetDictionary:zT,inflateInfo:XT};function WT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var JT=WT,by=Object.prototype.toString,{Z_NO_FLUSH:YT,Z_FINISH:ZT,Z_OK:Ai,Z_STREAM_END:ed,Z_NEED_DICT:jd,Z_STREAM_ERROR:AP,Z_DATA_ERROR:HE,Z_MEM_ERROR:eP}=_r;function ri(e){this.options=I6.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});let A=this.options;A.raw&&A.windowBits>=0&&A.windowBits<16&&(A.windowBits=-A.windowBits,A.windowBits===0&&(A.windowBits=-15)),A.windowBits>=0&&A.windowBits<16&&!(e&&e.windowBits)&&(A.windowBits+=32),A.windowBits>15&&A.windowBits<48&&(A.windowBits&15||(A.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ly,this.strm.avail_out=0;let j=yt.inflateInit2(this.strm,A.windowBits);if(j!==Ai)throw new Error(Or[j]);if(this.header=new JT,yt.inflateGetHeader(this.strm,this.header),A.dictionary&&(typeof A.dictionary=="string"?A.dictionary=Zs.string2buf(A.dictionary):by.call(A.dictionary)==="[object ArrayBuffer]"&&(A.dictionary=new Uint8Array(A.dictionary)),A.raw&&(j=yt.inflateSetDictionary(this.strm,A.dictionary),j!==Ai)))throw new Error(Or[j])}ri.prototype.push=function(e,A){let j=this.strm,t=this.options.chunkSize,r=this.options.dictionary,o,i,a;if(this.ended)return!1;for(A===~~A?i=A:i=A===!0?ZT:YT,by.call(e)==="[object ArrayBuffer]"?j.input=new Uint8Array(e):j.input=e,j.next_in=0,j.avail_in=j.input.length;;){for(j.avail_out===0&&(j.output=new Uint8Array(t),j.next_out=0,j.avail_out=t),o=yt.inflate(j,i),o===jd&&r&&(o=yt.inflateSetDictionary(j,r),o===Ai?o=yt.inflate(j,i):o===HE&&(o=jd));j.avail_in>0&&o===ed&&j.state.wrap>0&&e[j.next_in]!==0;)yt.inflateReset(j),o=yt.inflate(j,i);switch(o){case AP:case HE:case jd:case eP:return this.onEnd(o),this.ended=!0,!1}if(a=j.avail_out,j.next_out&&(j.avail_out===0||o===ed))if(this.options.to==="string"){let u=Zs.utf8border(j.output,j.next_out),c=j.next_out-u,l=Zs.buf2string(j.output,u);j.next_out=c,j.avail_out=t-c,c&&j.output.set(j.output.subarray(u,u+c),0),this.onData(l)}else this.onData(j.output.length===j.next_out?j.output:j.output.subarray(0,j.next_out));if(!(o===Ai&&a===0)){if(o===ed)return o=yt.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(j.avail_in===0)break}}return!0};ri.prototype.onData=function(e){this.chunks.push(e)};ri.prototype.onEnd=function(e){e===Ai&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=I6.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function fd(e,A){let j=new ri(A);if(j.push(e),j.err)throw j.msg||Or[j.err];return j.result}function jP(e,A){return A=A||{},A.raw=!0,fd(e,A)}var tP=ri,rP=fd,oP=jP,nP=fd,sP=_r,iP={Inflate:tP,inflate:rP,inflateRaw:oP,ungzip:nP,constants:sP},{Deflate:aP,deflate:pP,deflateRaw:cP,gzip:uP}=kT,{Inflate:lP,inflate:dP,inflateRaw:mP,ungzip:kP}=iP,BP=aP,fP=pP,gP=cP,EP=uP,yP=lP,hP=dP,FP=mP,SP=kP,wP=_r,gd={Deflate:BP,deflate:fP,deflateRaw:gP,gzip:EP,Inflate:yP,inflate:hP,inflateRaw:FP,ungzip:SP,constants:wP};n();s();var v6=class{maxSize=5;items=[];enqueue(A,j,t){let r=this.processQuoteResponse(A,j,t?.join(","));this.items.push(r),this.items.length>this.maxSize&&this.items.shift()}getItems(){return[...this.items]}size(){return this.items.length}clear(){this.items=[]}processQuoteResponse(A,j,t){return{quotes:A.quotes.map(o=>({amountIn:o.sellAmount,amountOut:o.buyAmount,tokenIn:M(A.sellToken),tokenOut:M(A.buyToken),provider:o.baseProvider.name})),timestamp:Date.now(),selectedProvider:j,alerts:t}}};var bP="Sq+",Ed=class{queue=new v6;addQuoteResponse(A,j,t){this.queue.enqueue(A,j,t)}reset(){this.queue.clear()}getQuotes(){return this.queue.getItems()}logState(A){let j=this.getStateData(A);b.addBreadcrumb("generic",`${bP}${j}`,"info")}processQuoteProcessorState(A){switch(A.type){case"starting":this.reset();break;case"quoteProcessed":this.addQuoteResponse(A.response,A.input.preferredProvider,[...A.quoteDetails.alerts,...A.quoteDetails.warnings].map(j=>j.toString()));break;default:break}}getStateData(A){let j=this.queue.getItems(),t=this.compactData(j,A),r=gd.gzip(JSON.stringify(t));return Buffer.from(r).toString("base64")}compactData(A,j){return A.length===0?null:{items:A.map(t=>({q:t.quotes.map(r=>({i:r.amountIn,o:r.amountOut,p:r.provider,ti:r.tokenIn,to:r.tokenOut})),t:t.timestamp,sp:t.selectedProvider,a:t.alerts})),th:j}}expandData(A){return A.items.map(j=>({quotes:j.q.map(t=>({amountIn:t.i,amountOut:t.o,tokenIn:t.ti,tokenOut:t.to,provider:t.p})),timestamp:j.t,selectedProvider:j.sp,alerts:j.a}))}decode(A){try{let j=Buffer.from(A,"base64"),t=gd.inflate(j,{to:"string"}),r=JSON.parse(t);return r?{items:this.expandData(r),txnHash:r.th}:{items:[]}}catch(j){return console.error("Failed to decode compressed data:",j),{items:[]}}}},Tj=new Ed;n();s();n();s();var SA=class extends Error{code;detailMessage;constructor(A,j){super(A),this.code=A,this.detailMessage=j}};var IP="slippageToleranceExceeded",$P="INSUFFICIENT_FUNDS",vP=Ck,qP="insufficient lamports",xP="lower balance than rent-exempt minimum",TP=Gk,PP="Transaction confirmation failed",GP=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],CP="Ledger user rejected action",OP="Ledger Sign Error";function MP(e){try{return Number(e.split('"Custom":')[1].split("}")[0])}catch{return null}}function RP(e){switch(MP(e.message)){case 301:return"slippageToleranceExceeded";case 6e3:return"EmptyRoute";case 6001:return"slippageToleranceExceeded";case 6002:return"InvalidCalculation";case 6003:return"MissingPlatformFeeAccount";case 6004:return"InvalidSlippage";case 6005:return"NotEnoughPercent";case 6006:return"InvalidInputIndex";case 6007:return"InvalidOutputIndex";case 6008:return"NotEnoughAccountKeys";case 6009:return"NonZeroMinimumOutAmountNotSupported";case 6010:return"InvalidRoutePlan";case 6011:return"InvalidReferralAuthority";case 6012:return"LedgerTokenAccountDoesNotMatch";case 6013:return"InvalidTokenLedger";case 6014:return"IncorrectTokenProgramID";case 6015:return"TokenProgramNotProvided";case 6016:return"SwapNotSupported";case 6017:return"ExactOutAmountNotMatched";case 6018:return"SourceAndDstinationMintCannotBeTheSame";default:return null}}function _P(e){return GP.some(j=>e.message.includes(j))?"LedgerConnectionError":e.message.includes(CP)?"LedgerRejectAction":e.message.includes(OP)?"LedgerUnknownSignError":e.message.toLowerCase().includes("ledger")?"LedgerUnknownError":null}function jr(e){if(e===void 0)return new SA("UnknownError","No error provided");if(e instanceof SA)return e;let A=DP(e);if(A.message.includes($P))return new SA("INSUFFICIENT_FUNDS");if(NP(A.message))return new SA("slippageToleranceExceeded");if(A.message==="Scan results are not valid")return new SA("Scan results are not valid");if([vP,qP,TP,xP].some(u=>A.message.includes(u)))return new SA("NotEnoughSol");let o=RP(A);if(o!==null)return new SA(o);if(A.message.includes(PP))return new SA("Transaction confirmation failed");let a=_P(A);return a!==null?new SA(a):new SA("UnknownError",A.message)}function DP(e){return typeof e=="string"?new Error(e):typeof e=="object"&&"logs"in e&&e.logs?.length?new Error(e.logs.join(`
`)):e}function NP(e){return e.includes(IP)}n();s();n();s();var Iy=3;function q6(){try{let e=Be.getMultivariateAssignment("swapper-high-slippage-threshold"),A=Number(e);return!e||isNaN(A)?Iy:A}catch{return Iy}}var $y=({currentQuote:e,quoteResponse:A,gasEstimation:j,swapTransactions:t,scanResults:r,isSwapSimulationDisabled:o,slippageTolerance:i})=>{if(!e)throw new SA("Trying to execute swap with no current quote");if(!A)throw new SA("Trying to execute swap with no quote response");if(I.isEVMNetworkID(A.sellToken.chainId)&&(!j||j?.length===0||j?.length<(t?.transactions.length??1)))throw new SA("No gas estimation available");if(!t)throw new SA("No swap transactions available");if(r.state!=="valid"&&(b.addBreadcrumb("swapper","swapSimulationNotValid","info",_t({scanResults:r.state})),!o)){let u=["Scan results are not valid","AccountFrozen","INSUFFICIENT_FUNDS","INSUFFICIENT_GAS","slippageToleranceExceeded","SIMULATION_TIMEOUT","MissingArgument","STALE_QUOTE","SimulationUnknownError"];if(KP(r.state)&&u.includes(r.state.code)){if(LP(r.state,i))return;throw r.state}else throw new SA("Scan results are not valid")}};function LP(e,A){return e.code==="slippageToleranceExceeded"&&A&&A>=q6()}function KP(e){return e instanceof SA}var UP={swap:{solana:"executeSolanaSwap",evm:"executeEvmSwap",sui:"executeSuiSwap"},bridge:{solana:"executeSolanaBridge",evm:"executeEvmBridge",sui:"executeSuiBridge"}},yd=(e,A)=>UP[e?"bridge":"swap"][A??"solana"],vy=async({isBridge:e,addressType:A,isSwapSimulationDisabled:j,sender:t,currentQuote:r,quoteResponse:o,gasEstimation:i,swapTransactions:a,scanResults:u,pendingActivityRows:c,connection:l,logSwapFailureNoSignature:m,logTransactionSubmitted:B,onTransactionReceiptReceived:k,onTransactionSubmissionError:f,resetToInitialState:g,slippageTolerance:E,swapFungibles:h})=>{await b.startSpan(yd(e,a?.type),async()=>{g();let y;try{$y({currentQuote:r,quoteResponse:o,gasEstimation:i,swapTransactions:a,scanResults:u,isSwapSimulationDisabled:j,slippageTolerance:E});let F=await h({type:A,callerAddress:t,swapTransactions:a,pendingSwapActivityRows:c.pendingSwapActivityRows,pendingApprovalActivityRows:c.pendingApprovalActivityRows,gasEstimation:i,connection:l});if(k(F),F.error)throw F.id||m(),y=F.id,F.error;B(F),Tj.logState(F.id)}catch(F){let S=jr(F);f(S,y)}})};n();s();n();s();n();s();n();s();var ht=(u=>(u.SlippageExceeded="SLIPPAGE_EXCEEDED",u.InsufficientFunds="INSUFFICIENT_FUNDS",u.InsufficientGas="INSUFFICIENT_GAS",u.AccountFrozen="ACCOUNT_FROZEN",u.SimulationTimeout="SIMULATION_TIMEOUT",u.StaleQuote="STALE_QUOTE",u.UnknownError="UNKNOWN_ERROR",u.SimulationFailed="SIMULATION_FAILED",u))(ht||{}),pn=class e extends Error{constructor(j,t,r){super(j);this.scannedTransactionResult=t;this.type=r;t&&(this.detailMessage=t.simulationError?.humanReadableError??(t.warnings.length>0?t.warnings[0].message:void 0)),this.type=r}detailMessage;static fromError(j){return j instanceof e?j:new e(j.message)}static fromScannedTransactionResult(j,t){return(o=>Object.values(ht).includes(o))(j)?new e(j,t,j):new e(j,t)}};n();s();var Nr=class e extends Error{constructor(j,t){super(j);this.type=t}static fromError(j){return new e(j.message)}static fromType(j){return new e(j,j)}};var qy="https://phantom.com",x6=class{constructor(A,j,t){this.swapCommand=A;this.send=j;this.executingQuote=t;this.takerAddress=A.takerAddress,this.networkId=A.networkId,this.quote=A.quote,this.executionId=A.executionId}takerAddress;networkId;quote;executionId;createTransaction(){return this.send({type:"executeSwapStarted",executionId:this.executionId,executingQuote:this.executingQuote}),this.swapCommand.createTransaction()}async fetchSimulation(A){let{transactions:j,deviceId:t,isSimulationKilled:r}=A,o=fe(T.language)??"en";if(I.isSuiNetworkID(this.networkId))return{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0};let i=await Wo({transactions:j,locale:o,url:qy,deviceId:t,takerAddress:this.takerAddress,networkId:this.networkId,slippageType:this.executingQuote.slippageType,quote:this.quote,quoteResponse:this.executingQuote.response,isSimulationKilled:r});return i.status==="success"?i.result:null}async simulate(A,j,t,r){try{this.send({type:"simulationRequestStarted",executionId:this.executionId,executingQuote:this.executingQuote,networkId:this.networkId});let o=await this.fetchSimulation({transactions:A,deviceId:t,isSimulationKilled:r});if(!o)return this.send({type:"simulationSkipped",executionId:this.executionId,networkId:this.networkId}),null;switch(o.error){case void 0:break;case"SIMULATION_FAILED":break;case"SLIPPAGE_EXCEEDED":if(this.executingQuote.response.slippageTolerance>=q6())break;default:throw pn.fromScannedTransactionResult(o.error,o)}return this.send({type:"simulationPassed",scannedTransactionResult:o,executionId:this.executionId,networkId:this.networkId}),o}catch(o){throw this.send({type:"simulationFailed",error:pn.fromError(o),executionId:this.executionId,networkId:this.networkId,url:qy}),o}}async swap(A,j,t,r,o){this.send({type:"transactionSubmissionStarted",executionId:this.executionId});try{let i=await this.swapCommand.swap(A,j,t,r,o);if(!i.id)throw Nr.fromType("noSignature");return this.send({type:"transactionSubmissionSuccess",txReceipt:i,executionId:this.executionId}),i}catch(i){let a=i instanceof Nr?i:Nr.fromError(i);throw this.send({type:"transactionSubmissionFailed",error:a,executionId:this.executionId}),a}}async waitForConfirmation(A){this.send({type:"transactionConfirmationStarted",executionId:this.executionId,txReceipt:A});try{let j=await this.swapCommand.waitForConfirmation(A);return this.send({type:"transactionConfirmed",executionId:this.executionId,txReceipt:A}),j}catch(j){throw this.send({type:"transactionConfirmationFailed",error:j,txReceipt:A,executionId:this.executionId}),j}}};n();s();n();s();var T6=class extends Error{constructor(A,j){let r=(Array.isArray(j)?j:[j]).join(", ");super(`Can't transition to ${r} from ${A.type}`)}},P6=class{state=new Map;listeners=new Set;send(A){A.type==="executeSwapStarted"&&this.state.set(A.executionId,{type:"idle",executingQuote:A.executingQuote});let j=this.state.get(A.executionId);if(!j)throw new Error(`No previous state found for execution id: ${A.executionId}`);let t=j;try{return t=this.detectNextState(j,A),t.type==="transactionConfirmed"?this.state.delete(A.executionId):this.state.set(A.executionId,t),t}catch{return j}finally{this.notifyListeners(A,j,t,this.state)}}notifyListeners(A,j,t,r){try{this.listeners.forEach(o=>o.onStateChange(A,j,t,r))}catch{}}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}detectNextState(A,j){switch(j.type){case"executeSwapStarted":return rt(A,"idle"),{type:"started",executingQuote:j.executingQuote};case"simulationRequestStarted":return rt(A,"started"),{type:"simulating",executingQuote:A.executingQuote};case"simulationPassed":return rt(A,"simulating"),{type:"simulated",scannedTransactionResult:j.scannedTransactionResult,executingQuote:A.executingQuote};case"simulationFailed":return rt(A,"simulating"),{type:"simulationFailed",error:j.error,executingQuote:A.executingQuote};case"simulationSkipped":return rt(A,"simulating"),{type:"simulationSkipped",executingQuote:A.executingQuote};case"transactionSubmissionStarted":return HP(A,["simulated","simulationSkipped"]),{type:"submittingTransaction",executingQuote:A.executingQuote,scannedTransactionResult:A.type==="simulated"?A.scannedTransactionResult:void 0};case"transactionSubmissionFailed":return rt(A,"submittingTransaction"),{type:"transactionSubmissionFailed",error:j.error,executingQuote:A.executingQuote,scannedTransactionResult:A.scannedTransactionResult};case"transactionSubmissionSuccess":return rt(A,"submittingTransaction"),{type:"transactionSubmitted",txReceipt:j.txReceipt,executingQuote:A.executingQuote,scannedTransactionResult:A.scannedTransactionResult};case"transactionConfirmationStarted":return rt(A,"transactionSubmitted"),{type:"confirmingTransaction",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,executingQuote:A.executingQuote};case"transactionConfirmationFailed":return rt(A,"transactionSubmitted"),{type:"transactionNotConfirmed",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,error:j.error,executingQuote:A.executingQuote};case"transactionConfirmed":return rt(A,"confirmingTransaction"),{type:"transactionConfirmed",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,executingQuote:A.executingQuote}}}};function rt(e,A){if(e.type!==A)throw new T6(e,A)}function HP(e,A){if(!A.includes(e.type))throw new T6(e,A)}n();s();function Ty(e){return e.type==="quote"}n();s();n();s();var QP={"Could not find any routes":"noRoute"},G6=class e extends Error{type;constructor(A,j){super(j??A),this.type=A}static fromMessage(A){let j=A?QP[A]??"undefinedError":"undefinedError";return new e(j,A)}};var Lr=class extends Error{constructor(A,j){super(`Can't transition to ${j} from ${A.type}`)}},C6=class{state;listeners=new Set;constructor(A){this.state=A??{type:"idle"}}send(A){let j=this.state;try{return j=this.detectNextState(this.state,A),this.state=j,j}catch{return this.state}finally{this.notifyListeners(A,this.state,j)}}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}notifyListeners(A,j,t){try{this.listeners.forEach(r=>r.onStateChange(A,j,t))}catch{}}detectNextState(A,j){switch(j.type){case"setPair":return{type:"pair",buy:j.buy,sell:j.sell,amount:j.amount};case"quoteRequestStarted":switch(A.type){case"pair":case"quote":case"quoteError":return{type:"fetchingQuote",buy:A.buy,sell:A.sell,amount:j.amount,slippageType:j.slippageType};default:throw new Lr(A,j.type)}case"quoteRequestError":if(A.type!=="fetchingQuote")throw new Lr(A,j.type);return{type:"quoteError",buy:A.buy,sell:A.sell,amount:A.amount,error:j.error,slippageType:A.slippageType};case"quoteResponseReceived":if(A.type!=="fetchingQuote")throw new Lr(A,j.type);let t=j.response.quotes[0];return t?{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:t,amount:A.amount,slippageType:A.slippageType}:{type:"quoteError",buy:A.buy,sell:A.sell,amount:A.amount,error:new G6("noRoute"),slippageType:A.slippageType};case"quoteResponseStreamed":switch(A.type){case"pair":case"fetchingQuote":case"quote":case"quoteError":return{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:j.quote,amount:{amount:j.quoteInput.amount,perspective:j.quoteInput.exactOut?"buy":"sell"},slippageType:j.quoteInput.autoSlippage?"auto":"fixed",input:j.quoteInput};default:throw new Lr(A,j.type)}case"userSelectedQuote":if(A.type!=="quote")throw new Lr(A,j.type);return{type:"quote",quote:j.quote,buy:A.buy,sell:A.sell,response:A.response,amount:A.amount,slippageType:A.slippageType}}}};n();s();n();s();var Gy=p.object({buyToken:p.custom(),sellToken:p.custom(),buyTokenPrice:p.custom().optional(),sellTokenPrice:p.custom().optional(),maxSellAmount:p.string().optional()}),ni=class e extends Error{constructor(j,t){super(t??j.name);this.type=j}static fromError(j){return new e({name:"unknown"},j.message)}};var rr=class{async initialize(A,j,t,r){let o=j.reduce((u,c)=>(u[c.networkID]=c.address,u),{}),i=await N.api().headers({"Content-Type":"application/json"}).timeout(K({seconds:20})).post("/swap/v2/initialize",{...A,addresses:o,cashAddresses:t,...r?{settings:r}:{}});if(i.status!==200)throw new DA({key:"SwapInitializationFailed"});let a=Gy.safeParse(i.data);if(!a.success)throw new DA({key:"SwapInitializationFailed"});return a.data}};n();s();function Cy(e){if(e.type!=="pair")return;let A=M(U(e.buyToken)),j=M(U(e.sellToken)),t,r;return e.mode.type==="swap"?(t=e.mode.takerDestinationCaip19,r=e.mode.takerCaip19):e.mode.type==="buy"?(t=void 0,r=e.mode.takerCaip19):e.mode.type==="sell"&&(t=e.mode.takerDestinationCaip19,r=void 0),{type:"swap",network:A?GA(A).chainId:I.solana.mainnetID,sellCaip19:A,buyCaip19:j,takerCaip19:t,takerDestinationCaip19:r}}n();s();n();s();n();s();n();s();n();s();n();s();var hd=5,Fd=5,Oy={id:I.solana.mainnetID,imageUrl:I.solana.iconUrl,name:I.solana.name,symbol:I.solana.tokenSymbol},or={type:"SolanaNative",data:{amount:"0",balance:new H(0),chain:Oy,decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:"VERIFIED"}},Sd={type:"SPL",data:{amount:"0",balance:new H(0),chain:Oy,decimals:6,key:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",splTokenAccountPubkey:"EAF7dH8Jy43Xgp68PhyybKhfKxk46NFRkWN4PMCLqMfS",symbol:"USDC",tokenAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",walletAddress:"",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:"VERIFIED"}},My={type:"SuiNative",data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/sui/info/logo.png",name:"Sui",symbol:"SUI",balance:new H(0),key:"SuiNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ry={type:"SuiCoin",data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",contractAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",decimals:6,amount:"0",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new H(0),key:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",tokenAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:"VERIFIED"}},_y={type:"PolygonNative",data:{chain:{id:I.polygon.mainnetID,name:I.polygon.name,symbol:I.polygon.tokenSymbol,imageUrl:I.polygon.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://wallet-asset.matic.network/img/tokens/matic.svg",name:"Polygon",symbol:I.polygon.tokenSymbol,balance:new H(0),key:"PolygonNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Dy={type:"BaseNative",data:{chain:{id:I.base.mainnetID,name:I.base.name,symbol:I.base.tokenSymbol,imageUrl:I.base.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Base",symbol:I.base.tokenSymbol,balance:new H(0),key:"BaseNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ny={type:"ArbitrumNative",data:{chain:{id:I.arbitrum.mainnetID,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol,imageUrl:I.arbitrum.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new H(0),key:"ArbitrumNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ly={type:"ERC20",data:{amount:"0",balance:new H(0),decimals:6,key:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",walletAddress:"",chain:{id:I.polygon.mainnetID,imageUrl:I.polygon.iconUrl,name:I.polygon.name,symbol:I.polygon.tokenSymbol},contractAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",spamStatus:"VERIFIED"}},Ky={type:"ERC20",data:{amount:"0",balance:new H(0),decimals:6,key:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",walletAddress:"",chain:{id:I.base.mainnetID,imageUrl:I.base.iconUrl,name:I.base.name,symbol:I.base.tokenSymbol},contractAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",spamStatus:"VERIFIED"}},Uy={type:"ERC20",data:{amount:"0",balance:new H(0),decimals:6,key:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",walletAddress:"",chain:{id:I.arbitrum.mainnetID,imageUrl:I.arbitrum.iconUrl,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol},contractAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",spamStatus:"VERIFIED"}},Hy={type:"EthereumNative",data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new H(0),key:"EthereumNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:"VERIFIED"}},Qy={type:"ERC20",data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,amount:"1881092",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new H(0),key:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",tokenAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:"VERIFIED"}},si=Sd,wd=or;var O6="https://help.phantom.com/hc/en-us/articles/5985106844435",Vy="https://help.phantom.com/hc/en-us/articles/29763090277139";var Kr=18;var un=500,nr={amount:new H(0),amountUsd:null,pct:0};n();s();var sr={};var zy={...sr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new H(15e-5*10**18),bridgeDefaultFee:new H(.025*10**18),averageNetworkFee:new H(15e-5*10**18),nativeFungible:Ny,usdcFungible:Uy};n();s();var Xy={...sr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new H(15e-5*10**18),bridgeDefaultFee:new H(.025*10**18),averageNetworkFee:new H(15e-5*10**18),nativeFungible:Dy,usdcFungible:Ky};n();s();var Wy={...sr,bridgeMinimumUsdAmounts:20,swapDefaultFee:new H(2.5*10**16),bridgeDefaultFee:new H(3.75*10**16),averageNetworkFee:new H(0),nativeFungible:Hy,usdcFungible:Qy};n();s();var Jy={...sr,bridgeMinimumUsdAmounts:2,swapDefaultFee:new H(6*10**16),bridgeDefaultFee:new H(6*10**16),averageNetworkFee:new H(.0015*10**18),nativeFungible:_y,usdcFungible:Ly};n();s();var Yy={bridgeMinimumUsdAmounts:1,swapDefaultFee:new H(3*10**6),bridgeDefaultFee:new H(30*10**6),averageNetworkFee:new H(15e3),nativeFungible:or,usdcFungible:Sd};n();s();var Zy={bridgeMinimumUsdAmounts:1,swapDefaultFee:new H(50*10**6),bridgeDefaultFee:new H(50*10**6),averageNetworkFee:new H(50*10**6),nativeFungible:My,usdcFungible:Ry};var KrA=["solana","ethereum","polygon","base","sui","arbitrum"],zP=new ko({solana:Yy,ethereum:Wy,polygon:Jy,base:Xy,sui:Zy,arbitrum:zy}),LA=mo(zP);n();s();var Ah=()=>[{chainId:"solana:101",address:"2b1kV6DkPAnxd5ixfnxCpjxmKwqjjaYmCZfHsFu24GXo",resourceType:"address"}];var Ur=(e,A)=>{let j=[];if(XP(e)&&!WP(e)&&j.push({type:"permanentDelegate",level:"warn",titleKey:"swapAssetWarningPermanentDelegate"}),(e.data.spamStatus==="NOT_VERIFIED"||e.data.spamStatus==="SPAM"||e.data.spamStatus==="POSSIBLE_SPAM")&&j.push({type:"unverified",level:"info",titleKey:"swapAssetWarningUnverified"}),!Ae(e.type)&&A&&JP(A)){let t=LA.get(e.data.chain.id).nativeFungible;j.push({type:"lowBalance",level:"info",titleKey:"swapAssetWarningLowTokenBalance",options:{token:t.data.symbol??"",network:t.data.chain.name}})}return j};function XP(e){let A=e.data;return A?.mintExtensions?A.mintExtensions.some(j=>j.extension==="permanentDelegate"):!1}function WP(e){let A=U(e),j=Ah();return A.resourceType==="address"?j.some(t=>t.resourceType===A.resourceType&&t.address===A.address&&t.chainId===A.chainId):!1}function JP(e){let A=LA.get(e.data.chain.id);return new w(e.data.amount?e.data.amount:0).lt(A.swapDefaultFee)}n();s();var YP=3,eh=new w(2039280),ZP=new w(356190);function M6(e,A){if(!Ae(e.type))return new w(e.data.balance);let{balance:j,decimals:t}=e.data,r=j?new w(j).multipliedBy(10**t):new w(0),o=AG(e,A);return(r.gt(o)?r.minus(o):r).dividedBy(10**t)}function AG(e,A){let j=e.data.chain.id;if(I.isSolanaNetworkID(j))return eG(e,A);if(I.isEVMNetworkID(j))return jG(e,A);if(I.isSuiNetworkID(j))return tG(e,A);throw new Error("Chain not supported by swapper")}function eG(e,A){let{defaultSwapFee:j,networkFeeBuffer:t}=bd(e,A),r=j.plus(t),o=eh,i=!A||new w(A.data.balance).isZero()?eh:new w(0);return r.plus(o).plus(i)}function jG(e,A){let{networkFeeBuffer:j}=bd(e,A),t=rG(e.data.chain.id),r=new w(t.maxFeePerGas),o=new w(t.maxPriorityFeePerGas);return ZP.multipliedBy(r.plus(o)).plus(j)}function tG(e,A){let{defaultSwapFee:j,networkFeeBuffer:t}=bd(e,A);return j.plus(t)}function bd(e,A){let j=xA(e.data.chain.id,A?.data.chain.id),t=LA.get(e.data.chain.id),r=j?t.bridgeDefaultFee:t.swapDefaultFee,o=t.averageNetworkFee.multipliedBy(YP);return{defaultSwapFee:r,networkFeeBuffer:o}}function rG(e){if(I.isEthereumNetworkID(e))return{maxFeePerGas:new w("5000000000"),maxPriorityFeePerGas:new w("79000000")};if(I.isPolygonNetworkID(e))return{maxFeePerGas:new w("30000000000"),maxPriorityFeePerGas:new w("30000000000")};if(I.isBaseNetworkID(e))return{maxFeePerGas:new w("25000000"),maxPriorityFeePerGas:new w("1100000")};if(I.isArbitrumNetworkID(e))return{maxFeePerGas:new w("29000000"),maxPriorityFeePerGas:new w("0")};throw new Error("Chain not supported by swapper")}var R6=class{state={type:"idle"};eventListeners=[];send(A){let j=this.state,t=j;try{return t=this.detectNextState(A),this.state=t,t}catch{return j}finally{this.eventListeners.forEach(r=>r.onStateChange(A,j,t))}}detectNextState(A){switch(A.type){case"initializeStarted":return{type:"initializing",mode:A.mode};case"initializeCompleted":if(this.state.type==="initializing"||this.state.type==="refreshing"){let j=new w(A.result.maxSellAmount??A.result.sellToken.data.balance);return{type:"pair",mode:this.state.mode,sellToken:A.result.sellToken,buyToken:A.result.buyToken,sellTokenPrice:A.result.sellTokenPrice,buyTokenPrice:A.result.buyTokenPrice,warnings:Ur(A.result.buyToken),maxSellAmount:j}}throw new Error("Invalid state");case"initializeFailed":if(this.state.type!=="initializing")throw new Error("Invalid state");return{type:"error",error:A.error};case"switchTokens":{if(this.state.type!=="pair")throw new Error("Invalid state");let j=this.state.buyToken,t=this.state.sellToken,r=this.state.buyTokenPrice,o=this.state.sellTokenPrice;return{type:"pair",mode:A.mode,sellToken:j,buyToken:t,sellTokenPrice:r,buyTokenPrice:o,maxSellAmount:M6(j,t),warnings:Ur(t)}}case"changeToken":{if(this.state.type!=="pair")throw new Error("Invalid state");let j=A.perspective==="sell"?A.token:this.state.sellToken,t=A.perspective==="buy"?A.token:this.state.buyToken;return{type:"pair",mode:A.mode,sellToken:j,buyToken:t,sellTokenPrice:A.sellTokenPrice??this.state.buyTokenPrice,buyTokenPrice:A.buyTokenPrice??this.state.sellTokenPrice,maxSellAmount:M6(j,t),warnings:Ur(A.perspective==="buy"?A.token:this.state.buyToken)}}case"updateBalances":{if(this.state.type!=="pair")throw new Error("Invalid state");if(M(U(this.state.sellToken))!==A.sellTokenCaip19)throw new Error("Invalid state");let j={...this.state.sellToken,data:{...this.state.sellToken.data,balance:A.sellTokenBalance}},t=this.state.buyToken;return{type:"pair",mode:this.state.mode,sellToken:j,buyToken:t,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,warnings:Ur(t),maxSellAmount:M6(j,t)}}case"refreshing":if(this.state.type!=="pair")throw new Error("Invalid state");return{type:"refreshing",mode:this.state.mode,sellToken:this.state.sellToken,buyToken:this.state.buyToken,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,maxSellAmount:this.state.maxSellAmount,warnings:this.state.warnings}}}getState(){return this.state}subscribe(A){this.eventListeners.push(A)}unsubscribe(A){this.eventListeners=this.eventListeners.filter(j=>j!==A)}};var ii=class{constructor(A,j,t,r){this.apiClient=A;this.swapCommandFactory=j;this.quoteProcessor=t;this.quoteProcessor.subscribe(this.quoteProcessorListener),this.tokenStateMachine.subscribe(this.tokenStateListener),r&&(this.account=r)}stateMachine=new C6;executeSwapStateMachine=new P6;account;cashAccount;config={slippageType:"auto",slippageTolerance:1.3,isSimulationKilled:!1};swapInitializer=new rr;tokenStateMachine=new R6;accountChangeListeners=[];tokenStateListener={onStateChange:(A,j,t)=>{t.type==="pair"&&(this.setPair(t.buyToken,t.sellToken,{amount:"0",perspective:"sell"}),A.type==="changeToken"&&this.refreshQuoteProcessor())}};refreshPair({swapMode:A,cashAddresses:j,settings:t}){this.initializeSwap({swapMode:A,cashAddresses:j,settings:t,refresh:!0})}initializeSwap({swapMode:A,cashAddresses:j,settings:t,refresh:r=!1}){let o=this.checkAccount();this.getTokenState().type==="pair"&&r?this.tokenStateMachine.send({type:"refreshing"}):this.tokenStateMachine.send({type:"initializeStarted",mode:A}),this.swapInitializer.initialize(A,o.addresses,j,t).then(a=>{this.tokenStateMachine.send({type:"initializeCompleted",result:a})}).catch(a=>{b.captureError(a,"swapper"),a instanceof ni?this.tokenStateMachine.send({type:"initializeFailed",error:a}):this.tokenStateMachine.send({type:"initializeFailed",error:ni.fromError(a)})})}updateBalances({sellTokenBalance:A,sellTokenCaip19:j}){this.getTokenState().type==="pair"&&this.tokenStateMachine.send({type:"updateBalances",sellTokenBalance:A,sellTokenCaip19:j})}getTokenState(){return this.tokenStateMachine.getState()}subscribeToken(A){return this.tokenStateMachine.subscribe(A),()=>this.unsubscribeToken(A)}unsubscribeToken(A){this.tokenStateMachine.unsubscribe(A)}quoteProcessorListener={onStateChange:(A,j)=>{(j.type==="firstQuoteReceived"||j.type==="quoteProcessed")&&this.send({type:"quoteResponseStreamed",response:j.response,quoteInput:j.input,quote:j.quote})}};isValidAmount(A){try{let j=new w(A);return j.isFinite()?!j.isNegative():!1}catch{return!1}}setAmount(A,j){let{amount:t}=A;if(t===""&&(t="0"),!this.isValidAmount(t))return;this.quoteProcessor.stop();let r=this.checkAccount(),o=this.getState(),i={...this.config,...j,isSimulationKilled:j?.isSimulationKilled??this.config.isSimulationKilled??!1};switch(o.type){case"pair":case"quote":case"quoteError":if(t==="0"||t===""){this.send({type:"setPair",buy:o.buy,sell:o.sell,amount:A});return}let a=this.checkChainAddress(o.sell.data),u=this.checkChainAddress(o.buy.data),c={chainId:a.networkID,resourceType:"address",address:a.address},l={chainId:u.networkID,resourceType:"address",address:u.address};try{let m={amount:new w(A.amount).shiftedBy(A.perspective==="buy"?o.buy.data.decimals:o.sell.data.decimals).toString(),amountUsd:w(A.amount).times(A.perspective==="buy"?o.buy.data.price??0:o.sell.data.price??0).toString(),buy:o.buy,sell:o.sell,taker:M(c),takerDestination:M(l),slippageTolerance:i.slippageTolerance,autoSlippage:i.slippageType==="auto",exactOut:A.perspective==="buy",priorityFee:i.priorityFee,tipAmount:i.tipAmount,preferredProvider:i.preferredProvider,isLedger:r.type==="ledger",phantomCashAccount:i.phantomCashAccount??!1,isSimulationKilled:i.isSimulationKilled};this.quoteProcessor.start(m,r)}catch(m){console.error("Error when streaming quotes",m)}break}}setPair(A,j,t){this.send({type:"setPair",buy:A,sell:j,amount:t})}switchTokens(){let A=this.getTokenState();if(A.type!=="pair")return;let j=Cy(A);j&&this.tokenStateMachine.send({type:"switchTokens",mode:j})}setAccount(A){this.account=A,this.accountChangeListeners.forEach(j=>j.onAccountChange(A))}setCashAccount(A){this.cashAccount=A}getAccount(){return this.account}async fetchQuotes({amount:A,amountUsd:j,buy:t,sell:r,slippageTolerance:o,autoSlippageEnabled:i,priorityFee:a,tipAmount:u,signal:c,phantomCashAccount:l}){let m=U(r),B=U(t),k=A.perspective==="buy",f=new w(A.amount).shiftedBy(A.perspective==="buy"?t.data.decimals:r.data.decimals).toString();this.send({type:"quoteRequestStarted",amount:A,slippageType:i?"auto":"fixed"});let g=this.checkChainAddress(r.data),E={chainId:g.networkID,resourceType:"address",address:g.address},h;if(xA(r.data.chain.id,t.data.chain.id)){let y=this.checkChainAddress(t.data);h={chainId:y.networkID,resourceType:"address",address:y.address}}try{let y=await this.apiClient.getQuotes({sell:m,buy:B,amount:f,amountUsd:j,taker:E,takerDestination:h,slippageTolerance:o??0,autoSlippageEnabled:i,exactOutEnabled:k,priorityFee:a,tipAmount:u,signal:c,phantomCashAccount:l});return this.send({type:"quoteResponseReceived",response:y}),y}catch(y){throw this.send({type:"quoteRequestError",error:y}),y}}async swap(A){let{signer:j,storage:t,locale:r,deviceId:o,connection:i,authRepository:a,isSimulationKilled:u,gasEstimation:c,preprocessor:l}=A,m=this.getState();if(!Ty(m))throw new Error(`Can't swap from ${m.type}`);this.quoteProcessor.stop();let B=this.checkAccount(),k=this.checkChainAddress(m.sell.data),f={account:B,buy:m.buy,sell:m.sell,amount:m.amount,quote:m.quote,response:m.response,slippageType:m.slippageType,quoteInput:m.input},g=this.swapCommandFactory.create(f,k.address,k.networkID,i,a,this.cashAccount,c),E=new x6(g,y=>this.executeSwapStateMachine.send(y),f),h=await E.createTransaction();await b.startSpan(yd(dA(m.quote),h.type),async()=>{let y=await E.simulate(h,r,o,u),F=async()=>{let S=await E.swap(B.identifier,h,y,j,t);await E.waitForConfirmation(S)};l?await l(F):await F()})}changeToken(A,j,t){let r=this.getTokenState();if(r.type!=="pair")return;let o=j==="buy"?A:r.buyToken,i=j==="sell"?A:r.sellToken,a=U(i),u=U(o),c;r.mode.type==="swap"?c={...r.mode,network:i.data.chain.id,sellCaip19:M(a),buyCaip19:M(u),takerCaip19:j==="sell"?t:r.mode.takerCaip19,takerDestinationCaip19:j==="buy"?t:r.mode.takerDestinationCaip19}:r.mode.type==="buy"?c={...r.mode,buyCaip19:M(u),sellCaip19:M(a),takerCaip19:j==="buy"?t:r.mode.takerCaip19}:r.mode.type==="sell"&&(c={...r.mode,sellCaip19:M(a),buyCaip19:M(u),takerDestinationCaip19:j==="sell"?t:r.mode.takerDestinationCaip19}),ua({tokens:[u,a]}).then(l=>{let m=l[M(u)],B=l[M(a)];this.tokenStateMachine.send({type:"changeToken",mode:c,token:A,perspective:j,buyTokenPrice:m,sellTokenPrice:B})}).catch(l=>{b.captureError(l,"swapper"),this.tokenStateMachine.send({type:"changeToken",mode:c,token:A,perspective:j})})}selectQuote(A){this.send({type:"userSelectedQuote",quote:A})}setQuoteConfig(A){this.config={...this.config,...A},this.refreshQuoteProcessor()}refreshQuoteProcessor(){let A=this.getLastQuoteProcessorSwapAmount();A&&this.setAmount(A)}getLastQuoteProcessorSwapAmount(){let A=this.getQuoteProcessorState();switch(A.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":let j=A.input;return{amount:new w(j.amount).shiftedBy(-1*(j.exactOut?j.buy.data.decimals:j.sell.data.decimals)).toString(),perspective:j.exactOut?"buy":"sell"};default:return}}getState(){return this.stateMachine.getState()}getExecuteState(){return this.executeSwapStateMachine.getState()}stopProcessingQuotes(){this.quoteProcessor.stop()}subscribeExecution(A){return this.executeSwapStateMachine.addListener(A),()=>this.unsubscribeExecution(A)}unsubscribeExecution(A){this.executeSwapStateMachine.removeListener(A)}getQuoteProcessorState(){return this.quoteProcessor.getState()}subscribeQuoteProcessor(A){return this.quoteProcessor.subscribe(A),()=>this.unsubscribeQuoteProcessor(A)}unsubscribeQuoteProcessor(A){this.quoteProcessor.unsubscribe(A)}stopQuoteProcessor(){this.quoteProcessor.stop()}subscribeAccountChange(A){return this.accountChangeListeners.push(A),()=>this.unsubscribeAccountChange(A)}unsubscribeAccountChange(A){this.accountChangeListeners=this.accountChangeListeners.filter(j=>j!==A)}send(A){return this.stateMachine.send(A)}checkAccount(){if(!this.account)throw new Error("Must set a MultiChainAccount");return this.account}checkChainAddress({chain:A,walletAddress:j}){let{id:t}=A;if(j)return{networkID:t,address:j};let o=this.checkAccount().addresses.find(a=>a.networkID===t);if(!o)throw new Error(`No address found for chain ${t}`);let i={...o};return lo(i)&&(i.address=i.address.toLowerCase()),i}};var jh=(0,ot.createContext)(null);function oG({children:e,processorMode:A="noOp"}){let{data:j}=aA(),{data:t}=vs(),r=(0,ot.useMemo)(()=>nG(A),[A]);return(0,ot.useEffect)(()=>{j&&(r.setAccount(j),r.setCashAccount(t))},[j,r,t]),ot.default.createElement(jh.Provider,{value:r},e)}function TA(){let e=(0,ot.useContext)(jh);if(!e)throw new Error("useSwapper must be used within a SwapperProvider");return e}function nG(e){return new ii(new Ua,new r6,new k6(new s6(We?new n6:new o6),e==="noOp"?new d6:new l6))}n();s();function Oe(e){return e.type==="pair"||e.type==="changingToken"||e.type==="refreshing"}n();s();var Ft=q(P());n();s();var rj=e=>{let A=Math.floor(e/3600),j=Math.floor((e-A*3600)/60),t=e%60;if(A>0)return T.t("swapProviderEstimatedTimeHM",{hours:A,minutes:j});if(j>0){let r=t>0?j+1:j;return T.t("swapProviderEstimatedTimeM",{minutes:r})}return T.t("swapProviderEstimatedTimeS",{seconds:t})};n();s();var _6=e=>e.steps.reduce((A,j)=>A.plus(new H(j.nonIncludedNonGasFees)),new H(0)),ln=e=>e.steps.flatMap(t=>t.feeCosts).reduce((t,r)=>t.plus(r.amountUSD??0),new H(0));n();s();var nt=e=>e&&dA(e)?e.executionDuration:0;var sG=({selectProvider:e})=>{let{currencySymbol:A,fromUsd:j}=bA(),t=TA(),[r,o]=(0,Ft.useState)(!1),[i,a]=(0,Ft.useState)(t.getQuoteProcessorState());(0,Ft.useEffect)(()=>{let m=t.subscribeQuoteProcessor({onStateChange(B,k){a(k)}});return()=>m()},[t]);let[u,c]=(0,Ft.useState)(t.getTokenState());return(0,Ft.useEffect)(()=>{let m=t.subscribeToken({onStateChange(B,k,f){c(f)}});return()=>m()},[t]),{details:(0,Ft.useMemo)(()=>{if(i.type!=="quoteProcessed"&&i.type!=="firstQuoteReceived"||u.type!=="pair")return[];let m=i.quote,B=cG(m),k=m.baseProvider.name,f=pG({currentQuote:m,buyToken:u.buyToken,sellToken:u.sellToken,isFlipped:r,setIsFlipped:o});return dA(m)?aG({quote:m,selectProvider:e,exchangeRate:f,currencySymbol:A,fromUsd:j}):iG({provider:k,sources:B,exchangeRate:f,selectProvider:e})},[i,u,e,A,j,r]),footnote:T.t("swapProviderPricingFootnote")}},iG=({provider:e,sources:A,exchangeRate:j,selectProvider:t})=>[{label:T.t("swapProviderPricingProvider"),value:e,icon:"chevron-right",onPress:t},{label:T.t("swapProviderPricingMarket"),value:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip}],aG=({quote:e,selectProvider:A,exchangeRate:j,currencySymbol:t,fromUsd:r})=>{let o=e.baseProvider.name,i=ln(e).toString(),a=rj(nt(e));return[{label:T.t("swapProviderPricingProvider"),value:o,icon:"chevron-right",onPress:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip},{label:T.t("swapProviderPricingFees"),value:`${t}${r(Number(i),2)} ${T.t("swapProvidersFee")}`},{label:T.t("swapProviderPricingTime"),value:a}]};function pG({currentQuote:e,buyToken:A,sellToken:j,isFlipped:t,setIsFlipped:r}){let{exchangeRate:o,exchangeRateFlipped:i}=Ll(e,A,j);return{rate:t?i:o,flip:()=>r(!t)}}function cG(e){return vA(OA(e))}n();s();n();s();var Se=q(P());n();s();var th=q(P());n();s();var ai=e=>{let A=e?.addressDetails?.address;return A?{[tA.Solana.Mainnet]:A}:{}};var pi=()=>{let{data:e}=vs();return(0,th.useMemo)(()=>ai(e),[e])};n();s();n();s();function St(e){return{chain:"solana",type:"fungible",address:e.type==="SPL"?e.data.mintAddress:void 0,symbol:e.data.symbol??""}}var ir=class{constructor(A,j){this.analytics=A;this.additionalAnalyticsTags=j}captureEvent(A,j){let t={...j,data:{...j.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}swapperOpen(A,j){this.captureEvent("swapperOpen",{data:{uiContext:"swapperInterstitial",swapMode:A.type,comingFrom:j}})}swapperClose(A){this.captureEvent("swapperClose",{data:{uiContext:"swapperInterstitial",reason:A}})}swapperUpdateAsset(A,j){switch(A.type){case"sell":this.captureEvent("swapperUpdateToAsset",{data:St(j)});break;case"buy":this.captureEvent("swapperUpdateFromAsset",{data:St(j)});break}}swapperSwapDefaultQuoteSelected(A){this.captureEvent("swapperSwapDefaultQuoteSelected",{data:{quotePercentageValue:A}})}swapperDetailPanelClicked(){this.captureEvent("swapperDetailPanelClicked",{data:{uiContext:"swapperInterstitial"}})}swapperToggleQuoteCurrency(){this.captureEvent("swapperToggleQuoteCurrency",{data:{uiContext:"swapperInterstitial"}})}swapperQuotesResult(A,j,t){this.captureEvent("swapperQuotesResult",{data:{...D6(A,t),numQuotes:j.quotes.length,sellToken:M(U(A.sell)),buyToken:M(U(A.buy)),fromNetworkId:A.sell.data.chain.id,toNetworkId:A.buy.data.chain.id,isGasless:j.quotes.some(r=>"gaslessSwapFeeResult"in r&&r.gaslessSwapFeeResult?.success===!0)}})}};function D6(e,A){let j=uG(A);return{isSellTokenVerified:la({minimum:"VERIFIED",spamStatus:e.sell.data.spamStatus}),sellTokenNetworkId:e.sell.data.chain.id,sellTokenSymbol:e.sell.data.symbol??void 0,sellTokenMarketCap:e.sell.data.marketCap,sellTokenAmount:e.amount,isAutoSlippageEnabled:e.autoSlippage,manualSlippagePercent:e.slippageTolerance,isExactOut:e.exactOut,isManualTipInput:e.tipAmount!==void 0,gaslessError:j?.error,gaslessAtaFeeUSD:j?.data?.ataFeeUSD,gaslessNetworkFeeUSD:j?.data?.networkFeeUSD,gaslessTotalAmountUSD:j?.data?.totalAmountUSD}}function Id(e){if(e.type==="quoteProcessed")return D6(e.input,e.quote)}function uG(e){if(Le(e))return e.gaslessSwapFeeResult}n();s();var dn=q(P());var lG=(0,dn.createContext)(void 0);var $d=()=>{let e=(0,dn.useContext)(lG);if(!e)throw new Error("useSwapToken must be used within a SwapTokenProvider");return e};n();s();function rh(e,A,j,t,r,o){let a=j.find(c=>c.percentage===1)?.amount;if(r==="sell"&&a&&new H(e).gt(a))return["insufficientBalance"];if(o&&r==="buy"&&a&&new H(A).gt(a))return["insufficientBalance"];let u=t.type==="buy"?t.options?.minimumOrderSize?.quote:t.options?.minimumOrderSize?.base;return u!=null&&new H(e).lt(u)?["minimumBalance"]:[]}n();s();var dG=[.25,.5,1],vd=class{constructor(A,j,t){this.percentage=A;this.amount=j;this.fiatAmount=t}getAmountForDenomination(A){return A==="crypto"?this.amount:this.fiatAmount}};function oh({maxSellAmount:e,sellTokenPrice:A,allowedPercentages:j=dG}){return j.map(t=>{let r=e.multipliedBy(t);return new vd(t,r,r.multipliedBy(A?.usd??0))})}n();s();var qd=q(P());n();s();var He=()=>ne({key:"priorityFee",queryKey:uA.priorityFee()}),nh=()=>le({key:"priorityFee",queryKey:uA.priorityFee()});n();s();var Qe=()=>ne({key:"tipAmount",queryKey:uA.tipAmount()}),sh=()=>le({key:"tipAmount",queryKey:uA.tipAmount()});n();s();function wt(e){return new w(e??0).multipliedBy(10**Ym.tokenDecimals)}n();s();var mG=3,kG=new H(356190),BG=e=>LA.get(e).averageNetworkFee.times(mG);function mn({sellFungible:e,totalFees:A,transactionSpeedsToUnitCost:j,minRequiredBalance:t,customPriorityFee:r,customTip:o,isBridge:i=!1}){let{decimals:a,amount:u,balance:c,chain:l}=e.data,m=u?new H(u):c?new H(c).multipliedBy(hr(a)):new H(0),B=Ae(e.type),k=NA(e),{source:f,destination:g}=t;if(k)return Au(m.toString(),a);let h=fG({isNativeToken:B,network:l,totalFees:A,isBridge:i,transactionSpeedsToUnitCost:j,customPriorityFee:r,customTip:o}).plus(g),y=B?gG(m,h,f):m.toString();return Au(y,a)}function fG({isNativeToken:e,network:A,totalFees:j,isBridge:t,transactionSpeedsToUnitCost:r,customPriorityFee:o,customTip:i}){if(!e)return j;let a=LA.get(A.id),u=t?a.bridgeDefaultFee:a.swapDefaultFee,c=r?.standard;return _k(c)&&(u=kG.multipliedBy(c.maxFeePerGas.plus(c.maxPriorityFeePerGas))),I.isSolanaNetworkID(A.id)&&o&&(u=u.plus(o)),I.isSolanaNetworkID(A.id)&&i&&(u=u.plus(i)),u.plus(BG(A.id))}function gG(e,A,j){let t=j.plus(A);return e.gt(t)?e.minus(t).toString():e.toString()}n();s();var ci=q(P()),ih=e=>{let A=e?.data.chain.id,{data:j}=aA(),t=(0,ci.useMemo)(()=>j?.addresses.find(o=>o.networkID===A),[j,A]),{data:r=0}=Sr(t);return(0,ci.useMemo)(()=>new w(r),[r])},ah=(e,A)=>{let j=e?.data.chain.id,r=A?.data.chain.id??j,{data:o}=aA(),i=(0,ci.useMemo)(()=>o?.addresses.find(u=>u.networkID===r),[o,r]),{data:a=0}=Sr(i);return(0,ci.useMemo)(()=>A?.data.amount||A?.data.balance&&new w(A.data.balance).gt(0)?new w(0):new w(a),[A?.data.amount,A?.data.balance,a])};function ph(e){let A=e.type==="pair"?e.sellToken:null,j=e.type==="pair"?e.buyToken:null,t=ih(A),r=ah(A,j),{data:o}=Io({networkID:A?.data.chain.id}),{data:i}=He(),{data:a}=Qe(),u=(0,qd.useMemo)(()=>!A||!j?!1:xA(A.data.chain.id,j.data.chain.id),[A,j]);return(0,qd.useMemo)(()=>A?mn({sellFungible:A,totalFees:new w(0),transactionSpeedsToUnitCost:I.isEVMNetworkID(A.data.chain.id)?o:void 0,isBridge:u,minRequiredBalance:{source:t,destination:r},customPriorityFee:wt(i??0),customTip:wt(a??0)}):"0",[A,o,u,t,r,i,a])}n();s();var Pj=VA(e=>({preferredProvider:void 0,setPreferredProvider:A=>e({preferredProvider:A})}));n();s();var Bh=q(P());n();s();var dh=q(P());n();s();var uh=q(P());n();s();var N6=q(P());var ch=()=>{let e=TA(),[A,j]=(0,N6.useState)(e.getTokenState());return(0,N6.useEffect)(()=>e.subscribeToken({onStateChange(r,o,i){j(i)}}),[e]),A};var lh=()=>{let e=ch();return(0,uh.useMemo)(()=>Oe(e)?{buyToken:e.buyToken,sellToken:e.sellToken}:{buyToken:void 0,sellToken:void 0},[e])};var L6=()=>{let{buyToken:e,sellToken:A}=lh(),{data:[j]}=_A(["enable-cash"]);return(0,dh.useMemo)(()=>!!(j&&(e&&NA(e)||A&&NA(A))),[e,A,j])};n();s();var bt=()=>ne({key:"slippageTolerance",queryKey:uA.slippageTolerance()}),K6=()=>le({key:"slippageTolerance",queryKey:uA.slippageTolerance()});n();s();var mh=q(P());var EG={type:"auto"},Hr=()=>{let{priorityFeeSetting:e,isFetched:A,save:j}=yG();return{isFetched:A,selectedSetting:e,setPriorityFeeSetting:j}},yG=()=>{let{data:e,isFetched:A}=ne({key:"priorityFeeSettings",queryKey:uA.priorityFeeSettings()}),{mutateAsync:j}=le({key:"priorityFeeSettings",queryKey:uA.priorityFeeSettings()}),t=(0,mh.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,priorityFeeSetting:e??EG,save:t}};n();s();var kh=q(P());var hG={type:"auto"},kn=()=>{let{tipSetting:e,isFetched:A,save:j}=FG();return{isFetched:A,selectedSetting:e,setTipSetting:j}},FG=()=>{let{data:e,isFetched:A}=ne({key:"tipSettings",queryKey:uA.tipSettings()}),{mutateAsync:j}=le({key:"tipSettings",queryKey:uA.tipSettings()}),t=(0,kh.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,tipSetting:e??hG,save:t}};var fh=()=>{let{selectedSetting:e}=MA(),{data:A}=bt(),{data:j}=He(),{selectedSetting:t}=Hr(),{data:r}=Qe(),{selectedSetting:o}=kn(),i=Pj(l=>l.preferredProvider),a=Rt("kill-swapper-simulation")??!1,u=L6();return(0,Bh.useMemo)(()=>({slippageTolerance:A??void 0,priorityFee:t.type==="fixed"?j??void 0:void 0,tipAmount:o.type==="fixed"?r??void 0:void 0,slippageType:e.type,preferredProvider:i,phantomCashAccount:u,isSimulationKilled:a}),[A,j,t.type,r,o.type,e,i,u,a])};n();s();var gh=q(P());var ui=()=>{let{data:e,isFetched:A}=He(),{data:j,isFetched:t}=Qe();return(0,gh.useMemo)(()=>{if(!A||!t||!e&&!j)return;let r={};return e&&(r.priorityFee=new w(e)),j&&(r.tip=new w(j)),r},[A,t,e,j])};var xd=(e,A=[],j,t)=>{let r=TA(),o=J(),i;try{i=$d().nextGenAnalytics}catch{}let a=(0,Se.useMemo)(()=>i||new ir(o,j),[o,j,i]),u=pi(),c=ui(),l=CA("enable-be-swapper-max-amount");(0,Se.useEffect)(()=>{let L=setTimeout(()=>{r.initializeSwap({swapMode:e,cashAddresses:u,settings:c})},100);return()=>clearTimeout(L)},[r,e,u,c]);let[m,B]=(0,Se.useState)(r.getTokenState());(0,Se.useEffect)(()=>{let L=r.subscribeToken({onStateChange(R,W,Q){B(Q)}});return()=>L()},[r]);let[k,f]=(0,Se.useState)(r.getQuoteProcessorState());(0,Se.useEffect)(()=>{let L=r.subscribeQuoteProcessor({onStateChange:(R,W)=>{W.type==="firstQuoteReceived"&&a.swapperQuotesResult(W.input,W.response,W.quote),f(W),Tj.processQuoteProcessorState(W)}});return()=>{r.stopQuoteProcessor(),L()}},[r,a]);let g=(0,Se.useMemo)(()=>wG(m,k),[m,k]),E=fh();(0,Se.useEffect)(()=>{r.setQuoteConfig(E)},[E,r]);let h=ph(m),y=(0,Se.useMemo)(()=>Oe(m)?oh({sellTokenPrice:m.sellTokenPrice,allowedPercentages:A,maxSellAmount:l?m.maxSellAmount:new w(h)}):[],[m,A,l,h]),F=Pj(L=>L.setPreferredProvider);(0,Se.useEffect)(()=>{let L=r.subscribeToken({onStateChange(R,W,Q){R.type==="initializeStarted"&&F(void 0)}});return()=>L()},[r,F]);let[S,x]=(0,Se.useState)([]),O=(0,Se.useCallback)(({amount:L,denomination:R,perspective:W,tokenStateOverride:Q})=>{try{let jA=SG(Q??m,L,R,W),Z=rh(jA,L,y,e,W,t);x(Z),F(void 0),r.setAmount({amount:jA,perspective:W},{...E,preferredProvider:void 0})}catch(jA){b.captureError(jA,"swapper")}},[r,m,E,F,y,e,t]),{connection:v}=cj(),D=wA(),G=Sj(),C=Lj(),_=T.language,V=Rt("kill-swapper-simulation")??!1,z=(0,Se.useCallback)(async L=>{L.forEach(W=>r.subscribeExecution(W));let R=await o.getDeviceId();await r.swap({signer:G,storage:D,locale:_,deviceId:R,connection:v,authRepository:C,isSimulationKilled:V}),L.forEach(W=>r.unsubscribeExecution(W))},[r,o,G,D,_,v,C,V]);return{setAmount:O,swap:z,tokenState:m,quoteProcessorState:k,quotedAmounts:g,inputErrors:S,sellPercentages:y}};function SG(e,A,j,t){if(!Oe(e))throw new Error("Token state is not a pair");let{sellTokenPrice:r,sellToken:o,buyToken:i,buyTokenPrice:a}=e;switch(j){case"fiat":switch(t){case"buy":if(!a?.usd)throw new Error("Token price not found");return new w(A).dividedBy(a.usd).decimalPlaces(i.data.decimals).toString();case"sell":if(!r?.usd)throw new Error("Token price not found");return new w(A).dividedBy(r.usd).decimalPlaces(o.data.decimals).toString()}break;case"crypto":switch(t){case"buy":return new w(A).decimalPlaces(i.data.decimals).toString();case"sell":return new w(A).decimalPlaces(o.data.decimals).toString()}break}}function wG(e,A){if(!Oe(e)||A.type!=="firstQuoteReceived"&&A.type!=="quoteProcessed")return;let j=A.quote,{sellToken:t,buyToken:r,sellTokenPrice:o,buyTokenPrice:i}=e;return{buyAmount:new w(j.buyAmount).shiftedBy(-r.data.decimals),buyAmountUsd:i?.usd?new w(j.buyAmount).shiftedBy(-r.data.decimals).multipliedBy(i.usd):void 0,sellAmount:new w(j.sellAmount).shiftedBy(-t.data.decimals),sellAmountUsd:o?.usd?new w(j.sellAmount).shiftedBy(-t.data.decimals).multipliedBy(o.usd):void 0}}n();s();var Eh=q(P());n();s();n();s();function Td(e){switch(e.type){case"SLIPPAGE_EXCEEDED":return T.t("swapTxConfirmationSwapFailedSlippageLimit");case"INSUFFICIENT_FUNDS":return T.t("swapTxConfirmationSwapFailedInsufficientBalance");case"INSUFFICIENT_GAS":return T.t("swapTxConfirmationSwapFailedInsufficientGas");case"ACCOUNT_FROZEN":return T.t("swapTxConfirmationSwapFailedAcountFrozen");case"SIMULATION_TIMEOUT":return T.t("swapTxConfirmationSwapFailedSimulationTimeout");case"STALE_QUOTE":return T.t("swapTxConfirmationSwapFailedStaleQuote");case"UNKNOWN_ERROR":return T.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return T.t("swapTxConfirmationSwapFailedTryAgain")}}n();s();var it=q(P());n();s();var Pd=class{format(A,j){return`${_e(A)} ${j}`}},Gd=class{format(A,j){return`${ma(A,{compact:!0})} ${j}`}},Cd=class{format(A){return ma(A,{compact:!0})}};function Qr(e){switch(e){case"full":return new Pd;case"compact":return new Gd;case"compactNoSymbol":return new Cd}}var Od=class{format(A,j,t){return`${_e(bj(Number(A),t,j.data?.decimals??0))} ${j.data.symbol??""}`}},U6=class{format(A,j,t){return ma(bj(Number(A),t,j.data?.decimals??0),{compact:!0})}},Md=class{noSymbolDisplayStrategy;constructor(A){this.noSymbolDisplayStrategy=A}format(A,j,t){return`${this.noSymbolDisplayStrategy.format(A,j,t)} ${j.data?.symbol??""}`}};function Rd(e){switch(e){case"full":return new Od;case"compact":return new Md(new U6);case"compactNoSymbol":return new U6}}n();s();var H6=class{async fetch(A){return await Ka(A)}stopFetching(){}getFetchInterval(A){return A}};n();s();n();s();var Bn=class{constructor(A){this.streamedQuoteLogger=A}onStateChange(A,j,t){t.type==="transactionSubmitted"&&this.streamedQuoteLogger.logState(t.txReceipt.id)}};n();s();n();s();n();s();var Q6=(e,A,j)=>{if(j)return kA(e,A).times(w(j)).toNumber()},yh=(e,A)=>A&&e?A>e?A:e:A??e;function hh({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,slippageType:m,sellSwapFilter:B,isRetry:k,analyticsContext:f}){if(A&&t){let g=Q6(r,A.data.decimals,e),E=Q6(o,t.data.decimals,j),h=yh(g,E);return{networkId:t.data.chain.id,chainId:I.getChainID(t.data.chain.id),toNetworkId:A.data.chain.id,toChainId:I.getChainID(A.data.chain.id),isBridge:t.data.chain.id!==A.data.chain.id,marketName:`${t.data.symbol}/${A.data.symbol}`,tradeDirection:"sell",swapSource:u,baseProvider:c,priceImpact:a,fromAssetSymbol:t.data.symbol??"",fromAssetAddress:t.data.tokenAddress,fromAssetAmount:kA(o,t.data.decimals),fromAssetUsdPrice:j,fromAssetUsdVolume:E,toAssetSymbol:A.data.symbol??"",toAssetAddress:A.data.tokenAddress,toAssetAmount:kA(r,A.data.decimals),toAssetUsdPrice:e,toAssetUsdVolume:g,totalUsdVolume:h,feeUsd:i,slippageTolerance:l,slippageType:m,sellSwapFilter:B,isRetry:k,analyticsContext:f}}return null}function li({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,quote:r,slippageTolerance:o,slippageType:i,sellSwapFilter:a,isRetry:u,analyticsContext:c,baseProvider:l}){if(A&&t){let{buyAmount:m,sellAmount:B}=r,k="priceImpact"in r?r.priceImpact:0,f="sources"in r?vA(r.sources):"",g=("fees"in r?r.fees.find(F=>F.type==="phantom")?.amount.toString():"")??"",E=Q6(m,A.data.decimals,e),h=Q6(B,t.data.decimals,j),y=yh(E,h);return{chainId:t.data.chain.id??A.data.chain.id,swap:{marketName:`${t.data.symbol}/${A.data.symbol}`,tradeDirection:"sell",swapSource:f,priceImpact:k,fromAssetSymbol:t.data.symbol??"",fromAssetAddress:t.data.tokenAddress??"",fromAssetAmount:kA(B,t.data.decimals),fromAssetUsdPrice:j??0,fromAssetUsdVolume:h??0,toAssetSymbol:A.data.symbol??"",toAssetAddress:A.data.tokenAddress??"",toAssetAmount:kA(m,A.data.decimals),toAssetUsdPrice:e,toAssetUsdVolume:E,totalUsdVolume:y??0,feeUsd:Number(g),slippageTolerance:o,slippageType:i,sellSwapFilter:a,isRetry:u,analyticsContext:c,baseProvider:l}}}return null}function V6({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,transactionId:m,slippageType:B,sellSwapFilter:k,isRetry:f,analyticsContext:g}){let E=hh({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,slippageType:B,sellSwapFilter:k,isRetry:f,analyticsContext:g});return E?{data:{...E,id:m}}:{}}n();s();var z6=({txReceipt:e,networkID:A,amountType:j,swapAnalytics:t})=>{let r=Lt(A);b.addBreadcrumb("swapper","submittedTransaction","info",{...r,txReceipt:e.id,method:r.chainType==="solana"?"signAndSendTransaction":r.chainType==="eip155"?"eth_sendRawTransaction":r.chainType==="sui"?"signAndExecuteTransaction":"UNKNOWN"}),r.chainType==="solana"?t.submittedTransaction(e.id,{...r,method:"signAndSendTransaction",swapType:j==="sell"?"exactIn":"exactOut"}):r.chainType==="eip155"?t.submittedTransaction(e.id,{...r,method:"eth_sendRawTransaction",swapType:j==="sell"?"exactIn":"exactOut"}):r.chainType==="sui"&&t.submittedTransaction(e.id,{...r,method:"signAndExecuteTransaction",swapType:j==="sell"?"exactIn":"exactOut"})};n();s();var Fh=q(P());var bG={calculate(e){let A=(e?.fees??[]).find(j=>j.type==="phantom");return{amount:new w(A?.amount??0),amountUsd:null,pct:A?.percentage??0}}},IG={calculate(e){let A=e.steps.flatMap(j=>j.feeCosts).find(j=>j.name==="phantom");return{amount:new w(A?.amount??0),amountUsd:null,pct:parseFloat(A?.percentage??"0")}}},Sh=()=>{let{currentQuote:e}=iA();return{phantomFee:(0,Fh.useMemo)(()=>_d(e),[e])}};function _d(e){return Wj(e)?bG.calculate(e):dA(e)?IG.calculate(e):nr}n();s();var ar=e=>e?dA(e)?void 0:e.priceImpact:0;n();s();var wh=VA(e=>({lastFailedSwap:void 0,setLastFailedSwap:A=>{e({lastFailedSwap:A})}}));function bh(){return wh.getState().lastFailedSwap}function Dd(e){wh.getState().setLastFailedSwap(e)}var fn=class{constructor(A,j,t="swapperClassic",r){this.swapAnalytics=A;this.analytics=j;this.uiContext=t;this.additionalAnalyticsTags=r}captureEvent(A,j){let t={...j,data:{...j?.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}onStateChange(A,j,t,r){switch(A.type){case"executeSwapStarted":this.captureEvent("swapperSwap",{data:{...this.createAnalyticsPayload(t.executingQuote).data,uiContext:this.uiContext}});let o=li({buyAssetUsdValue:t.executingQuote.buy.data.usd,buyToken:t.executingQuote.buy,sellAssetUsdValue:t.executingQuote.sell.data.usd,sellToken:t.executingQuote.sell,quote:t.executingQuote.quote,slippageTolerance:this.parseSlippageTolerance(t.executingQuote.slippageType,t.executingQuote.quote,t.executingQuote.response),slippageType:t.executingQuote.slippageType,sellSwapFilter:$.getState().swapFilter,isRetry:this.isRetry(t.executingQuote),analyticsContext:t.executingQuote.quote.analyticsContext,baseProvider:t.executingQuote.quote.baseProvider?.id??""});o&&(b.addBreadcrumb("swapper","approved","info",_t(o.swap)),this.swapAnalytics.approved(o));break;case"simulationFailed":A.error.type!=="SLIPPAGE_EXCEEDED"&&b.captureError(A.error,"swapper"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:$G(A.error)}});break;case"transactionSubmissionFailed":b.captureError(A.error,"swapper"),A.error.type==="noSignature"&&this.captureEvent("swapperSwapFailureNoSignature"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:A.error.message,uiContext:this.uiContext}});break;case"transactionSubmissionSuccess":z6({txReceipt:A.txReceipt,networkID:A.txReceipt.networkID,amountType:t.executingQuote.amount.perspective==="buy"?"buy":"sell",swapAnalytics:this.swapAnalytics});break;case"transactionConfirmationFailed":let i=jr(A.error);b.captureError(A.error,"swapper"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:i.message,uiContext:this.uiContext}});let a=Lt(A.txReceipt.networkID),u={chainId:I.getChainID(A.txReceipt.networkID),networkId:A.txReceipt.networkID},c=A.txReceipt;switch(this.captureEvent("waitForTransactionConfirmationError",{data:{...u,errorMessage:i.message}}),a.chainType){case"eip155":case"solana":case"sui":b.addBreadcrumb("swapper","transactionStatus","error",{...a,txReceipt:c.id}),this.swapAnalytics.transactionStatus(c.id,{...a,status:{type:"error"}});break}break;case"transactionConfirmed":this.captureEvent("swapperSwapSuccess",{data:{...this.createAnalyticsPayload(t.executingQuote,A.txReceipt).data,uiContext:this.uiContext}});let l=Lt(A.txReceipt.networkID);switch(b.addBreadcrumb("swapper","transactionStatus","info",{...l,txReceipt:A.txReceipt.id}),l.chainType){case"eip155":case"solana":case"sui":this.swapAnalytics.transactionStatus(A.txReceipt.id,{...l,status:{type:"confirmed"}});break}break}this.isFailureEvent(A)?Dd(t.executingQuote):A.type==="transactionSubmissionSuccess"&&Dd(void 0)}createAnalyticsPayload(A,j){let t=A.quote,r=$.getState(),o=V6({buyToken:A.buy,sellToken:A.sell,buyAmount:t.buyAmount.toString(),sellAmount:t.sellAmount.toString(),phantomFeeUiAmount:_d(t).amountUsd?.toString()??"",priceImpact:ar(t),provider:vA(OA(t)),buyAssetUsdValue:r.buyUsdValue,sellAssetUsdValue:r.sellUsdValue,slippageTolerance:this.parseSlippageTolerance(A.slippageType,t,A.response),transactionId:j?.id??"",slippageType:A.slippageType,sellSwapFilter:r.swapFilter,isRetry:this.isRetry(A),analyticsContext:A.quote.analyticsContext,baseProvider:A.quote.baseProvider?.id??""}),i=A.quoteInput;return i?{data:{...o.data,...D6(i,t)}}:o}parseSlippageTolerance(A,j,t){switch(A){case"fixed":return t.slippageTolerance;case"auto":return Wj(j)?j.slippageTolerance:t.slippageTolerance}}isRetry(A){let j=bh();if(!j)return!1;let t=M(U(j.buy)),r=M(U(j.sell)),o=M(U(A.buy)),i=M(U(A.sell));return t===o&&r===i}isFailureEvent(A){switch(A.type){case"simulationFailed":case"transactionSubmissionFailed":case"transactionConfirmationFailed":return!0;default:return!1}}};function $G(e){switch(e.type){case"SLIPPAGE_EXCEEDED":return"slippageToleranceExceeded";case"INSUFFICIENT_FUNDS":return"INSUFFICIENT_FUNDS";case"INSUFFICIENT_GAS":return"INSUFFICIENT_GAS";case"ACCOUNT_FROZEN":return"AccountFrozen";case"STALE_QUOTE":return"STALE_QUOTE";case"SIMULATION_TIMEOUT":return"SIMULATION_TIMEOUT";case"UNKNOWN_ERROR":return"SimulationUnknownError";case"SIMULATION_FAILED":return"SIMULATION_FAILED";default:return"Scan results are not valid"}}n();s();n();s();var vG=20;function X6(e,A){let j=uA.optimisticUpdates(),t=e.getQueryData(j)??[];e.setQueryData(j,[...t.filter(r=>r.id!==A.id),A])}function Ih(e,A){let j=uA.optimisticUpdates(),t=e.getQueryState(j);if(t){let r=A??Date.now(),o=t.dataUpdatedAt,i=K({seconds:vG});return r-o>i?(e.removeQueries({queryKey:j}),[]):t?.data??[]}else return[]}function gn(e){return`${e.type}-${e.data.key}`}var qG=K({seconds:3}),En=class{constructor(A,j,t){this.queryClient=A;this.storage=j;this.authRepository=t}onStateChange(A,j,t,r){let{sell:o,quote:i,account:a}=t.executingQuote;if(A.type==="transactionConfirmed"){this.storage.set("priorityFee",null),this.storage.set("priorityFeeSettings",{type:"auto"}),this.queryClient.setQueryData(uA.priorityFee(),null),this.queryClient.setQueryData(uA.priorityFeeSettings(),{type:"auto"}),this.storage.set("tipAmount",null),this.storage.set("tipSettings",{type:"auto"}),this.queryClient.setQueryData(uA.tipAmount(),null),this.queryClient.setQueryData(uA.tipSettings(),{type:"auto"});let u=new H(o.data.amount),c=new H(i.sellAmount),l=u.minus(c).toString();X6(this.queryClient,{id:gn(o),amount:l}),this.queryClient.invalidateQueries({queryKey:Zk.tokens(a.addresses)}),this.queryClient.invalidateQueries({queryKey:AB.tokenBalance({wallets:a.addresses,encodedCaip19:M(U(o))})}),(async()=>{let m=await this.authRepository.getUser(),B=U(o);Gl(this.queryClient,M(B),c.negated()),await new Promise(k=>setTimeout(k,qG)),await Promise.all([wl(this.queryClient,m?.userID),bl(this.queryClient)])})()}}};n();s();n();s();var Vr=class{#A;constructor(A){this.#A=A}onScannedMessageByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"message",status:"success"}}})};onFailedScannedMessageByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"message",status:"error"}}})};onScannedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"success"}}})};onFailedScannedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"error"}}})};onSkippedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"skipped"}}})}};var vh="swap-validation",yn=class{simulationAnalytics;constructor(A){this.simulationAnalytics=new Vr(A)}onStateChange(A,j,t){switch(A.type){case"simulationPassed":let r=A.scannedTransactionResult;this.simulationAnalytics.onScannedTransactionByUser({networkId:A.networkId,warnings:r.warnings.map(i=>i.severity),shouldBlock:!!r.block,errorCode:r.error??""});break;case"simulationFailed":let o=A.error.scannedTransactionResult;if(o){this.simulationAnalytics.onScannedTransactionByUser({networkId:A.networkId,warnings:o.warnings.map(i=>i.severity),shouldBlock:!!o.block,errorCode:o.error??""}),o?.error&&b.addBreadcrumb(vh,`Simulation error: ${JSON.stringify({error:o.error})}`,"info");return}this.simulationAnalytics.onFailedScannedTransactionByUser({networkId:A.networkId,url:A.url}),b.addBreadcrumb("simulation",`networkID: ${A.networkId}, url: ${A.url}, type: transaction`,"info");break;case"simulationSkipped":this.simulationAnalytics.onSkippedTransactionByUser({networkId:A.networkId}),b.addBreadcrumb(vh,`Simulation skipped for networkID: ${A.networkId}`,"info");break}}};n();s();n();s();n();s();var xG=10,TG=VA(e=>({transitions:[],addTransition:(A,j)=>e(t=>{let r=PG(j,A);return r?{transitions:[r,...t.transitions].slice(0,xG)}:t})}));function J6(e,A){TG.getState().addTransition(e,A)}function PG(e,A){switch(A.type){case"idle":return;case"fetchingQuote":return;case"quote":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,timestamp:Date.now()};case"simulationRequestErrored":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,error:A.error,quoteTransactionData:W6(A.quote),timestamp:Date.now()};case"simulated":return;case"simulationFailed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,simulationError:A.simulationError,stateType:A.type,eventType:e.type,simulationWarning:A.scannedTransactionResult?.warnings,quoteTransactionData:W6(A.quote),simulationHumanReadableError:A.scannedTransactionResult?.simulationError?.humanReadableError,simulationRequestId:A.scannedTransactionResult?.advancedDetails?.requestId,timestamp:Date.now()};case"transactionSubmissionFailed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,error:A.error,stateType:A.type,eventType:e.type,quoteTransactionData:W6(A.quote),timestamp:Date.now()};case"transactionNotConfirmed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,quoteTransactionData:W6(A.quote),timestamp:Date.now(),error:A.error};default:return}}var di=e=>{let A=OA(e);return vA(A)},st=(e,A,j)=>{switch(j){case"sell":return{caip19:e.sellToken,symbol:A.data.symbol??void 0};case"buy":return{caip19:e.buyToken,symbol:A.data.symbol??void 0}}},W6=e=>{if(!dA(e))return e.transactionData};n();s();var hn=class{onStateChange(A,j,t,r){let o=this.toLegacyTransition(A,t);o&&J6(o.nextState,o.event)}toLegacyTransition(A,j){let{buy:t,sell:r,quote:o,response:i}=j.executingQuote;switch(A.type){case"simulationFailed":return{event:{type:"simulationRequestError",error:A.error},nextState:{type:"simulationFailed",buy:t,sell:r,response:i,quote:o,scannedTransactionResult:A.error.scannedTransactionResult,simulationError:A.error.message}};case"transactionSubmissionFailed":return{event:{type:"transactionSubmissionFailed",error:A.error},nextState:{type:"transactionSubmissionFailed",buy:t,sell:r,response:i,quote:o,error:A.error}};case"transactionConfirmationFailed":return{event:{type:"transactionConfirmationFailed",error:A.error,txReceipt:A.txReceipt},nextState:{type:"transactionNotConfirmed",buy:t,sell:r,response:i,quote:o,error:A.error,txReceipt:A.txReceipt}};default:return}}};n();s();n();s();n();s();n();s();n();s();var Y6,GG=new Uint8Array(16);function Ld(){if(!Y6&&(Y6=typeof self.crypto<"u"&&self.crypto.getRandomValues&&self.crypto.getRandomValues.bind(self.crypto),!Y6))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y6(GG)}n();s();var we=[];for(let e=0;e<256;++e)we.push((e+256).toString(16).slice(1));function qh(e,A=0){return we[e[A+0]]+we[e[A+1]]+we[e[A+2]]+we[e[A+3]]+"-"+we[e[A+4]]+we[e[A+5]]+"-"+we[e[A+6]]+we[e[A+7]]+"-"+we[e[A+8]]+we[e[A+9]]+"-"+we[e[A+10]]+we[e[A+11]]+we[e[A+12]]+we[e[A+13]]+we[e[A+14]]+we[e[A+15]]}n();s();n();s();var CG=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),Kd={randomUUID:CG};function OG(e,A,j){if(Kd.randomUUID&&!A&&!e)return Kd.randomUUID();e=e||{};let t=e.random||(e.rng||Ld)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){j=j||0;for(let r=0;r<16;++r)A[j+r]=t[r];return A}return qh(t)}var mj=OG;n();s();n();s();var xh=e=>{let A,j=new Set,t=(l,m)=>{let B=typeof l=="function"?l(A):l;if(!Object.is(B,A)){let k=A;A=m??(typeof B!="object"||B===null)?B:Object.assign({},A,B),j.forEach(f=>f(A,k))}},r=()=>A,u={setState:t,getState:r,getInitialState:()=>c,subscribe:l=>(j.add(l),()=>j.delete(l)),destroy:()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),j.clear()}},c=A=e(t,r,u);return u},Th=e=>e?xh(e):xh;var Uh=q(P(),1),Hh=q(Nh(),1),{useDebugValue:A1}=Uh.default,{useSyncExternalStoreWithSelector:e1}=Hh.default,Lh=!1,j1=e=>e;function t1(e,A=j1,j){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&j&&!Lh&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Lh=!0);let t=e1(e.subscribe,e.getState,e.getServerState||e.getInitialState,A,j);return A1(t),t}var Kh=e=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let A=typeof e=="function"?Th(e):e,j=(t,r)=>t1(A,t,r);return Object.assign(j,A),j},r1=e=>e?Kh(e):Kh,Qh=e=>((import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),r1(e));n();s();var n1=3e3,zA=Qh(e=>({toast:void 0,toastId:void 0,visible:!1,currentTimer:null,hideToast(A){e(j=>A&&j.toastId!==A?j:(j.currentTimer&&clearTimeout(j.currentTimer),{visible:!1,currentTimer:null}))},removeToast(){e(A=>(A.currentTimer&&clearTimeout(A.currentTimer),{toast:void 0,toastId:void 0,visible:!1,currentTimer:null}))},success(A){e(j=>{j.currentTimer&&clearTimeout(j.currentTimer);let t=setTimeout(()=>{e({visible:!1,currentTimer:null})},n1);return{toast:{type:"Success",...A},toastId:A.id??mj(),visible:!0,currentTimer:t}})},failed(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Failed",...A},toastId:A.id??mj(),visible:!0,currentTimer:null}))},progress(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Progress",...A},toastId:A.id??mj(),visible:!0,currentTimer:null}))},message(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Default",...A},toastId:A.id??mj(),visible:!0,currentTimer:null}))}}));n();s();var ki=e=>{let A=nt(e);return rj(A)};n();s();function zd(e,A,j,t){let r=NA(e),o=r?e:A,i=r?A:e,a=r?j.sellAmount:j.buyAmount,u=kA(a,o.data.decimals),c=ja(u,!0),l=i.data.symbol,m="";return t?m=r?"swapTokenConfirmationBuyToast":"swapTokenConfirmationSellToast":m=r?"swapSwappingCashBuyToast":"swapSwappingCashSellToast",T.t(m,{amount:c,symbol:l})}n();s();n();s();function Vh({sell:e,buy:A,onBuyFungiblePress:j}){let t=`${T.t("swapTxConfirmationSwapFailed")} ${e.data.symbol} \u2192 ${A.data.symbol}`,r=I.getChainDefinition(e.data.chain.id).tokenSymbol,o=T.t("buyAssetInterpolated",{tokenSymbol:r});return{title:t,message:T.t("swapTabInsufficientFunds"),onPress:j,buttonText:o}}function zh(e,A,j,t,r,o){let{sell:i,buy:a}=A,u=s1(e,i,a,r,t,j,o);return u||{title:`${T.t("swapTxConfirmationSwapFailed")} ${i.data.symbol} \u2192 ${a.data.symbol}`,message:Td(e),onPress:()=>{zA.getState().hideToast(),t()},buttonText:T.t("commandRetry")}}function s1(e,A,j,t,r,o,i){if(!(e.type&&!i.includes(e.type)))switch(e.type){case"INSUFFICIENT_FUNDS":return Vh({sell:A,buy:j,onBuyFungiblePress:()=>{zA.getState().hideToast(),o()}});case"SLIPPAGE_EXCEEDED":return t.selectedSetting.type==="auto"?void 0:{title:T.t("swapEnableAutoSlippageTitleToast",{sellSymbol:A.data.symbol,buySymbol:j.data.symbol}),buttonText:T.t("swapEnableAutoSlippageButtonToast"),message:"",onPress:()=>{t.setSlippageSetting({type:"auto"}),r(),zA.getState().hideToast()}}}}n();s();n();s();var i1=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],a1="Ledger user rejected action",p1="Ledger Sign Error";function Xh(e){return i1.some(j=>e.message.includes(j))?T.t("swapTxConfirmationSwapFailedLedgerConnectionError"):e.message.includes(a1)?T.t("swapTxConfirmationSwapFailedLedgerReject"):e.message.includes(p1)?T.t("swapTxConfirmationSwapFailedLedgerSignError"):e.message.toLowerCase().includes("ledger")?T.t("swapTxConfirmationSwapFailedLedgerError"):null}function Wh({sellSymbol:e,buySymbol:A,error:j,onPress:t}){let r=T.t("unknownToken"),o=`${T.t("swapTxConfirmationSwapFailed")} ${e??r} \u2192 ${A??r}`,i=T.t("commandRetry"),a=T.t("swapTxConfirmationSwapFailedUnknownError"),u=Xh(j);return u&&(a=u),{title:o,message:a,onPress:t,buttonText:i}}var wn=class{constructor(A,j,t,r,o,i=l1){this.showFungibleDetails=A;this.showBuyFungibleScreen=j;this.slippageSettings=t;this.supportedCustomSimulationToastErrorTypes=r;this.retryAndNavigateToSwapper=o;this.toastMessageParser=i}onStateChange(A,j,t,r){let{sell:o,buy:i,quote:a}=t.executingQuote;switch(A.type){case"executeSwapStarted":let u;dA(a)?u=T.t("swapInitiatingBridgeToast",{sellSymbol:o.data.symbol,sellChain:o.data.chain.name,buySymbol:i.data.symbol,buyChain:i.data.chain.name}):NA(o)||NA(i)?u=zd(o,i,a,!1):u=T.t("swapSwappingToast",{sellSymbol:o.data.symbol,buySymbol:i.data.symbol}),c1(u);break;case"transactionConfirmed":u1(this.toastMessageParser.parseTransactionConfirmed(o,i,a),()=>this.showFungibleDetails(i));break;case"simulationFailed":Jh(zh(A.error,t.executingQuote,this.showBuyFungibleScreen,()=>this.handleRetryPress(t.executingQuote),this.slippageSettings,this.supportedCustomSimulationToastErrorTypes));break;case"transactionSubmissionFailed":case"transactionConfirmationFailed":Jh(Wh({sellSymbol:o.data.symbol,buySymbol:i.data.symbol,error:A.error,onPress:()=>this.handleRetryPress(t.executingQuote)}));break}}handleRetryPress(A){zA.getState().hideToast(),this.retryAndNavigateToSwapper(A)}};function c1(e){zA.getState().progress({message:e,onPress:()=>{zA.getState().hideToast()}})}function u1(e,A){zA.getState().success({id:"swap-success",message:e,onPress:()=>{zA.getState().hideToast(),A()}})}function Jh(e){zA.getState().failed(e)}var l1={parseTransactionConfirmed(e,A,j){return dA(j)?T.t("swapBridgeInitiatedToast",{sellSymbol:e.data.symbol,sellChain:e.data.chain.name,buySymbol:A.data.symbol,buyChain:A.data.chain.name,estimatedTime:ki(j)}):T.t("swapSwappedToast",{sellSymbol:e.data.symbol,buySymbol:A.data.symbol})}};var Ap=class{intercept(A){let{swapper:j,connection:t,storage:r,vaultProxy:o,locale:i,analytics:a,resetSwapper:u,queryClient:c,showFungibleDetails:l,showBuyFungibleScreen:m,swapAnalytics:B,gasEstimation:k,slippageSettings:f,supportedCustomSimulationToastErrorTypes:g,navigateToSwapper:E,storePairs:h,isMobile:y,enableExtSwapCommands:F,authRepository:S,isSimulationKilled:x}=A;if(j.getAccount()?.type==="ledger"||!y&&!F)return"continue";let v=j.getState();if(v.type!=="quote")return"continue";let{quote:D,sell:G,buy:C}=v;return this.isSupportedQuote(D)&&(async()=>{h(G,C);let _=await a.getDeviceId(),V=new wn(l,m,f,g,jA=>{E(jA)}),z=new En(c,r,S),L=new fn(B,a),R=new yn(a),W=new hn,Q=new Bn(Tj);try{j.subscribeExecution(z),j.subscribeExecution(R),j.subscribeExecution(L),j.subscribeExecution(V),j.subscribeExecution(W),j.subscribeExecution(Q),await j.swap({signer:o,storage:r,locale:i,deviceId:_,connection:t,authRepository:S,isSimulationKilled:x,gasEstimation:k}),u()}catch{}finally{j.unsubscribeExecution(z),j.unsubscribeExecution(R),j.unsubscribeExecution(L),j.unsubscribeExecution(V),j.unsubscribeExecution(W),j.unsubscribeExecution(Q)}})(),"continue"}isSupportedQuote(A){return Le(A)||Ze(A)||Bt(A)||dA(A)}};n();s();var ep=class{constructor(A,j){this.swapper=A;this.queryClient=j}queryKey;quoteProcessorListener={onStateChange:(A,j)=>{if(!this.queryKey){console.error("queryKey is not set");return}j.type==="quoteProcessed"&&this.queryClient.setQueryData(this.queryKey,j.response)}};async fetch(A,j){return this.queryKey=j,this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener),new Promise((t,r)=>{let o=d1(A.amount,A.sell,A.buy),i={onStateChange:(a,u)=>{switch(u.type){case"firstQuoteReceived":t(u.response),this.swapper.unsubscribeQuoteProcessor(i);break;case"error":r(u.error),this.swapper.unsubscribeQuoteProcessor(i),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener);break}}};this.swapper.subscribeQuoteProcessor(this.quoteProcessorListener),this.swapper.subscribeQuoteProcessor(i),this.swapper.setPair(Zh(A.buy),Zh(A.sell),o),this.swapper.setAmount(o,{slippageTolerance:A.slippageTolerance,slippageType:A.enableAutoSlippage?"auto":"fixed",priorityFee:A.priorityFee,tipAmount:A.tipAmount,preferredProvider:A.preferredProvider})})}stopFetching(){this.swapper.getQuoteProcessorState().type!=="idle"&&(this.swapper.stopProcessingQuotes(),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener))}getFetchInterval(A){return!1}};function d1(e,A,j){let t=e.type==="sell"?A:j;return{amount:new w(e.value).shiftedBy(-t.data.decimals).toString(),perspective:e.type}}function Zh(e){return{...e,data:{...e.data,walletAddress:""}}}n();s();n();s();var jp=class{intercept({hasViewedAutoSlippageOptIn:A,selectedSetting:j,setHasViewedAutoSlippageOptIn:t,showOverlay:r}){return!A&&j!=="auto"?(r("autoSlippageOptIn"),t(!0),"interrupt"):"continue"}};n();s();var Wd=q(P());n();s();var A0=q(P());n();s();var k1=p.object({swapper:p.number(),review:p.number().nullish().default(null)}),tp={swapper:Ts.Short,review:null},Xd=()=>{let e=Be.getMultivariateAssignment("swapper-poll-interval-json");if(!e)return tp;try{let A=JSON.parse(e);return k1.parse(A)}catch{return tp}};var Gj=()=>{let e=Bi(r=>r.intervalMs),A=Bi(r=>r.state),j=Bi(r=>r.setState),t=(0,A0.useCallback)(r=>{j("resumed",r??e0())},[j]);return{state:A,pause:()=>j("paused"),resume:t,intervalMs:e}},bn=e=>{Bi.getState().setState("resumed",e??e0())},rp=()=>{Bi.getState().setState("paused")},e0=()=>Xd().swapper,Bi=VA(e=>({state:"resumed",intervalMs:tp.swapper,setState(A,j){e(j?{state:A,intervalMs:j}:{state:A})}}));var j0=()=>{let e=(0,Wd.useCallback)(()=>{bn()},[]),A=(0,Wd.useCallback)(()=>{rp()},[]);return{onSwapTabEnter:e,onSwapTabExit:A}};var t0=(0,it.createContext)(void 0),B1=({children:e})=>{let A=["auto","fixed"],j=["SLIPPAGE_EXCEEDED"],t=(0,it.useMemo)(()=>[new jp,new Ap],[]),r=!0,o=TA(),i=pA(),a=(0,it.useMemo)(()=>Fj?new ep(o,i):new H6,[o,i]),{onSwapTabEnter:u,onSwapTabExit:c}=j0(),l=(0,it.useMemo)(()=>We?Qr("full"):Qr("compactNoSymbol"),[]);return it.default.createElement(t0.Provider,{value:{slippageSettingTypes:A,reviewInterceptors:t,showStickyCTAButton:r,getSwapQuotesStrategy:a,supportedCustomSimulationToastErrorTypes:j,onSwapTabEnter:u,onSwapTabExit:c,balanceDisplayStrategy:l}},e)},fi=()=>{let e=(0,it.useContext)(t0);if(!e)throw new Error("useSwapTab must be used within a SwapTabProvider");return e};n();s();var zr=q(P());n();s();n();s();var f1=p.enum(["pumpFun","moonshot"]),g1=p.object({type:f1,programId:p.string(),name:p.string(),iconUrl:p.string()}),E1=p.object({programs:p.array(g1)}),r0=e=>{try{return E1.parse(e)}catch{return}};var y1={type:"pumpFun",programId:"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P",name:"Pump.fun",iconUrl:"https://dhc7eusqrdwa0.cloudfront.net/assets/pumpfun.svg"},Jd=[],It=()=>{try{let e=Be.getMultivariateAssignment("enabled-ugc-programs");if(!e)return Be.isFeatureEnabled("enabled-ugc-programs")?[y1]:Jd;let A=JSON.parse(e);return r0(A)?.programs??Jd}catch{return Jd}};var h1=p.object({programId:p.string(),complete:p.boolean(),progress:p.string()}),F1=p.object({bondingCurves:p.record(p.string(),h1)});function S1(e){let A=o0(e),t=pA().getQueryData(A.queryKey),{data:r,isFetching:o,isError:i}=X({...A,initialData:t,staleTime:0}),a=(0,zr.useMemo)(()=>It(),[]);return(0,zr.useMemo)(()=>{let u=t===r;if(o&&!u)return{type:"Loading"};if(i)return{type:"Error"};let c=F1.safeParse(r);if(!c.success)return{type:"Error"};let l=c.data.bondingCurves[e];if(!l)return{type:"NoBondingCurve"};let m=a.find(k=>k.programId===l.programId);if(!m)return{type:"NoBondingCurve"};let B=I1(l.progress);return B?l.complete?{type:"Graduated",ugcProgram:m}:{type:u&&o?"BondingCurveRefreshing":"BondingCurve",progressPercentage:B,ugcProgram:m}:{type:"Error"}},[t,e,r,i,o,a])}var w1=e=>{let A=pA(),j=o0(e);return(0,zr.useCallback)(async()=>{await A.refetchQueries({queryKey:j.queryKey,type:"active"})},[A,j.queryKey])},o0=e=>{let A=(0,zr.useMemo)(()=>It(),[]),j=(0,zr.useMemo)(()=>A.map(r=>r.programId),[A]);return{queryKey:["bonding-curve",e,j],queryFn:()=>b1(e,j)}},b1=async(e,A)=>{let j=encodeURIComponent(e),t=encodeURIComponent(A.join(","));return(await N.api().get(`/ugc/v1/bonding-curve/${j}/${t}`)).data},I1=e=>{let A=Number(e);if(!isNaN(A))return Math.round(A*100)};n();s();var $1="https://help.phantom.com/hc/en-us/articles/33745013398675";n();s();n();s();var n0=q(P());n();s();var Yd=q(P());n();s();function pr(){return LA.supportedChains}var $t=()=>{let{data:e}=aA(),A=pr(),j=(0,Yd.useMemo)(()=>A.map(t=>I.getMainnetNetworkID(t)),[A]);return(0,Yd.useMemo)(()=>v1(e,j),[e,j])},v1=(e,A)=>[...new Set((e?.addresses??[]).map(j=>j.networkID).filter(j=>A.includes(j)))];var Zd=()=>{let e=$t();return(0,n0.useCallback)(A=>!!A&&e.includes(A),[e])};n();s();var d0=q(P());n();s();n();s();n();s();n();s();var q1=e=>{let A=wA(),j=J(),{data:t,isPending:r}=X({gcTime:0,queryKey:["originIsBlocklisted",e],queryFn:async()=>{let{result:o}=await Tk(A,j,e);return o}});return e===void 0?{isLoading:!1,originIsBlocklisted:!1}:{isLoading:r,originIsBlocklisted:t??!1}};n();s();var A7=q(P());function x1(e,A){let{data:j}=aA(),{params:t,networkID:r}=e,[o,i]=(0,A7.useState)(null),a=["scan-message",{url:e.url,message:t.message}],u=j?.addresses.find(f=>f.networkID===r)?.address,c=fe(T.language)??"en",l=J(),m=new Vr(l),B=i0(),k=X({queryKey:a,queryFn:async()=>{try{let f=await Hk(c,await l.getDeviceId(),{...e,userAccount:u});return i(null),m.onScannedMessageByUser({networkId:r,warnings:f.warnings.map(g=>g.severity),shouldBlock:!!f.block,errorCode:f.error??""}),f}catch(f){i(f),m.onFailedScannedMessageByUser({networkId:r,url:e.url}),b.addBreadcrumb("simulation",`networkID: ${r}, url: ${e.url}, type: message`,"info"),b.captureError(k.error,"simulation")}},enabled:!!u&&!!e.url&&!!t.message&&!A?.disabled,refetchInterval:A?.disableRefetch?!1:B,staleTime:1e3*10,...zc()});return{isFetched:k.isFetched,isFetching:k.isFetching,data:k.data,isLoading:k.isPending&&!A?.disabled,isError:k.isError||!!o,error:k.error||o}}function gi(e,A){let{params:j}=e,[t,r]=(0,A7.useState)(null),o=J(),i=["scan-transaction",e.networkID,e.url,j?j.transactions??j.transaction:""],a=i0(),u=!1;I.isEVMNetworkID(e.networkID)||I.isSolanaNetworkID(e.networkID)?u=!!j&&j.transactions.length>0&&!!e.userAccount:I.isBitcoinNetworkID(e.networkID)?u=!!j&&!!j.transaction&&!!j.userAddresses&&j.userAddresses.length>0:I.isSuiNetworkID(e.networkID)&&(u=!!j&&!!e.userAccount);let c=fe(T.language)??"en",l=new Vr(o),m=u&&!A?.disabled,B=X({queryKey:i,queryFn:async()=>{try{let k=await ca(c,await o.getDeviceId(),e);return l.onScannedTransactionByUser({networkId:e.networkID,warnings:k.warnings.map(f=>f.severity),shouldBlock:!!k.block,errorCode:k.error??""}),r(null),A?.onSettled?.(k,void 0),k}catch(k){l.onFailedScannedTransactionByUser({networkId:e.networkID,url:e.url}),b.addBreadcrumb("simulation",`networkID: ${e.networkID}, url: ${e.url}, type: transaction`,"info"),r(k),A?.onSettled?.(void 0,k),b.captureError(k,"simulation")}},enabled:m,refetchInterval:A?.disableRefetch?!1:a,staleTime:1e3*10,...zc()});return{isFetched:B.isFetched,isFetching:B.isFetching,data:B.data,isLoading:B.isPending&&m,isError:B.isError||!!t,error:B.error||t}}var s0=5e3;function i0(){let e=Be.getMultivariateAssignment("transactions-simulation-interval-ms");if(!e)return s0;let A=parseInt(e,10);return Number.isNaN(A)?s0:A}var Ei=q(P());n();s();n();s();var op=class{onStateChange(A,j,t){J6(t,A)}};n();s();var np=class{constructor(A){this.listeners=A}transition(A,j){try{let t=this.detectNextState(A,j);return this.listeners.forEach(r=>r.onStateChange(j,A,t)),t}catch{return A}}detectNextState(A,j){switch(j.type){case"quoteRequestStarted":return{type:"fetchingQuote",buy:j.buy,sell:j.sell,amount:j.amount};case"quoteResponseReceived":switch(A.type){case"fetchingQuote":case"quote":case"simulated":case"simulationRequestErrored":case"transactionSubmissionFailed":case"transactionNotConfirmed":let t=j.response.quotes[j.quoteIndex];if(!t)throw new Error("Quote index out of bounds");return{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:t};default:throw new Error("Can't transition from this state")}case"quoteSelected":switch(A.type){case"quote":let t=A.response.quotes[j.quoteIndex];if(!t)throw new Error("Quote index out of bounds");return{type:"quote",quote:t,buy:A.buy,sell:A.sell,response:A.response};default:throw new Error("Can only transition to QuoteChanged from Quote")}case"simulationResponseReceived":switch(A.type){case"quote":return j.scannedTransactionResult.error?{type:"simulationFailed",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:j.scannedTransactionResult,simulationError:j.scannedTransactionResult.error}:{type:"simulated",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:j.scannedTransactionResult};default:throw new Error("Can only transition to Simulated from Simulating")}case"simulationRequestError":switch(A.type){case"quote":return{type:"simulationRequestErrored",buy:A.buy,sell:A.sell,quote:A.quote,response:A.response,error:j.error};default:throw new Error("Can only transition to SimulationRequestErrored from Simulating")}case"transactionSubmissionFailed":switch(A.type){case"simulated":case"simulationFailed":return{type:"transactionSubmissionFailed",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:A.scannedTransactionResult,error:j.error};default:throw new Error("Can only transition to SwapSubmitFailed from SubmittingSwap")}case"transactionConfirmationFailed":switch(A.type){case"simulated":return{type:"transactionNotConfirmed",quote:A.quote,buy:A.buy,sell:A.sell,txReceipt:j.txReceipt,response:A.response,scannedTransactionResult:A.scannedTransactionResult,error:j.error};default:throw new Error("Can only transition to TransactionNotConfirmed from ConfirmingTransaction")}}}};var T1=new np(new Set([new op])),a0=VA(e=>({state:{type:"idle"},transition:A=>{e(j=>{let t=j.state;return{state:T1.transition(t,A)}})}}));var vt=()=>{let e=a0(j=>j.state),A=a0(j=>j.transition);return{state:e,transition:A}};n();s();var P1="swap-priority-fee",G1=async(e,A,j)=>{let t=ue(e,"bs58");return await ao(t,j),{networkFeeEstimation:await aa(A,[t.message])}};function p0({swapTransactions:e,chainId:A,solanaConnection:j,enabled:t=!0}){return X({queryKey:[P1],queryFn:async()=>{if(!e)throw new Error("No swap transactions");if(e.type!=="solana")throw new Error("Trying to estimate network fee for non-solana txs");if(!A)throw new Error("Trying to execute swap with no chain id.");try{let r=e.transactions.map(a=>G1(a,A,j));return(await Promise.all(r)).map(a=>a.networkFeeEstimation.value)}catch{return[0]}},staleTime:0,enabled:t&&!!e&&e.transactions.length>0&&e.type==="solana"&&!!A})}n();s();var C1="swap-priority-fee";function c0({swapTransactions:e,chainId:A,estimatedFee:j,enabled:t=!0}){return X({queryKey:[C1,e],queryFn:async()=>{if(!e)throw new Error("No swap transactions");if(e.type!=="sui")throw new Error("Trying to estimate network fee for non-sui txs");if(!A)throw new Error("Trying to execute swap with no chain id.");if(j&&j.length===e.transactions.length)return j;try{return(await Promise.all(e.transactions.map(o=>sa({networkID:A,transaction:wo.deserializeTransactionString(o)})))).map(o=>o.gasBudget.toNumber())}catch{return[0]}},enabled:t&&!!e&&e.transactions.length>0&&e.type==="sui"&&!!A})}n();s();var u0={estimateGas:({solanaNetworkFees:e,networkID:A})=>e.map(j=>({networkID:A,value:j}))};n();s();var l0={estimateGas:({suiGasBudget:e,networkID:A})=>e.map(j=>({networkID:A,gasBudget:new w(j)}))};var O1=2e4,e7=({includeGasBuffer:e=!1}={})=>{let{currentQuote:A,quoteResponse:j}=iA(),t=$(C=>C.sellFungible),r=t?.data.chain.id??tA.Solana.Mainnet,{data:o}=yr(t?{address:t.data.walletAddress,networkID:t.data.chain.id}:void 0),i=o?.address??"",a=I.isEVMNetworkID(r),u=I.isSolanaNetworkID(r),c=I.isSuiNetworkID(r),l=$(C=>C.isFetchingQuote),{data:m,isFetching:B}=Jj({callerAddress:i,sellFungible:t,quote:A}),k={type:"transaction",userAccount:i,params:void 0,url:"https://phantom.com",networkID:r};m?.type==="evm"&&a&&(k.params={transactions:m.transactions});let{transition:f}=vt(),g=(0,Ei.useCallback)((C,_)=>{_&&f({type:"simulationRequestError",error:_}),C&&f({type:"simulationResponseReceived",scannedTransactionResult:C})},[f]),{data:E,isFetching:h}=gi(k,{disabled:u,onSettled:g}),{connection:y}=cj(),{data:F}=eB({networkID:a?r:tA.Ethereum.Mainnet,transactionSpeed:"standard",gasLimit:new H(1),refetchInterval:O1,enabled:a}),{data:S,isLoading:x}=p0({swapTransactions:m,chainId:u?r:tA.Solana.Mainnet,solanaConnection:y,enabled:u}),{data:O,isFetching:v}=c0({swapTransactions:m,chainId:c?r:tA.Sui.Mainnet,estimatedFee:j?.estimateGasFee,enabled:c}),D=(0,Ei.useMemo)(()=>{if(!(l||!A)){if(a&&(Ze(A)||dA(A))&&F&&m)return Wt.estimateGas({swapTransactions:m,evmGasEstimation:F,currentQuote:A,scanResult:E,includeGasBuffer:e,networkID:r,gasBuffer:j?.gasBuffer});if(u&&S!==void 0)return u0.estimateGas({solanaNetworkFees:S,networkID:r});if(c&&O!==void 0)return l0.estimateGas({suiGasBudget:O,networkID:r})}},[l,A,F,r,S,E,e,j?.gasBuffer,a,u,c,O,m]),G=!1;return u?G=x:c?G=B||h||v:a&&(G=B||h),(0,Ei.useMemo)(()=>({gasEstimation:D,isFetching:G,isError:F===void 0}),[D,G,F])};function M1(){let e=$(o=>o.setGasEstimation),{state:A}=Gj(),{gasEstimation:j}=e7(),{gasEstimation:t,isFetching:r}=e7({includeGasBuffer:!0});(0,d0.useEffect)(()=>{if(A==="paused"){e({isFetching:!1});return}e({isFetching:r,estimate:j,estimateWithBuffer:t})},[A,e,j,t,r])}n();s();var B0=q(P());n();s();var R1="swap",m0=e=>new Vk(e,R1),cr=Eo(J,e=>m0(e));n();s();function ur(e,A,j){if(!j)return;if(A==="fixed")return j.slippageTolerance;let t=j.quotes[e];if(t)return dA(t)?j.slippageTolerance:Wj(t)?t.slippageTolerance:j.slippageTolerance}n();s();var sp=q(P());var Ve=()=>{let{data:e,isFetching:A}=ne({key:"lastSubmittedPairsV2",queryKey:uA.lastSubmittedPairs()}),j=(0,sp.useMemo)(()=>e??null,[e]),{mutateAsync:t}=le({key:"lastSubmittedPairsV2",queryKey:uA.lastSubmittedPairs()}),r=(0,sp.useCallback)(async(o,i)=>{await t({sellFungible:k0(o),buyFungible:k0(i)})},[t]);return{pairs:j,isLoading:A,storePairs:r}};function k0(e){return{...e,data:{...e.data,walletAddress:""}}}var ip=({goToConfirmation:e})=>{let A=$(E=>E.sellUsdValue),j=$(E=>E.buyUsdValue),{currentQuote:t,quoteResponse:r,selectedProviderIndex:o,selectedBaseProvider:i}=iA(),a=$(E=>E.sellFungible),u=$(E=>E.buyFungible),c=$(E=>E.swapFilter),{selectedSetting:l}=MA(),{storePairs:m}=Ve(),B=J(),k=cr(),{pause:f}=Gj();return(0,B0.useCallback)(()=>{if(!t||!a||!u)return;let E=ur(o,l.type,r);B.capture("swapperSwap");let h=li({buyToken:u,sellToken:a,sellAssetUsdValue:A,buyAssetUsdValue:j,quote:t,slippageTolerance:E,slippageType:l.type,sellSwapFilter:c,baseProvider:i});h&&(b.addBreadcrumb("swapper","approved","info",_t(h.swap)),k.approved(h)),f(),e(),I.compareNetworkID(a.data.chain.id,u.data.chain.id)===0&&m(a,u)},[t,a,u,o,l.type,r,B,A,j,f,e,k,m,c,i])};n();s();n();s();n();s();n();s();n();s();var _1=p.object({type:p.literal("fungible"),data:Yk}),f0=p.object({results:p.array(p.any()).transform(e=>e.reduce((A,j)=>{let t=_1.safeParse(j);return t.success&&A.push(t.data),A},[])),prevCursor:p.string().nullish().default(null),nextCursor:p.string().nullish().default(null),hasMore:p.boolean()});async function g0(e){let{query:A,networkIds:j,searchContext:t,supportedNetworkIds:r,pageSize:o=50,cursor:i}=e,a=await N.api().headers({"Content-Type":"application/json"}).get("/search/v1",{params:{query:A.trim(),chainIds:j.join(","),platform:hj,pageSize:o.toString(),searchTypes:"fungible",searchContext:t,...i&&{cursor:i},...r&&{supportedNetworkIds:r.join(",")}}});if(!AA(a))throw new DA({key:"UnknownError"});let u=f0.safeParse(a.data);if(u.success)return u.data;throw new DA({key:"UnknownError"})}n();s();var j7=e=>{let A=e.data,j=Zc(A)??void 0;return{type:A.type,data:{...A.data,tokenAddress:Zc(A)??void 0,key:j}}};n();s();var D1="search",E0={searchResults:(e,A,j,t,r)=>[D1,{query:e,networkIds:A,supportedNetworkIds:t,chainAddresses:j,cursor:r}]};n();s();var t7=(o=>(o[o.Always=1/0]="Always",o[o.Short=K({minutes:5})]="Short",o[o.Medium=K({minutes:30})]="Medium",o[o.Long=K({hours:1})]="Long",o[o.Never=0]="Never",o))(t7||{}),r7=(r=>(r[r.Immediate=0]="Immediate",r[r.Short=K({minutes:5})]="Short",r[r.Medium=K({minutes:30})]="Medium",r[r.Long=K({hours:1})]="Long",r))(r7||{});var N1=async e=>(await g0(e)).results.map(j=>j7(j)),Xr=({query:e,networkIds:A,enableQuery:j=!0,keepPreviousData:t=!1,searchContext:r,supportedNetworkIds:o,chainAddresses:i,pageSize:a})=>{let u=E0.searchResults(e,A,i,o);return X({queryKey:u,gcTime:t7.Short,staleTime:r7.Short,enabled:j,placeholderData:t?ek:void 0,queryFn:()=>N1({query:e,networkIds:A,searchContext:r,supportedNetworkIds:o,pageSize:a})})};var kj=q(P());n();s();n();s();function o7(e,A){return e.localeCompare(A,void 0,{sensitivity:"base"})===0}n();s();function y0(e,A){if(!e||A.length===0)return null;let j=new Set(A),t=1/0,r=null;for(let o of e){let i=new w(o.data.amount??0).gt(0);if(!j.has(o.data.chain.id)||!i)continue;let a=A.indexOf(o.data.chain.id);if(a<t&&(t=a,r=o.data.chain.id,a===0))break}return r}var h0=(e,A,j)=>{let t=A.length?y0(e,A):null;return!t||!j.includes(t)?wd:LA.get(t).nativeFungible},F0=e=>e?LA.get(e).usdcFungible:si,yi=(e,A)=>{let j=dt(A);return e.find(t=>{if(Ae(j)&&j===t.type)return!0;if(A.resourceType==="address"){let r=nB(t);return Er(A)?o7(A.address,r):A.address===r}})},ap=(e,A,j)=>{let t=yi(j,e);if(!t){if(Ae(dt(e)))t=LA.get(e.chainId).nativeFungible;else if(A&&A.chainId===e.chainId){let r=Ae(dt(A)),{usdcFungible:o,nativeFungible:i}=LA.get(A.chainId);t=r?o:i}}return t},n7=e=>{let{usdcFungible:A,nativeFungible:j}=LA.get(e.chainId),t=M(e),r=M(U(A));return Ae(dt(e))?A:(o7(t,r),j)};n();s();var S0=q(P());n();s();var s7=q(P());n();s();function Wr(e,A){return e.data.key===A.data.key}function Jr({enablePrices:e,enableSorting:A}){let{fungibles:j,isLoadingTokens:t,tokensError:r,refetch:o}=$j({enablePrices:e,enableSorting:A}),i=Zd(),a=$(l=>l.sellFungible),u=j.filter(l=>i(l.data.chain.id)&&l.type!=="CompressedSPL"),c=(0,s7.useMemo)(()=>{if(a){let l=u.findIndex(B=>Wr(B,a)),m=u[l];m&&m.data.amount!==a.data.amount&&(u[l]=a)}return u.filter(l=>l.data.amount!=="0")},[u,a]);return(0,s7.useMemo)(()=>({assets:c,isLoading:t,error:r,refetchTokens:o}),[c,t,r,o])}var w0=e=>{let A=go(),{pairs:j}=Ve(),{assets:t}=Jr({enablePrices:!1,enableSorting:!1});return(0,S0.useMemo)(()=>{let r=F0(e?.data.chain.id),a=((j?A.includes(j.buyFungible.data.chain.id):!1)?j?.buyFungible:void 0)??r;return a?yi(t,U(a))??a:void 0},[e,j,A,t])};n();s();var b0=q(P());var pp=()=>{let e=go(),A=$t(),{pairs:j}=Ve(),{assets:t}=Jr({enablePrices:!1,enableSorting:!1}),{fungibles:r}=$j();return(0,b0.useMemo)(()=>{let o=h0(r,e,A),i=j?U(j?.sellFungible):void 0,a=j?U(j?.buyFungible):void 0;return((i?e.includes(i.chainId):!1)&&i&&a?ap(i,a,t):void 0)??o},[e,j,t,A,r])};var I0=e=>{if(e)try{return GA(e)}catch{return}},$0=e=>Fr(e)??[];function L1({paramsSellFungible:e,paramsSellAmount:A,paramsBuyFungible:j,navRef:t}){let{isLoading:r}=Ve(),o=(0,kj.useMemo)(()=>I0(e),[e]),i=(0,kj.useMemo)(()=>I0(j),[j]),a=A,[u,c]=(0,kj.useState)(!1),[l,m]=(0,kj.useState)(!1),{data:B}=aA(),{assets:k,isLoading:f}=Jr({enablePrices:!1,enableSorting:!1}),{data:g,isPending:E}=Xr({query:i?.resourceType==="address"?i.address:i?.slip44??"",enableQuery:!!i,networkIds:[i?.chainId??I.solana.mainnetID],searchContext:"swapper"}),h=(0,kj.useMemo)(()=>{let R=[];return o&&R.push(...$0(o)),i&&R.push(...$0(i)),R},[o,i]),{fungibles:y,isLoadingTokens:F,isRefetchingTokens:S,tokensError:x}=$j({keys:h,enablePrices:!1,enableSorting:!1}),O=pp(),v=$(R=>R.sellFungible),D=w0(v),G=$(R=>R.setBuyFungible),C=$(R=>R.setSellFungible),_=$(R=>R.setUiSellAmountCryptoInput),V=$(R=>R.setSellAmount),z=$(R=>R.setSwapFilter);return(0,kj.useEffect)(()=>{C(void 0),c(!1),G(void 0),m(!1)},[o,i,C,G,B?.identifier,r,t]),(0,kj.useEffect)(()=>{if(u)return;let R;if(o){if(f)return;R=ap(o,i,k)}else!o&&i?R=n7(i):R=O;c(!0),C(R)},[o,i,O,k,C,f,u]),(0,kj.useEffect)(()=>{if(l)return;let R;if(i){if(E)return;if(R=yi(g??[],i),!R){let{usdcFungible:W,nativeFungible:Q}=LA.get(i.chainId);R=Ae(dt(i))?Q:W}}else!i&&o?R=n7(o):R=D;if(!F&&!S&&!x&&y&&R){let W=M(U(R)),Q=y.find(jA=>M(U(jA))===W);Q&&(R=Q)}m(!0),G(R)},[i,o,g,E,G,l,D,y,F,S,x]),(0,kj.useEffect)(()=>{a?(V(a),_(a)):(V(""),_("")),z(void 0)},[a,t,_,V,z]),{isLoading:(!!o||!!i)&&(!l||!u)||r}}n();s();var Cj=q(P()),P0=q(In());n();s();var q0=({sellToken:e,buyToken:A,taker:j,takerDestination:t,amount:r,slippageTolerance:o,pollInterval:i,pollerState:a,enableAutoSlippage:u,priorityFee:c,tipAmount:l,getSwapQuotesStrategy:m})=>{let B=J(),k=e?U(e):void 0,f=A?U(A):void 0,g=e?sB(e,r.value).toString():r.value,E=Pj(x=>x.preferredProvider),h=!!r.value&&!!A&&!!e&&!!j&&a==="resumed";h||m.stopFetching();let y=L6(),F=uA.quotes({sellTokenCaip19:k,buyTokenCaip19:f,taker:j,amountValue:g,amountType:r.type,takerDestination:t,slippageTolerance:o,enableAutoSlippage:u,priorityFee:c,tipAmount:l,preferredProvider:E,phantomCashAccount:y}),S=m.getFetchInterval(i);return X({queryKey:F,enabled:h,gcTime:0,staleTime:0,refetchInterval:S,async queryFn({signal:x}){if(!r||!f||!k||!A||!e||!j)throw new Error("missing necessary args");let O=await m.fetch({sellTokenCaip19:k,buyTokenCaip19:f,taker:j,takerDestination:t,sellAmount:g,exactOut:r.type==="buy",slippageTolerance:o,signal:x,enableAutoSlippage:u,priorityFee:c,tipAmount:l,sell:e,buy:A,amount:{value:g,type:r.type},sellAmountUsd:w(g).times(e.data.price??0).toString(),preferredProvider:E,phantomCashAccount:y??!1},F);return B.capture("swapperQuotesResult",{data:{numQuotes:O.quotes.length,sellToken:e,buyToken:A,fromNetworkId:k.chainId,toNetworkId:f.chainId}}),O}})};n();s();var x0=q(P());var T0=()=>{let e=$(r=>r.sellAmount),A=$(r=>r.sellFungible),j=$(r=>r.buyFungible),t=$(r=>r.setSelectedBaseProvider);(0,x0.useEffect)(()=>{t(xe)},[e,A,j,t])};n();s();var $n=()=>{let e=$(m=>m.sellFungible),A=$(m=>m.buyFungible),j=$(m=>m.sellAmount),t=e?U(e):null,{data:r}=ve({query:t?{data:t}:void 0}),o=e?.data.chain.id,i=A?.data.chain.id,a=r?.usd;if(!o||!i||!j||!a||I.compareNetworkID(o,i)===0)return!0;let u=ee(Number(j),a),c=LA.get(o).bridgeMinimumUsdAmounts,l=LA.get(i).bridgeMinimumUsdAmounts;return c<=u&&l<=u};function U1({skipInitialBuyFungible:e,getSwapQuotesStrategy:A}){let j=$(Y=>Y.sellAmount),t=$(Y=>Y.amountType),o=$(Y=>Y.buyFungible)??(e?void 0:si),i=$(Y=>Y.sellFungible),{data:a}=He(),{selectedSetting:u}=Hr(),{data:c}=Qe(),{selectedSetting:l}=kn(),{state:m,intervalMs:B}=Gj(),k=$(Y=>Y.resetQuote),f=$(Y=>Y.setHasNoRoutes),g=$(Y=>Y.setError),E=$(Y=>Y.setIsFetchingQuote),h=$(Y=>Y.setQuoteResponse),y=$(Y=>Y.setSelectedProviderIndex),{data:F}=bt(),{mutateAsync:S}=K6(),{selectedSetting:x}=MA(),O=x.type==="auto",v=l.type==="auto",D=u.type==="auto",G=$n(),C=(0,P0.default)(G),_=(0,Cj.useMemo)(()=>{let Y=t==="sell"?{amount:j,fungible:i}:{amount:j,fungible:o};return new H(Y.amount).isGreaterThan(0)&&Y.fungible?dB(Y.amount,Y.fungible.data.decimals).toString():(k(),"")},[t,o,k,j,i]),V=xA(i?.data?.chain.id,o?.data.chain.id),{data:z}=yr(i?.data?.chain.id),{data:L}=yr(o?.data.chain.id),R=(0,Cj.useMemo)(()=>{if(z)return{chainId:z.networkID,address:z.address,resourceType:"address"}},[z]),W=(0,Cj.useMemo)(()=>{if(V)return{chainId:L?.networkID,address:L?.address,resourceType:"address"}},[V,L?.address,L?.networkID]),{data:Q,error:jA,isLoading:Z}=q0({sellToken:i,buyToken:o,taker:R,takerDestination:W,amount:{value:G?_:"",type:t},slippageTolerance:O?void 0:F??void 0,enableAutoSlippage:O,priorityFee:D?void 0:a??void 0,tipAmount:v?void 0:c??void 0,pollInterval:B,pollerState:m,getSwapQuotesStrategy:A}),mA=$(Y=>Y.selectedProviderIndex);(0,Cj.useEffect)(()=>{!Z&&Q&&Tj.addQuoteResponse(Q,mA.toString())},[mA]);let cA=(0,Cj.useCallback)(Y=>{g(null),y(0),E(!1),f(!1),h(Y),Tj.addQuoteResponse(Y,"0");let sA=ur(0,x.type,Y);sA&&F!==sA&&S(sA)},[g,f,E,h,y,S,F,x.type]),rA=(0,Cj.useCallback)(Y=>{k(),E(!1),f(!0),g(Y)},[k,g,f,E]);(0,Cj.useEffect)(()=>{m!=="paused"&&(Z?E(!0):Q?cA(Q):jA&&rA(jA))},[jA,Q,Z,cA,rA,E,m,G]),(0,Cj.useEffect)(()=>{G?C===!1&&G&&(g(null),f(!1)):(g(new DA({key:"InsufficientSellAmount"})),f(!0))},[G,C,g,f]),T0()}n();s();var cp=q(P());n();s();var H1=5*60,G0=e=>{if(dA(e))return vA(Qo(e));let{sources:A}=e;return vA(A)},C0=({quotes:e,buyTokenNetworkId:A,buyTokenDecimals:j,buyTokenSymbol:t})=>e.map(r=>{let{buyAmount:o}=r,i=Ij.get(A).formDisplayPrecision;return{name:G0(r),amount:`${_e(kA(o,j),i)} ${t}`}}),O0=({quotes:e,buyTokenNetworkId:A,buyTokenDecimals:j,buyTokenSymbol:t,networkIDForFees:r,networkFee:o,priceMap:i})=>e.filter(dA).map(a=>{let{buyAmount:u,executionDuration:c,steps:l}=a,B=_6(a).plus(o),k=l.find(g=>!!g.tool.logoURI),f=Ij.get(A).formDisplayPrecision;return{name:G0(a),feeUsd:r&&i?ej(r,B,i):null,amount:`${_e(kA(u,j),f)} ${t}`,time:{text:rj(c),isFast:c<=H1},logoURI:k?.tool.logoURI??""}});n();s();var Q1={aggregate(e){return e.reduce((A,j)=>({...A,gasLimit:A.gasLimit.plus(j.gasLimit)}),{networkID:I.ethereum.mainnetID,gasLimit:new H(0),maxFeePerGas:e[0].maxFeePerGas,maxPriorityFeePerGas:e[0].maxPriorityFeePerGas})}},V1={aggregate(e){return e.reduce((A,j)=>({...A,value:A.value+j.value}),{networkID:I.solana.mainnetID,value:0})}},z1={aggregate(e){return e.reduce((A,j)=>({...A,gasBudget:A.gasBudget.plus(j.gasBudget)}),{networkID:I.sui.mainnetID,gasBudget:new H(0)})}},hi=e=>{if(!(!e||e.length===0)){if(oa(e[0]))return Q1.aggregate(e);if(Mk(e[0]))return V1.aggregate(e);if(Rk(e[0]))return z1.aggregate(e)}};function X1({selectQuote:e}){let{quoteResponse:A,isFetchingQuote:j,quotes:t,selectedProviderIndex:r}=iA(),o=$(F=>F.setSelectedProviderIndex),i=$(F=>F.gasEstimation.estimateWithBuffer),a=$(F=>F.sellFungible),u=$(F=>F.buyFungible),c=a?.data.chain.id,{data:l}=cs(c,hi(i)),B=pr().map(F=>Re(F)),{data:k={}}=lt({query:{data:B}}),f=A?.type==="xchain",g=(0,cp.useMemo)(()=>u?f?O0({quotes:t,buyTokenNetworkId:u.data.chain.id,buyTokenDecimals:u.data.decimals,buyTokenSymbol:u.data.symbol,networkIDForFees:c,networkFee:l?.gasEstimationAmount??new H(0),priceMap:k}):C0({quotes:t,buyTokenNetworkId:u.data.chain.id,buyTokenDecimals:u.data.decimals,buyTokenSymbol:u.data.symbol}):[],[u,f,t,c,l?.gasEstimationAmount,k]),E=J(),{transition:h}=vt(),y=(0,cp.useCallback)(F=>{let S=g[F];E.capture("swapperProviderSelected",{data:{provider:S.name}}),o(F),e(t,F),h({type:"quoteSelected",quoteIndex:F})},[o,g,E,h,t,e]);return{rows:g,selectedProviderIndex:r,isLoadingProviders:j,setSelectedProviderIndex:y}}n();s();var M0=q(P());var qt=()=>{let{resume:e}=Gj(),A=$(j=>j.resetSwapper);return(0,M0.useCallback)(()=>{e(),A()},[A,e])};n();s();var lp=q(P());n();s();var _0=q(P());n();s();var R0=q(P());var up=()=>{let e=pA();return{cancelQuotes:(0,R0.useCallback)(async()=>{await e.cancelQueries({queryKey:uA.quotesScope()}),await ak(1)},[e])}};function a7(){let e=J(),A=$(r=>r.setBuyFungible),j=$(r=>r.buyFungible),{cancelQuotes:t}=up();return(0,_0.useCallback)(async r=>{if(j&&Wr(r,j))return;await t();let o=St(r);e.capture("swapperUpdateToAsset",{data:o}),A(r)},[e,j,t,A])}n();s();var D0=e=>{p7.getState().setAsset(e)},p7=VA(e=>({asset:void 0,setAsset(A){e({asset:A})}}));var W1=({onClose:e})=>{let A=TA(),j=a7(),t=p7(i=>i.asset),r=(0,lp.useMemo)(()=>It().find(a=>a.programId===t?.data?.ugcTokenMeta?.programId),[t]),o=(0,lp.useCallback)(async()=>{t&&(A.changeToken(t,"buy"),await j(t),e())},[j,A,t,e]);return{asset:t,program:r,handleConfirmPress:o}};n();s();n();s();var c7=()=>{let e=pA(),A=$();return{clearQuotes:async()=>{A.resetQuote(),await e.invalidateQueries({queryKey:uA.quotesScope()})}}};n();s();var u7=({accountIdentifier:e,networkID:A})=>{let j=wA(),t=Sj();return IA({mutationFn:async o=>{let{swapTransactions:i,type:a}=o;if(i.type==="evm"&&a==="eip155"){let{gasEstimation:u,pendingApprovalActivityRows:c,pendingSwapActivityRows:l}=o,{signature:m,error:B}=await b.startSpan("Process EVM Swap Txns",()=>Xa({transactions:i.transactions,transactionTypes:i.transactionTypes,networkID:A,gasEstimation:u,pendingSwapActivityRows:l,pendingApprovalActivityRows:c,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:m,error:B}}else if(i.type==="solana"&&a==="solana"){let{callerAddress:u,connection:c,pendingSwapActivityRows:l}=o;if(!c)throw new Error("missing connection");let{signature:m,error:B}=await b.startSpan("Process Solana Swap Txns",()=>Ya({callerAddress:u,connection:c,networkID:A,transactions:i.transactions,pendingSwapActivityRows:l,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:m,error:B}}else if(i.type==="sui"&&a==="sui"){let{callerAddress:u,pendingSwapActivityRows:c}=o,{signature:l,error:m}=await b.startSpan("Process Sui Swap Txns",()=>j6({callerAddress:u,networkID:A,transactions:i.transactions,pendingSwapActivityRows:c,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:l,error:m}}throw new Error("unsupported")}})};n();s();n();s();var qn=q(P());n();s();n();s();var ze=(e,A=9)=>{let j=(e.match(/\./g)||[]).length;return e.endsWith(".")&&j>1?e.substring(0,e.length-1):e.length===0||e.endsWith(".")||e.endsWith("0")?e:new w(e).decimalPlaces(A).toString()};var N0=q(P());function L0(){let e=$(r=>r.setUiBuyAmountCryptoInput),A=$(r=>r.setUiBuyAmountLocalFiatInput),j=$(r=>r.primaryCurrency),{fromUsd:t}=bA();return(0,N0.useCallback)(({amount:r,decimals:o,usdPrice:i})=>{if(j==="crypto")if(r===void 0)e("");else{let a=kA(r,o).toString(),u=ze(a);e(u)}else if(j==="fiat"&&i)if(r===void 0)A("");else{let a=kA(r,o).toString(),u=ee(Number(a),i),c=t(u);A(c.toString())}},[t,j,A,e])}n();s();n();s();var lr=q(P());function vn(e,A,j=100){let[t,r]=(0,lr.useState)(()=>e),o=(0,lr.useRef)(void 0),i=(0,lr.useCallback)(a=>{r(a),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{A(a),o.current=void 0},j)},[j,A]);return(0,lr.useEffect)(()=>{o.current&&(clearTimeout(o.current),o.current=void 0),r(e)},[e]),[t,i]}var K0=q(P());function U0(){let e=$(a=>a.setAmountType),A=$(a=>a.setSellAmount),j=$(a=>a.sellAmount),t=$(a=>a.setUiBuyAmountCryptoInput),r=J(),[o,i]=vn(j,A,un);return(0,K0.useCallback)(async({fungibleValue:a,shouldUpdateQuote:u,decimals:c})=>{let l=De(a.substring(0,Kr)),m=ze(l,c);e("buy"),t(m),await r.capture("swapperChangeReceiveCryptoAmount",{data:{amount:m}}),u&&i(m)},[r,e,t,i])}n();s();var H0=q(P());function dp(e){return(0,H0.useMemo)(()=>e===void 0?void 0:U(e),[e])}n();s();var Yr=q(P());var Q0=()=>{let e=J(),A=$(y=>y.primaryCurrency),j=$(y=>y.sellFungible),t=$(y=>y.buyFungible),r=$(y=>y.uiSellAmountLocalFiatInput),o=$(y=>y.uiBuyAmountLocalFiatInput),i=$(y=>y.amountType),a=$(y=>y.setUiSellAmountCryptoInput),u=$(y=>y.setUiBuyAmountCryptoInput),c=$(y=>y.switchTokensForBuy),l=$(y=>y.switchTokensForSell),{data:m}=ve({query:j?{data:U(j)}:void 0}),{data:B}=ve({query:t?{data:U(t)}:void 0}),{toUsd:k}=bA(),f=(0,Yr.useMemo)(()=>({localFiatValue:r,decimals:j?.data.decimals??0,usdPrice:m?.usd}),[j?.data.decimals,r,m?.usd]),g=(0,Yr.useMemo)(()=>({localFiatValue:o,decimals:t?.data.decimals??0,usdPrice:B?.usd}),[t?.data.decimals,B?.usd,o]),E=(0,Yr.useCallback)(({localFiatValue:y,decimals:F,usdPrice:S})=>{let x=y?"":_e(0,F);if(S&&y){let O=k(y);x=bj(Number(O),S,F).toString()}return x},[k]),h=(0,Yr.useCallback)(()=>{e.capture("swapperSwitchTokensClicked",{data:{sell:j?M(U(j)):"",buy:t?M(U(t)):""}})},[e,j,t]);return(0,Yr.useCallback)(()=>{if(A==="fiat"){let y=E(f);a(y);let F=E(g);u(F)}i==="sell"?l():c(),h()},[i,g,A,f,u,a,c,l,E,h])};var Y1={chainId:tA.Solana.Mainnet,slip44:"501",resourceType:"nativeToken"};function l7(){let e=$(x=>x.buyFungible),A=dp(e),j=$(x=>x.sellFungible),t=$(x=>x.primaryCurrency),r=$(x=>x.uiBuyAmountCryptoInput),o=$(x=>x.uiBuyAmountLocalFiatInput),i=$(x=>x.amountType),a=$(x=>x.setAmountType),u=$(x=>x.setSellAmount),c=$(x=>x.uiSellAmountCryptoInput),l=$(x=>x.uiSellAmountLocalFiatInput),m=e?.data.decimals??0,{currentQuote:B}=iA(),k=e?U(e):Y1,{data:f}=ve({query:{data:k}}),g=Q0(),E=L0(),h=U0(),{toUsd:y}=bA();(0,qn.useEffect)(()=>{i==="sell"&&A&&E({amount:B?.buyAmount,decimals:m,usdPrice:f?.usd})},[i,A,B?.buyAmount,m,f?.usd,E]),(0,qn.useEffect)(()=>{if(xA(j?.data.chain.id,e?.data.chain.id)&&i==="buy"){if(a("sell"),t==="crypto")u(c);else if(f?.usd){let x=y(l),O=bj(x,f.usd,m);u(O.toString())}}},[i,e,m,f,t,j,a,u,y,c,l]);let F=(0,qn.useCallback)(x=>{h({fungibleValue:x,decimals:m,shouldUpdateQuote:!0})},[m,h]),S=(0,qn.useCallback)(()=>{g()},[g]);return{cryptoAmountInputValue:r,handleCryptoAmountInputChange:F,localFiatAmountInputValue:o,handleSwitchTokensClick:S}}n();s();var Mj=q(P());n();s();var V0=q(P());function z0(){let e=$(c=>c.primaryCurrency),A=$(c=>c.setUiSellAmountLocalFiatInput),j=$(c=>c.setUiBuyAmountLocalFiatInput),t=$(c=>c.setAmountType),r=$(c=>c.setPrimaryCurrency),o=$(c=>c.setUiSellAmountCryptoInput),i=$(c=>c.setSellAmount),a=$(c=>c.setUiBuyAmountCryptoInput),{fromUsd:u}=bA();return(0,V0.useCallback)(({buyAmountFromQuote:c,buyFungibleDecimals:l,buyFungibleUsdPrice:m,sellAmountFromQuote:B,sellFungibleUsdPrice:k})=>{if(e==="crypto"){if(t("sell"),k&&B){let f=ee(Number(B),k),g=u(f);A(g.toString()),i(B.toString())}if(m&&c){let f=kA(c,l).toString(),g=ee(Number(f),m),E=u(g);j(E.toString())}r("fiat")}if(e==="fiat"){if(B&&o(B),m&&c){let f=kA(c,l).toString();a(f)}r("crypto")}},[u,e,i,t,a,j,r,o,A])}n();s();var X0=q(P());function W0(){let e=$(r=>r.primaryCurrency),A=$(r=>r.setUiSellAmountCryptoInput),j=$(r=>r.setUiSellAmountLocalFiatInput),{fromUsd:t}=bA();return(0,X0.useCallback)(({amount:r,decimals:o,usdPrice:i})=>{if(e==="crypto")if(r===void 0)A("0");else{let a=kA(r,o).toString();A(a)}else if(e==="fiat"&&i)if(r===void 0)j("0");else{let a=kA(r,o).toString(),u=ee(Number(a),i),c=t(u);j(c.toString())}},[t,e,A,j])}n();s();var J0=q(P());function Y0(){let e=$(i=>i.setAmountType),A=$(i=>i.setUiSellAmountCryptoInput),j=$(i=>i.setSellAmount),t=$(i=>i.sellAmount),[r,o]=vn(t,j,un);return(0,J0.useCallback)(({fungibleValue:i,decimals:a,shouldUpdateQuote:u,shouldTrimLength:c=!0})=>{let l=De(c?i.substring(0,Kr):i),m=ze(l,a);e("sell"),A(m),u&&o(m)},[e,A,o])}n();s();var Z0=q(P());function AF(){let e=$(a=>a.setAmountType),A=$(a=>a.setSellAmount),j=$(a=>a.sellAmount),t=$(a=>a.setUiSellAmountLocalFiatInput),{toUsd:r}=bA(),[o,i]=vn(j,A,un);return(0,Z0.useCallback)(({localFiatValue:a,shouldUpdateQuote:u,decimals:c,priceData:l})=>{let m=De(a.substring(0,Kr)),B=ze(m,2);if(e("sell"),t(B),u&&l?.usd){let k=r(a),f=bj(k,l.usd,c);i(f.toString())}},[e,t,i,r])}n();s();var uF=q(P());n();s();var eF=q(P());var Z1={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"},jF=()=>{let{currentQuote:e}=iA(),{destinationNetworkFee:A,liquidityFee:j}=(0,eF.useMemo)(()=>{function t(o){return o?{amount:new w(o.amount??0),amountUsd:o.amountUSD?parseFloat(o.amountUSD):null,pct:parseFloat(o.percentage??"0")}:nr}let r=new Map([]);return e&&dA(e)&&(r=e.steps.flatMap(o=>o.includedFeeCosts).reduce((o,i)=>{if(!i)return o;let a=Z1[i.name];return a&&o.set(a,i),o},r)),{destinationNetworkFee:t(r.get("destinationNetwork")),liquidityFee:t(r.get("liquidityProvider"))}},[e]);return{destinationNetworkFee:A,liquidityFee:j}};n();s();var tF=q(P());var AC={calculate({currentQuote:e,gasEstimationPriceData:A}){return{amount:(e&&A?.gasEstimationAmount)??new w(0),amountUsd:(e&&A?.gasEstimationPriceUSDNumber)??null,pct:0}}},eC={calculate({currentQuote:e,gasEstimationPriceData:A,priceMap:j,networkID:t}){let r=(e?.fees??[]).find(a=>a.type==="tips"||a.type==="network"&&a.name!=="Token account deposits"),o=(e&&A?.gasEstimationAmount)??new w(0),i=(e&&A?.gasEstimationPriceUSDNumber)??null;if(r&&r.amount&&(o=o.plus(new w(r.amount)),i)){let a=ej(t,new w(r.amount),j);a&&(i+=a)}return{amount:o,amountUsd:i,pct:0}}},jC={calculate({currentQuote:e,gasEstimationPriceData:A,maxGasEstimationPriceData:j}){return{amount:(e&&A?.gasEstimationAmount)??new w(0),amountUsd:(e&&A?.gasEstimationPriceUSDNumber)??null,maxAmount:(e&&j?.gasEstimationAmount)??new w(0),maxAmountUsd:(e&&j?.gasEstimationPriceUSDNumber)??null,pct:0}}},rF=({priceMap:e})=>{let{currentQuote:A}=iA(),j=$(c=>c.sellFungible),t=$(c=>c.gasEstimation),r=j?.data.chain.id??tA.Solana.Mainnet,{data:o,isLoading:i}=cs(r,hi(t.estimate)),{data:a}=cs(r,hi(t.estimateWithBuffer));return{networkFee:(0,tF.useMemo)(()=>I.isEVMNetworkID(r)?jC.calculate({currentQuote:A,gasEstimationPriceData:o,maxGasEstimationPriceData:a}):I.isSolanaNetworkID(r)?eC.calculate({currentQuote:A,gasEstimationPriceData:o,networkID:r,priceMap:e}):AC.calculate({currentQuote:A,gasEstimationPriceData:o}),[A,o,a,r,e]),isFetchingGasEstimationPrice:i}};n();s();var oF=q(P());var tC={calculate(){return nr}},rC={calculate({currentQuote:e,networkID:A,priceMap:j}){let t=_6(e);return{amount:t,amountUsd:ej(A,t,j),pct:0}}},nF=({priceMap:e})=>{let{currentQuote:A}=iA(),t=$(o=>o.sellFungible)?.data.chain.id??tA.Solana.Mainnet;return{nonIncludedFees:(0,oF.useMemo)(()=>A&&dA(A)?rC.calculate({currentQuote:A,networkID:t,priceMap:e}):tC.calculate(),[t,A,e])}};n();s();var sF=q(P());var oC={calculate({currentQuote:e,networkID:A,priceMap:j}){let t=(e?.fees??[]).find(r=>r.name==="Token account deposits");return{amount:new w(t?.amount??0),amountUsd:t?.amount?ej(A,new w(t.amount),j):null,pct:t?.percentage??0}}},nC={calculate(){return nr}},iF=({priceMap:e})=>{let{currentQuote:A}=iA(),t=$(o=>o.sellFungible)?.data.chain.id??tA.Solana.Mainnet;return{tokenAccountFee:(0,sF.useMemo)(()=>Wj(A)?oC.calculate({currentQuote:A,networkID:t,priceMap:e}):nC.calculate(),[A,t,e])}};n();s();var aF=q(P());var pF={calculate:({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r})=>{let o=e.amount.plus(A.amount).plus(j.amount);return{amount:o,amountUsd:ej(t,o,r),pct:0}}},sC={calculate:({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r})=>{let o=pF.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r}),i=e.amount.plus(A.maxAmount??0).plus(j.amount);return{...o,maxAmount:i,maxAmountUsd:ej(t,i,r)}}},cF=({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,priceMap:t})=>{let o=$(a=>a.sellFungible)?.data.chain.id??tA.Solana.Mainnet;return{totalFees:(0,aF.useMemo)(()=>I.isEVMNetworkID(o)?sC.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:o,priceMap:t}):pF.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:o,priceMap:t}),[A,o,j,t,e])}};var Oj=()=>{let e=$(B=>B.gasEstimation.isFetching),A=pr(),{data:j={}}=lt({query:{data:A.map(B=>Re(B))}}),{networkFee:t,isFetchingGasEstimationPrice:r}=rF({priceMap:j}),o=e||r,{phantomFee:i}=Sh(),{tokenAccountFee:a}=iF({priceMap:j}),{nonIncludedFees:u}=nF({priceMap:j}),{totalFees:c}=cF({tokenAccountFee:a,networkFee:t,nonIncludedFees:u,priceMap:j}),{destinationNetworkFee:l,liquidityFee:m}=jF();return(0,uF.useMemo)(()=>({phantomFee:i,networkFee:t,tokenAccountFee:a,totalFees:c,nonIncludedFees:u,destinationNetworkFee:l,liquidityFee:m,isFetchingFees:o}),[i,t,a,c,u,l,m,o])};n();s();var d7=q(P());var iC=.05,aC=({sellNetworkId:e,buyNetworkId:A,destinationMinRequiredBalance:j,priceMap:t})=>{if(!e||!A||!t)return new w(0);let r=M(Re(I.getChainID(e))),o=M(Re(I.getChainID(A))),i=t[r]?.usd,a=t[o]?.usd;if(!i||!a)return new w(0);let u=kA(j.toNumber(),I.getTokenDecimals(A)),c=ee(u.toNumber(),a),l=bj(c,i,I.getTokenDecimals(e));return new w(l).times(1+iC)},dr=({sellFungible:e,buyFungible:A})=>{let j=e?.data.chain.id,t=A?.data.chain.id,r=t??j,o=xA(j,t),{fungible:i}=vj({key:A?.data.key}),{data:a}=aA(),u=(0,d7.useMemo)(()=>a?.addresses.find(k=>k.networkID===r),[a,r]),l=pr().map(k=>Re(k)),{data:m}=lt({query:{data:l},queryOptions:{refetchInterval:!1}}),{data:B=0}=Sr(u);return(0,d7.useMemo)(()=>{if(i)return new w(0);let k=new w(B);return o?aC({sellNetworkId:j,buyNetworkId:t,destinationMinRequiredBalance:k,priceMap:m}):k},[i,B,o,j,t,m])};n();s();var m7=q(P()),mr=e=>{let A=e?.data.chain.id,{data:j}=aA(),t=(0,m7.useMemo)(()=>j?.addresses.find(o=>o.networkID===A),[j,A]),{data:r=0}=Sr(t);return(0,m7.useMemo)(()=>new w(r),[r])};function k7(){let e=pA(),A=pp(),j=$(lA=>lA.sellFungible)??A,t=$(lA=>lA.buyFungible),r=$(lA=>lA.primaryCurrency),o=$(lA=>lA.isFetchingQuote),i=$(lA=>lA.sellAmount),a=$(lA=>lA.uiSellAmountCryptoInput),u=$(lA=>lA.setSellFungible),c=$(lA=>lA.uiSellAmountLocalFiatInput),l=$(lA=>lA.amountType),m=$(lA=>lA.setSwapFilter),{data:B}=He(),{data:k}=Qe(),f=dp(j),g=j?.data.key,{fungible:E}=vj({key:g}),h=j?.data.chain.id,y=t?.data.chain.id,{totalFees:F}=Oj(),{data:S}=Io({networkID:h}),x=xA(h,y),O=mr(j),v=dr({sellFungible:j,buyFungible:t}),D=j?.data.amount,G=j?j.data.decimals:0,C=(0,Mj.useMemo)(()=>mn({sellFungible:j,totalFees:F.amount,transactionSpeedsToUnitCost:I.isEVMNetworkID(j.data.chain.id)?S:void 0,isBridge:x,minRequiredBalance:{source:O,destination:v},customPriorityFee:wt(B??0),customTip:wt(k??0)}),[j,F.amount,S,x,v,O,B,k]),_=(0,Mj.useMemo)(()=>l==="buy"?new w(a).isLessThanOrEqualTo(new w(C)):i===""?!0:new w(i).isLessThanOrEqualTo(new w(C)),[l,C,i,a]),{currentQuote:V}=iA(),{data:z}=ve({query:{data:U(j)}}),L=z?.usd,{data:R}=ve({query:t?{data:U(t)}:void 0}),W=z0(),Q=Y0(),jA=AF(),Z=W0(),mA=(0,Mj.useCallback)(()=>{let lA=V?.sellAmount?kA(V?.sellAmount,G).toString():i,QA=V?.buyAmount,pe=t?.data.decimals??0,ce=R?.usd;W({buyAmountFromQuote:QA,buyFungibleDecimals:pe,buyFungibleUsdPrice:ce,sellAmountFromQuote:lA,sellFungibleUsdPrice:L})},[V?.sellAmount,V?.buyAmount,G,i,t?.data.decimals,R?.usd,W,L]),cA=(0,Mj.useCallback)(lA=>{Q({fungibleValue:lA,decimals:G,shouldUpdateQuote:!0})},[G,Q]),rA=(0,Mj.useCallback)(lA=>{jA({priceData:z,localFiatValue:lA,decimals:G,shouldUpdateQuote:!0})},[G,z,jA]),{fromUsd:Y}=bA(),sA=(0,Mj.useCallback)(lA=>{m(lA);let QA=w(C).multipliedBy(lA);if(r==="crypto")Q({fungibleValue:QA.toString(),decimals:G,shouldUpdateQuote:!0,shouldTrimLength:!1});else if(L){let pe=ee(Number(QA),L),ce=Y(pe).toString();jA({priceData:z,localFiatValue:ce,decimals:G,shouldUpdateQuote:!0})}},[m,C,r,L,Q,G,jA,z,Y]);(0,Mj.useEffect)(()=>{let lA=Ih(e);if(E){let QA={...E},pe=lA.find(ce=>ce.id===gn(E));pe&&E.data.amount!==pe.amount&&(QA.data={...QA.data,amount:pe.amount}),QA.data.amount!==D&&u(QA)}},[E,D,u,e]),(0,Mj.useEffect)(()=>{l==="buy"&&f&&Z({amount:V?.sellAmount,decimals:G,usdPrice:L})},[l,V?.sellAmount,G,z?.usd,f,L,Z]);let EA=$n();return{maxSellAmount:C,sellFungible:j,notEnoughAssets:!_,uiSellAmountCryptoInput:a,uiSellAmountLocalFiatInput:c,hasMinimumSellAmount:EA,isFetchingQuote:o,handleToggleCurrencyClick:mA,handleFiatAmountInputChange:rA,handleCryptoAmountInputChange:cA,handleSwapFilterClick:sA}}n();s();var lC=q(P());n();s();n();s();var pC=q(lI());var hFA={network:{id:I.solana.mainnetID,name:I.solana.name,symbol:I.solana.tokenSymbol,imageUrl:I.solana.iconUrl},tokenType:"SolanaNative",symbol:"",logoUri:"",tokenAddress:"",amount:"",amountUsd:0};n();s();var oj=q(P());n();s();var dC=50,lF=({includeOwnedAssets:e,sellAsset:A,sellCaip19:j,ownedAssets:t,searchAssets:r})=>{if(!e||!A)return r;let o=B=>M(U(B)),i=o(A)??j,a=A.data.chain.id??(j&&GA(j).chainId),u=t.filter(B=>o(B)!==i&&I.compareNetworkID(a,B.data.chain.id)===0&&B.type!=="CompressedSPL").slice(0,dC-1),c=u.map(B=>[o(B),B]),l=new Map(c),m=r.filter(B=>!l.has(o(B)));return[...u,...m]};function mC({enableQuery:e=!0,chainFilter:A,sellCaip19:j}={}){let t=(0,oj.useMemo)(()=>j?GA(j):void 0,[j]),{sellFungible:r,searchQuery:o,setSearchQuery:i,setNumSearchResults:a}=$(),u=ra(o,150),{fungibles:c,isLoadingTokens:l,isRefetchingTokens:m,tokensError:B}=$j(),k=$t(),[f,g]=(0,oj.useState)(""),{data:E}=aA(),h=(0,oj.useMemo)(()=>E?.addresses??[],[E]),{data:y,isSuccess:F,isFetching:S,error:x}=Xr({query:u,networkIds:A?[A]:[t?.chainId??r?.data.chain.id??I.solana.mainnetID],enableQuery:e,keepPreviousData:!0,searchContext:"swapper",supportedNetworkIds:k,chainAddresses:h}),O=!F&&S,v=(0,oj.useMemo)(()=>c.filter(z=>z.type!=="CompressedSPL").map(z=>[M(U(z)),z]),[c]),D=(0,oj.useMemo)(()=>{let z=Vm(v.map(([R])=>R).join("~")),L=Wi(z);return co(L)},[v]),G=(0,oj.useMemo)(()=>new Map(v),[D]),C=(0,oj.useMemo)(()=>{if(!y||y.length===0)return[];g(Aj());let z=y.reduce((L,R)=>{let W="";if(Ae(R.type)){if(r&&Ae(r.type)&&R.data.chain.id===r.data.chain.id||t&&t.chainId===R.data.chain.id&&t.resourceType==="nativeToken")return L;W=M(Re(I.getChainID(R.data.chain.id)))}else{if(r&&R.data.tokenAddress===r.data.tokenAddress&&!A||t&&t.chainId===R.data.chain.id&&t.resourceType==="address"&&t.address===R.data.tokenAddress)return L;W=M(U(R))}let Q,jA=G.get(W);return jA&&jA.data.balance?Q=jA:Q=R,Q&&L.push(Q),L},[]);return a(z.length),z},[G,y,r,a,A,t]),_=J();(0,oj.useEffect)(()=>{F&&C.length===0&&_.capture("swapperNullSearchResult",{data:{searchQuery:u}})},[F,C,u,_]);let V=(0,oj.useMemo)(()=>lF({includeOwnedAssets:!u,sellAsset:r,sellCaip19:j,ownedAssets:c,searchAssets:C}),[u,c,C,r,j]);return(0,oj.useMemo)(()=>({assets:V,initialFilterKey:A??r?.data.chain.id??t?.chainId,isLoading:l||O,isFetching:l||O||m,error:B??x,searchRef:f,setSearchQuery:i}),[V,l,O,m,B,x,r,f,i,t?.chainId,A])}n();s();var me=q(P()),mF=q(In());n();s();var mp="https://help.phantom.com/hc/en-us/articles/27085326202515";var kC=[.3,.5,1],BC=kC.map(e=>`${e}%`),fC=[...BC,"custom"],xn=[.5,1,2],gC=xn.map(e=>`${e}%`),EC=[...gC,"custom"],kF=fC.length-1,yC=5,hC=2,B7=.1,f7=30,FC=2,dF=(e,A)=>{if(!e)return;let j=parseFloat(e);if(isNaN(j))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(j>f7)return{message:A("swapSlippageSettingsCustomMaxError",{maxSlippage:f7}),severity:"critical"};if(j>FC)return{message:A("swapSlippageSettingsHighSlippageWarning"),severity:"warning"};if(j<B7)return{message:A("swapSlippageSettingsCustomMinError",{minSlippage:B7}),severity:"critical"}},SC=e=>e&&xn.indexOf(e)!==-1?xn.indexOf(e):e?kF:1,wC=e=>e&&xn.indexOf(e)===-1?`${e}`:"",bC=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=bt(),{mutateAsync:o}=K6(),{selectedSetting:i,isFetched:a,setSlippageSetting:u}=MA(),[c,l]=(0,me.useState)(i.type),m=(0,mF.default)(a),[B,k]=(0,me.useState)(!1),[f,g]=(0,me.useState)(0),[E,h]=(0,me.useState)(),[y,F]=(0,me.useState)(""),[S,x]=(0,me.useState)(),O=c==="auto",v=f===kF,D=O?!1:S?.severity==="critical"||v&&!y;(0,me.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let G=(0,me.useCallback)(R=>{if(f===R)return;x(void 0),g(R);let W=xn;W[R]?(h(W[R]),F("")):h(void 0)},[f]),C=(0,me.useCallback)(R=>{let W=De(R.substring(0,yC)),Q=ze(W,hC),jA=parseFloat(Q);if(isNaN(jA)){x(void 0),F("");return}F(Q),x(dF(Q,A))},[A]),_=(0,me.useCallback)(()=>{if(O)j.capture("slippageChanged",{data:{slippageType:"auto"}});else if(v){let R=parseFloat(y??"");o(R),j.capture("slippageChanged",{data:{slippageValue:R,slippageType:"custom"}}),h(void 0)}else E&&(o(E),j.capture("slippageChanged",{data:{slippageValue:E,slippageType:"preset"}}),F(""));u({type:c}),e()},[O,u,c,e,v,E,y,o,j]),V=(0,me.useCallback)(()=>{let R=SC(t),W=wC(t),Q=xn;g(R),h(Q[R]),F(W),x(dF(W,A)),l(i.type)},[t,A,i.type]),z=(0,me.useCallback)(()=>{l(c==="auto"?"fixed":"auto")},[c,l]),L=(0,me.useMemo)(()=>({title:A("swapSlippageSettingsTitle"),subtitle:A("swapSlippageSettingsSubtitle",{minSlippage:B7,maxSlippage:f7}),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapSlippageSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,me.useEffect)(()=>{!B&&r&&(V(),k(!0))},[r,B,V]),{options:EC,selectedIndex:f,customSlippageValue:y,i18nStrings:L,error:S,submitDisabled:D,isAutoEnabled:O,autoLearnMoreUrl:mp,onConfirm:_,onDismiss:e,onSelectOption:G,onChangeCustomSlippage:C,onResetToDefault:V,onToggleAutoSlippage:z}};n();s();var se=q(P()),fF=q(In());var g7={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},BF=(e,A,j)=>{let t=parseFloat(e);if(isNaN(t))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(t>j.max)return{message:A("swapPriorityFeeSettingsCustomMaxError",{maxPriorityFee:j.max}),severity:"critical"};if(t<j.min)return{message:A("swapPriorityFeeSettingsCustomMinError",{minPriorityFee:j.min}),severity:"critical"};if(t>j.high)return{message:A("swapPriorityFeeSettingsHighFeeWarning"),severity:"warning"};if(t<j.low)return{message:A("swapPriorityFeeSettingsLowFeeWarning"),severity:"warning"}},IC=()=>{let[e,A]=(0,se.useState)(g7.bounds);return(0,se.useEffect)(()=>{(async()=>{try{let t=await na({accounts:[],transactionType:"Swap"});A({min:t.min,low:t.low,high:t.high,max:t.max})}catch(t){b.captureError(t instanceof Error?t:new Error("Unable to fetch priority fee bounds."),"swapper")}})()},[]),e},$C=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=He(),{mutateAsync:o}=nh(),{selectedSetting:i,isFetched:a,setPriorityFeeSetting:u}=Hr(),[c,l]=(0,se.useState)(i.type),m=(0,fF.default)(a),[B,k]=(0,se.useState)(!1),[f,g]=(0,se.useState)(""),[E,h]=(0,se.useState)("$0"),[y,F]=(0,se.useState)(),S=c==="auto",x=S?!1:y?.severity==="critical"||!f,O=IC(),v=Re("solana"),{data:D}=ve({query:{data:v}}),G=D?.usd;(0,se.useEffect)(()=>{if(!G)return;let R=ee(Number(f),G);h(`$${R.toString()}`)},[f,G]),(0,se.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let C=(0,se.useCallback)(R=>{let W=De(R.substring(0,g7.input.maxLength)),Q=ze(W,g7.input.maxDecimals);if(isNaN(parseFloat(Q))){F(void 0),g("");return}g(Q),F(BF(Q,A,O))},[A,O]),_=(0,se.useCallback)(()=>{if(S)o(null),b.addBreadcrumb("swapper","Priority fee setting changed to auto.","info"),j.capture("swapperPriorityFeeChanged",{data:{priorityFeeType:"auto"}});else if(f){let R=parseFloat(f??"");o(R),b.addBreadcrumb("swapper",`Priority fee setting changed to custom: ${R} SOL`,"info"),j.capture("swapperPriorityFeeChanged",{data:{priorityFeeValue:R,priorityFeeType:"custom"}})}u({type:c}),e()},[S,u,c,e,f,o,j]),V=(0,se.useCallback)(()=>{let R=t?`${t}`:"";g(R),F(BF(R,A,O)),l(i.type)},[t,A,i.type,O]),z=(0,se.useCallback)(()=>{l(c==="auto"?"fixed":"auto"),g("")},[c,l]),L=(0,se.useMemo)(()=>({title:A("swapPriorityFeeSettingsTitle"),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapPriorityFeeSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,se.useEffect)(()=>{!B&&r&&(V(),k(!0))},[r,B,V]),{customPriorityFeeValue:f,customPriorityFeeValueInDollars:E,i18nStrings:L,error:y,submitDisabled:x,isAutoEnabled:S,onConfirm:_,onDismiss:e,onChangeCustomPriorityFee:C,onResetToDefault:V,onToggleAutoPriorityFee:z}};n();s();var ie=q(P()),EF=q(In());var E7={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},gF=(e,A,j)=>{let t=parseFloat(e);if(isNaN(t))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(t>j.max)return{message:A("swapTipSettingsCustomMaxError",{maxTip:j.max}),severity:"critical"};if(t<j.min)return{message:A("swapTipSettingsCustomMinError",{minTip:j.min}),severity:"critical"};if(t>j.high)return{message:A("swapTipSettingsHighFeeWarning"),severity:"warning"};if(t<j.low)return{message:A("swapTipSettingsLowFeeWarning"),severity:"warning"}},vC=()=>{let[e,A]=(0,ie.useState)(E7.bounds);return(0,ie.useEffect)(()=>{(async()=>{try{let t=await na({accounts:[],transactionType:"Swap"});A({min:t.min,low:t.low,high:t.high,max:t.max})}catch(t){b.captureError(t instanceof Error?t:new Error("Unable to fetch tip bounds."),"swapper")}})()},[]),e},qC=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=Qe(),{mutateAsync:o}=sh(),{selectedSetting:i,isFetched:a,setTipSetting:u}=kn(),[c,l]=(0,ie.useState)(i.type),m=(0,EF.default)(a),[B,k]=(0,ie.useState)(!1),[f,g]=(0,ie.useState)(""),[E,h]=(0,ie.useState)("$0"),[y,F]=(0,ie.useState)(),S=c==="auto",x=S?!1:y?.severity==="critical"||!f,O=vC(),v=Re("solana"),{data:D}=ve({query:{data:v}}),G=D?.usd;(0,ie.useEffect)(()=>{if(!G)return;let R=ee(Number(f),G);h(`$${R.toString()}`)},[f,G]),(0,ie.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let C=(0,ie.useCallback)(R=>{let W=De(R.substring(0,E7.input.maxLength)),Q=ze(W,E7.input.maxDecimals);if(isNaN(parseFloat(Q))){F(void 0),g("");return}g(Q),F(gF(Q,A,O))},[A,O]),_=(0,ie.useCallback)(()=>{if(S)o(null),b.addBreadcrumb("swapper","Tip setting changed to auto.","info"),j.capture("swapperTipChanged",{data:{tipType:"auto"}});else if(f){let R=parseFloat(f??"");o(R),b.addBreadcrumb("swapper",`Tip setting changed to custom: ${R} SOL`,"info"),j.capture("swapperTipChanged",{data:{tipValue:R,tipType:"custom"}})}u({type:c}),e()},[S,u,c,e,f,o,j]),V=(0,ie.useCallback)(()=>{let R=t?`${t}`:"";g(R),F(gF(R,A,O)),l(i.type)},[t,A,i.type,O]),z=(0,ie.useCallback)(()=>{l(c==="auto"?"fixed":"auto"),g("")},[c,l]),L=(0,ie.useMemo)(()=>({title:A("swapTipSettingsTitle"),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapTipSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,ie.useEffect)(()=>{!B&&r&&(V(),k(!0))},[r,B,V]),{customTipValue:f,customTipValueInDollars:E,i18nStrings:L,error:y,submitDisabled:x,isAutoEnabled:S,onConfirm:_,onDismiss:e,onChangeCustomTip:C,onResetToDefault:V,onToggleAutoTip:z}};n();s();var Zr=q(P());n();s();var hF=q(P());n();s();function yF(){return[new y7,new F7,new h7]}var y7=class{isEditable({sellAsset:A}){return!!A&&I.isSolanaNetworkID(A.data.chain.id)}},h7=class{isEditable({currencyDenomination:A}){return A==="crypto"}},F7=class{isEditable({sellAsset:A,buyAsset:j}){return!xA(A?.data.chain.id,j?.data.chain.id)}};var Fi=({sellAsset:e,buyAsset:A,currencyDenomination:j})=>{let t=CA("enable-swapper-exact-out"),r=(0,hF.useMemo)(()=>yF(),[]);return!A||!t?!1:r.every(o=>o.isEditable({sellAsset:e,buyAsset:A,currencyDenomination:j}))};n();s();var FF=q(P());n();s();var S7=class{isSupported(A,j,t,r,o){switch(A){case"sell":return!!(t&&o);case"buy":return!1}}},w7=class{isSupported(A){return A!=="buy"}};function kp(){return[new S7,new w7]}var Bp=(e,A,j,t,r)=>(0,FF.useMemo)(()=>kp(),[]).every(i=>i.isSupported(e,A,j,t,r));var xC=We?[.25,.5,1]:[.5,1],SF=We?Qr("full"):Qr("compactNoSymbol"),wF=We?Rd("full"):Rd("compact"),TC={chainId:tA.Solana.Mainnet,slip44:"501",resourceType:"nativeToken"},PC=()=>{let A=$(sA=>sA.amountType)==="sell"?"sell":"buy",j=$(sA=>sA.primaryCurrency),{currencySymbol:t,toUsd:r}=bA(),o=j==="fiat"?t:void 0,i=$(sA=>sA.swapFilter),a=$(sA=>sA.setSwapFilter),u=ta(),{handleCryptoAmountInputChange:c,handleFiatAmountInputChange:l,sellFungible:m,uiSellAmountCryptoInput:B,isFetchingQuote:k,notEnoughAssets:f,hasMinimumSellAmount:g,handleToggleCurrencyClick:E,uiSellAmountLocalFiatInput:h,handleSwapFilterClick:y,maxSellAmount:F}=k7(),S=$(sA=>sA.buyFungible),x=S?U(S):TC,O=$F(x),v=$F(U(m)),D=Bp("sell",m,v,S,O),G=(0,Zr.useMemo)(()=>({fungible:m,perspective:"sell",amount:j==="crypto"?B:h,secondaryCryptoSubtitle:j==="fiat"?bF(r(h),m,wF,v):void 0,balance:IF(m,SF,u,F),isAmountLoading:k&&A!=="sell",isSecondaryCryptoSubtitleLoading:k,isWarning:f||!g,isAmountEditable:!0,supportsCurrencyDenominationSwitching:D,amountPrefix:o,filters:xC,selectedFilter:i,warnings:[],usdAmount:v?ee(Number(B),v):0}),[m,j,B,h,v,u,F,k,A,f,g,D,o,i,r]),{handleSwitchTokensClick:C,cryptoAmountInputValue:_,localFiatAmountInputValue:V,handleCryptoAmountInputChange:z}=l7(),L=Bp("buy",m,v,S,O),R=Fi({sellAsset:m,buyAsset:S,currencyDenomination:j}),W=xA(m?.data.chain.id,S?.data.chain.id),Q=S?.data.chain.id,{fungible:jA}=vj({key:Q?vo(Q,void 0):void 0}),Z=(0,Zr.useMemo)(()=>{if(S)return{fungible:S,perspective:"buy",balance:IF(S,SF,u),amount:j==="crypto"?_:V,secondaryCryptoSubtitle:j==="fiat"?bF(r(V),S,wF,O):void 0,isAmountLoading:k&&A!=="buy",isSecondaryCryptoSubtitleLoading:k,isWarning:!1,isAmountEditable:R,supportsCurrencyDenominationSwitching:L,amountPrefix:o,filters:[],selectedFilter:void 0,warnings:Ur(S,W?jA:void 0),usdAmount:O?ee(Number(_),O):0}},[S,u,j,_,V,O,k,A,R,L,o,r,W,jA]),mA=(0,Zr.useCallback)((sA,EA)=>{switch(a(void 0),sA){case"sell":j==="crypto"?c(EA):l(EA);break;case"buy":if(j==="fiat")return;z(EA);break}},[a,j,c,l,z]),cA=J(),rA=(0,Zr.useCallback)(async()=>{A==="sell"&&(E(),await cA.capture("swapperToggleQuoteCurrency",{data:{value:j==="fiat"?"native":"fiat"}}))},[A,cA,j,E]),Y=(0,Zr.useCallback)((sA,EA)=>{EA==="sell"&&y(sA)},[y]);return{switchPerspective:C,sell:G,buy:Z,setAmount:mA,switchCurrencyDenomination:rA,setFilter:Y,currencyDenomination:j}};function bF(e,A,j,t){let r=A.data?.symbol??"",o=Number(e);return t?j.format(o,A,t):`0 ${r}`}function IF(e,A,j,t){let r=t?w(t):e.data?.balance;if(!(!r||j))return A.format(r,e.data?.symbol??"")}var $F=e=>{let{data:A}=ve({query:{data:e}});return A?.usd};n();s();var GC=["lastSubmittedPairsV2","slippageTolerance"],b7=e=>{let A=String(e.queryKey[1]);return GC.includes(A)};n();s();var CC=q(P());n();s();var vF=q(P());function I7(e){let{t:A}=hA();return(0,vF.useMemo)(()=>{let{networkFee:j,phantomFee:t,tokenAccountFee:r,nonIncludedFees:o,destinationNetworkFee:i,liquidityFee:a}=e;return{networkFee:{label:A("swapQuoteNetwork"),valueUsd:j.amountUsd,maxValueUsd:j.maxAmountUsd},bridgeFee:{label:A("swapQuoteBridgeFee"),valueUsd:o.amountUsd,maxValueUsd:o.maxAmountUsd},tokenAccountFee:{label:A("swapQuoteOneTimeTokenAccount"),valueUsd:r.amountUsd},phantomFeePercent:{label:t.pct?A("swapQuoteFeeDisclaimer",{feePercentage:us(t.pct)}):"",value:t.pct?`${t.pct}`:""},destinationNetworkFee:{label:A("swapQuoteDestinationNetwork"),valueUsd:i.amountUsd},liquidityProviderFee:{label:A("swapQuoteLiquidityProvider"),valueUsd:a.amountUsd}}},[e,A])}n();s();var qF=q(P());function OC(){let e=J(),A=$(m=>m.buyFungible),j=$(m=>m.sellFungible),t=$(m=>m.setBuyFungible),r=$(m=>m.setSellFungible),o=$(m=>m.setSellAmount),i=$(m=>m.setUiSellAmountCryptoInput),a=$(m=>m.resetQuote),u=$(m=>m.setSwapFilter),c=j?.data.amount,{cancelQuotes:l}=up();return(0,qF.useCallback)(async m=>{if(j&&Wr(m,j)){m&&m.data.amount!==c&&(r(m),u(void 0));return}await l();let B=St(m);e.capture("swapperUpdateFromAsset",{data:B}),r(m),u(void 0),A&&j&&Wr(m,A)&&t(j),m&&j?.data.chain.id!==m.data.chain.id&&(a(),t(void 0),o(""),i(""))},[e,A,l,c,a,j,t,o,r,u,i])}n();s();var OF=q(P());n();s();var kr=q(P());n();s();n();s();n();s();var fp=class{sections(A){let j=It().map(o=>o.programId),t=A.reduce((o,i)=>{if(la({minimum:"VERIFIED",spamStatus:i.data.spamStatus}))return o.verified.push(i),o;if(i.type!=="SPL"||!i.data.ugcTokenMeta||i.data.ugcTokenMeta.status==="graduated"||!j.includes(i.data.ugcTokenMeta.programId))return o.unverified.push(i),o;let a=i.data.ugcTokenMeta.programId,u=o[a]??[];return u.push(i),o[a]=u,o},{verified:[],unverified:[]}),r=It().map(o=>{let i=t[o.programId]??[];return{id:o.programId,header:{title:T.t("swapSectionTitleTokens",{section:o.name}),iconUrl:o.iconUrl},data:i,behavior:"collapsible"}});return[{id:"verified",data:t.verified,behavior:"static"},{id:"unverified",header:{title:T.t("swapUnverifiedTokens")},data:t.unverified,behavior:"collapsible"},...r]}};function xF(){return new fp}n();s();var PF=q(P());n();s();var gp=q(P());var TF=()=>{let{data:e}=ne({key:"lastSelectedTokens",queryKey:uA.lastSelectedTokens()}),A=(0,gp.useMemo)(()=>e?JSON.parse(e):{},[e]),{mutateAsync:j}=le({key:"lastSelectedTokens",queryKey:uA.lastSelectedTokens()}),t=(0,gp.useCallback)(async r=>{let o={...A,[r]:!0};await j(JSON.stringify(o))},[A,j]);return{lastSelectedTokens:A,storeSelectedToken:t}};n();s();var Ep=class{constructor(A,j){this.lastSelectedTokens=A;this.storeSelectedToken=j}intercept(A){let j=M(U(A));return this.lastSelectedTokens[j]||this.storeSelectedToken(j),"continue"}};n();s();n();s();var yp=class{constructor(A){this.lastSelectedTokens=A}intercept(A,j){switch(A.type){case"SPL":{let t=M(U(A)),r=this.lastSelectedTokens[t];return A.data.ugcTokenMeta?.status==="preDeploy"&&!r?(D0(A),j("ugcWarning"),"interrupt"):"continue"}default:return"continue"}}};function DC({lastSelectedTokens:e,storeSelectedToken:A}){return[new Ep(e,A),new yp(e)]}function GF(){let{lastSelectedTokens:e,storeSelectedToken:A}=TF();return(0,PF.useMemo)(()=>DC({lastSelectedTokens:e,storeSelectedToken:A}),[e,A])}var CF=(0,kr.createContext)(void 0),NC=({children:e})=>{let A=(0,kr.useMemo)(()=>xF(),[]),j=GF();return kr.default.createElement(CF.Provider,{value:{buyAssetSectionAdapter:A,interceptors:j}},e)},Si=()=>{let e=(0,kr.useContext)(CF);if(!e)throw new Error("useSwapAssetSelect must be used within a SwapAssetSelectProvider");return e};var LC=()=>{let{interceptors:e}=Si();return{executeInterceptors:(0,OF.useCallback)((j,t)=>{for(let r of e)if(r.intercept(j,t)==="interrupt")return"interrupt";return"continue"},[e])}};n();s();var Ao=q(P());var MF=3;function $7(e){return{id:e.id,data:e.data,...e.header?{header:e.header}:{}}}var KC=e=>{let[A,j]=(0,Ao.useState)({}),t=(0,Ao.useCallback)((i,a)=>j(u=>({...u,[i]:a})),[]),{buyAssetSectionAdapter:r}=Si(),o=(0,Ao.useMemo)(()=>r.sections(e),[r,e]);return(0,Ao.useMemo)(()=>o.map(i=>{switch(i.behavior){case"static":return $7(i);case"collapsible":{if(i.data.length<=MF)return $7(i);let a=A[i.id],u=a?i.data:i.data.slice(0,MF),c=()=>t(i.id,!a),l=$7(i);return{...l,header:{...l.header,button:{label:a?T.t("commandShowLess"):T.t("commandShowMore"),onClick:c}},data:u}}}}),[o,A,t])};n();s();n();s();var wi=({networkID:e,txReceipt:A,preferredExplorers:j})=>{let t=A?.id??"";if(!t)return;let r=j?.explorers[e];return vk({networkID:e,endpoint:"transaction",explorerType:r,param:t})};n();s();n();s();var xt=q(P());n();s();function RF(e,A){if(A){let j=HC(e),t=VC(e,A),r=zC(e,A);return{notEnoughSol:A.message==="NotEnoughSol",txErrorTitle:j,txErrorMessage:t,txErrorHelpButtonLink:r}}return{notEnoughSol:!1,txErrorTitle:"",txErrorMessage:"",txErrorHelpButtonLink:""}}var HC=e=>e?T.t("swapTxBridgeFailed"):T.t("swapTxConfirmationSwapFailed"),QC=e=>{switch(e.message){case"LedgerConnectionError":return T.t("swapTxConfirmationSwapFailedLedgerConnectionError");case"LedgerRejectAction":return T.t("swapTxConfirmationSwapFailedLedgerReject");case"LedgerUnknownSignError":return T.t("swapTxConfirmationSwapFailedLedgerSignError");case"LedgerUnknownError":return T.t("swapTxConfirmationSwapFailedLedgerError");default:return null}},VC=(e,A)=>{let j=QC(A);if(j!==null)return j;if(e)switch(A.message){case"slippageToleranceExceeded":return T.t("swapTxConfirmationSwapFailedSlippageLimit");default:return T.t("swapTxBridgeFailedDescription")}else switch(A.message){case"INSUFFICIENT_FUNDS":return T.t("swapTxConfirmationSwapFailedInsufficientBalance");case"slippageToleranceExceeded":return T.t("swapTxConfirmationSwapFailedSlippageLimit");case"EmptyRoute":return T.t("swapTxConfirmationSwapFailedEmptyRoute");case"AccountFrozen":return T.t("swapTxConfirmationSwapFailedAcountFrozen");case"SIMULATION_TIMEOUT":return T.t("swapTxConfirmationSwapFailedSimulationTimeout");case"INSUFFICIENT_GAS":return T.t("swapTxConfirmationSwapFailedInsufficientGas");case"Scan results are not valid":return T.t("swapTxConfirmationSwapFailedUnknownError");case"STALE_QUOTE":return T.t("swapTxConfirmationSwapFailedStaleQuote");case"SimulationUnknownError":return T.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return T.t("swapTxConfirmationSwapFailedTryAgain")}},zC=(e,A)=>e?O6:A.message==="AccountFrozen"?Vy:O6;n();s();var _F=({sellAmount:e,sellFungible:A,buyAmount:j,buyFungible:t,txStatus:r,txReceipt:o,swapTransactions:i,isReadyToExecute:a,uiEstimatedTime:u,isBridge:c,isLedger:l,notEnoughSol:m,txError:B,txErrorTitle:k,txErrorMessage:f,explorerUrl:g,txErrorHelpButtonLink:E,addressType:h})=>{let y=kA(e,A?.data.decimals??0).toNumber(),F=kA(j,t?.data.decimals??0).toNumber(),S=r==="success",x=r==="error",O=!!o,v=i?.transactions.length||0;return{sellAsset:{amount:y,symbol:A?.data.symbol??"",networkID:A?.data.chain.id??tA.Solana.Mainnet},buyAsset:{amount:F,symbol:t?.data.symbol??"",networkID:t?.data.chain.id??tA.Solana.Mainnet},estimatedTime:u,isBridge:c,isSuccess:S,isFailure:x,isLedger:l,isClosable:O,notEnoughSol:m,txError:B,txErrorTitle:k,txErrorMessage:B?.detailMessage?`${f}

${B?.detailMessage}`:f,txLink:g??"",txErrorHelpButtonLink:E,numberOfTransactions:v,isReadyToExecute:a,addressType:h}};var v7=({sellFungible:e,txReceipt:A,swapTransactions:j,isBridge:t,txError:r,txStatus:o,isReadyToExecute:i,isLedger:a})=>{let u=e?.data.chain.id??tA.Solana.Mainnet,{notEnoughSol:c,txErrorTitle:l,txErrorMessage:m,txErrorHelpButtonLink:B}=(0,xt.useMemo)(()=>RF(t,r),[t,r]),k=(0,xt.useMemo)(()=>I.getAddressType(u),[u]),{currentQuote:f}=iA(),[g]=(0,xt.useState)(f),{buyAmount:E,sellAmount:h}=g??{buyAmount:"0",sellAmount:"0"},y=$(v=>v.buyFungible),{data:F}=xk(),S=(0,xt.useMemo)(()=>wi({txReceipt:A,networkID:u,preferredExplorers:F}),[A,u,F]),x=(0,xt.useMemo)(()=>ki(g),[g]);return(0,xt.useCallback)(()=>_F({sellFungible:e,txReceipt:A,addressType:k,swapTransactions:j,isBridge:t,txError:r,sellAmount:h,buyAmount:E,buyFungible:y,txStatus:o,isReadyToExecute:i,uiEstimatedTime:x,isLedger:a,notEnoughSol:c,txErrorTitle:l,txErrorMessage:m,explorerUrl:S,txErrorHelpButtonLink:B}),[e,A,k,j,t,r,h,E,y,o,i,x,a,c,l,m,S,B])()};n();s();var nj=q(P());n();s();var Tn=q(P());var eo=()=>{let e=J(),A=cr(),{currentQuote:j,quoteResponse:t,selectedProviderIndex:r,selectedBaseProvider:o}=iA(),{analyticsContext:i}=j??{analyticsContext:void 0},a=$(v=>v.buyFungible),u=$(v=>v.sellFungible),c=$(v=>v.buyUsdValue),l=$(v=>v.sellUsdValue),m=$(v=>v.swapFilter),{selectedSetting:B}=MA(),k=$.getState().amountType,f=u?.data.chain.id??tA.Solana.Mainnet,g=Oj(),{transition:E}=vt(),h=(0,Tn.useCallback)(v=>{let D=ur(r,B.type,t);return V6({buyToken:a,sellToken:u,buyAmount:j?.buyAmount.toString()??"",sellAmount:j?.sellAmount.toString()??"",phantomFeeUiAmount:g.phantomFee.amountUsd?.toString()??"",priceImpact:ar(j),provider:vA(OA(j)),baseProvider:o,buyAssetUsdValue:c,sellAssetUsdValue:l,slippageTolerance:D,transactionId:v??"",slippageType:B.type,sellSwapFilter:m,analyticsContext:i})},[a,u,j,g.phantomFee.amountUsd,c,l,t,r,B.type,m,i,o]),y=(0,Tn.useCallback)(v=>{z6({txReceipt:v,networkID:f,amountType:k,swapAnalytics:A})},[f,k,A]),F=(0,Tn.useCallback)((v,D)=>{E({type:"transactionSubmissionFailed",error:v}),v.message!=="Scan results are not valid"&&v.message!=="slippageToleranceExceeded"&&b.captureError(v,"swapper");let G=h(D);e.capture("swapperSwapFailure",{data:{...G.data,error:v.message}})},[e,h,E]),S=()=>{e.capture("swapperSwapFailureNoSignature")},x=(0,Tn.useCallback)(v=>{let D=h(v.id);e.capture("swapperSwapSuccess",D);let G=Lt(v.networkID);b.addBreadcrumb("swapper","transactionStatus","info",{...G,txReceipt:v.id}),(G.chainType==="eip155"||G.chainType==="solana"||G.chainType==="sui")&&A.transactionStatus(v.id,{...G,status:{type:"confirmed"}})},[e,h,A]),O=(0,Tn.useCallback)((v,D)=>{let G=v?.networkID?Lt(v.networkID):null;(G?.chainType==="eip155"||G?.chainType==="solana"||G?.chainType==="sui")&&v?.id&&(b.addBreadcrumb("swapper","transactionStatus","error",{...G,txReceipt:v.id}),A.transactionStatus(v.id,{...G,status:{type:"error"}}),E({type:"transactionConfirmationFailed",error:D,txReceipt:v}))},[A,E]);return{logTransactionSubmitted:y,logTransactionSubmissionError:F,logSwapFailureNoSignature:S,logTransactionConfirmed:x,logTransactionConfirmationFailed:O}};n();s();var LF=q(P());n();s();var bi=()=>{let{selectedSetting:e}=MA(),{selectedProviderIndex:A,quoteResponse:j}=iA(),t=ur(A,e.type,j),{data:r}=bt();return{slippageSetting:e,slippageTolerance:t??r??void 0}};n();s();n();s();var hp=q(P());n();s();var q7="swap-validation",DF=({scanResult:e,scanResultError:A,quote:j,sellToken:t,buyToken:r})=>{if(A)return"valid";if(!j||!t||!r)return b.addBreadcrumb(q7,`Missing necessary args: ${JSON.stringify({quote:!!j,scanResult:!!e,sellToken:t,buyToken:r})}`,"info"),new SA("MissingArgument");if(e?.error===ut.SIMULATION_FAILED)return"valid";if(e?.error){if(b.addBreadcrumb(q7,`Simulation error: ${JSON.stringify({error:e.error})}`,"info"),e.error===ut.SLIPPAGE_EXCEEDED)return new SA("slippageToleranceExceeded");if(e.error===ut.INSUFFICIENT_FUNDS)return new SA("INSUFFICIENT_FUNDS");if(e.error===ut.INSUFFICIENT_GAS)return new SA("INSUFFICIENT_GAS");if(e.error===ut.ACCOUNT_FROZEN)return new SA("AccountFrozen");if(e.error===ut.SIMULATION_TIMEOUT)return new SA("SIMULATION_TIMEOUT");if(e.error===ut.STALE_QUOTE)return new SA("STALE_QUOTE");if(e.error===ut.UNKNOWN_ERROR){let o=XC(e);return new SA("SimulationUnknownError",o)}return new SA("Scan results are not valid")}return e?"valid":(b.addBreadcrumb(q7,`Missing necessary args: ${JSON.stringify({quote:!!j,scanResult:!1,sellToken:t,buyToken:r})}`,"info"),new SA("MissingArgument"))};function XC(e){return e.simulationError?e.simulationError.humanReadableError:e.warnings[0]?.message}var NF=({swapTransactions:e})=>{let A=$(g=>g.sellFungible),j=$(g=>g.buyFungible),t=A?.data.chain.id??tA.Solana.Mainnet,{selectedSetting:r}=MA(),{currentQuote:o,quoteResponse:i}=iA(),a=vA(OA(o)),u=xA(A?.data.chain.id,j?.data.chain.id),c=i?.buyToken?M(i?.buyToken):void 0,l=i?.sellToken?M(i?.sellToken):void 0,m={type:"transaction",userAccount:A?.data.walletAddress??"",params:void 0,url:"https://phantom.com",networkID:t,context:u?"bridge":"swap",provider:a,slippageType:r.type,metadata:{swapper:{quoteOutputAmount:o?.buyAmount,quoteOutputToken:c,quoteInputAmount:o?.sellAmount,quoteInputToken:l}}};e?.type==="evm"&&I.isEVMNetworkID(t)&&(m.params={transactions:e.transactions}),e?.type==="solana"&&I.isSolanaNetworkID(t)&&(m.params={transactions:e.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}});let{transition:B}=vt(),k=(0,hp.useCallback)((g,E)=>{E&&B({type:"simulationRequestError",error:E}),g&&B({type:"simulationResponseReceived",scannedTransactionResult:g})},[B]),f=gi(m,{disableRefetch:!0,onSettled:k,disabled:e?.type==="sui"});return(0,hp.useMemo)(()=>{if(f.isLoading)return{isLoading:!0,state:"loading"};if(e?.type==="sui")return{isLoading:!1,state:"valid"};let g=DF({scanResult:f.data,scanResultError:f.isError,quote:o,sellToken:i?.sellToken,buyToken:i?.buyToken,simulationTolerance:i?.simulationTolerance});return{isLoading:f.isLoading,state:g}},[f,o,i,e?.type])};function KF({isBridge:e,addressType:A,isSwapSimulationDisabled:j,onTransactionReceiptReceived:t,onTransactionSubmissionError:r,resetToInitialState:o,sender:i}){let{logTransactionSubmitted:a,logSwapFailureNoSignature:u}=eo(),{connection:c}=cj(),{data:l}=aA(),{currentQuote:m,quoteResponse:B}=iA(),{slippageTolerance:k}=bi(),f=$(C=>C.gasEstimation.estimateWithBuffer),g=$(C=>C.sellFungible),E=g?.data.chain.id??tA.Solana.Mainnet,{data:h,isSuccess:y}=Jj({callerAddress:i,quote:m,sellFungible:g}),F=NF({swapTransactions:h}),{pendingActivityRows:S}=eE({sender:i}),{mutateAsync:x}=u7({accountIdentifier:l?.identifier??"",networkID:E}),[O,v]=(0,LF.useState)(!1),D=async()=>(v(!0),vy({isBridge:e,addressType:A,isSwapSimulationDisabled:j,sender:i,currentQuote:m,quoteResponse:B,gasEstimation:f,swapTransactions:h,scanResults:F,pendingActivityRows:S,connection:c,slippageTolerance:k,logSwapFailureNoSignature:u,logTransactionSubmitted:a,swapFungibles:x,onTransactionSubmissionError:r,onTransactionReceiptReceived:t,resetToInitialState:o}));return{isReadyToExecute:O||(!F.isLoading||j)&&y,executeSwap:D}}n();s();var Fp=q(P());var UF=({goToSwapTab:e,goToActivityTab:A})=>{let{resume:j}=Gj(),{clearQuotes:t}=c7(),r=qt(),o=(0,Fp.useCallback)(()=>{j(),t(),e()},[e,j,t]),i=(0,Fp.useCallback)(()=>{j()},[j]),a=(0,Fp.useCallback)(()=>{r(),A()},[A,r]);return{onClose:o,onRetry:i,onSwapSuccess:a}};n();s();function HF(){let{data:[e]}=_A(["kill-swapper-simulation"]);return e}n();s();var Pn=q(P());var QF=({onTransactionConfirmationSuccess:e,onTransactionConfirmationError:A,txReceipt:j})=>{let t=pA(),{data:r}=aA(),o=(0,Pn.useMemo)(()=>r?.addresses??[],[r]),i=aB(o),a=qt(),{logTransactionConfirmed:u,logTransactionConfirmationFailed:c,logTransactionSubmissionError:l}=eo(),m=$(F=>F.sellFungible),{currentQuote:B}=iA(),{sellAmount:k}=B??{sellAmount:"0"},f=iB({wallets:o,encodedCaip19:m?M(U(m)):""}),g=(0,Pn.useCallback)(async F=>{if(u(F),a(),m){let S=new H(m.data.amount),x=new H(k),O=S.minus(x).toString();X6(t,{id:gn(m),amount:O})}i(),f()},[u,a,k,m,i,f,t]),{isSuccess:E,isError:h,error:y}=oB(g,j);(0,Pn.useEffect)(()=>{if(E)e();else if(h){let F=jr(y);A(F),c(j,F),l(F,j?.id)}},[E,h,y,j,c,e,A,l])};function VF({isLedger:e,goToSwapTab:A,goToActivityTab:j}){let{currentQuote:t}=iA(),r=$(Q=>Q.buyFungible),o=$(Q=>Q.sellFungible),i=qt(),a=HF(),{logTransactionSubmissionError:u}=eo(),[c]=(0,nj.useState)(xA(o?.data.chain.id,r?.data.chain.id)),l=o?.data.chain.id??tA.Solana.Mainnet,{data:m}=aA(),B=(0,nj.useMemo)(()=>m?.addresses??[],[m]),k=(0,nj.useMemo)(()=>B.find(Q=>Q.networkID===o?.data.chain.id)?.address??"",[B,o]),f=(0,nj.useMemo)(()=>I.getAddressType(l),[l]),{data:g}=Jj({callerAddress:k,quote:t,sellFungible:o}),[E,h]=(0,nj.useState)(),[y,F]=(0,nj.useState)("loading"),[S,x]=(0,nj.useState)(),O=()=>{F("loading"),x(void 0),h(void 0)},v=Q=>{h(Q)},D=(0,nj.useCallback)((Q,jA)=>{F("error"),x(Q),u(Q,jA)},[u]),G=(0,nj.useCallback)(()=>{F("success")},[]),C=(0,nj.useCallback)(Q=>{F("error"),x(jr(Q))},[]);QF({onTransactionConfirmationSuccess:G,onTransactionConfirmationError:C,txReceipt:y==="error"?void 0:E});let{executeSwap:_,isReadyToExecute:V}=KF({isBridge:c,addressType:f,isSwapSimulationDisabled:a,onTransactionSubmissionError:D,onTransactionReceiptReceived:v,resetToInitialState:O,sender:k}),{onClose:z,onRetry:L,onSwapSuccess:R}=UF({goToSwapTab:A,goToActivityTab:j});return{...v7({sellFungible:o,txReceipt:E,swapTransactions:g,isBridge:c,txStatus:y,isReadyToExecute:V,isLedger:e,txError:S}),executeSwap:_,resetSwapper:i,onClose:z,onRetry:L,onSwapSuccess:R}}n();s();n();s();var zF=q(P()),XF=()=>{let{data:[e]}=_A(["enable-custom-tips"]);return(0,zF.useMemo)(()=>e?"autoWithPriorityFeesAndTips":"autoWithPriorityFees",[e])};n();s();n();s();var WF=q(P());var WC=()=>{let e=TA();return{selectQuote:(0,WF.useCallback)((j,t)=>{let r=j[t];r&&e.selectQuote(r)},[e])}};n();s();var JF=q(P());var JC=async(e,A,j)=>{try{await N.api().post("/swap/v2/presence",{caip19:e,visitorId:A,source:j})}catch(t){throw t instanceof Error&&b.captureError(t,"swapper"),t}},YC=(e,A)=>{let j=J(),t=CA("enable-swapper-presence"),r=(0,JF.useCallback)(async()=>{if(!e||!t)return null;let o=await j.getDeviceId();return await JC(e,o,A),{success:!0,timestamp:Date.now()}},[e,A,j,t]);return X({queryKey:[...uA.presence(e),"post",A],queryFn:r,enabled:!!e&&t,refetchInterval:5e3,gcTime:0,staleTime:0})};n();s();n();s();n();s();n();s();n();s();var sxA=VA(e=>({quoteSpan:void 0,previousBuyAmount:void 0,previousSellAmount:void 0,setQuoteSpan(A){e({quoteSpan:A})},setPreviousBuyAmount(A){e({previousBuyAmount:A})},setPreviousSellAmount(A){e({previousSellAmount:A})}}));n();s();var lxA=VA(e=>({initialLoadSpan:void 0,setInitialLoadSpan(A){e({initialLoadSpan:A})}}));n();s();var AO=q(P());var gxA=["simulationRequestErrored","simulationFailed","transactionSubmissionFailed","transactionNotConfirmed"];n();s();var YF=q(P());var eO=()=>{},x7=e=>{let A=TA(),{connection:j}=cj(),t=wA(),r=Sj(),o=T.language,i=J(),a=pA(),u=cr(),c=MA(),l=Lj(),m=Rt("kill-swapper-simulation")??!1;return(0,YF.useCallback)(async({showFungibleDetails:k,showBuyFungibleScreen:f=eO,showRetrySwap:g,executeSwapStateListeners:E,toastMessageParser:h,uiContext:y="swapperInterstitial",preprocessor:F})=>{let S=new wn(k,f,c,["SLIPPAGE_EXCEEDED"],g,h),x=new En(a,t,l),O=new fn(u,i,y,e),v=new yn(i),D=new hn,G=new Bn(Tj);try{A.subscribeExecution(x),A.subscribeExecution(v),A.subscribeExecution(O),A.subscribeExecution(S),A.subscribeExecution(D),A.subscribeExecution(G),E.forEach(_=>A.subscribeExecution(_));let C=await i.getDeviceId();await A.swap({signer:r,storage:t,locale:o,deviceId:C,connection:j,authRepository:l,isSimulationKilled:m,preprocessor:F})}catch{}finally{A.unsubscribeExecution(x),A.unsubscribeExecution(v),A.unsubscribeExecution(O),A.unsubscribeExecution(S),A.unsubscribeExecution(D),A.unsubscribeExecution(G),E.forEach(C=>A.unsubscribeExecution(C))}},[c,a,u,i,A,r,t,o,j,l,m,e])};n();s();n();s();function ZF(e,A){return{takerCaip19:jO(e,A),takerDestinationCaip19:tO(e,A)}}function jO(e,A){if(e.type==="buy")return A.data.walletAddress?M($o(A)):void 0;if(e.type==="swap")return e.takerCaip19}function tO(e,A){if(e.type==="sell")return A.data.walletAddress?M($o(A)):void 0;if(e.type==="swap")return e.takerDestinationCaip19}var T7=class{getNavigationParams({initiatingSwapMode:A,selectedToken:j,initialSwapAmount:t}){let{takerCaip19:r,takerDestinationCaip19:o}=ZF(A,j);return{swapMode:{type:A.type,buyCaip19:A.type==="buy"?A.buyCaip19:M(U(j)),sellCaip19:A.type==="sell"?A.sellCaip19:M(U(j)),takerCaip19:r,takerDestinationCaip19:o},initialSwapAmount:t}}captureAnalytics(A,j,t){new ir(A).swapperUpdateAsset(t,j)}},P7=class{selectToken({swapper:A,selectedToken:j,currentTokens:t,perspective:r,navigateToSwapper:o,dismiss:i}){let a=r==="sell"?t.buyCaip19:t.sellCaip19;if(this.isSameSelectedToken(a,j))return this.handleTokenSwitch(A,i);if(this.shouldNavigateToNewChain(r,t.sellCaip19,j))return o({sellFungible:j});let c=NA(j)?M($o(j)):void 0;A.changeToken(j,r,c),i()}shouldNavigateToNewChain(A,j,t){return A!=="sell"?!1:GA(j).chainId!==t.data.chain.id}handleTokenSwitch(A,j){A.switchTokens(),j()}isSameSelectedToken(A,j){let t=M(U(j));return A!==t?!1:!NA(j)}},rO=new T7,oO=new P7;n();s();var Sp=class{constructor(A,j){this.analytics=A;this.additionalAnalyticsTags=j}captureEvent(A,j){let t={...j,data:{...j.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}tradeHubSelectOpen(A){this.captureEvent("tradeHubSelectOpen",{data:{action:A}})}tradeHubAssetSelected(A,j){this.captureEvent("tradeHubAssetSelected",{data:{...St(A),assetCaip19:M(U(A)),action:j}})}tradeHubSearchPress(){this.captureEvent("tradeHubSearchPress",{data:{}})}},nO=Eo(J,e=>new Sp(e));n();s();n();s();var wTA=p.object({visitors:p.number()});n();s();var _j=q(P());n();s();n();s();n();s();var be=p.string().regex(/^\d*\.?\d+$/,"Invalid numeric string"),wp=p.string().regex(/^-?\d*\.?\d+$/,"Invalid signed numeric string"),eS=p.object({accountValue:wp,totalMarginUsed:be,totalNtlPos:be,totalRawUsd:wp}),VPA=p.object({marginSummary:eS,withdrawable:be,assetPositions:p.array(p.any()).optional(),crossMaintenanceMarginUsed:be.optional(),crossMarginSummary:eS.optional(),guaranteedUntil:p.number().optional(),isAccountSolvent:p.boolean().optional(),pendingCashAdjusts:p.array(p.any()).optional(),totalCrossCollateral:be.optional(),totalIsolatedCollateral:be.optional(),totalMaintenanceMarginUsed:be.optional()}),jS=p.object({coin:p.string(),side:p.enum(["B","A"]),limitPx:be,sz:be,oid:p.number(),timestamp:p.number(),origSz:be,cloid:p.string().optional()}),zPA=p.array(jS),sO=p.object({position:jS,status:p.string(),statusTimestamp:p.number()}),XPA=p.array(sO),iO=p.object({status:p.literal("ok"),response:p.object({type:p.string()}).optional()}),tS=p.object({error:p.string()}),WPA=p.union([iO,tS]),aO=p.enum(["withdraw","deposit"]),pO=p.object({id:p.string(),type:aO,timestamp:p.string(),delta:p.object({usdAmount:wp,token:p.object({caip19:p.string(),symbol:p.string(),image:p.string(),amount:wp})})}),JPA=p.array(pO),cO=p.object({resting:p.object({oid:p.number()})}),uO=p.object({filled:p.object({totalSz:be,avgPx:be,oid:p.number()})}),lO=p.object({error:p.string()}),dO=p.union([cO,uO,lO]),mO=p.object({status:p.literal("ok"),response:p.object({type:p.literal("order"),data:p.object({statuses:p.array(dO)})})}),YPA=p.union([mO,tS]),rS=p.array(p.object({t:p.number(),T:p.number(),s:p.string(),i:p.string(),o:be,h:be,l:be,c:be,v:be,n:p.number()}));n();s();n();s();var JA=p.string().regex(/^\d*\.?\d+$/,"Invalid numeric string"),ke=p.string().regex(/^-?\d*\.?\d+$/,"Invalid signed numeric string");var kO=p.object({accountValue:JA,availableBalance:JA,availableToTrade:JA}),oS=p.object({accountValue:JA,availableBalance:JA,availableToTrade:JA,dexs:p.record(p.string(),kO).optional()});n();s();var BO=p.enum(["withdrawal","deposit"]),fO=p.object({id:p.string(),type:BO,timestamp:p.number(),usdcAmount:ke}),nS=p.object({depositAndWithdrawals:p.array(p.any()).transform(e=>e.reduce((A,j)=>{let t=fO.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();n();s();var Gn=Zm.extend({chainId:Xm,address:p.string()}),Ii=p.object({symbol:p.string(),name:p.string(),token:Gn,logoUri:p.string(),szDecimals:p.number(),maxLeverage:p.number(),price:ke,priceChange24h:p.object({amount:ke,percentage:ke}),volume24h:JA,openInterest:JA,fundingRate:ke,assetId:p.number(),isAtOpenInterestCap:p.boolean().optional()}),sS=p.object({markets:p.array(Ii).transform(e=>e.reduce((A,j)=>{let t=Ii.safeParse(j);return t.success&&(A[M(t.data.token)]=t.data),A},{}))}),gGA=p.object({id:p.string(),name:p.string(),logoUri:p.string(),currentPrice:p.number(),maxLeverage:p.number(),szDecimals:p.number(),assetId:p.number(),symbol:p.string()});var bGA=p.enum(["success","failed"]),IGA=p.enum(["close","liquidation","take_profit","stop_loss"]),$GA=p.literal("open"),iS=p.object({id:p.string(),market:p.object({token:Gn,logoUri:p.string(),szDecimals:p.number().optional()}),type:p.string(),timestamp:p.number(),price:JA,size:ke,tradeValue:JA,fee:ke,closedPnl:p.optional(ke)}),aS=p.object({tradeHistory:p.array(iS).transform(e=>e.reduce((A,j)=>{let t=iS.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();var cS=p.enum(["long","short"]),bp=p.object({direction:cS,leverage:JA,size:ke,margin:JA,entryPrice:JA,fundingPayments:ke,market:p.object({token:Gn,logoUri:p.string()}),value:JA,unrealizedPnl:p.object({amount:ke,percentage:ke}),liquidationPrice:ke}),uS=p.object({positions:p.array(bp).transform(e=>e.reduce((A,j)=>{let t=bp.safeParse(j);return t.success&&A.push(t.data),A},[]))}),pS=p.object({id:p.string(),market:p.object({token:Gn,logoUri:p.string()}),isTrigger:p.boolean(),direction:cS,type:p.enum(["take_profit_market","stop_market"]),reduceOnly:p.boolean(),triggerPrice:JA,limitPrice:JA,timestamp:JA,size:ke}),lS=p.object({positions:p.array(bp).transform(e=>e.reduce((A,j)=>{let t=bp.safeParse(j);return t.success&&A.push(t.data),A},[])),openOrders:p.array(pS).transform(e=>e.reduce((A,j)=>{let t=pS.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();function YA(e,A){return e+Math.random()*A}n();s();var gO=p.object({address:p.string(),registered:p.boolean()}),EO=p.object({code:p.string(),registered:p.boolean()}).optional(),dS=p.object({providerFee:p.string(),phantomFee:p.string(),referral:EO.optional(),builder:gO.optional()});n();s();var mS=p.object({usdcPrice:p.string(),orderAssetId:p.number(),depositAddress:p.object({address:p.string()})}),yO=p.object({destinationAmount:p.string().optional(),sourceTxHash:p.string().optional(),state:p.enum(["done","sourceTxDiscovered","waitForSrcTxFinalization","buildingDstTx","signTx","broadcastTx","waitForDstTxFinalization","readyForWithdrawQueue","queuedForWithdraw","failure","additionalChecks"]),opCreatedAt:p.string().optional(),operationId:p.string().optional(),protocolAddress:p.string().optional(),sourceAddress:p.string().optional(),destinationAddress:p.string().optional(),sourceChain:p.string().optional(),destinationChain:p.string().optional(),sourceAmount:p.string().optional(),destinationFeeAmount:p.string().optional(),sweepFeeAmount:p.string().optional(),stateStartedAt:p.string().optional(),stateUpdatedAt:p.string().optional(),stateNextAttemptAt:p.string().optional(),destinationTxHash:p.string().optional(),asset:p.string().optional()}),kS=p.object({usdcPrice:p.string(),orderAssetId:p.number(),operations:p.array(yO)}),BS=p.discriminatedUnion("status",[p.object({status:p.literal("ok"),response:p.object({type:p.string()})}),p.object({status:p.literal("err"),response:p.string()})]),fS=p.object({status:p.enum(["ok","err"])}),gS=p.object({name:p.string(),midPx:p.string()}),hO=p.object({unixTime:p.number(),value:p.string(),open:p.string(),high:p.string(),low:p.string(),close:p.string(),volume:p.string()}),VGA=p.object({history:p.array(hO)}),ES=p.object({role:p.enum(["missing","user"])}),yS=p.object({fundingCaip19Address:uo,spotAssetId:p.number(),spotTokenId:p.string(),spotTokenName:p.string(),spotSzDecimals:p.number(),eta:p.string(),fee:p.string(),minimumAmount:p.string()}),hS=p.object({tokens:p.array(Pe)}),G7=(j=>(j.Hyperunit="hyperunit",j.Relay="relay",j))(G7||{}),FS=p.object({providers:p.array(p.object({name:p.nativeEnum(G7),max:p.number(),initializingCaip19Address:p.optional(uo)}))});var Cn=class{async getSpotBridgeInitialize(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/bridge-initialize",{params:A}),t=mS.safeParse(j.data);if(!t.success)throw new Error(`Failed to parse spot bridge initialize response: ${t.error}`);return t.data}async getOperations(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/bridge-operations",{params:A}),t=kS.safeParse(j.data);if(!t.success)throw new Error(`Failed to parse operations response: ${t.error}`);return t.data}async getAccountBalance(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/balance",{params:{user:M(A)}});if(!AA(j))throw new Error("Failed to get account balance: response is not okay");let t=j.data,r=oS.safeParse(t);if(!r.success)throw new Error("Failed to get account balance: schema validation failed");return r.data}async getUserFundingHistory(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/deposits-and-withdrawals",{params:{user:M(A)}});if(!AA(j))throw new Error("Failed to get deposits and withdrawals: response is not okay");let t=j.data,r=nS.safeParse(t);if(!r.success)throw new Error("Failed to get deposits and withdrawals: schema validation failed");return r.data.depositAndWithdrawals}async getPositions(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/positions",{params:{user:M(A)}});if(!AA(j))throw new Error("Failed to get positions: response is not okay");let t=j.data,r=uS.safeParse(t);if(!r.success)throw new Error("Failed to get positions: schema validation failed");return r.data.positions}async getPositionsAndOpenOrders(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/positions-and-open-orders",{params:{user:M(A)}});if(!AA(j))throw new Error("Failed to get positions: response is not okay");let t=j.data,r=lS.safeParse(t);if(!r.success)throw new Error("Failed to get positions: schema validation failed");return r.data}async getHistoricalOrders(A,j){let t={user:M(A)};j&&j.length>0&&(t.markets=j.join(","));let r=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/trade-history",{params:t});if(!AA(r))throw new Error("Failed to get historical orders: response is not okay");let o=r.data,i=aS.safeParse(o);if(!i.success)throw new Error("Failed to get historical orders: schema validation failed");return i.data.tradeHistory}async postSpotSend(A){let j=await N.api().retry(1,YA(1e3,1e3)).post("/swap/v2/spot/send",A);if(!AA(j))throw new Error("Failed to post spot send: response is not okay");let t=j.data,r=BS.safeParse(t);if(!r.success)throw new Error("Failed to post spot send: schema validation failed");return r.data}async postTransferUsdcSpotPerp(A){let j=await N.api().retry(1,YA(1e3,1e3)).post("/swap/v2/transfer-usdc-spot-perp",A);if(!AA(j))throw new Error("Failed to post spot send: response is not okay");let t=j.data,r=fS.safeParse(t);if(!r.success)throw new Error("Failed to post spot send: schema validation failed");return r.data}async getTokenDetails(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/token-details",{params:{tokenId:A.tokenId,type:"tokenDetails"}});if(!AA(j))throw new Error("Failed to get token info: response is not okay");let t=j.data,r=gS.safeParse(t);if(!r.success)throw new Error("Failed to get token info: schema validation failed");return r.data}async getUserRole(A){let j=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"userRole",user:A})});if(!j.ok)throw new Error("Failed to get token info");let t=await j.json(),r=ES.safeParse(t);if(!r.success)throw new Error("Failed to get user role: schema validation failed");return r.data}async postFunding(A){let j=await N.api().retry(1,YA(1e3,1e3)).post("/swap/v2/spot/funding",A);if(!AA(j))throw new Error("Failed to get funding");let t=j.data,r=yS.safeParse(t);if(!r.success)throw new Error("Failed to post funding: schema validation failed");return r.data}async getPriceHistory(A){let j={coin:A.coin,interval:A.interval,startTime:A.startTime.toString(),endTime:A.endTime.toString()};A.isTestnet&&(j.isTestnet="true");let t=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/candles",{params:j});if(!AA(t))throw new Error("Failed to get price history: response is not okay");let r=t.data,o=rS.safeParse(r);if(!o.success)throw new Error("Failed to get price history: schema validation failed");return o.data}async getSpotBalances(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/balances",{params:A});if(!AA(j))throw new Error("Failed to get spot balances: response is not okay");return j.data}async getPositionFees(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/perp/fees",{params:{user:M(A)}});if(!AA(j))throw new Error("Failed to get position fees: response is not okay");let t=j.data,r=dS.safeParse(t);if(!r.success)throw new Error("Failed to get position fees: schema validation failed");return r.data}async getBridgeableTokens(A){if(!A)throw new Error("No addresses provided to get bridgeable tokens");let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/bridgeable-tokens",{params:{addresses:A.join(",")}});if(!AA(j))throw new Error("Failed to get bridgeable tokens: response is not okay");let t=j.data,r=hS.safeParse(t);if(!r.success)throw new Error("Failed to get bridgeable tokens: schema validation failed");return r.data}async getPreferredBridges(){let A=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/preferred-bridges");if(!AA(A))throw new Error("Failed to get preferred bridge: response is not okay");let j=A.data,t=FS.safeParse(j);if(!t.success)throw new Error("Failed to get preferred bridge: schema validation failed");return t.data}};var FO=K({minutes:10}),SO=K({minutes:10}),C7=()=>{let e=CA("enable-perps-relay-bridge"),{data:A,isLoading:j,error:t}=X({queryKey:["perps","preferred-bridge"],queryFn:async()=>{try{return await new Cn().getPreferredBridges()}catch(a){return b.addBreadcrumb("perps","Error fetching preferred bridge","error",{error:a instanceof Error?a.message:"Unknown error"}),null}},staleTime:FO,gcTime:SO}),r=e&&(po()||A?.providers?.[0]?.name==="relay"),o=A?.providers?.[0]?.max,i=A?.providers?.[0]?.initializingCaip19Address;return{useRelayBridge:r,maxRelayAmount:o,initializingCaip19Address:i,isLoading:j,error:t}};n();s();n();s();var ae=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];var Ip=[{name:"hyperliquidChain",type:"string"},{name:"maxFeeRate",type:"string"},{name:"builder",type:"address"},{name:"nonce",type:"uint64"}],sj=[{name:"source",type:"string"},{name:"connectionId",type:"bytes32"}];n();s();var wO=p.object({totalSz:p.string(),avgPx:p.string(),oid:p.number()}),bO=p.object({oid:p.number()}),IO=p.union([p.object({error:p.string()}),p.object({filled:wO}),p.literal("success"),p.object({resting:bO})]),$O=p.object({status:p.literal("ok"),response:p.object({type:p.string(),data:p.object({statuses:p.array(IO)}).optional()})}),vO=p.union([p.object({status:p.literal("err"),response:p.string()}),$O]),b1A=p.object({action:p.any(),nonce:p.number(),signature:p.object({r:p.string(),s:p.string(),v:p.number()}),isTestnet:p.boolean().optional()});var On=class{async postExchange(A){return await b.startSpan("hyperliquid.exchange.post",async()=>{let t=(await N.api().post("/swap/v2/exchange",A)).data,r=vO.safeParse(t);if(!r.success)throw new Error(`Invalid exchange response: ${r.error.message}`);return r.data})}};n();s();function O7(e){return e.map(A=>({time:A.t/1e3,open:Number(A.o),high:Number(A.h),low:Number(A.l),close:Number(A.c)}))}n();s();var $p=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingAccountBalanceStart":switch(this.state.type){case"accountBalance":return{type:"refreshing",accountBalance:this.state.accountBalance};case"refreshing":return{type:"refreshing",accountBalance:this.state.accountBalance};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let j=this.state;throw new Error(`Invalid state ${j.type} for fetchingAccountBalanceStart`)}}case"fetchingAccountBalanceSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"accountBalance",accountBalance:A.accountBalance};default:throw new Error(`Invalid state ${this.state.type} for fetchingAccountBalanceSuccess`)}case"fetchingAccountBalanceError":return{type:"error",error:A.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onAccountBalanceStateChange(this.state)})}};n();s();var vp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingFundingHistoryStart":switch(this.state.type){case"history":return{type:"refreshing",history:this.state.history};case"refreshing":return{type:"refreshing",history:this.state.history};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistoryStart`)}case"fetchingFundingHistorySuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"history",history:A.history};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistorySuccess`)}case"fetchingFundingHistoryError":switch(this.state.type){case"history":case"refreshing":return{type:"history",history:this.state.history};default:return{type:"error",error:A.error}}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onFundingHistoryStateChange(this.state)})}};n();s();var qp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingHistoricalOrdersStart":switch(this.state.type){case"historicalOrders":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"refreshing":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersStart`)}case"fetchingHistoricalOrdersSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"historicalOrders",historicalOrders:A.historicalOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersSuccess`)}case"fetchingHistoricalOrdersError":return{type:"error",error:A.error}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onHistoricalOrdersStateChange(this.state)})}};n();s();var xp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingPositionsStart":switch(this.state.type){case"positions":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"refreshing":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let j=this.state;throw new Error(`Invalid state ${j.type} for fetchingPositionsStart`)}}case"fetchingPositionsSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positions",positions:A.positions,openOrders:A.openOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionsSuccess`)}case"fetchingPositionsError":return{type:"error",error:A.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPositionStateChange(this.state)})}};n();s();n();s();n();s();n();s();n();s();n();s();function SS(e){let A=e.length,j=0,t=0;for(;t<A;){let r=e.charCodeAt(t++);if(r&4294967168)if(!(r&4294965248))j+=2;else{if(r>=55296&&r<=56319&&t<A){let o=e.charCodeAt(t);(o&64512)===56320&&(++t,r=((r&1023)<<10)+(o&1023)+65536)}r&4294901760?j+=4:j+=3}else{j++;continue}}return j}function qO(e,A,j){let t=e.length,r=j,o=0;for(;o<t;){let i=e.charCodeAt(o++);if(i&4294967168)if(!(i&4294965248))A[r++]=i>>6&31|192;else{if(i>=55296&&i<=56319&&o<t){let a=e.charCodeAt(o);(a&64512)===56320&&(++o,i=((i&1023)<<10)+(a&1023)+65536)}i&4294901760?(A[r++]=i>>18&7|240,A[r++]=i>>12&63|128,A[r++]=i>>6&63|128):(A[r++]=i>>12&15|224,A[r++]=i>>6&63|128)}else{A[r++]=i;continue}A[r++]=i&63|128}}var xO=new TextEncoder,TO=50;function PO(e,A,j){xO.encodeInto(e,A.subarray(j))}function wS(e,A,j){e.length>TO?PO(e,A,j):qO(e,A,j)}var Q1A=new TextDecoder;n();s();n();s();var jo=class{constructor(A,j){this.type=A,this.data=j}};n();s();n();s();var Tp=class e extends Error{constructor(A){super(A);let j=Object.create(e.prototype);Object.setPrototypeOf(this,j),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:e.name})}};n();s();function bS(e,A,j){let t=j/4294967296,r=j;e.setUint32(A,t),e.setUint32(A+4,r)}function Pp(e,A,j){let t=Math.floor(j/4294967296),r=j;e.setUint32(A,t),e.setUint32(A+4,r)}function IS(e,A){let j=e.getInt32(A),t=e.getUint32(A+4);return j*4294967296+t}var GO=-1,CO=4294967296-1,OO=17179869184-1;function MO({sec:e,nsec:A}){if(e>=0&&A>=0&&e<=OO)if(A===0&&e<=CO){let j=new Uint8Array(4);return new DataView(j.buffer).setUint32(0,e),j}else{let j=e/4294967296,t=e&4294967295,r=new Uint8Array(8),o=new DataView(r.buffer);return o.setUint32(0,A<<2|j&3),o.setUint32(4,t),r}else{let j=new Uint8Array(12),t=new DataView(j.buffer);return t.setUint32(0,A),Pp(t,4,e),j}}function RO(e){let A=e.getTime(),j=Math.floor(A/1e3),t=(A-j*1e3)*1e6,r=Math.floor(t/1e9);return{sec:j+r,nsec:t-r*1e9}}function _O(e){if(e instanceof Date){let A=RO(e);return MO(A)}else return null}function DO(e){let A=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:A.getUint32(0),nsec:0};case 8:{let j=A.getUint32(0),t=A.getUint32(4),r=(j&3)*4294967296+t,o=j>>>2;return{sec:r,nsec:o}}case 12:{let j=IS(A,4),t=A.getUint32(0);return{sec:j,nsec:t}}default:throw new Tp(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function NO(e){let A=DO(e);return new Date(A.sec*1e3+A.nsec/1e6)}var $S={type:GO,encode:_O,decode:NO};var Mn=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register($S)}register({type:A,encode:j,decode:t}){if(A>=0)this.encoders[A]=j,this.decoders[A]=t;else{let r=-1-A;this.builtInEncoders[r]=j,this.builtInDecoders[r]=t}}tryToEncode(A,j){for(let t=0;t<this.builtInEncoders.length;t++){let r=this.builtInEncoders[t];if(r!=null){let o=r(A,j);if(o!=null){let i=-1-t;return new jo(i,o)}}}for(let t=0;t<this.encoders.length;t++){let r=this.encoders[t];if(r!=null){let o=r(A,j);if(o!=null){let i=t;return new jo(i,o)}}}return A instanceof jo?A:null}decode(A,j,t){let r=j<0?this.builtInDecoders[-1-j]:this.decoders[j];return r?r(A,j,t):new jo(j,A)}};Mn.defaultCodec=new Mn;n();s();function LO(e){return e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer}function vS(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):LO(e)?new Uint8Array(e):Uint8Array.from(e)}var KO=100,UO=2048,Gp=class e{constructor(A){this.entered=!1,this.extensionCodec=A?.extensionCodec??Mn.defaultCodec,this.context=A?.context,this.useBigInt64=A?.useBigInt64??!1,this.maxDepth=A?.maxDepth??KO,this.initialBufferSize=A?.initialBufferSize??UO,this.sortKeys=A?.sortKeys??!1,this.forceFloat32=A?.forceFloat32??!1,this.ignoreUndefined=A?.ignoreUndefined??!1,this.forceIntegerToFloat=A?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new e({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(A){if(this.entered)return this.clone().encodeSharedRef(A);try{return this.entered=!0,this.reinitializeState(),this.doEncode(A,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(A){if(this.entered)return this.clone().encode(A);try{return this.entered=!0,this.reinitializeState(),this.doEncode(A,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(A,j){if(j>this.maxDepth)throw new Error(`Too deep objects in depth ${j}`);A==null?this.encodeNil():typeof A=="boolean"?this.encodeBoolean(A):typeof A=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(A):this.encodeNumber(A):typeof A=="string"?this.encodeString(A):this.useBigInt64&&typeof A=="bigint"?this.encodeBigInt64(A):this.encodeObject(A,j)}ensureBufferSizeToWrite(A){let j=this.pos+A;this.view.byteLength<j&&this.resizeBuffer(j*2)}resizeBuffer(A){let j=new ArrayBuffer(A),t=new Uint8Array(j),r=new DataView(j);t.set(this.bytes),this.view=r,this.bytes=t}encodeNil(){this.writeU8(192)}encodeBoolean(A){A===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(A){!this.forceIntegerToFloat&&Number.isSafeInteger(A)?A>=0?A<128?this.writeU8(A):A<256?(this.writeU8(204),this.writeU8(A)):A<65536?(this.writeU8(205),this.writeU16(A)):A<4294967296?(this.writeU8(206),this.writeU32(A)):this.useBigInt64?this.encodeNumberAsFloat(A):(this.writeU8(207),this.writeU64(A)):A>=-32?this.writeU8(224|A+32):A>=-128?(this.writeU8(208),this.writeI8(A)):A>=-32768?(this.writeU8(209),this.writeI16(A)):A>=-2147483648?(this.writeU8(210),this.writeI32(A)):this.useBigInt64?this.encodeNumberAsFloat(A):(this.writeU8(211),this.writeI64(A)):this.encodeNumberAsFloat(A)}encodeNumberAsFloat(A){this.forceFloat32?(this.writeU8(202),this.writeF32(A)):(this.writeU8(203),this.writeF64(A))}encodeBigInt64(A){A>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(A)):(this.writeU8(211),this.writeBigInt64(A))}writeStringHeader(A){if(A<32)this.writeU8(160+A);else if(A<256)this.writeU8(217),this.writeU8(A);else if(A<65536)this.writeU8(218),this.writeU16(A);else if(A<4294967296)this.writeU8(219),this.writeU32(A);else throw new Error(`Too long string: ${A} bytes in UTF-8`)}encodeString(A){let t=SS(A);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),wS(A,this.bytes,this.pos),this.pos+=t}encodeObject(A,j){let t=this.extensionCodec.tryToEncode(A,this.context);if(t!=null)this.encodeExtension(t);else if(Array.isArray(A))this.encodeArray(A,j);else if(ArrayBuffer.isView(A))this.encodeBinary(A);else if(typeof A=="object")this.encodeMap(A,j);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(A)}`)}encodeBinary(A){let j=A.byteLength;if(j<256)this.writeU8(196),this.writeU8(j);else if(j<65536)this.writeU8(197),this.writeU16(j);else if(j<4294967296)this.writeU8(198),this.writeU32(j);else throw new Error(`Too large binary: ${j}`);let t=vS(A);this.writeU8a(t)}encodeArray(A,j){let t=A.length;if(t<16)this.writeU8(144+t);else if(t<65536)this.writeU8(220),this.writeU16(t);else if(t<4294967296)this.writeU8(221),this.writeU32(t);else throw new Error(`Too large array: ${t}`);for(let r of A)this.doEncode(r,j+1)}countWithoutUndefined(A,j){let t=0;for(let r of j)A[r]!==void 0&&t++;return t}encodeMap(A,j){let t=Object.keys(A);this.sortKeys&&t.sort();let r=this.ignoreUndefined?this.countWithoutUndefined(A,t):t.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(let o of t){let i=A[o];this.ignoreUndefined&&i===void 0||(this.encodeString(o),this.doEncode(i,j+1))}}encodeExtension(A){if(typeof A.data=="function"){let t=A.data(this.pos+6),r=t.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(A.type),this.writeU8a(t);return}let j=A.data.length;if(j===1)this.writeU8(212);else if(j===2)this.writeU8(213);else if(j===4)this.writeU8(214);else if(j===8)this.writeU8(215);else if(j===16)this.writeU8(216);else if(j<256)this.writeU8(199),this.writeU8(j);else if(j<65536)this.writeU8(200),this.writeU16(j);else if(j<4294967296)this.writeU8(201),this.writeU32(j);else throw new Error(`Too large extension object: ${j}`);this.writeI8(A.type),this.writeU8a(A.data)}writeU8(A){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,A),this.pos++}writeU8a(A){let j=A.length;this.ensureBufferSizeToWrite(j),this.bytes.set(A,this.pos),this.pos+=j}writeI8(A){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,A),this.pos++}writeU16(A){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,A),this.pos+=2}writeI16(A){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,A),this.pos+=2}writeU32(A){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,A),this.pos+=4}writeI32(A){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,A),this.pos+=4}writeF32(A){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,A),this.pos+=4}writeF64(A){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,A),this.pos+=8}writeU64(A){this.ensureBufferSizeToWrite(8),bS(this.view,this.pos,A),this.pos+=8}writeI64(A){this.ensureBufferSizeToWrite(8),Pp(this.view,this.pos,A),this.pos+=8}writeBigUint64(A){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,A),this.pos+=8}writeBigInt64(A){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,A),this.pos+=8}};function Rj(e,A){return new Gp(A).encodeSharedRef(e)}var qS=q(ss()),Cp=class{type="updateIsolatedMargin";asset;isBuy;ntli;constructor(A){this.asset=A.asset,this.isBuy=A.isBuy,this.ntli=A.ntli}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(HO(A),t.length+9)),`0x${(0,qS.keccak256)(o)}`}};function HO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function M7(e){switch(e.type){case"preparingTransaction":case"managingMargin":case"manageMarginSucceeded":return xS(e);case"manageMarginFailed":return{...xS(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var xS=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbol:e.market.symbol,assetId:e.market.assetId.toString(),positionDirection:e.position.direction,positionSize:e.position.size.toString(),currentMargin:e.position.margin.toString(),marginDelta:e.marginDelta.toString(),marginAction:e.marginDelta.isPositive()?"increase":"decrease",newMargin:new w(e.position.margin).plus(e.marginDelta).toString(),fee:e.fee?.toString()||"N/A"};n();s();var Op=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in ManageMarginStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateManageMargin":{let{position:t,market:r,marginDelta:o,fee:i}=j.payload;return{type:"preparingTransaction",...{position:t,market:r,marginDelta:o,fee:i}}}case"ManageMarginInitiated":{if(A.type==="preparingTransaction")return{type:"managingMargin",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee};break}case"ManageMarginSuccess":{if(A.type==="managingMargin")return{type:"manageMarginSucceeded",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee};break}case"ManageMarginFailure":{if(A.type==="managingMargin")return{type:"manageMarginFailed",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee,error:j.error};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onManageMarginStateChange(A,this.state)})}};var QO=6,Mp=class{stateMachine=new Op;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManageMarginStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onManageMarginStateChange:(A,j)=>{switch(j.type){case"manageMarginSucceeded":b.addBreadcrumb("perps",`Manage margin succeeded: ${j.type}`,"info",M7(j));break;case"manageMarginFailed":b.addBreadcrumb("perps",`Manage margin failed: ${j.type}`,"error",M7(j));break;default:b.addBreadcrumb("perps",`Manage margin state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="manageMarginSucceeded"||j.type==="manageMarginFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateManageMargin":this.stateMachine.send({type:"ManageMarginInitiated"});break;case"ManageMarginInitiated":j.type==="managingMargin"&&await this.manageMargin(j);break}}async manageMargin(A){try{let{position:j,market:t,marginDelta:r}=A,o=r.multipliedBy(new w(10).pow(QO)).toNumber(),i=new Cp({asset:t.assetId,isBuy:j.direction==="long",ntli:o}),a=Date.now(),u={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:i.hash(null,a)}},c=await this.perps.exchangeAction(i,u,a),l=c.response.data?.statuses?.find(B=>typeof B=="object"&&"error"in B);if(l&&typeof l=="object"&&"error"in l)throw new Error(l.error);let m=JSON.stringify(c.response.data?.statuses||"unknown");this.stateMachine.send({type:"ManageMarginSuccess",payload:m})}catch(j){this.stateMachine.send({type:"ManageMarginFailure",error:j})}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){return this.stateMachine.addListener(A),()=>this.stateMachine.removeListener(A)}removeListener(A){this.stateMachine.removeListener(A)}};n();s();n();s();var TS=q(ss()),Tt=class{type="order";orders;grouping;builder;constructor(A,j){this.orders=A,this.grouping="na",j&&(this.builder=j)}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(VO(A),t.length+9)),`0x${(0,TS.keccak256)(o)}`}};function VO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}var Rp=class{hyperliquidChain;signatureChainId;amount;destination;time;token;type="spotSend";constructor(A){this.hyperliquidChain=A.hyperliquidChain,this.signatureChainId=A.signatureChainId,this.token=A.token,this.amount=A.amount,this.destination=A.destination,this.time=A.time}};n();s();var PS=q(ss()),Rn=class{type="setReferrer";code;constructor(A){this.code=A.code}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(zO(A),t.length+9)),`0x${(0,PS.keccak256)(o)}`}};function zO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();var Bj=class{_order={};asset(A){return this._order.a=A,this}isBuy(A){return this._order.b=A,this}buy(){return this.isBuy(!0)}sell(){return this.isBuy(!1)}price(A){return this._order.p=A.toString(),this}size(A){return this._order.s=A.toString(),this}reduceOnly(A){return this._order.r=A,this}clientOrderId(A){return this._order.c=A,this}limitOrder(A="Gtc"){return this._order.t={limit:{tif:A}},this}postOnly(){return this.limitOrder("Alo")}immediateOrCancel(){return this.limitOrder("Ioc")}triggerOrder(A,j=!0,t="sl"){return this._order.t={trigger:{isMarket:j,triggerPx:A.toString(),tpsl:t}},this}stopLoss(A,j=!0){return this.triggerOrder(A,j,"sl")}takeProfit(A,j=!0){return this.triggerOrder(A,j,"tp")}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.b===void 0)throw new Error("Buy/sell direction is required");if(this._order.p===void 0)throw new Error("Price is required");if(this._order.s===void 0)throw new Error("Size is required");if(this._order.t===void 0)throw new Error("Order type is required");return this._order.r===void 0&&(this._order.r=!1),this._order}};n();s();function fj(e,A,j=!0,t=w.ROUND_HALF_UP){let r=new w(e);if(r.isInteger())return r.toString();let o=XO(A,j);return r.precision(5,t).toFixed(o,t).replace(/\.?0+$/,"")}function XO(e,A=!0){return Math.max((A?6:8)-e,0)}n();s();function _p(e,A,j=w.ROUND_HALF_UP){return new w(e).toFixed(A,j).replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}n();s();var Dp=class{_order={};asset(A){return this._order.a=A,this}orderId(A){return this._order.o=A,this}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.o===void 0)throw new Error("Order ID is required");return this._order}};n();s();var GS=q(ss()),Np=class{type="cancel";cancels;constructor(A){this.cancels=A}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(WO(A),t.length+9)),`0x${(0,GS.keccak256)(o)}`}};function WO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function R7(e){switch(e.type){case"preparingTransaction":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"managingPosition":case"managePositionSucceeded":return CS(e);case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":return{...CS(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var CS=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbols:e.markets.map(A=>A.symbol).join(", "),assetIds:e.markets.map(A=>A.assetId.toString()).join(", "),positionDirections:e.positions.map(A=>A.direction).join(", "),positionSizes:e.positions.map(A=>A.size.toString()).join(", "),updateType:e.update.type,fees:e.fees.map(A=>A.toString()).join(", "),...e.update.type==="close"&&{closeSize:e.update.size.toString()},...e.update.type==="addAutoClose"&&{tpTriggerPrice:e.update.autoClose.tp?.triggerPrice.toString()||"N/A",slTriggerPrice:e.update.autoClose.sl?.triggerPrice.toString()||"N/A"},...e.update.type==="removeAutoClose"&&{tpOrderId:e.update.autoClose.tp?.orderId?.toString()||"N/A",slOrderId:e.update.autoClose.sl?.orderId?.toString()||"N/A"}};n();s();var Lp=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in ManagePositionStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateManagePosition":{let{positions:t,update:r,markets:o,fees:i,autoClose:a}=j.payload;return{type:"preparingTransaction",...{positions:t,update:r,markets:o,fees:i,autoClose:a}}}case"RegisterBuilderCodeInitiated":{if(A.type==="preparingTransaction")return{type:"registeringBuilder",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(A.type==="registeringBuilder")return{type:"builderRegistered",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterBuilderCodeFailure":{if(A.type==="registeringBuilder")return{type:"builderRegistrationFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralInitiated":{if(A.type==="builderRegistered")return{type:"registeringReferral",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(A.type==="registeringReferral")return{type:"referralRegistered",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralFailure":{if(A.type==="registeringReferral")return{type:"referralRegistrationFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionInitiated":{if(A.type==="preparingTransaction"||A.type==="referralRegistered")return{type:"managingPosition",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionSuccess":{if(A.type==="managingPosition")return{type:"managePositionSucceeded",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionFailure":{if(A.type==="managingPosition")return{type:"managePositionFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onManagePositionStateChange(A,this.state)})}};var _n=.1,Kp=class{stateMachine=new Lp;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManagePositionStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onManagePositionStateChange:(A,j)=>{switch(j.type){case"managePositionSucceeded":b.addBreadcrumb("perps",`Manage position succeeded: ${j.type}`,"info",R7(j));break;case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":b.addBreadcrumb("perps",`Manage position failed: ${j.type}`,"error",R7(j));break;default:b.addBreadcrumb("perps",`Manage position state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="managePositionSucceeded"||j.type==="managePositionFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateManagePosition":A.payload.update.type==="close"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"ManagePositionInitiated"});break;case"RegisterBuilderCodeInitiated":j.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":j.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":j.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":j.type==="referralRegistered"&&this.stateMachine.send({type:"ManagePositionInitiated"});break;case"ManagePositionInitiated":j.type==="managingPosition"&&await this.managePosition(j);break}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){this.stateMachine.addListener(A)}removeListener(A){this.stateMachine.removeListener(A)}async registerBuilder(){try{let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing"||!A.positionFees.builder)throw new Error("position fees not found");if(A.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let j=A.positionFees.builder.address,t=`${Number(A.positionFees.phantomFee.toString())*100}%`,r=Date.now(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:t,builder:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ae,"HyperliquidTransaction:ApproveBuilderFee":Ip},message:o},u=(await this.perps.exchangeAction(o,i,r)).response.data?.statuses?.find(c=>typeof c=="object"&&"error"in c);if(u&&typeof u=="object"&&"error"in u)throw new Error(u.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"})}catch(A){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:A})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing")throw new Error("position fees not found");if(!A.positionFees.referral||A.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let j=A.positionFees.referral.code,t=new Rn({code:j}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"RegisterReferralSuccess"})}catch(A){this.stateMachine.send({type:"RegisterReferralFailure",error:A})}}async managePosition(A){try{let{positions:j,update:t,markets:r}=A,o="",a=j.map(u=>u.direction==="long").map(u=>u);if(t.type==="removeAutoClose"){let u=await this.removeAutoClose(r[0].assetId,[t.autoClose.tp?.orderId,t.autoClose.sl?.orderId].filter(Boolean));if(!u)throw new Error("Failed to cancel auto close orders");o=u}else if(t.type==="close"||t.type==="closeAll")o=await this.closePositions(r.map(c=>c.assetId),t.size instanceof w?[t.size.abs().toString()]:t.size.map(c=>c.abs().toString()),a,r.map(c=>c.currentPrice.toString()),r.map(c=>c.szDecimals));else if(t.type==="addAutoClose"){let u={tp:t.autoClose.tp?.orderId,sl:t.autoClose.sl?.orderId},c=await this.createAutoClose(u,r[0].assetId,a[0],r[0].szDecimals,t.autoClose);if(!c)throw new Error("Failed to cancel auto close orders");o=c}this.stateMachine.send({type:"ManagePositionSuccess",payload:o})}catch(j){this.stateMachine.send({type:"ManagePositionFailure",error:j})}}async closePositions(A,j,t,r,o){let i=this.perps.getPositionFeesState();if(i.type!=="positionFees"&&i.type!=="refreshing"||!i.positionFees.builder)throw new Error("position fees not found");let a={b:i.positionFees.builder.address.toLowerCase(),f:Number(i.positionFees.phantomFee)*100*100*10},u=[];for(let g=0;g<A.length;g++){let E=fj(new w(r[g]).multipliedBy(t[g]?1-_n:1+_n),o[g]),h=_p(new w(j[g]),o[g]),y=new Bj().asset(A[g]).isBuy(!t[g]).price(E).size(h).reduceOnly(!0).immediateOrCancel().build();u.push(y)}let c=new Tt(u,a),l=Date.now(),m={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:c.hash(null,l)}},B=await this.perps.exchangeAction(c,m,l),k=B.response.data?.statuses.find(g=>g==="error"||g?.error);if(k){let g=typeof k=="string"?"Operation failed":k.error;throw new Error(g)}let f=B.response.data?.statuses.find(g=>g==="filled"||g?.filled);if(f&&typeof f=="object"&&f.filled)return JSON.stringify(B.response.data?.statuses);throw new Error("No filled status found")}async createAutoClose(A,j,t,r,o){let i=[A.tp,A.sl].filter(Boolean).filter(F=>F!==-1);if(i.length>0&&!await this.removeAutoClose(j,i))throw new Error("Failed to cancel auto close orders");let a=this.perps.getPositionFeesState();if(a.type!=="positionFees"&&a.type!=="refreshing"||!a.positionFees.builder)throw new Error("position fees not found");let u={b:a.positionFees.builder.address.toLowerCase(),f:Number(a.positionFees.phantomFee)*100*100*10},c="0",l;if(o?.tp){let F=fj(new w(o.tp.triggerPrice).multipliedBy(t?1-_n:1+_n),r),S=fj(new w(o.tp.triggerPrice),r).toString();l=new Bj().asset(j).isBuy(!t).price(F).size(c).reduceOnly(!0).triggerOrder(S,!0,"tp").build()}let m;if(o?.sl){let F=fj(new w(o.sl.triggerPrice).multipliedBy(t?1-_n:1+_n),r),S=fj(new w(o.sl.triggerPrice),r).toString();m=new Bj().asset(j).isBuy(!t).price(F).size(c).reduceOnly(!0).triggerOrder(S,!0,"sl").build()}let B=[l,m].filter(Boolean),k=new Tt(B,u),f=Date.now(),g={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:k.hash(null,f)}},E=await this.perps.exchangeAction(k,g,f),h=E.response.data?.statuses.find(F=>F==="error"||F?.error);if(h){let F=typeof h=="string"?"Operation failed":h.error;throw new Error(F)}let y=E.response.data?.statuses.find(F=>F==="resting"||F?.resting);if(y&&typeof y=="object"&&y.resting&&y.resting.oid)return JSON.stringify(E.response.data?.statuses);throw new Error("No order status found")}async removeAutoClose(A,j){let t=j.map(c=>new Dp().asset(A).orderId(Number(c)).build()),r=new Np(t),o=Date.now(),i={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:r.hash(null,o)}},a=await this.perps.exchangeAction(r,i,o),u=a.response.data?.statuses.find(c=>c==="error"||c?.error);if(u){let c=typeof u=="string"?"Operation failed":u.error;throw new Error(c)}if(a.response.data?.statuses&&a.response.data?.statuses.length>0&&a.response.data?.statuses.every(c=>c==="success"||c?.success))return JSON.stringify({orderIds:t});throw new Error("Cancel operation failed")}};n();s();n();s();var OS=q(ss()),Up=class{type="updateLeverage";asset;isCross;leverage;constructor(A){this.asset=A.asset,this.isCross=A.isCross,this.leverage=A.leverage}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(JO(A),t.length+9)),`0x${(0,OS.keccak256)(o)}`}};function JO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function _7(e){switch(e.type){case"preparingTransaction":case"updatingLeverage":case"leverageUpdated":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"creatingPosition":case"orderSucceeded":return MS(e);case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":return{...MS(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var MS=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbol:e.market.symbol,assetId:e.market.assetId.toString(),direction:e.direction,margin:e.margin.toString(),leverage:e.leverage.toString(),size:e.size.toString(),sizeInCoin:e.sizeInCoin.toString(),estimatedLiquidationPrice:e.estimatedLiquidationPrice?.toString()||"N/A",fee:e.fee?.toString()||"N/A",action:e.action};n();s();var Hp=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in OpenPositionStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateOpenPosition":{let{market:t,direction:r,margin:o,leverage:i,autoClose:a,estimatedLiquidationPrice:u,fee:c,action:l}=j.payload,m=new w(o).multipliedBy(i),B=new w(t.currentPrice),k=B.isGreaterThan(0)?m.dividedBy(B):new w(0);return{type:"preparingTransaction",...{market:t,direction:r,margin:o,leverage:i,autoClose:a,size:m,sizeInCoin:k,estimatedLiquidationPrice:u,fee:c,action:l}}}case"InitiateUpdateLeverage":{if(A.type==="preparingTransaction")return A;break}case"UpdateLeverageInitiated":{if(A.type==="preparingTransaction")return{type:"updatingLeverage",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"UpdateLeverageSuccess":{if(A.type==="updatingLeverage")return{type:"leverageUpdated",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferInitiated":{if(A.type==="leverageUpdated")return{type:"transferringToHip3Dex",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferNotRequired":case"Hip3TransferSuccess":{if(A.type==="transferringToHip3Dex")return{type:"hip3TransferCompleted",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferFailure":{if(A.type==="transferringToHip3Dex")return{type:"hip3TransferFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"UpdateLeverageFailure":{if(A.type==="updatingLeverage")return{type:"leverageUpdateFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"RegisterBuilderCodeInitiated":{if(A.type==="leverageUpdated"||A.type==="hip3TransferCompleted")return{type:"registeringBuilder",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(A.type==="registeringBuilder")return{type:"builderRegistered",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterBuilderCodeFailure":{if(A.type==="registeringBuilder")return{type:"builderRegistrationFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"RegisterReferralInitiated":{if(A.type==="builderRegistered")return{type:"registeringReferral",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(A.type==="registeringReferral")return{type:"referralRegistered",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterReferralFailure":{if(A.type==="registeringReferral")return{type:"referralRegistrationFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"PositionCreationInitiated":{if(A.type==="referralRegistered")return{type:"creatingPosition",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"PositionCreationSuccess":{if(A.type==="creatingPosition")return{type:"orderSucceeded",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"PositionCreationFailure":{if(A.type==="creatingPosition")return{type:"orderFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,error:j.error,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onOpenPositionStateChange(A,this.state)})}};var Dn=.1,Qp=class{stateMachine=new Hp;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onOpenPositionStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onOpenPositionStateChange:(A,j)=>{switch(j.type){case"orderSucceeded":b.addBreadcrumb("perps",`Open position succeeded: ${j.type}`,"info",_7(j));break;case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"hip3TransferFailed":case"orderFailed":b.addBreadcrumb("perps",`Open position failed: ${j.type}`,"error",_7(j));break;default:b.addBreadcrumb("perps",`Open position state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="orderSucceeded"||j.type==="orderFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateOpenPosition":await this.ensureSufficientBalance(A.payload.margin,A.payload.action),this.stateMachine.send({type:"InitiateUpdateLeverage",payload:{isCross:!1,leverage:A.payload.leverage}});break;case"InitiateUpdateLeverage":this.stateMachine.send({type:"UpdateLeverageInitiated"});break;case"UpdateLeverageInitiated":j.type==="updatingLeverage"&&await this.updateLeverage(j);break;case"UpdateLeverageSuccess":j.type==="leverageUpdated"&&this.stateMachine.send({type:"Hip3TransferInitiated"});break;case"Hip3TransferInitiated":j.type==="transferringToHip3Dex"&&await this.checkAndTransferToHip3Dex(j);break;case"Hip3TransferNotRequired":case"Hip3TransferSuccess":j.type==="hip3TransferCompleted"&&this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"InitiateRegisterBuilder":this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"RegisterBuilderCodeInitiated":j.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":j.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"InitiateRegisterReferral":this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":j.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":j.type==="referralRegistered"&&this.stateMachine.send({type:"PositionCreationInitiated"});break;case"PositionCreationInitiated":j.type==="creatingPosition"&&await this.createPosition(j);break}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){this.stateMachine.addListener(A)}removeListener(A){this.stateMachine.removeListener(A)}async ensureSufficientBalance(A,j){let t=this.perps.getAccountBalanceState();if(t.type==="accountBalance"||t.type==="refreshing"){let i=new w(t.accountBalance.availableBalance);if(j==="reduce"||j==="reverse"||i.isGreaterThanOrEqualTo(A))return}this.perps.syncAccountBalance();let r=300,o=0;for(;o<r;){let i=this.perps.getAccountBalanceState();if((i.type==="accountBalance"||i.type==="refreshing")&&new w(i.accountBalance.availableBalance).isGreaterThanOrEqualTo(A))return;await new Promise(a=>setTimeout(a,10)),o++}throw new Error("Insufficient balance after consolidation attempt")}async updateLeverage(A){try{let j=A.market.assetId,t=new Up({asset:j,isCross:!1,leverage:A.leverage.toNumber()}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"UpdateLeverageSuccess"})}catch(j){this.stateMachine.send({type:"UpdateLeverageFailure",error:j})}}async registerBuilder(){try{let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing"||!A.positionFees.builder)throw new Error("position fees not found");if(A.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let j=A.positionFees.builder.address,t=`${Number(A.positionFees.phantomFee.toString())*100}%`,r=Date.now(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:t,builder:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ae,"HyperliquidTransaction:ApproveBuilderFee":Ip},message:o},u=(await this.perps.exchangeAction(o,i,r)).response.data?.statuses?.find(c=>typeof c=="object"&&"error"in c);if(u&&typeof u=="object"&&"error"in u)throw new Error(u.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"})}catch(A){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:A})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing")throw new Error("position fees not found");if(!A.positionFees.referral||A.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let j=A.positionFees.referral.code,t=new Rn({code:j}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"RegisterReferralSuccess"})}catch(A){this.stateMachine.send({type:"RegisterReferralFailure",error:A})}}async checkAndTransferToHip3Dex(A){try{let j=A.market.symbol.split(":");if(j.length<2){this.stateMachine.send({type:"Hip3TransferNotRequired"});return}let t=j[0],r=A.margin;if(!this.perps.user)throw new Error("User address not set");let o=await this.perps.sendAsset({destination:this.perps.user.address.toLowerCase(),sourceDex:"",destinationDex:t,token:"USDC",amount:r});if(o.status==="ok")this.stateMachine.send({type:"Hip3TransferSuccess"});else throw new Error(JSON.stringify(o.response))}catch(j){this.stateMachine.send({type:"Hip3TransferFailure",error:j})}}async createPosition(A){try{let j=await this.createOrder(A.market.assetId,A.size.toString(),A.direction==="long",A.market.currentPrice.toString(),A.market.szDecimals,A.autoClose,A.action==="reduce");this.stateMachine.send({type:"PositionCreationSuccess",payload:j})}catch(j){this.stateMachine.send({type:"PositionCreationFailure",error:j})}}async createOrder(A,j,t,r,o,i,a){let u=fj(new w(r).multipliedBy(t?1+Dn:1-Dn),o),c=this.perps.getPositionFeesState();if(c.type!=="positionFees"&&c.type!=="refreshing"||!c.positionFees.builder)throw new Error("position fees not found");let l={b:c.positionFees.builder.address.toLowerCase(),f:Number(c.positionFees.phantomFee)*100*100*10},m=_p(new w(j).dividedBy(new w(r)),o),B=new Bj().asset(A).isBuy(t).price(u).size(m).reduceOnly(a??!1).immediateOrCancel().build(),k;if(i?.tp?.dollar){let O=fj(new w(i.tp.dollar),o).toString(),v=fj(new w(i.tp.dollar).multipliedBy(t?1+Dn:1-Dn),o);k=new Bj().asset(A).isBuy(!t).price(v).size(m).reduceOnly(!0).triggerOrder(O,!0,"tp").build()}let f;if(i?.sl?.dollar){let O=fj(new w(i.sl.dollar),o).toString(),v=fj(new w(i.sl.dollar).multipliedBy(t?1+Dn:1-Dn),o);f=new Bj().asset(A).isBuy(!t).price(v).size(m).reduceOnly(!0).triggerOrder(O,!0,"sl").build()}let g=[B,k,f].filter(Boolean),E=new Tt(g,l),h=Date.now(),y={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:E.hash(null,h)}},F=await this.perps.exchangeAction(E,y,h),S=F.response.data?.statuses?.find(O=>typeof O=="object"&&"error"in O);if(S&&typeof S=="object"&&"error"in S)throw new Error(S.error);let x=F.response.data?.statuses.find(O=>typeof O=="object"&&"filled"in O);if(x&&typeof x=="object"&&"filled"in x)return JSON.stringify(F.response.data?.statuses);throw new Error("No filled status found")}};n();s();var Vp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingPositionFeesStart":switch(this.state.type){case"positionFees":return{type:"refreshing",positionFees:this.state.positionFees};case"refreshing":return{type:"refreshing",positionFees:this.state.positionFees};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesStart`)}case"fetchingPositionFeesSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positionFees",positionFees:A.fees};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesSuccess`)}case"fetchingPositionFeesError":return{type:"error",error:A.error}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPositionFeesStateChange(this.state)})}};n();s();var D7=["1H","1D","1W","1M","YTD","ALL"],zp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"initiateSequentialFetch":return{type:"multiInterval",intervals:{"1H":{type:"idle"},"1D":{type:"idle"},"1W":{type:"idle"},"1M":{type:"idle"},YTD:{type:"idle"},ALL:{type:"idle"}},currentlyFetchingInterval:null,sequenceComplete:!1};case"fetchingIntervalStart":return this.state.type!=="multiInterval"?this.state:{...this.state,intervals:{...this.state.intervals,[A.interval]:{type:"loading"}},currentlyFetchingInterval:A.interval};case"fetchingIntervalSuccess":{if(this.state.type!=="multiInterval")return this.state;let j={...this.state.intervals,[A.interval]:{type:"loaded",candleSnapshots:A.candleSnapshots}},t=D7.every(r=>{let o=j[r];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",intervals:j,currentlyFetchingInterval:null,sequenceComplete:t}}case"fetchingIntervalError":{if(this.state.type!=="multiInterval")return this.state;let j={...this.state.intervals,[A.interval]:{type:"error",error:A.error}},t=D7.every(r=>{let o=j[r];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",intervals:j,currentlyFetchingInterval:null,sequenceComplete:t}}case"sequentialFetchComplete":return this.state.type!=="multiInterval"?this.state:{...this.state,sequenceComplete:!0};default:return this.state}}getState(){return this.state}getNextIntervalToFetch(){if(this.state.type!=="multiInterval")return null;for(let A of D7)if(this.state.intervals[A].type==="idle")return A;return null}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPricingStateChange(this.state)})}};n();s();var Xp=.98,Wp=class{constructor(A,j){this.perps=A;this.perpsClient=j}async getSpotBalances(A){let j=M({address:A,chainId:"hypercore:mainnet",resourceType:"address"});return(await this.perpsClient.getSpotBalances({user:j})).balances}async buy(A,j,t){let r=new w(t).dividedBy(Xp).decimalPlaces(2);return this.placeBuySellOrder(A,j,!0,r.toString())}async sell(A,j,t){let r=new w(t).multipliedBy(Xp).decimalPlaces(2);return this.placeBuySellOrder(A,j,!1,r.toString())}async placeBuySellOrder(A,j,t,r){if(!this.perps.user?.address)throw new Error("User not found");let i=new Bj().asset(A).isBuy(t).price(r).size(j).reduceOnly(!1).immediateOrCancel().build(),a=new Tt([i]),u=Date.now(),c={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:a.hash(null,u)}},l=await this.perps.exchangeAction(a,c,u),m=l.response.data?.statuses.find(k=>typeof k=="object"&&"error"in k);if(m&&typeof m=="object"&&"error"in m)throw new Error(m.error);let B=l.response.data?.statuses.find(k=>typeof k=="object"&&"filled"in k);if(B&&typeof B=="object"&&"filled"in B)return{totalSz:B.filled.totalSz,avgPx:B.filled.avgPx};throw new Error("No filled status found")}async send(A,j,t,r){let o=`${A}:${j}`,i=Date.now(),a=new Rp({hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",token:o,amount:t.toString(),destination:r.toLowerCase(),time:i}),u={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SpotSend",types:{EIP712Domain:ae,"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:a},{splitSignature:c}=await this.perps.sign(u),l=await this.perpsClient.postSpotSend({action:a,nonce:i,signature:c});if(l.status==="err")throw new Error(l.response);return l.response}async getTokenMidPrice(A){let j=await this.perpsClient.getTokenDetails({tokenId:A});return new w(j.midPx)}};var $i=class{client;accountBalanceStateMachine=new $p;positionsStateMachine=new xp;pricingStateMachine=new zp;positionFeesStateMachine=new Vp;signer=void 0;fundingHistoryStateMachine=new vp;historicalOrdersStateMachine=new qp;openPositionOrchestrator;managePositionOrchestrator;manageMarginOrchestrator;accountChangeListeners=[];account;user;isTestnet;spot;fundingPool;fundingTaskFactory;sequentialPricingCoin=null;authRepository;constructor({client:A,isTestnet:j,fundingPool:t,fundingTaskFactory:r,authRepository:o}){this.client=A,this.isTestnet=j,this.spot=new Wp(this,this.client),this.fundingPool=t,this.fundingPool.addListener(this.fundingPoolListener),this.fundingTaskFactory=r,this.openPositionOrchestrator=new Qp(this),this.managePositionOrchestrator=new Kp(this),this.manageMarginOrchestrator=new Mp(this),this.authRepository=o,this.pricingStateMachine.addListener({onPricingStateChange:this.handlePricingStateChange.bind(this)}),this.accountBalanceStateMachine.addListener({onAccountBalanceStateChange:i=>{this.consolidateDexBalances(i)}})}setSigner(A){this.signer=A}createFundingTask(A,j,t,r){return this.fundingTaskFactory.createTask(this,A,this.authRepository,j,t,Nn(this.signer),Nn(this.user),r)}executeFundingTask(A,j,t,r,o){this.fundingPool.submit(A,j,t,r,o)}fundingPoolListener={onFundingPoolStateChange:(A,j)=>{(A.type==="fundingCompleted"||A.type==="fundingStarted")&&(this.syncAccountBalance(),this.syncFundingHistory())}};setAccount(A){this.account=A;let{address:j}=A.addresses?.find(t=>I.isEVMNetworkID(t.networkID))??{addressType:"eip155",networkID:tA.Ethereum.Mainnet};j&&(this.user={resourceType:"address",chainId:this.isTestnet?"hypercore:testnet":I.hypercore.mainnetID,address:j},this.fundingPool.setAccountId(j)),this.accountChangeListeners.forEach(t=>t.onAccountChange(A))}getAccount(){return this.account}getUser(){return this.user}subscribeAccountChange(A){return this.accountChangeListeners.push(A),()=>this.unsubscribeAccountChange(A)}unsubscribeAccountChange(A){this.accountChangeListeners=this.accountChangeListeners.filter(j=>j!==A)}getAccountBalanceState(){return this.accountBalanceStateMachine.getState()}syncAccountBalance(){if(!this.user)return;let A=this.accountBalanceStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceStart"}),this.client.getAccountBalance(this.user).then(j=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceSuccess",accountBalance:j})}).catch(j=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceError",error:j}),b.addBreadcrumb("perps","Error fetching account balance","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribeAccountBalanceState(A){return this.accountBalanceStateMachine.addListener(A),()=>{this.unsubscribeAccountBalanceState(A)}}unsubscribeAccountBalanceState(A){this.accountBalanceStateMachine.removeListener(A)}getPositionFeesState(){return this.positionFeesStateMachine.getState()}syncPositionFees(){if(!this.user)return;let A=this.positionFeesStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.positionFeesStateMachine.send({type:"fetchingPositionFeesStart"}),this.client.getPositionFees(this.user).then(j=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesSuccess",fees:j})}).catch(j=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesError",error:j}),b.addBreadcrumb("perps","Error fetching position fees","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribePositionFees(A){return this.positionFeesStateMachine.addListener(A),()=>{this.unsubscribePositionFees(A)}}unsubscribePositionFees(A){this.positionFeesStateMachine.removeListener(A)}getPositionsState(){return this.positionsStateMachine.getState()}syncPositions(){if(!this.user)return;let A=this.positionsStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.positionsStateMachine.send({type:"fetchingPositionsStart"}),this.client.getPositionsAndOpenOrders(this.user).then(j=>{this.positionsStateMachine.send({type:"fetchingPositionsSuccess",positions:j.positions,openOrders:j.openOrders})}).catch(j=>{this.positionsStateMachine.send({type:"fetchingPositionsError",error:j}),b.addBreadcrumb("perps","Error fetching positions","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribePositions(A){return this.positionsStateMachine.addListener(A),()=>{this.unsubscribePositions(A)}}unsubscribePositions(A){this.positionsStateMachine.removeListener(A)}getFundingHistoryState(){return this.fundingHistoryStateMachine.getState()}syncFundingHistory(){if(!this.user)return;let A=this.fundingHistoryStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryStart"}),this.client.getUserFundingHistory(this.user).then(j=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistorySuccess",history:j})}).catch(j=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryError",error:j}),b.addBreadcrumb("perps","Error fetching funding history","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribeFundingHistory(A){return this.fundingHistoryStateMachine.addListener(A),()=>{this.unsubscribeFundingHistory(A)}}unsubscribeFundingHistory(A){this.fundingHistoryStateMachine.removeListener(A)}getHistoricalOrdersState(){return this.historicalOrdersStateMachine.getState()}syncHistoricalOrders(A){if(!this.user)return;let j=this.historicalOrdersStateMachine.getState();j.type==="loading"||j.type==="refreshing"||(this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersStart"}),this.client.getHistoricalOrders(this.user,A).then(t=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersSuccess",historicalOrders:t})}).catch(t=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersError",error:t}),b.addBreadcrumb("perps","Error fetching historical orders","error",{error:t instanceof Error?t.message:"Unknown error",markets:A?.join(",")??"No markets"})}))}subscribeHistoricalOrders(A){return this.historicalOrdersStateMachine.addListener(A),()=>{this.unsubscribeHistoricalOrders(A)}}unsubscribeHistoricalOrders(A){this.historicalOrdersStateMachine.removeListener(A)}getPricingState(){return this.pricingStateMachine.getState()}syncPricing(A,j,t,r){if(!this.user)return;let o;switch(j){case"1m":o="1H";break;case"15m":o="1D";break;case"1h":o="1W";break;case"4h":o="1M";break;case"1d":o="ALL";break;default:o="1D"}this.pricingStateMachine.getState().type!=="multiInterval"&&this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:A}),this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:o,coin:A,apiInterval:j,startTime:t,endTime:r}),this.client.getPriceHistory({coin:A,interval:o,startTime:t,endTime:r,isTestnet:this.isTestnet}).then(a=>{let u=O7(a);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:o,candleSnapshots:u})}).catch(a=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:o,error:a}),b.addBreadcrumb("perps","Error fetching pricing","error",{error:a instanceof Error?a.message:"Unknown error",coin:A,interval:j,startTime:t,endTime:r})})}getTimeFrameDetails(A,j){let t=j,r,o;switch(A){case"1H":r=j-1e3*60*60*1,o="1m";break;case"1D":r=j-1e3*60*60*24,o="30m";break;case"1W":r=j-1e3*60*60*24*7,o="4h";break;case"1M":r=j-1e3*60*60*24*30,o="12h";break;case"YTD":r=new Date(new Date().getFullYear(),0,1).getTime(),o="1d";break;case"ALL":r=j-1e3*60*60*24*365*10,o="1d";break}return{startTime:r,endTime:t,apiInterval:o}}startSequentialPricingSync(A){this.sequentialPricingCoin=A,this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:A}),this.fetchNextInterval()}fetchNextInterval(){let A=this.pricingStateMachine.getNextIntervalToFetch();if(!A||!this.sequentialPricingCoin)return;let j=new Date().getTime(),{startTime:t,endTime:r,apiInterval:o}=this.getTimeFrameDetails(A,j);this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:A,coin:this.sequentialPricingCoin,apiInterval:o,startTime:t,endTime:r}),this.client.getPriceHistory({coin:this.sequentialPricingCoin,interval:o,startTime:t,endTime:r,isTestnet:this.isTestnet}).then(i=>{let a=O7(i);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:A,candleSnapshots:a})}).catch(i=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:A,error:i}),b.addBreadcrumb("perps","Error fetching next pricing interval","error",{error:i instanceof Error?i.message:"Unknown error",coin:this.sequentialPricingCoin,interval:A,apiInterval:o,startTime:t,endTime:new Date(r).toISOString()})})}handlePricingStateChange(A){A.type==="multiInterval"&&!A.currentlyFetchingInterval&&!A.sequenceComplete&&setTimeout(()=>{this.fetchNextInterval()},100)}isConsolidating=!1;async consolidateDexBalances(A){if(A.type!=="accountBalance")return;let j=A.accountBalance.dexs;if(!j||Object.keys(j).length===0||this.isConsolidating)return;let t=!1;for(let o of Object.values(j))if(new w(o.availableBalance).isGreaterThan(.01)){t=!0;break}if(!t||!this.user)return;let r=this.user.address.toLowerCase();this.isConsolidating=!0;try{let o=[];for(let[i,a]of Object.entries(j)){let u=new w(a.availableBalance);if(u.isGreaterThan(.01)){let c=this.sendAsset({destination:r,sourceDex:i,destinationDex:"",token:"USDC",amount:u}).catch(l=>{b.addBreadcrumb("perps","Failed to consolidate from DEX","error",{dexName:i,error:l instanceof Error?l.message:"Unknown error"})});o.push(c)}}o.length>0&&await Promise.all(o)}catch(o){b.addBreadcrumb("perps","Failed to auto-consolidate DEX balances","error",{error:o instanceof Error?o.message:"Unknown error"})}finally{this.isConsolidating=!1}}subscribePricing(A){return this.pricingStateMachine.addListener(A),()=>{this.unsubscribePricing(A)}}unsubscribePricing(A){this.pricingStateMachine.removeListener(A)}async sign(A){let j=Nn(this.signer),t=Nn(this.account),{signature:r}=await j.sign(t.identifier,{chainType:"eip155",signingType:"typedData",version:4,data:A});return{splitSignature:_S(r)}}async exchangeAction(A,j,t){let r=new On,o=Nn(this.signer),i=Nn(this.account),{signature:a}=await o.sign(i.identifier,{chainType:"eip155",signingType:"typedData",version:4,data:j}),u=_S(a),c=await r.postExchange({action:A,nonce:t,signature:{r:u.r,s:u.s,v:u.v},isTestnet:this.isTestnet});if(c.status==="err")throw new Error(c.response);if(c.status==="ok")return c;throw new Error("Unknown response status")}async transfer(A){let{toPerp:j,amount:t}=A,r=Date.now(),o={type:"usdClassTransfer",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:t.toString(),toPerp:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdClassTransfer",types:{EIP712Domain:ae,"HyperliquidTransaction:UsdClassTransfer":[{name:"hyperliquidChain",type:"string"},{name:"amount",type:"string"},{name:"toPerp",type:"bool"},{name:"nonce",type:"uint64"}]},message:o},{splitSignature:a}=await this.sign(i),c=await new On().postExchange({action:o,nonce:r,signature:a,isTestnet:this.isTestnet});if(c.status==="err")throw new Error(c.response);return c}async sendAsset(A){let{destination:j,sourceDex:t,destinationDex:r,token:o,amount:i,vaultAddress:a}=A,u=Date.now(),c={type:"sendAsset",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",destination:j.toLowerCase(),sourceDex:t,destinationDex:r,token:o,amount:i.toString(),fromSubAccount:a?a.toLowerCase():"",nonce:u},l={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SendAsset",types:{EIP712Domain:ae,"HyperliquidTransaction:SendAsset":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"sourceDex",type:"string"},{name:"destinationDex",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"fromSubAccount",type:"string"},{name:"nonce",type:"uint64"}]},message:c},{splitSignature:m}=await this.sign(l),k=await new On().postExchange({action:c,nonce:u,signature:m,isTestnet:this.isTestnet});if(k.status==="err")throw new Error(k.response);return k}openPosition(A){this.openPositionOrchestrator.send({type:"InitiateOpenPosition",payload:A})}resetOpenPosition(){this.openPositionOrchestrator.send({type:"Reset"})}getOpenPositionState(){return this.openPositionOrchestrator.getState()}subscribeOpenPosition(A){return this.openPositionOrchestrator.addListener(A),()=>{this.unsubscribeOpenPosition(A)}}unsubscribeOpenPosition(A){this.openPositionOrchestrator.removeListener(A)}managePosition(A){this.managePositionOrchestrator.send({type:"InitiateManagePosition",payload:A})}resetManagePosition(){this.managePositionOrchestrator.send({type:"Reset"})}getManagePositionState(){return this.managePositionOrchestrator.getState()}subscribeManagePosition(A){return this.managePositionOrchestrator.addListener(A),()=>{this.unsubscribeManagePosition(A)}}unsubscribeManagePosition(A){this.managePositionOrchestrator.removeListener(A)}manageMargin(A){this.manageMarginOrchestrator.send({type:"InitiateManageMargin",payload:A})}resetManageMargin(){this.manageMarginOrchestrator.send({type:"Reset"})}getManageMarginState(){return this.manageMarginOrchestrator.getState()}subscribeManageMargin(A){return this.manageMarginOrchestrator.addListener(A)}};function Nn(e,A){if(e==null)throw new Error(A||"Required value is undefined or null");return e}function _S(e){let A=`0x${e.slice(2,66)}`,j=`0x${e.slice(66,130)}`,t=parseInt(e.slice(130,132),16);return{r:A,s:j,v:t}}n();s();var vi=q(P());var DS=()=>{let e=J(),A=(0,vi.useCallback)((o,i)=>{e.capture(o,{data:{...i}}),o==="perpsDepositFailed"&&b.captureError(new Error(`depositFailed: ${i.error}`),"perps"),o==="perpsWithdrawFailed"&&b.captureError(new Error(`withdrawalFailed: ${i.error}`),"perps")},[e]),j=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]),t=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]),r=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]);return{reportDeposit:j,reportWithdraw:t,reportFundingUIState:r}};n();s();var Jp=class{onFundingPoolStateChange(A,j,t){switch(A.type){case"fundingFailed":b.addBreadcrumb("perps",`FundingPool: ${j.type} funding failed`,"error",{error:A.error.message,fundingTaskState:j.getState().type});break;case"fundingStarted":case"fundingBridgingStarted":case"fundingCompleted":b.addBreadcrumb("perps",`FundingPool: ${j.type} ${A.type}`,"info");break}}};n();s();var Yp=class{onFundingPoolStateChange(A,j,t){switch(j.type){case"deposit":this.onDepositEvent(A,j);break;case"withdraw":this.onWithdrawEvent(A,j);break}}onDepositEvent(A,j){switch(A.type){case"fundingStarted":this.progress(T.t("perpsToastInitiatingFunding"));break;case"fundingBridgingStarted":j.estimatedTime?this.success(T.t("perpsToastFundingInitiated",{time:j.estimatedTime})):this.success(T.t("perpsToastFundingInitiatedNoTime"));break;case"fundingCompleted":this.success(T.t("perpsToastFundsAdded"));break;case"fundingFailed":this.failed(T.t("perpsToastFundingFailed"),A.error.message,T.t("commandOK"),()=>{zA.getState().hideToast()});break}}onWithdrawEvent(A,j){switch(A.type){case"fundingStarted":this.progress(T.t("perpsToastInitiatingWithdrawal"));break;case"fundingBridgingStarted":this.success(T.t("perpsToastWithdrawalInitiated",{time:A.estimateTime}));break;case"fundingCompleted":this.success(T.t("perpsToastWithdrawalComplete"));break;case"fundingFailed":this.failed(T.t("perpsToastWithdrawalFailed"),A.error.message,T.t("commandOK"),()=>{zA.getState().hideToast()});break}}success(A){setTimeout(()=>{zA.getState().success({message:A,onPress:()=>{zA.getState().hideToast()}})},100)}failed(A,j,t,r){setTimeout(()=>{zA.getState().failed({title:A,message:j,buttonText:t,onPress:r})},100)}progress(A){setTimeout(()=>{zA.getState().progress({message:A,onPress:()=>{zA.getState().hideToast()}})},100)}};n();s();var NS="failedFundingEvents";var qi=class{storage;listeners=[];storageKey;accountId;constructor(A,j){this.storage=A,this.accountId=j,this.storageKey=this.generateStorageKey()}async setAccountId(A){if(this.accountId===A)return;this.accountId=A,this.storageKey=this.generateStorageKey();let j=await this.getEvents();this.notifyListeners(j)}generateStorageKey(){return this.accountId?`${NS}_${this.accountId}`:NS}async addEvent(A){let j=await this.getEvents(),t={id:`${A.type}_${A.startedAt}_${A.amountUsd}`,type:A.type,amountUsd:A.amountUsd||"0",timestamp:Date.now(),startedAt:A.startedAt,errorMessage:A.getState().type==="failed"?A.getState().error?.message:void 0};j.some(o=>o.id===t.id)||(j.unshift(t),j.length>25&&j.splice(25),await this.storage.set(this.storageKey,j),this.notifyListeners(j))}async getEvents(){let A=await this.storage.get(this.storageKey);return Array.isArray(A)?A:[]}async clear(){await this.storage.remove(this.storageKey),this.notifyListeners([])}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(A){for(let j of this.listeners)j.onFailedEventsChange(A)}};n();s();var xi=class{activeTasks=new Set;listeners=new Set;failedEventsCache;constructor(A){this.failedEventsCache=A}setFailedEventsCache(A){this.failedEventsCache=A}async setAccountId(A){await this.failedEventsCache?.setAccountId(A)}submit(A,j,t,r,o){A.addListener(this.taskListener),this.activeTasks.add(A),A.execute(j,t,r,o)}getActiveTasks(){return Array.from(this.activeTasks)}getFailedEventsCache(){return this.failedEventsCache}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}pauseTasks(){this.activeTasks.forEach(A=>A.pause())}resumeTasks(){this.activeTasks.forEach(A=>A.resume())}taskListener={onFundingTaskStateChange:(A,j,t)=>{switch(j.type){case"fundingStarted":break;case"fundingCompleted":this.activeTasks.delete(A),A.removeListener(this.taskListener);break;case"fundingFailed":A.removeListener(this.taskListener),this.failedEventsCache?.addEvent(A);break}this.listeners.forEach(r=>r.onFundingPoolStateChange(j,A,this.getActiveTasks()))}}};n();s();n();s();n();s();n();s();var YO="perps_deposit_step";var Zp=class{storage;listeners=[];userAddress=null;constructor(A){this.storage=A}setUserAddress(A){this.userAddress=A}getKey(){if(!this.userAddress)throw new Error("User address not set");return`${YO}_${this.userAddress}`}set(A,j){(async()=>{let t={step:A,startedAt:j||Date.now()};await this.storage.set(this.getKey(),t),this.notifyListeners(t)})()}clear(){(async()=>(await this.storage.remove(this.getKey()),this.notifyListeners(null)))()}async get(){if(!this.userAddress)return null;let A=await this.storage.get(this.getKey());if(!A)return null;let j=A;return Date.now()-j.startedAt>12e5?(this.clear(),null):j}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(A){for(let j of this.listeners)j.onDepositStepChange(A)}};n();s();function LS(e){return e.type==="idle"?"idle":e.type==="streamOperations"?`${e.sourceTxHash}:${e.depositAddress}`:`${e.type}:${e.depositAddress}`}var N7=null;function ZO(e){return N7||(N7=new Zp(e)),N7}var Ac=class{constructor(A,j,t){this.perps=A;this.cache=ZO(j),this.perps.user&&this.cache.setUserAddress(M(this.perps.user)),this.analytics=t}cache;analytics;async getStuckDeposit(){this.perps.user&&this.cache.setUserAddress(M(this.perps.user));let A=await this.cache.get();return A?.step.type==="transfer"?(this.cache.clear(),null):A}async retry(A){if(A.type!=="streamOperations"){this.cache.clear();return}let j=LS(A);try{let t=await this.pollForOperationCompletion(A);if(!t.destinationAmount)throw this.cache.clear(),new Error("Operation has no destination amount");let{destinationAmount:r}=t,o=await this.perps.spot.getTokenMidPrice(A.spotTokenId),{totalSz:i,avgPx:a}=await this.sellSpotAsset(new w(r),A.assetId,o,A.tokenDecimals,j);await this.transferToPerps(i,a,j),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.cache.clear()}catch{this.cache.clear();return}}async pollForOperationCompletion(A){let r=!1;for(let o=0;o<15;o++){let i=await this.perps.client.getOperations({taker:M(this.perps.user)}),a=`${A.sourceTxHash}:${A.depositAddress}`,u=i.operations.find(c=>c.sourceTxHash===a);if(u){if(r=!0,u.state==="failure")throw new Error("Operation failed");if(u.state==="done")return u}o<14&&await new Promise(c=>setTimeout(c,5e3))}throw r?new Error("Operation not done after maximum attempts"):new Error("Operation not found")}async sellSpotAsset(A,j,t,r,o){let i=A.shiftedBy(-r).decimalPlaces(3,w.ROUND_DOWN),a=await this.perps.spot.sell(j,i.toString(),t);return this.analytics.reportDeposit("perpsHyperunitDepositSellSpotCompleted",{depositId:o,assetId:j,assetLimitPriceUsd:t,tokenDecimals:r,adjustedDepositedAmount:i}),{totalSz:new w(a.totalSz),avgPx:new w(a.avgPx)}}async transferToPerps(A,j,t){let r=A.multipliedBy(j).decimalPlaces(2,w.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:r}),this.analytics.reportDeposit("perpsHyperunitDepositTransferToPerpCompleted",{depositId:t,totalSz:A,avgPx:j,transferUsdcAmount:r}),r}};n();s();var at=class{startedAt;type;minimumUiAmount;amount;amountUsd;estimatedTime;fee;withdrawAddress;withdrawAddressRole;state={type:"indeterminate"};listeners=new Set;constructor(A,j,t,r,o,i){this.startedAt=Date.now(),this.type=A,this.minimumUiAmount=j,this.estimatedTime=t,this.fee=r,this.withdrawAddress=o,this.withdrawAddressRole=i}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}notify(A,j){this.listeners.forEach(t=>t.onFundingTaskStateChange(this,A,j))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};n();s();var ec=class{step={type:"idle"};listeners=[];setStep(A){this.step=A}completeStep(A){let j=this.step,t=this.detectNextStep(A);if(!t){this.listeners.forEach(r=>r.onStepCompleted(this.step,void 0)),this.listeners.forEach(r=>r.onDepositCompleted());return}this.step=t,this.listeners.forEach(r=>r.onStepCompleted(j,t))}detectNextStep(A){switch(A.stepType){case"idle":return{type:"transfer",depositAddress:A.depositAddress,depositAmount:A.amount};case"transfer":if(this.step.type!=="transfer")throw new Error("Invalid step: expected transfer, got "+this.step.type);return{...this.step,type:"streamOperations",senderAddress:A.senderAddress,networkId:A.networkId,tokenDecimals:A.tokenDecimals,sourceTxHash:A.txHash,assetId:A.assetId,spotTokenId:A.spotTokenId,assetLimitPriceUsd:A.assetLimitPriceUsd};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return{...this.step,type:"sellSpotAsset",destinationAmount:A.destinationAmount};case"sellSpotAsset":if(this.step.type!=="sellSpotAsset")throw new Error("Invalid step: expected sellSpotAsset, got "+this.step.type);return{...this.step,type:"transferToPerps",totalSz:A.totalSz,avgPx:A.avgPx};case"transferToPerps":if(this.step.type!=="transferToPerps")throw new Error("Invalid step: expected transferToPerps, got "+this.step.type);return}}failStep(A){this.listeners.forEach(j=>j.onDepositFailed(this.step,A))}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}getStep(){return this.step}};n();s();var L7=class{constructor(A,j,t){this.sourceAddress=A;this.networkId=j;this.account=t}async execute(A,j,t,r){let o=Nt(this.networkId),i=new Hm.Transaction().add(BA.SystemProgram.transfer({fromPubkey:new BA.PublicKey(this.sourceAddress),toPubkey:new BA.PublicKey(j),lamports:A.toNumber()}));i=await So(i,{connection:o}),i.feePayer=new BA.PublicKey(this.sourceAddress),await Lm(i,o);let a=await bo({accountIdentifier:this.account.identifier,feePayer:new BA.PublicKey(this.sourceAddress),connection:o,accountSigner:r,transaction:i,pendingTransactionInput:{ownerAddress:this.sourceAddress,networkID:this.networkId,data:{signature:""},type:"dappInteraction",display:{summary:{topLeft:{text:"Deposit"}}}},storage:t});return await Hj({connection:o,signature:a}),{senderAddress:this.sourceAddress,networkId:this.networkId,tokenDecimals:9,txHash:a}}},jc=class{create(A,j){let t=A.chainId,r=j.addresses.find(o=>o.networkID===t)?.address;if(!r)throw new Error(`No source address found for networkID: ${t}`);if(I.isSolanaNetworkID(t))return new L7(r,t,j);throw new Error(`Unsupported chain for deposit transfer: ${t}`)}};n();s();function K7(e){switch(e.type){case"transfer":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString()};case"streamOperations":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash};case"sellSpotAsset":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash,destinationAmount:e.destinationAmount.toString()};case"transferToPerps":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash,destinationAmount:e.destinationAmount.toString(),totalSz:e.totalSz.toString(),avgPx:e.avgPx.toString()};default:return{step:e.type}}}var U7=e=>{switch(e.type){case"perpsToSpot":case"buyAsset":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString()};case"sendToWithdrawAddress":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString(),assetMidPrice:e.assetMidPrice.toString(),filledAmount:e.filledAmount.toString()};case"streamOperations":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString(),sendToWithdrawAmount:e.sendToWithdrawAmount.toString(),operationStartTime:e.operationStartTime.toISOString()};default:return{step:e.type}}};n();s();var Ln=class{constructor(A){this.perpsClient=A}streamOpen=!1;listeners=[];interval=2e3;startStream(A,j,t){this.streamOpen=!0,this.stream(M(A),j,t)}startWithdrawStream(A,j,t){this.streamOpen=!0,this.streamWithdraw(M(A),j,t)}stream(A,j,t){this.streamOpen&&(async()=>{try{let r=await this.perpsClient.getOperations({taker:A}),o=`${j}:${t}`,i=r.operations.find(a=>a.sourceTxHash===o);this.listeners.forEach(a=>{a.onOperation(r,i)}),this.streamOpen&&setTimeout(()=>this.stream(A,j,t),this.interval)}catch(r){this.listeners.forEach(o=>{o.onError(r)}),this.stopStream()}})()}streamWithdraw(A,j,t){this.streamOpen&&(async()=>{try{let r=await this.perpsClient.getOperations({taker:A}),o=this.findMatchingWithdrawOperation(r.operations,j,t);this.listeners.forEach(i=>{i.onOperation(r,o)}),this.streamOpen&&setTimeout(()=>this.streamWithdraw(A,j,t),this.interval)}catch(r){this.listeners.forEach(o=>{o.onError(r)}),this.stopStream()}})()}findMatchingWithdrawOperation(A,j,t){let r=A.filter(o=>{if(o.sourceChain!=="hyperliquid"||o.destinationChain!=="solana"||!o.opCreatedAt)return!1;let i=new Date(o.opCreatedAt).getTime(),a=Math.abs(i-j.getTime()),u=4*60*1e3;if(a>u)return!1;if(o.sourceAmount){let c=new w(o.sourceAmount).dividedBy(10**or.data.decimals),l=t,m=c.minus(l).abs(),B=l.multipliedBy(.1);if(m.isGreaterThan(B))return!1}return!0});if(r.length!==0)return r.sort((o,i)=>new Date(i.opCreatedAt).getTime()-new Date(o.opCreatedAt).getTime())[0]}stopStream(){this.streamOpen=!1}subscribe(A){return this.listeners.push(A),()=>this.unsubscribe(A)}unsubscribe(A){this.listeners=this.listeners.filter(j=>j!==A)}};var tc=class e extends at{constructor(j,t,r,o,i,a,u,c,l,m,B,k,f){super("deposit",j,t,r);this.perps=o;this.assetId=i;this.spotTokenId=a;this.depositTokenCaip19=u;this.account=c;this.depositAddress=l;this.storage=m;this.signer=B;this.analytics=k,this.stateMachine.addListener(this.stateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new Ln(this.perps.client),this.depositRecoverer=new Ac(this.perps,this.storage,this.analytics),this.perps.user&&this.depositRecoverer.cache.setUserAddress(M(this.perps.user)),this.depositId=f||mj(),this.reportAnalytics("perpsDepositInitialized",{})}stateMachine=new ec;depositTransferFactory=new jc;operationsStreamer;depositRecoverer;fundingState="active";analytics;depositId;reportAnalytics(j,t){let r={fundingType:"deposit",fundingRoute:"hyperunit",amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,assetId:this.assetId,spotTokenId:this.spotTokenId,depositTokenCaip19:M(this.depositTokenCaip19),depositAddress:this.depositAddress,depositId:this.depositId};this.analytics.reportDeposit(j,{...r,...t})}stateMachineListener={onStepCompleted:(j,t)=>{this.fundingState!=="paused"&&(j.type==="transfer"&&this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),t&&(this.depositRecoverer.cache.set(t,this.startedAt),this.executeStep(t)))},onDepositCompleted:()=>{this.depositRecoverer.cache.clear(),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics("perpsDepositCompleted",{})},onDepositFailed:(j,t)=>{console.error(`Deposit failed at step: ${j.type}`,t),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"failed",error:t},this.notify({type:"fundingFailed",error:t},this.state),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(t)})}};stateLogsListener={onStepCompleted:(j,t)=>{b.addBreadcrumb("perps",`Deposit step completed: ${j.type}`,"info",{...K7(j),amountUsd:this.amountUsd??""})},onDepositCompleted:()=>{this.stateMachine.removeListener(this.stateLogsListener)},onDepositFailed:(j,t)=>{b.addBreadcrumb("perps",`Deposit failed at step: ${j.type}`,"error",{error:t instanceof Error?t.message:"Unknown error",...K7(j),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)}};execute(j,t,r,o){if(this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),o){this.stateMachine.setStep(o.state),this.stateMachine.completeStep(o.completedStep);return}this.stateMachine.completeStep({stepType:"idle",depositAddress:this.depositAddress,amount:j})}pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics("perpsDepositPaused",{})}resume(){this.fundingState="active";let j=this.stateMachine.getStep();j.type==="streamOperations"&&((async()=>{try{if(!this.perps.user)return;let t=await this.perps.client.getOperations({taker:M(this.perps.user)}),r=`${j.sourceTxHash}:${j.depositAddress}`,o=t.operations.find(i=>i.sourceTxHash===r);o&&o.state==="done"?this.processOperation(o):this.executeStep(j)}catch{this.executeStep(j)}})(),this.reportAnalytics("perpsDepositResumed",{}))}executeStep(j){(async()=>{try{switch(j.type){case"transfer":this.reportAnalytics("perpsHyperunitDepositTransferStarted",{...j});let{senderAddress:t,networkId:r,tokenDecimals:o,txHash:i}=await this.transfer(j.depositAmount),a=await this.perps.spot.getTokenMidPrice(this.spotTokenId);this.stateMachine.completeStep({stepType:"transfer",senderAddress:t,networkId:r,tokenDecimals:o,txHash:i,assetId:this.assetId,spotTokenId:this.spotTokenId,assetLimitPriceUsd:a}),this.reportAnalytics("perpsHyperunitDepositTransferCompleted",{...j,senderAddress:t,networkId:r,tokenDecimals:o,txHash:i,assetLimitPriceUsd:a});break;case"streamOperations":this.reportAnalytics("perpsHyperunitDepositStreamOperationsStarted",{...j}),this.startOperationsStream(j.sourceTxHash,j.depositAddress),this.reportAnalytics("perpsHyperunitDepositStreamOperationsCompleted",{...j});break;case"sellSpotAsset":this.reportAnalytics("perpsHyperunitDepositSellSpotStarted",{...j});let u=await this.sellSpotAsset(j.depositAmount,j.tokenDecimals);this.stateMachine.completeStep({stepType:"sellSpotAsset",...u}),this.reportAnalytics("perpsHyperunitDepositSellSpotCompleted",{...j,...u});break;case"transferToPerps":this.reportAnalytics("perpsHyperunitDepositTransferToPerpStarted",{...j});let c=await this.transferToPerps(j.totalSz,j.avgPx);this.stateMachine.completeStep({stepType:"transferToPerps",transferUsdcAmount:c}),this.reportAnalytics("perpsHyperunitDepositTransferToPerpCompleted",{...j,transferUsdcAmount:c});break}}catch(t){this.stateMachine.failStep(t)}})()}async transfer(j){return await this.depositTransferFactory.create(this.depositTokenCaip19,this.account).execute(j,this.depositAddress,this.storage,this.signer)}startOperationsStream(j,t){if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startStream(this.perps.user,j,t)}operationsStreamListener={onOperation:(j,t)=>{t&&this.processOperation(t)},onError:j=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(j)}};processOperation(j){if(j.state==="failure"){this.stateMachine.failStep(new Error("Operation failed"));return}if(j.state==="done"){if(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),!j.destinationAmount)throw new Error("Destination amount is required");this.stateMachine.completeStep({stepType:"streamOperations",destinationAmount:new w(j.destinationAmount)})}}async sellSpotAsset(j,t){let r=j.shiftedBy(-t).decimalPlaces(3,w.ROUND_DOWN),o=await this.perps.spot.getTokenMidPrice(this.spotTokenId),i=await this.perps.spot.sell(this.assetId,r.toString(),o);return{totalSz:new w(i.totalSz),avgPx:new w(i.avgPx)}}async transferToPerps(j,t){let r=j.multipliedBy(t).decimalPlaces(2,w.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:r}),r}static create({minimumUiAmount:j,estimatedTime:t,fee:r,perps:o,assetId:i,spotTokenId:a,depositTokenCaip19:u,account:c,depositAddress:l,storage:m,signer:B,analytics:k,depositId:f}){return new e(j,t,r,o,i,a,u,c,l,m,B,k,f)}};n();s();n();s();var US={1:7e-4,2:6e-4,3:5e-4,4:4e-4,5:35e-5,6:3e-4,7:.0025,8:.002};n();s();var rc=class{step;constructor(A){A?this.step=A:this.step={type:"idle"}}setStep(A){this.step=A}listeners=[];completeStep(A){let j=this.step,t=this.detectNextStep(A);if(!t){this.listeners.forEach(r=>r.onStepCompleted(this.step,void 0)),this.listeners.forEach(r=>r.onWithdrawCompleted());return}this.step=t,this.listeners.forEach(r=>r.onStepCompleted(j,t))}failStep(A){this.listeners.forEach(j=>j.onWithdrawFailed(this.step,A))}detectNextStep(A){switch(A.stepType){case"idle":return{type:"perpsToSpot",withdrawAddress:A.withdrawAddress,assetId:A.assetId,estimatedTime:A.estimatedTime,withdrawAmountUsd:A.withdrawAmountUsd};case"perpsToSpot":if(this.step.type!=="perpsToSpot")throw new Error("Invalid step: expected perpsToSpot, got "+this.step.type);return{...this.step,type:"buyAsset"};case"buyAsset":if(this.step.type!=="buyAsset")throw new Error("Invalid step: expected buyAsset, got "+this.step.type);return{...this.step,type:"sendToWithdrawAddress",assetMidPrice:A.assetMidPrice,filledAmount:A.filledAmount};case"sendToWithdrawAddress":if(this.step.type!=="sendToWithdrawAddress")throw new Error("Invalid step: expected sendToWithdrawAddress, got "+this.step.type);return{...this.step,type:"streamOperations",sendToWithdrawAmount:A.sendToWithdrawAmount,operationStartTime:new Date};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}getStep(){return this.step}};var oc=class extends at{constructor(j,t,r,o,i,a,u,c,l,m){super("withdraw",u,c,l);this.withdrawAddress=j;this.withdrawAddressRole=t;this.assetId=r;this.spotTokenName=o;this.spotTokenId=i;this.perps=a;this.analytics=m,this.stateMachine.addListener(this.withdrawStateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new Ln(this.perps.client),this.reportAnalytics("perpsWithdrawInitialized",{})}stateMachine=new rc;analytics;operationsStreamer;fundingState="active";reportAnalytics(j,t){let r={fundingType:"withdraw",amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole,assetId:this.assetId,spotTokenName:this.spotTokenName,spotTokenId:this.spotTokenId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(j,{...r,...t})}withdrawStateMachineListener={onStepCompleted:(j,t)=>{this.fundingState!=="paused"&&(j.type==="sendToWithdrawAddress"&&this.notify({type:"fundingBridgingStarted",estimateTime:"4"},this.state),t&&this.executeStep(t))},onWithdrawCompleted:()=>{this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics("perpsWithdrawCompleted",{})},onWithdrawFailed:(j,t)=>{console.error(`Withdraw failed at step: ${j.type}`,t),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"failed",error:t},this.notify({type:"fundingFailed",error:t},this.state),this.reportAnalytics("perpsWithdrawFailed",{error:JSON.stringify(t)})}};stateLogsListener={onStepCompleted:(j,t)=>{b.addBreadcrumb("perps",`Withdraw step completed: ${j.type}`,"info",{...U7(j),amountUsd:this.amountUsd??""})},onWithdrawCompleted:()=>{this.stateMachine.removeListener(this.stateLogsListener)},onWithdrawFailed:(j,t)=>{b.addBreadcrumb("perps",`Withdraw failed at step: ${j.type}`,"error",{error:t instanceof Error?t.message:"Unknown error",...U7(j),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)}};pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics("perpsWithdrawPaused",{})}resume(){this.fundingState="active";let j=this.stateMachine.getStep();j.type==="streamOperations"&&(this.perps.user&&this.executeStep(j),this.reportAnalytics("perpsWithdrawResumed",{}))}execute(j,t,r,o){if(this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),o){this.stateMachine.setStep(o.state),this.stateMachine.completeStep(o.completedStep);return}this.stateMachine.completeStep({stepType:"idle",withdrawAddress:this.withdrawAddress,assetId:this.assetId,estimatedTime:this.estimatedTime??"",withdrawAmountUsd:j})}executeStep(j){(async()=>{try{switch(j.type){case"perpsToSpot":this.reportAnalytics("perpsHyperunitWithdrawPerpsToSpotStarted",j),await this.transferToSpot(j.withdrawAmountUsd),this.reportAnalytics("perpsHyperunitWithdrawPerpsToSpotCompleted",j);break;case"buyAsset":this.reportAnalytics("perpsHyperunitWithdrawBuyAssetStarted",j),await this.buyAsset(j.assetId,j.withdrawAmountUsd),this.reportAnalytics("perpsHyperunitWithdrawBuyAssetCompleted",j);break;case"sendToWithdrawAddress":this.reportAnalytics("perpsHyperunitWithdrawSendToWithdrawAddressStarted",j),await this.sendToWithdrawAddress(this.spotTokenName,this.spotTokenId,j.filledAmount),this.reportAnalytics("perpsHyperunitWithdrawSendToWithdrawAddressCompleted",j);break;case"streamOperations":this.reportAnalytics("perpsHyperunitWithdrawStreamOperationsStarted",j),this.startOperationsStream(j),this.reportAnalytics("perpsHyperunitWithdrawStreamOperationsCompleted",j);break}}catch(t){this.stateMachine.failStep(t)}})()}async transferToSpot(j){let t=this.withdrawAddressRole==="missing"?new w(1):new w(0);await this.perps.transfer({toPerp:!1,amount:j.minus(t)}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.stateMachine.completeStep({stepType:"perpsToSpot"})}async buyAsset(j,t){let r=await this.perps.spot.getTokenMidPrice(this.spotTokenId),o=t.dividedBy(r.multipliedBy(Xp)).decimalPlaces(3),i=await this.perps.spot.buy(j,o.toString(),r),a=US[1];this.stateMachine.completeStep({stepType:"buyAsset",assetMidPrice:r,filledAmount:new w(i.totalSz).multipliedBy(1-a)})}async sendToWithdrawAddress(j,t,r){let o=this.fee.dividedBy(10**or.data.decimals),i=r.minus(o).decimalPlaces(3,w.ROUND_DOWN);await this.perps.spot.send(j,t,i,this.withdrawAddress),this.stateMachine.completeStep({stepType:"sendToWithdrawAddress",sendToWithdrawAmount:i})}startOperationsStream(j){if(j.type!=="streamOperations")throw new Error("Invalid step type for operations stream");if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startWithdrawStream(this.perps.user,j.operationStartTime,j.sendToWithdrawAmount)}operationsStreamListener={onOperation:(j,t)=>{t&&this.processOperation(t)},onError:j=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(j)}};processOperation(j){if(j.state==="failure"){this.stateMachine.failStep(new Error("Withdrawal operation failed"));return}j.state==="done"&&(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),this.stateMachine.completeStep({stepType:"streamOperations"}))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var Kn=class{analytics;constructor(A){this.analytics=A}async createTask(A,j,t,r,o,i,a,u){switch(u.type){case"deposit":return this.createDepositTask(A,j,u.depositTokenCaip19,a,o,i,u.depositId);case"withdraw":return this.createWithdrawTask(A,u.withdrawNetworkId,j)}}async createDepositTask(A,j,t,r,o,i,a){let{fundingCaip19Address:u,spotAssetId:c,eta:l,minimumAmount:m,spotTokenId:B,fee:k}=await A.client.postFunding({type:"deposit",taker:M(r),originChain:t.chainId}),f=this.checkCaip19Address(u);return tc.create({minimumUiAmount:new w(m),estimatedTime:l,fee:new w(k),perps:A,assetId:c,spotTokenId:B,depositTokenCaip19:t,account:j,depositAddress:f,storage:o,signer:i,analytics:this.analytics,depositId:a})}async createWithdrawTask(A,j,t){let r=t.addresses.find(f=>f.networkID===j);if(!r)throw new Error("Couldn't find destination account address for network: "+j);let{fundingCaip19Address:o,spotAssetId:i,eta:a,minimumAmount:u,spotTokenName:c,spotTokenId:l,fee:m}=await A.client.postFunding({type:"withdraw",taker:M({resourceType:"address",chainId:r.networkID,address:r.address}),originChain:j}),B=this.checkCaip19Address(o),k=await A.client.getUserRole(B);return new oc(B,k.role,i,c,l,A,new w(u),a,new w(m),this.analytics)}checkCaip19Address(A){let j=GA(A);if(j.resourceType!=="address")throw new Error("Funding CAIP19 is not an address");return j.address}};n();s();var H7=class extends at{constructor(j,t=!1){super(j,new w(.01),"1m",new w(8471530));this.shouldFail=t}execute(j,t,r){this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),setTimeout(()=>{if(this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.shouldFail){setTimeout(()=>{this.state={type:"failed",error:new Error("Mock funding task failed")},this.notify({type:"fundingFailed",error:new Error("Mock funding task failed")},this.state)},3e3);return}setTimeout(()=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state)},3e3)},3e3)}pause(){}resume(){}},nc=class{createTask(A,j,t,r,o,i,a,u){return Promise.resolve(new H7(u.type,!1))}};n();s();n();s();n();s();n();s();var Ti=class{account;authRepository;cashAccount;signer;solanaConnection;storage;constructor(A){this.account=A.account,this.authRepository=A.authRepository,this.cashAccount=A.cashAccount,this.signer=A.signer,this.solanaConnection=A.solanaConnection,this.storage=A.storage}getSolanaAddress(){let A=this.account.addresses.find(j=>j.addressType==="solana");if(!A)throw new Error("No Solana address found for account");return A.address}isCash(A){return A?.resourceType!=="address"||!this.cashAccount?!1:this.cashAccount.addressDetails.address===A.address}getTakerAddress(A){return A?.resourceType==="address"&&this.isCash(A)?A.address:this.getSolanaAddress()}getEvmAddress(){let A=this.account.addresses.find(j=>j.addressType==="eip155");if(!A)throw new Error("No EVM address found for account");return A.address}async fetchQuotes(A){let j=this.getTakerAddress(A.fromTokenOwner),t=this.getEvmAddress(),r=this.isCash(A.fromTokenOwner),o={sellToken:A.fromToken,buyToken:A.toToken,taker:{chainId:A.fromChain,address:j,resourceType:"address"},takerDestination:{chainId:A.toChain,address:t.toLowerCase(),resourceType:"address"},sellAmount:A.amount.toString(),slippageTolerance:(A.slippageBps??100)/100,phantomCashAccount:r};b.addBreadcrumb("perps","Fetching Relay quotes","info",{sellAmount:o.sellAmount,sellToken:M(o.sellToken),buyToken:M(o.buyToken),fromChain:o.sellToken.chainId,toChain:o.buyToken.chainId});try{let i=await N.api().retry(1,YA(1e3,1e3)).post("/swap/v2/quotes",o);if(i.status!==200)throw new Error(`Failed to fetch quotes: ${i.status}`);let a=i.data;return b.addBreadcrumb("perps","Relay quotes fetched","info",{quotesCount:a.quotes.length,firstQuoteBuyAmount:a.quotes[0]?.buyAmount}),a.quotes}catch(i){throw b.addBreadcrumb("perps","Failed to fetch Relay quotes","error",{error:i instanceof Error?i.message:"Unknown error"}),i}}async executeSwap(A,j,t="solana:101"){let r=this.getTakerAddress(j),o=this.isCash(j),i=await AM(r,A,this.solanaConnection);try{b.addBreadcrumb("perps","Executing Relay swap","info",{buyAmount:A.buyAmount,sellAmount:A.sellAmount});let a=mj(),u=await this.authRepository?.getUser();if(!u)throw new Error("User not found for swap");let{accessToken:c,userID:l}=u,m;return o?m=await xs({unsignedTransaction:Nm(i),vaultProxy:this.signer,accountIdentifier:this.account.identifier,signerAddress:r,idempotencyKey:a,isCash:!0,accessToken:c,userID:l,skipActivityRecording:!1,swapInfo:void 0,waitForActivityState:"completed"}):(m=await bo({accountIdentifier:this.account.identifier,accountSigner:this.signer,transaction:i,feePayer:new BA.PublicKey(r),connection:this.solanaConnection,storage:this.storage,pendingTransactionInput:{ownerAddress:r,networkID:t,data:{signature:""},type:"dappInteraction",display:{summary:{topLeft:{text:"Deposit"}}}}}),await Hj({connection:this.solanaConnection,signature:m})),b.addBreadcrumb("perps","Relay swap transaction sent","info",{signature:m}),m}catch(a){throw b.addBreadcrumb("perps","Failed to send Relay swap transaction","error",{error:a instanceof Error?a.message:"Unknown error"}),a}}};async function AM(e,A,j){let t=ue(A.steps[0]?.transactionData,"bs58");t=await So(t,{connection:j});let r=new BA.PublicKey(e);return await ao(t,j),Km(t,r),t}n();s();var eM=p.object({status:p.enum(["waiting","success","failure","refund","delayed","pending"]),requestId:p.string().optional()}),Pi=class{pollInterval=null;listeners=new Set;POLL_INTERVAL_MS=1e3;MAX_POLL_ATTEMPTS=45;pollAttempts=0;subscribe(A){this.listeners.add(A)}unsubscribe(A){this.listeners.delete(A)}startPolling(A){this.pollAttempts=0,this.poll(A)}stopPolling(){this.pollInterval&&(clearTimeout(this.pollInterval),this.pollInterval=null)}async poll(A){this.pollAttempts++;try{let j=await this.fetchBridgeStatus(A);if(this.listeners.forEach(t=>t.onStatusUpdate(j)),j.status==="success"){b.addBreadcrumb("perps",`Relay bridge completed for request: ${A}`,"info",{requestId:A}),this.listeners.forEach(t=>t.onCompleted(j)),this.stopPolling();return}if(j.status==="failure"||j.status==="refund"){let t=new Error(`Relay bridge failed with status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge failed","error",{requestId:A,status:j.status}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}if(j.status!=="waiting"&&j.status!=="pending"&&j.status!=="delayed"){let t=new Error(`Unexpected Relay bridge status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge unexpected status","error",{requestId:A,status:j.status}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}if(this.pollAttempts>=this.MAX_POLL_ATTEMPTS){let t=new Error(`Relay bridge status polling timed out with status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge polling timeout","error",{requestId:A,finalStatus:j.status,attempts:this.pollAttempts}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}this.pollInterval=setTimeout(()=>{this.poll(A)},this.POLL_INTERVAL_MS)}catch(j){b.addBreadcrumb("perps",`Error polling Relay bridge status for request: ${A}`,"error",{error:j instanceof Error?j.message:"Unknown error",requestId:A,attempts:this.pollAttempts}),this.listeners.forEach(t=>t.onError(j)),this.stopPolling()}}async fetchBridgeStatus(A){let j=await N.api().retry(1,YA(1e3,1e3)).get("/swap/v2/spot/get-intents-status",{params:{requestId:A}});if(!AA(j))throw new Error("Failed to get bridge status: response is not okay");let t=j.data,r=eM.safeParse(t);if(!r.success)throw new Error("Failed to get bridge status: schema validation failed");return r.data}};var HS=250,jM=.05,sc=class e extends at{constructor(j,t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y){super("deposit",j,"",t);this.perps=r;this.account=o;this.authRepository=i;this.cashAccount=a;this.signer=u;this.storage=c;this.fromToken=l;this.fromTokenOwner=m;this.fromTokenDecimals=B;this.toToken=k;this.toTokenDecimals=f;this.fromChain=g;this.toChain=E;this.analytics=h,this.depositId=y||mj(),this.connection=Nt("solana:101"),this.relayBridge=new Ti({account:o,authRepository:i,cashAccount:a,signer:u,solanaConnection:this.connection,storage:c}),this.statusPoller=new Pi,this.reportAnalytics("perpsDepositInitialized",{})}relayBridge;connection;bridgeListeners=new Set;quote;isFetchingQuote=!1;statusPoller;analytics;depositId;reportAnalytics(j,t){let r={fundingType:"deposit",fundingRoute:"relay",amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,fromToken:M(this.fromToken),toToken:M(this.toToken),fromChain:this.fromChain,toChain:this.toChain,depositId:this.depositId};this.analytics.reportDeposit(j,{...r,...t})}addBridgeListener(j){this.bridgeListeners.add(j)}removeBridgeListener(j){this.bridgeListeners.delete(j)}notifyBridgeListeners(j,...t){this.bridgeListeners.forEach(r=>{let o=r[j];typeof o=="function"&&o.call(r,...t)})}async fetchQuote(j,t){this.isFetchingQuote=!0;try{let r=j.shiftedBy(this.fromTokenDecimals),o=await this.relayBridge.fetchQuotes({amount:r.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:HS});return o.length===0?(this.isFetchingQuote=!1,null):(this.quote=o[0],this.fee=new w(this.quote.steps[0]?.feeCosts?.[0]?.value??jM),b.addBreadcrumb("perps","Relay quote fetched","info",{inputAmount:j.toString(),tokenPrice:t.toString(),inputUsd:j.toString(),outputUsd:j.toString(),feeUsd:this.fee.toString(),buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount,fromTokenDecimals:this.fromTokenDecimals,toTokenDecimals:this.toTokenDecimals}),this.notifyBridgeListeners("onQuoteFetched",this.quote),this.quote)}catch(r){return b.addBreadcrumb("perps","Failed to fetch Relay quote","info",{error:r instanceof Error?r.message:"Unknown error"}),this.isFetchingQuote=!1,null}finally{this.isFetchingQuote=!1}}async execute(j,t,r){this.startedAt=Date.now(),this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics("perpsDepositInitiated",{});try{b.addBreadcrumb("perps","Fetching Relay bridge quotes","info",{amount:r,fromChain:this.fromChain,toChain:this.toChain});let o=new w(r).shiftedBy(this.fromTokenDecimals),i=await this.relayBridge.fetchQuotes({amount:o.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:HS});if(i.length===0)throw new Error("No quotes available for bridge");this.quote=i[0],this.notifyBridgeListeners("onQuoteFetched",this.quote),this.notify({type:"fundingBridgingStarted"},this.state),this.notifyBridgeListeners("onBridgeStarted"),b.addBreadcrumb("perps","Executing Relay bridge swap","info",{buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount});let a=await this.relayBridge.executeSwap(this.quote,this.fromTokenOwner);b.addBreadcrumb("perps","Relay bridge transaction submitted","info",{txHash:a}),this.notifyBridgeListeners("onBridgeCompleted",a);let u=this.quote.steps[0].id;if(!u)throw new Error("No request ID found in Relay quote");this.startPollingForCompletion(u)}catch(o){let i=o;this.state={type:"failed",error:i},this.notify({type:"fundingFailed",error:i},this.state),this.notifyBridgeListeners("onBridgeFailed",i),b.addBreadcrumb("perps","Relay bridge failed","error",{error:i.message}),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(i)})}}pause(){this.statusPoller.stopPolling(),b.addBreadcrumb("perps","Relay bridge pause requested - stopped polling","info"),this.reportAnalytics("perpsDepositPaused",{})}resume(){b.addBreadcrumb("perps","Relay bridge resume requested (no-op)","info"),this.reportAnalytics("perpsDepositResumed",{})}getFee(){return this.fee}startPollingForCompletion(j){let t={onStatusUpdate:r=>{b.addBreadcrumb("perps","Relay bridge status update","info",{requestId:j,status:r.status})},onCompleted:r=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),b.addBreadcrumb("perps","Relay bridge funds received","info",{requestId:j}),this.reportAnalytics("perpsDepositCompleted",{}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(t)},onError:r=>{b.addBreadcrumb("perps","Relay bridge polling error","error",{error:r.message,requestId:j}),this.statusPoller.unsubscribe(t),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(r)})}};this.statusPoller.subscribe(t),this.statusPoller.startPolling(j)}static create({minimumUiAmount:j,fee:t,perps:r,account:o,authRepository:i,cashAccount:a,signer:u,storage:c,fromToken:l,fromTokenOwner:m,fromTokenDecimals:B,toToken:k,toTokenDecimals:f,fromChain:g,toChain:E,analytics:h,depositId:y}){return new e(j,t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y)}};var tM=5,rM={chainId:"hypercore:mainnet",address:"0x00000000000000000000000000000000",resourceType:"address"},ic=class{hyperunitFactory;analytics;enableRelayBridgeSol;constructor(A,j){this.hyperunitFactory=new Kn(A),this.analytics=A,this.enableRelayBridgeSol=j}async fetchTokenInfo(A,j,t,r,o){let i=A.addresses.find(B=>B.networkID===t);if(!i)throw new Error("Couldn't find result address for network: "+t);let a=new rr,u={type:"swap",network:t,sellCaip19:M(r),buyCaip19:"solana:101/nativeToken:501",takerCaip19:o?M(o):void 0,takerDestinationCaip19:void 0},c=ai(j),l=await a.initialize(u,[i],c);if(!l.sellTokenPrice?.usd)throw new Error("No price available for token");let m=l.sellToken;return{priceUsd:new w(l.sellTokenPrice.usd),decimals:m.data.decimals}}async createTask(A,j,t,r,o,i,a,u){if(u.type!=="deposit")return this.hyperunitFactory.createTask(A,j,t,r,o,i,a,u);let{depositTokenCaip19:c,depositTokenWalletCaip19:l}=u;if(!this.enableRelayBridgeSol&&M(c)===pB)return this.hyperunitFactory.createTask(A,j,t,r,o,i,a,u);let{priceUsd:m,decimals:B}=await this.fetchTokenInfo(j,r,c.chainId,c,l),k=new w(tM).dividedBy(m);return sc.create({minimumUiAmount:k,estimatedTime:"5 seconds",fee:new w(0),perps:A,account:j,authRepository:t,cashAccount:r,signer:i,storage:o,fromToken:c,fromTokenOwner:l,fromTokenDecimals:B,toToken:rM,toTokenDecimals:18,fromChain:"solana:101",toChain:"hypercore:mainnet",analytics:this.analytics,depositId:u.depositId})}};var QS=(0,_j.createContext)(null),oM=!1;function nM({fundingPoolFactory:e,children:A}){let j=DS(),t=wA(),{useRelayBridge:r}=C7(),o=ea(),i=CA("enable-perps-relay-bridge-sol"),a=Lj(),u=(0,_j.useMemo)(()=>{let m;if(e)m=e.create();else{let k=new qi(t);m=new xi(k)}m.addListener(new Yp),m.addListener(new Jp);let B=oM?new nc:r?new ic(j,i):new Kn(j);return new $i({client:new Cn,isTestnet:o,fundingPool:m,fundingTaskFactory:B,authRepository:a})},[e,j,t,r,i,o,a]),{data:c}=aA();(0,_j.useEffect)(()=>{c&&u.setAccount(c)},[c,u]);let l=Sj();return(0,_j.useEffect)(()=>{u.setSigner(l)},[l,u]),_j.default.createElement(QS.Provider,{value:u},A)}function ac(){let e=(0,_j.useContext)(QS);if(!e)throw new Error("usePerps must be used within a PerpsProvider");return e}n();s();n();s();n();s();var zS=q(P());n();s();var VS=q(P()),Gi=()=>{let{data:[e]}=_A(["enable-perps"]),{data:A}=aA(),j=(0,VS.useMemo)(()=>A?.addresses.some(t=>I.isEVMNetworkID(t.networkID))??!1,[A]);return e&&j};n();s();var XA=q(P());var Q7=()=>{let e=ac(),A=(0,XA.useCallback)(()=>{e.syncAccountBalance()},[e]),[j,t]=(0,XA.useState)(e.getAccountBalanceState());(0,XA.useEffect)(()=>e.subscribeAccountBalanceState({onAccountBalanceStateChange:x=>{t(x)}}),[e]);let r=(0,XA.useCallback)(()=>{e.syncPositions()},[e]),[o,i]=(0,XA.useState)(e.getPositionsState());(0,XA.useEffect)(()=>e.subscribePositions({onPositionStateChange:x=>{i(x)}}),[e]);let a=(0,XA.useCallback)(()=>{e.syncPositionFees()},[e]),[u,c]=(0,XA.useState)(e.getPositionFeesState());(0,XA.useEffect)(()=>e.subscribePositionFees({onPositionFeesStateChange:x=>{c(x)}}),[e]);let l=(0,XA.useCallback)(()=>{e.syncFundingHistory()},[e]),[m,B]=(0,XA.useState)(e.getFundingHistoryState());(0,XA.useEffect)(()=>e.subscribeFundingHistory({onFundingHistoryStateChange:x=>{B(x)}}),[e]);let k=(0,XA.useCallback)(S=>{e.syncHistoricalOrders(S)},[e]),[f,g]=(0,XA.useState)(e.getHistoricalOrdersState());(0,XA.useEffect)(()=>e.subscribeHistoricalOrders({onHistoricalOrdersStateChange:x=>{g(x)}}),[e]);let E=(0,XA.useCallback)((S,x,O,v)=>{e.syncPricing(S,x,O,v)},[e]),h=(0,XA.useCallback)(S=>{e.startSequentialPricingSync(S)},[e]),[y,F]=(0,XA.useState)(e.getPricingState());return(0,XA.useEffect)(()=>e.subscribePricing({onPricingStateChange:x=>{F(x)}}),[e]),{isReady:e.getUser()!==void 0,accountBalanceState:j,syncAccountBalance:A,positionsState:o,syncPositions:r,positionFeesState:u,syncPositionFees:a,fundingHistoryState:m,syncFundingHistory:l,historicalOrdersState:f,syncHistoricalOrders:k,pricingState:y,syncPricing:E,startSequentialPricingSync:h}};n();s();n();s();n();s();var XS=3,sM=Wc(e=>{let A=e(V7);return{isPerpsBalanceError:A.accountBalanceErrors>=XS,isPerpsPositionsError:A.positionsErrors>=XS}}),V7=Wc({accountBalanceErrors:0,positionsErrors:0}),iM=sM;var z7=q(P());n();s();n();s();var to="perps",pc={historicalOrders:(e,A)=>[to,"historical-orders",e,A],market:e=>[to,"market",e],markets:e=>[to,"markets",e.sort()],defaultLeverage:()=>[to,"default-leverage"],assetLeverage:()=>[to,"asset-leverage"],permissions:()=>[to,"config"],fungibleToPerpMap:()=>[to,"fungible-to-perp-map"]};n();s();var aM={perp:6,spot:8};function WS(e,A,j="perp",t=w.ROUND_HALF_UP){let r=new w(e);if(r.isInteger())return r.toString();let o=aM[j],i=Math.max(o-A,0);return r.precision(5,t).toFixed(i,t).replace(/\.?0+$/,"")}var pM=K({days:1}),cM=K({minutes:5});var X7=(e,A=!1)=>X({enabled:e.length>0,queryKey:pc.markets(e),gcTime:pM,staleTime:cM,async queryFn(){try{return await uM(e,A)}catch(j){throw b.addBreadcrumb("perps","Failed to get perp markets","error",{caip19s:e.join(","),error:j instanceof Error?j.message:"Unknown error"}),j}}});async function uM(e,A=!1){let j=await N.api().get("/swap/v2/perp/markets",{params:{tokens:e.join(",")}});if(!AA(j))throw new Error("Failed to get perp markets: response is not okay");let t=j.data,r=sS.safeParse(t);if(!r.success)throw new Error("Failed to get perp markets: schema validation failed");if(A){let o=r.data.markets,i={};for(let[a,u]of Object.entries(o))i[a]={...u,price:WS(u.price,u.szDecimals),priceChange24h:{...u.priceChange24h,percentage:String(Number(u.priceChange24h.percentage)/100)}};return i}return r.data.markets}n();s();n();s();var lM=p.object({actions:p.boolean(),disableFunding:p.boolean().optional()}),dM=p.object({perps:lM}),zDA=p.enum(["open","close","funding","manage-position"]);var n2A=K({minutes:1}),s2A=K({minutes:1});n();s();var mM=q(P());n();s();var f2A=K({days:1}),g2A=K({minutes:15}),E2A=p.record(uo,uo);n();s();n();s();n();s();var JS=(r=>(r[r.Always=1/0]="Always",r[r.Short=K({days:1})]="Short",r[r.Medium=K({days:3})]="Medium",r[r.Long=K({days:7})]="Long",r))(JS||{}),YS=(o=>(o[o.Immediate=0]="Immediate",o[o.Short=K({minutes:1})]="Short",o[o.Medium=K({minutes:2.5})]="Medium",o[o.Long=K({minutes:60})]="Long",o[o.Never=1/0]="Never",o))(YS||{}),kM=(t=>(t[t.Short=K({seconds:20})]="Short",t[t.Medium=K({minutes:2.5})]="Medium",t[t.Long=K({minutes:5})]="Long",t))(kM||{});n();s();var Z2A=K({minutes:10}),ANA=K({minutes:10});var cc=q(P());n();s();var iw=q(uI()),aw=q(pI());var BM=p.object({domain:p.string(),url:p.string(),name:p.string(),category:p.string(),imageUrl:p.string(),slug:p.string()}),pw=p.object({uuid:p.string(),data:p.array(BM)}),fM=p.object({type:p.literal("site"),url:p.string(),name:p.string(),category:p.string(),imageUrl:p.string(),description:p.string().optional()}),gM=p.object({type:p.literal("tokenCategory"),id:p.string(),name:p.string(),subtitle:p.string().optional(),imageUrl:p.string(),description:p.string().optional()}),cw=p.discriminatedUnion("type",[fM,gM]),$NA=e=>e.type==="site";var EM=p.object({chainId:Mt,address:p.string(),name:p.string(),symbol:p.string(),logoUrl:p.string(),marketCap:p.number(),price:p.number(),priceChange:p.number(),volume:p.number(),volumeChange:p.number(),spamStatus:Jk.optional().default("NOT_VERIFIED")}),vNA=p.object({id:p.string(),name:p.string(),imageUri:p.string()}),uw=p.object({items:p.array(EM)}),yM=p.object({paymentTokenId:p.string(),name:p.string(),symbol:p.string(),decimals:p.number()}),hM=p.object({verified:p.boolean(),collectionUrl:p.string(),marketplaceId:p.string(),marketplaceName:p.string(),marketplaceCollectionId:p.string()}),FM=p.object({marketplaceId:p.string(),paymentToken:yM,value:p.string()}),SM=p.object({id:p.string(),name:p.string(),volume:p.string().optional(),volumePercentChange:p.number(),marketplacePages:p.array(hM),floorPrices:p.array(FM),imageUrl:p.string()}),lw=p.object({uuid:p.string(),data:p.array(SM)}),wM=["tokens","perps","sites","collections","learn","suggested-users-to-follow","suggested-users-to-follow-by-pnl","token-categories","tokens-for-you"],Dj=p.enum(["shortcuts","carousel",...wM]),bM=p.object({type:p.literal(Dj.enum.shortcuts)}),IM=p.object({type:p.literal(Dj.enum.carousel)}),$M=p.object({type:p.literal(Dj.enum["suggested-users-to-follow"]),limit:p.number()}),vM=["7d","30d"],ZS=p.enum(vM),qM=p.object({type:p.literal(Dj.enum["suggested-users-to-follow-by-pnl"]),limit:p.number(),timeFrame:p.array(ZS).refine(e=>new Set(e).size===e.length),timeFrameDefault:ZS}),Ci="all_networks",Un=p.union([Mt,p.literal(Ci)]),xM=["asc","desc"],dw=p.enum(xM),TM=["rank","volume","price","price-change","market-cap"],Aw=p.enum(TM),PM=["1h","24h","7d","30d"],ew=p.enum(PM),GM=p.object({type:p.literal(Dj.enum.tokens),sortBy:p.array(Aw).refine(e=>new Set(e).size===e.length),sortByDefault:Aw,sortDirectionDefault:dw,network:p.array(Un).refine(e=>new Set(e).size===e.length),networkDefault:Un,timeFrame:p.array(ew).refine(e=>new Set(e).size===e.length),timeFrameDefault:ew,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),CM=p.object({type:p.literal(Dj.enum["token-categories"])}),OM=["volume","price-change","open-interest"],jw=p.enum(OM),MM=["1h","24h","7d","30d"],tw=p.enum(MM),RM=p.object({type:p.literal(Dj.enum.perps),sortBy:p.array(jw).refine(e=>new Set(e).size===e.length),sortByDefault:jw,sortDirectionDefault:dw,timeFrame:p.array(tw).refine(e=>new Set(e).size===e.length),timeFrameDefault:tw,limit:p.number(),listLimit:p.number()}),_M=["top","rank"],rw=p.enum(_M),DM=["24h","7d","30d"],ow=p.enum(DM),NM=p.object({type:p.literal(Dj.enum.sites),sortBy:p.array(rw).refine(e=>new Set(e).size===e.length),sortByDefault:rw,network:p.array(Un).refine(e=>new Set(e).size===e.length),networkDefault:Un,timeFrame:p.array(ow).refine(e=>new Set(e).size===e.length),timeFrameDefault:ow,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),LM=["top","rank"],nw=p.enum(LM),KM=["24h","7d","30d"],sw=p.enum(KM),UM=p.object({type:p.literal(Dj.enum.collections),sortBy:p.array(nw).refine(e=>new Set(e).size===e.length),sortByDefault:nw,network:p.array(Un).refine(e=>new Set(e).size===e.length),networkDefault:Un,timeFrame:p.array(sw).refine(e=>new Set(e).size===e.length),timeFrameDefault:sw,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),HM=p.object({type:p.literal(Dj.enum.learn),limit:p.number()}),QM=p.object({type:p.literal(Dj.enum["tokens-for-you"]),limit:p.number(),listLimit:p.number()}),W7=p.discriminatedUnion("type",[bM,IM,$M,qM,GM,RM,NM,UM,HM,CM,QM]),mw=p.object({sections:p.array(W7).refine(e=>(0,iw.default)(e,(0,aw.default)(e,"type")))}),qNA=p.object({uuid:p.string(),data:p.array(_m)}),xNA=p.object({tokenAddress:p.string(),bondingCurve:p.string(),migratedPool:p.string().optional(),name:p.string(),image:p.string(),symbol:p.string(),marketCap:p.coerce.number(),liquidity:p.coerce.number(),bondingCurvePercentage:p.coerce.number(),tokenCreatedAt:p.coerce.date(),twitter:p.string(),website:p.string(),telegram:p.string(),discord:p.string(),migratedAt:p.coerce.date().optional(),type:p.enum(["NEW","ABOUT_TO_MIGRATE","MIGRATED"]).optional(),slot:p.coerce.number().optional(),devHolding:p.coerce.number(),snipersHolding:p.coerce.number(),bundlersHolding:p.coerce.number(),top10Holding:p.coerce.number(),volume:p.coerce.number(),buysCount:p.coerce.number(),sellsCount:p.coerce.number(),uniqueHolders:p.coerce.number(),telegramCallCount:p.coerce.number(),bondingCurvePlatform:p.string()});var kw=mw.parse({sections:[{type:"shortcuts"},{type:"carousel"},{type:"tokens",sortBy:["rank","volume","price","price-change","market-cap"],sortByDefault:"rank",sortDirectionDefault:"asc",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["1h","24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:100},{type:"perps",sortBy:["volume","price-change","open-interest"],sortByDefault:"volume",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"token-categories"},{type:"suggested-users-to-follow-by-pnl",limit:3,timeFrame:["7d","30d"],timeFrameDefault:"7d"},{type:"tokens-for-you",limit:3,listLimit:50},{type:"sites",sortBy:["rank","top"],sortByDefault:"rank",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:50},{type:"learn",limit:3}]}),VM=e=>{try{let A=JSON.parse(e??"");return A?.sections?{sections:A.sections.filter(t=>W7.safeParse(t).success)}:kw}catch{return kw}},J7=()=>{let e=Be.getMultivariateAssignment("explore-config"),{data:[A]}=_A(["enable-fungible-categories"]),j=CA("enable-social-tokens-for-you"),t=Gi();return(0,cc.useMemo)(()=>{let r=VM(e);return We||(r={...r,sections:r.sections.filter(o=>o.type!=="suggested-users-to-follow")}),(!j||!We)&&(r={...r,sections:r.sections.filter(o=>o.type!=="tokens-for-you")}),A||(r={...r,sections:r.sections.filter(o=>o.type!=="token-categories")}),t||(r={...r,sections:r.sections.filter(o=>o.type!=="perps")}),r},[e,A,t,j])},Y7=()=>{let e=J7();return(0,cc.useMemo)(()=>{let A=[];for(let j of e.sections)(j.type==="collections"||j.type==="tokens"||j.type==="perps"||j.type==="sites"||j.type==="learn"||j.type==="suggested-users-to-follow"||j.type==="suggested-users-to-follow-by-pnl"||j.type==="token-categories"||j.type==="tokens-for-you")&&A.push(j);return A},[e.sections])},Z7=e=>{let A=J7();return(0,cc.useMemo)(()=>A.sections.find(t=>t.type===e)??null,[A.sections,e])};n();s();n();s();n();s();n();s();var Bw="@phantom/fungible-categories",uc={fungibleCategories:e=>[Bw,"fungible-categories",e],fungibleCategoryById:e=>[Bw,"fungible-category",e]};n();s();n();s();var fw=p.object({items:p.array(Jc)}),gw=p.object({id:p.string(),name:p.string(),imageUri:p.string().nullish().transform(e=>e??""),items:Yc.array()});var Am=({limit:e,searchQuery:A}={})=>{let{data:[j]}=_A(["enable-fungible-categories"]);return X({enabled:j,queryKey:uc.fungibleCategories({enabled:j,searchQuery:A}),queryFn:async()=>{let t=await N.api().get("/fungibles/v1/categories",{params:{limit:"100",...A?{query:A}:{}}});return fw.parse(t.data)},select:t=>e?t.items.slice(0,e):t.items})};n();s();var zM=({id:e})=>{let{data:[A]}=_A(["enable-fungible-categories"]);return X({enabled:A,queryKey:uc.fungibleCategoryById({id:e,enabled:A}),queryFn:async()=>{let j=await N.api().get(`/fungibles/v1/categories/${e}`,{params:{includePrices:"true"}});return gw.parse(j.data)}})};var KA=q(P());n();s();n();s();n();s();var Ew={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var yw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var hw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var Fw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var Sw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var ww={tokenSearchEnabled:()=>!1,trendingTokensEnabled:()=>!1};n();s();var bw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var Iw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var $w={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};var XM=new ko({solana:Iw,ethereum:Fw,polygon:bw,base:yw,arbitrum:Ew,bitcoin:hw,monad:ww,sui:$w,hypercore:Sw}),em=mo(XM);n();s();var jm=e=>["explore-dapp",e];var lc=e=>e.addresses.map(A=>I.getMainnetNetworkID(A.networkID))??[];function vw(e){try{return Ij.get(e).nonNativeFungibleTokenType}catch{return"SolanaNative"}}n();s();n();s();var gj="@phantom/explore",ZA={RecentlyViewedSearchItems:[gj,"RecentlyViewedSearchItems"],sitesV2({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o}){return[gj,"sitesV2",PA,r,{sortBy:e,timeFrame:A,networkIDs:j,rankAlgo:o,limit:t}]},recommendedSites(e,A){return[gj,"sites","recommended",PA,A,e]},featuredItems(e,A){return[gj,"items","featured",PA,A,e]},tokensV2({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,limit:r,rankAlgo:o}){return[gj,"tokensV2",{sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,rankAlgo:o,limit:r}]},collectionsV2({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o}){return[gj,"collectionsV2",PA,r,{sortBy:e,timeFrame:A,networkIDs:j,rankAlgo:o,limit:t}]},featuredTransactions(e,A){return[gj,"transactions","featured",PA,A,e]},learn(e,A){return[gj,"learn",PA,A,e]},perpMarkets(e,A,j,t,r,o){return[gj,"perp-markets",{chainId:e,sortBy:A,sortDirection:j,timeFrame:t,limit:r,search:o}]}};var WM=10,xw="RecentlyViewedSearchItems";async function JM(e){return await e.get(xw)??[]}async function Tw(e,A){await e.set(xw,A)}function tm(e){return X({queryKey:ZA.RecentlyViewedSearchItems,queryFn:async()=>JM(e),staleTime:0,enabled:!0})}function YM(e){let A=pA();return IA({mutationFn:async t=>{let r=qw(t),i=(A.getQueryData(ZA.RecentlyViewedSearchItems)??[]).filter(a=>qw(a)!==r);i.unshift(t),i=i.slice(0,WM),await Tw(e,i),A.setQueryData(ZA.RecentlyViewedSearchItems,i),await A.refetchQueries({queryKey:ZA.RecentlyViewedSearchItems})}})}function ZM(e){let A=pA();return IA({mutationFn:async()=>{await Tw(e,[]),A.setQueryData(ZA.RecentlyViewedSearchItems,[]),await A.refetchQueries({queryKey:ZA.RecentlyViewedSearchItems})}})}function qw(e){return e.type==="token"||e.type==="perp"?M(U(e.data)):e.data.id}n();s();var nm=q(rm()),om=q(P());n();s();var Dw={fields:["domain","name","category","tags"],storeFields:["domain","name","category","tags","imageUrl"],searchOptions:{boost:{name:2},prefix:!0,fuzzy:e=>e.length>3?.2:!1}};var c8=e=>{let A={isRecommended:"true"};return e.networkIds&&(A.chainIds=e.networkIds.join(",")),`/dapps/v1?${new URLSearchParams(A).toString()}`},Nw=async e=>{let A=await N.api().get(c8(e));if(!AA(A))throw new Error("Error fetching recommended dapps from registry");if(!A?.data||!A?.data?.data)throw new Error("No data returned from registry");let j=A.data,t=(0,nm.default)(j.data??[],o=>o.id);return Object.values(t)},Lw=e=>{let A=pA();return X({queryKey:["dapps","recommended",e],queryFn:async()=>{try{let t=await Nw(e);return Kc.batch(()=>{for(let r of t){let o=jm(r.domain),i=A.getQueryState(o);A.setQueryData(o,()=>r??i?.data??null)}}),t}catch(t){throw b.captureError(t,"dappRegistry"),t}},gcTime:K({days:1}),staleTime:K({days:1})})},sm=(e,A)=>{let{searchQuery:j,networkIds:t}=e,{data:r=[],...o}=Lw({networkIds:t}),i=(0,om.useMemo)(()=>{let l=[...r||[],...A||[]],m=(0,nm.default)(l,B=>fl(B.domain));return Object.values(m)},[r,A]),a=fl(j),u=lB(i,a,Dw);return{data:(0,om.useMemo)(()=>{let l=new Map(i.map(m=>[m.id,m]));return u.map(m=>l.get(m.id)).filter(m=>m!==void 0).sort((m,B)=>B.recommendationScore-m.recommendationScore)},[u,i]),...o}};n();s();n();s();var Kw=async({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,limit:r,rankAlgo:o,anonymousId:i})=>{let a=new URLSearchParams({timeFrame:j,sortBy:e,sortDirection:A,limit:r.toString(),rankAlgo:o,...i?{anonymousId:i}:{}});t.forEach(l=>{a.append("chainIds[]",l)});let u=await N.api().get("/explore/v2/trending-tokens",{params:a});if(!AA(u))throw new Error("Failed to fetch tokens");let c=uw.safeParse(u.data);if(!c.success)throw new Error("Failed to parse tokens");return c.data};n();s();var Hn=(e,A)=>{let j=fo(),r=Y7().find(i=>i.type===A),o=[];return r&&"network"in r?r.network.forEach(i=>{i!==Ci&&j.includes(i)&&o.push(i)}):o=j,e!==Ci&&!o.includes(e)?[]:e===Ci?o:[e]};var u8=K({minutes:1}),l8=K({minutes:1}),d8=100,im=({sortBy:e,sortDirection:A,timeFrame:j,network:t,limit:r,rankAlgo:o,enableQuery:i=!0})=>{let{data:a}=aA(),u=J(),c=Hn(t,"tokens"),l=d8,m=fe(T.language)??"en";return X({queryKey:ZA.tokensV2({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:c,limit:l,rankAlgo:o}),enabled:!!a&&i,async queryFn(){if(!a)throw new Error("No account found");let B=await u.getDeviceId();return Kw({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:c,locale:m,limit:l,rankAlgo:o,anonymousId:B})},gcTime:l8,staleTime:u8,retry:3,select:B=>r>=l?B:{...B,items:B.items.slice(0,r)}})};var Qn=3,m8=15,dc=50,Uw={TRUSTED:1,VERIFIED:2,NOT_VERIFIED:3,POSSIBLE_SPAM:4,SPAM:5},k8=(e,A=100)=>{let[j,t]=(0,KA.useState)(!1);return(0,KA.useEffect)(()=>{let r;return e?r=setTimeout(()=>t(!0),A):t(!1),()=>clearTimeout(r)},[e,A]),j},B8=e=>{let A=vw(e.chainId),j=I.getChainDefinition(e.chainId),t={name:e.name,symbol:e.symbol,logoUri:e.logoUrl,spamStatus:e.spamStatus,chain:{id:e.chainId,symbol:j.tokenSymbol,name:j.name,imageUrl:j.iconUrl}};switch(A){case"SPL":return{type:A,data:{...t,mintAddress:e.address}};case"ERC20":return{type:A,data:{...t,contractAddress:e.address}};case"BRC20":return{type:A,data:{...t,firstCreatedInscriptionId:e.address}};default:return null}},f8=e=>e.reduce((A,j)=>{let t=B8(j);return t&&A.push(t),A},[]),g8=({searchQuery:e,networkIds:A,excludePlaceholderTokens:j=!1,extraDapps:t=[],actorSearchHook:r})=>{let[o,i]=(0,KA.useState)(!1),[a,u]=(0,KA.useState)(!1),[c,l]=(0,KA.useState)(!1),[m,B]=(0,KA.useState)(!1),[k,f]=(0,KA.useState)(!1),g=(0,KA.useMemo)(()=>A.filter(Ej=>em.get(Ej).tokenSearchEnabled()),[A]);(0,KA.useEffect)(()=>{i(!1),u(!1),l(!1),B(!1),f(!1)},[e]);let{data:E=[],isLoading:h}=Xr({query:e,networkIds:g,searchContext:"explore",enableQuery:!!e}),{data:y,isLoading:F}=Am({limit:e?void 0:10,searchQuery:e}),S=Z7("tokens"),{data:x}=im({sortBy:S?.sortByDefault??"rank",sortDirection:S?.sortDirectionDefault??"asc",timeFrame:S?.timeFrameDefault??"24h",network:S?.networkDefault??"solana:101",limit:10,rankAlgo:S?.rankAlgo??"default",enableQuery:!e&&!j}),{tokens:O,perps:v}=(0,KA.useMemo)(()=>E.sort((fr,ns)=>Uw[fr.data.spamStatus??"NOT_VERIFIED"]-Uw[ns.data.spamStatus??"NOT_VERIFIED"]).reduce((fr,ns)=>(ns.type==="HypercoreAsset"?fr.perps.push(ns):fr.tokens.push(ns),fr),{tokens:[],perps:[]}),[E]),D=(0,KA.useMemo)(()=>x?.items?f8(x.items):[],[x?.items]),G=e.length===0?m8:Qn,C=(0,KA.useMemo)(()=>O.slice(0,a?dc:G),[a,O,G]),_=(0,KA.useMemo)(()=>v.slice(0,c?dc:G),[c,v,G]),V=(0,KA.useMemo)(()=>[...C.map(Ej=>M(U(Ej))),...D.map(Ej=>M(U(Ej)))],[C,D]),{data:z={},isLoading:L}=lt({query:{data:V},enabled:V.length>0}),R=(0,KA.useMemo)(()=>_.map(Ej=>M(U(Ej))),[_]),{data:W,isPending:Q}=X7(R,!0),{data:jA=[],isLoading:Z}=sm({networkIds:g,searchQuery:e},t),mA=jA.slice(0,o?dc:Qn),cA=r??(()=>({data:void 0,isLoading:!1})),{data:rA,isLoading:Y}=cA({query:e}),sA=!!e,EA=Z||h||F||Y,lA=sA&&!EA,QA=wA(),{data:pe}=tm(QA),{actorsAll:ce,actors:Cm}=(0,KA.useMemo)(()=>{let Ej=rA?.actors??[],fr=Ej.slice(0,m?dc:Qn);return{actorsAll:Ej,actors:fr}},[m,rA?.actors]),Om=(0,KA.useMemo)(()=>{if(y)return k?y:y.slice(0,G)},[y,k,G]),os=(0,KA.useMemo)(()=>({actors:Cm,dapps:jA,searchedDapps:mA,renderShowMoreDappsButton:sA&&jA.length>Qn,isLoading:EA,tokens:C,perps:_,trendingTokens:D,renderShowMoreTokensButton:sA&&O.length>G,renderShowMorePerpsButton:sA&&v.length>G,renderShowMoreUsersButton:sA&&ce.length>Qn,priceMap:z,isPriceMapLoading:L,showSearchResults:lA,showMoreTokens:a,setShowMoreTokens:u,showMorePerps:c,setShowMorePerps:l,showMoreDapps:o,setShowMoreDapps:i,showMoreUsers:m,setShowMoreUsers:B,recentlyViewedSearchItems:pe,categories:Om,showMoreCategories:k,setShowMoreCategories:f,renderShowMoreCategoriesButton:sA&&y&&y?.length>Qn,perpMarketMap:W,isPerpMarketMapLoading:Q}),[Cm,jA,mA,sA,EA,C,_,D,O.length,v.length,G,ce.length,z,L,lA,a,c,o,m,pe,Om,k,y,W,Q]),[Mm,jI]=(0,KA.useState)(null),tI=k8(EA);return(0,KA.useEffect)(()=>{os.isLoading||jI(e?os:null)},[os.isLoading,e]),{...os.isLoading&&Mm?Mm:os,showSpinner:tI&&sA}};n();s();n();s();n();s();var E8=q(rm());n();s();var y8=q(P());n();s();var y5A=K({minutes:10}),h5A=K({minutes:10});n();s();var Qw=q(P());n();s();var Hw=async(e,A)=>{let j=new URLSearchParams({appVersion:PA,limit:"6",locale:A,platform:hj});e.forEach(i=>{j.append("chainIds[]",i)});let t=await N.api().get("/explore/v1/featured-items",{params:j});if(!AA(t))throw new Error("Failed to fetch featured items");let r=await t.data;if(!r.data||!Array.isArray(r.data))return[];let o=[];for(let i of r.data)try{let a=cw.parse(i);o.push(a)}catch{}return o};var h8=K({minutes:10}),F8=K({minutes:10}),S8=()=>{let{data:e}=aA(),A=(0,Qw.useMemo)(()=>e?lc(e):[],[e]),j=fe(T.language)??"en",t=async()=>{if(!e)throw new Error("No account found");return Hw(A,j)};return X({queryKey:ZA.featuredItems(A,j),enabled:!!e,queryFn:t,gcTime:h8,staleTime:F8})};n();s();var w8=q(P());n();s();n();s();var pUA=K({minutes:10}),cUA=K({minutes:10});n();s();n();s();var b8={rank:"trending",top:"top"},Vw=async({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o})=>{let i=new URLSearchParams({appVersion:PA,limit:t.toString(),locale:r,platform:hj,rankAlgo:o,rankBy:b8[e],timeframe:A});j.forEach(c=>{i.append("chainIds[]",c)});let a=await N.api().get("/explore/v1/trending-dapps",{params:i});if(!AA(a))throw new Error("Failed to fetch sites");let u=pw.safeParse(a.data);if(!u.success)throw new Error("Failed to parse sites");return u.data};var I8=K({minutes:10}),$8=K({minutes:10}),v8=({sortBy:e,timeFrame:A,network:j,limit:t,rankAlgo:r})=>{let{data:o}=aA(),i=Hn(j,"sites"),a=fe(T.language)??"en";return X({queryKey:ZA.sitesV2({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return Vw({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r})},gcTime:$8,staleTime:I8,retry:3})};n();s();n();s();var q8={rank:"trending",top:"volume"},x8=e=>e.floorPrices.length>0&&e.marketplacePages.length>0,zw=async({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o})=>{let i=new URLSearchParams({appVersion:PA,limit:t.toString(),locale:r,platform:hj,rankAlgo:o,rankBy:q8[e],timeframe:A});j.forEach(c=>{i.append("chainIds[]",c.toString())});let a=await N.api().get("/explore/v1/trending-collections",{params:i});if(!AA(a))throw new Error("Failed to fetch collections");let u=lw.safeParse(a.data);if(!u.success)throw new Error("Failed to parse collections");return{...u.data,data:u.data.data.filter(x8)}};var T8=K({minutes:10}),P8=K({minutes:10}),G8=({sortBy:e,timeFrame:A,network:j,limit:t,rankAlgo:r})=>{let{data:o}=aA(),i=Hn(j,"collections"),a=fe(T.language)??"en";return X({queryKey:ZA.collectionsV2({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return zw({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r})},gcTime:P8,staleTime:T8,retry:3})};n();s();n();s();var Xw=async(e,A)=>{let j=new URLSearchParams({appVersion:PA,locale:A,platform:hj});e.forEach(o=>{j.append("chainIds[]",o)});let t=await N.api().get("/explore/v1/learn-grid",{params:j});if(!AA(t))throw new Error("Failed to fetch learn grid");return t.data};var C8=K({minutes:10}),O8=K({minutes:10}),M8=()=>{let e=fo(),A=fe(T.language)??"en";return X({queryKey:ZA.learn(e,A),enabled:e.length>0,async queryFn(){return Xw(e,A)},gcTime:O8,staleTime:C8})};n();s();n();s();var R8=p.object({trendingMarkets:p.array(Ii)}),Ww=async({chainId:e,sortBy:A,sortDirection:j,timeFrame:t,limit:r,search:o})=>{let i=new URLSearchParams({chainId:e,sortBy:A,sortDirection:j,timeFrame:t,...r?{limit:r.toString()}:{},...o?{search:o}:{}}),a=await N.api().get("/swap/v2/perp/trending-markets",{params:i});if(!AA(a))throw new Error("Failed to fetch perp markets");let u=R8.safeParse(a.data);if(!u.success)throw new Error("Failed to parse perp markets");return u.data};var _8=K({minutes:1}),D8=K({minutes:1}),N8=({sortBy:e,sortDirection:A,timeFrame:j,limit:t,search:r})=>{let o=ea(),i=o?"hypercore:testnet":I.hypercore.mainnetID,a=CA("enable-hip3-testnet-dogfood-filter");return X({queryKey:ZA.perpMarkets(i,e,A,j,void 0,r),queryFn:()=>Ww({chainId:i,sortBy:e,sortDirection:A,timeFrame:j,search:r}),gcTime:D8,staleTime:_8,retry:3,select:u=>{let c=u.trendingMarkets;return a&&o&&(c=c.filter(l=>l.name.includes(":"))),t?{...u,trendingMarkets:c.slice(0,t)}:{...u,trendingMarkets:c}}})};n();s();n();s();var As=q(P());n();s();var Wn=q(P());n();s();var am={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"token.name",weight:.4},{name:"token.symbol",weight:.4},{name:"token.caip19.chainId",weight:.2}]};var Oi=30,L8=6,pm=3e4,cm=5,um=["100","500","1000"];n();s();n();s();var Vn="@phantom/fiat-ramp",Mi=`${Vn}:fungibles`,K8=`${Vn}:payment-methods`,U8=`${Vn}:providers`,H8=`${Vn}:recommended-quote`,Q8=`${Vn}:status`,V8=`${Vn}:completed`,Pt={fiatRampTokens(e,A,j){return[Mi,e,A,j]},fiatRampPaymentMethods(e,A,j){return[K8,e,A,j]},fiatRampProviders(e,A,j){return[U8,e,A,j]},fiatRampRecommendedQuote(e,A,j){return[H8,e,A,j]},fiatRampStatus(e,A,j){return[Q8,e,A,j]},fiatRampCompleted(e,A,j){return[V8,e,A,j]}};n();s();n();s();n();s();var Jw=p.object({name:p.string().nullish().default(null),symbol:p.string().nullish().default(null),decimals:p.number(),caip19:Pe,logoURI:p.string().nullish().default(null)}),Yw=p.object({token:Jw,addressType:zm.optional()}),mc=p.object({id:p.string(),name:p.string(),tag:p.string(),logo:p.string(),quote:p.object({displaySourceAmount:p.string(),displayDestinationAmount:p.string(),displayFee:p.string()}).optional()}),Zw=(o=>(o.CARD="CARD",o.MOBILE_WALLET="MOBILE_WALLET",o.BANK_TRANSFER="BANK_TRANSFER",o.EXCHANGE="EXCHANGE",o.LOCAL="LOCAL",o))(Zw||{}),kc=p.object({id:p.string(),type:p.nativeEnum(Zw),name:p.string(),estimatedArrival:p.string(),assets:p.object({icon:p.string(),roundIcon:p.string()}),description:p.string().optional()}),z8=p.object({groups:p.array(p.object({groupName:p.string(),tokens:p.array(Yw)}))}),X8=p.object({paymentMethods:p.array(kc),provider:mc.optional()}),W8=p.object({providers:p.array(mc),paymentMethod:kc,token:Pe}),J8=p.object({provider:mc,paymentMethod:kc,location:p.object({countryCode:p.string(),subdivision:p.string().optional()}).optional(),token:Pe.optional(),tokenAmount:p.string().optional(),fiatAmount:p.string().optional(),fiatCurrencyCode:p.string().optional(),minPurchaseAmount:p.string().optional(),maxPurchaseAmount:p.string().optional(),quickSelectDenominations:p.array(p.string()).optional()}),Y8=p.object({url:p.string(),sessionId:p.string()}),lm=(t=>(t.PENDING="PENDING",t.COMPLETED="COMPLETED",t.FAILED="FAILED",t))(lm||{}),nHA=p.object({status:p.nativeEnum(lm),tokenAmount:p.number().optional(),fiatCurrencyCode:p.string().optional(),usdFiatAmount:p.number().optional(),usdFiatFeeAmount:p.number().optional(),fiatFeeAmount:p.number().optional(),cryptoTransactionId:p.string().optional(),createdAt:p.date().optional(),updatedAt:p.date().optional()}),Ie=class extends Error{constructor(A){super(A),this.name="FiatRampError"}};var Ab=new Ie("Failed to get FiatRampPaymentMethods"),eb=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/payment_methods",A);if(!AA(t))throw Ab;return t.data}catch{throw Ab}};var Z8=K({days:7}),AR=K({hours:1}),Bc=(e,A,j,t)=>{let r={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:o}=oe(),i=o?.userID,a=o?.accessToken;return X({queryKey:Pt.fiatRampPaymentMethods(r,t,i),queryFn:()=>eb(r,t,a),gcTime:Z8,staleTime:AR})};n();s();n();s();var jb=new Ie("Failed to get FiatRampProviders"),tb=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/providers",A);if(!AA(t))throw jb;return t.data}catch{throw jb}};var eR=K({seconds:Oi}),jR=K({hours:1}),fc=(e,A,j,t)=>{let r={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:o}=oe(),i=o?.userID,a=o?.accessToken;return X({queryKey:Pt.fiatRampProviders(r,t,i),queryFn:()=>tb(r,t,a),gcTime:jR,staleTime:eR,enabled:!!t.destinationAddress})};n();s();n();s();var rb=new Ie("Failed to get FiatRampRecommendedQuote"),ob=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/recommended_quote",A);if(!AA(t))throw rb;return t.data}catch{throw rb}};var tR=K({days:7}),rR=K({hours:1}),gc=(e,A,j,t,r=!0)=>{let o={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:i}=oe(),a=i?.userID,u=i?.accessToken;return X({queryKey:Pt.fiatRampRecommendedQuote(o,t,a),queryFn:()=>ob(o,t,u),gcTime:tR,staleTime:rR,enabled:r})};n();s();n();s();var nb=new Ie("Failed to get FiatRampTokens"),dm=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/tokens",A);if(!AA(t))throw nb;return t.data}catch{throw nb}};n();s();var Ec=e=>e.sort((A,j)=>I.compareNetworkID(A.token.caip19.chainId,j.token.caip19.chainId));var oR=K({days:7}),nR=K({hours:1}),zn=(e,A,j,t=!0,r)=>{let{data:o}=aA(),i=Array.from(new Set(o?.addresses?.map(k=>k.networkID))),a=Array.from(new Set(o?.addresses?.map(k=>k.addressType))),u={chainIDs:i},c={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:l}=oe(),m=l?.userID,B=l?.accessToken;return X({queryKey:Pt.fiatRampTokens(c,u,m),queryFn:()=>dm(c,u,B),gcTime:oR,staleTime:nR,enabled:t&&i.length>0,select:k=>{let f={...k,groups:k.groups.map(g=>({...g,tokens:Ec(g.tokens.filter(E=>E.addressType?a.includes(E.addressType):!0))}))};return r?r(f):f}})};n();s();n();s();var mm=e=>{let A=e?.groups.flatMap(j=>j.tokens)??[];return Ec(A)};var Xn=(e,A,j,t=!0)=>zn(e,A,j,t,mm);n();s();n();s();var bQA=new Ie("Failed to get ramp status");var MQA=K({seconds:Oi}),RQA=K({hours:1});n();s();var Gt={onClose:()=>{},context:"modal",fungible:void 0,purchaseAmount:"0",purchaseType:"currency",isPurchaseAmountValid:!1,error:void 0,redirectErrorMessage:void 0,ownerPublicKey:"",price:0,minPurchaseAmountUsd:cm,maxPurchaseAmountUsd:pm,quickSelectDenominations:um,paymentMethod:void 0,provider:void 0,checkoutQuoteType:"recommended",redirectURL:void 0,stripePaymentMethod:void 0},ij=VA(e=>({...Gt,setState:A=>e(j=>({...j,...A})),reset:()=>{e(Gt)}}));var sb=({platform:e,version:A,onClosePress:j,onNextPress:t})=>{let r=J(),{i18n:o}=hA(),i=o.language,{setState:a}=ij(),{data:u}=aA(),c=Array.from(new Set(u?.addresses?.map(v=>v.addressType))),{data:l=[]}=Xn(e,A,i),{data:m,isPending:B,isFetching:k,isError:f}=zn(e,A,i),g=m?.groups??[],E=B||k||f,[h,y]=(0,Wn.useState)(""),F=ra(h)??"",S=h.length>0,x=uB(l,F,am),O=(0,Wn.useCallback)(({tokenWithMetadata:v,ownerPublicKey:D})=>{let{token:G}=v,{name:C,symbol:_,caip19:V}=G,{chainId:z}=V;r.capture("fiatOnrampFungibleSelected",{data:{networkId:z,chainId:I.getChainID(z),asset:{name:C,symbol:_,type:"fungible"}}}),a({...Gt,onClose:j,ownerPublicKey:D,fungible:v.token}),t()},[r,j,t,a]);return(0,Wn.useEffect)(()=>{r.capture("fiatOnrampInitiated")},[r]),{enabledAddressTypes:c,groupedTokens:g,isLoading:E,isSearching:S,searchedTokens:x,searchTerm:h,selectedAccount:u,onClosePress:j,onTokenPress:O,setSearchTerm:y}};n();s();var pj=q(P());n();s();var Yn=q(P());n();s();var km=q(P()),yc=({marginBottom:e=0})=>{let{t:A}=hA(),{data:[j]}=_A(["enable-buy-flow-warning"]);return j?km.default.createElement(fA,{marginBottom:e},km.default.createElement(Fk,{level:"4-error"},A("buyFlowHealthWarning"))):null};n();s();var ro=q(P());n();s();var aj=q(P());n();s();var Nj=q(P()),hc=48,Bm=Nj.default.memo(({networkId:e,logoURI:A,type:j})=>{let t=iR({disableBadge:!1,tokenType:j,chain:I.getChainID(e)});return Nj.default.createElement(fA,{size:hc,position:"relative"},A?Nj.default.createElement(wj,{src:A,height:hc,width:hc,borderRadius:"circle",fallback:Nj.default.createElement(ib,null)}):Nj.default.createElement(ib,null),t?Nj.default.createElement(aR,{networkId:e}):null)}),ib=()=>Nj.default.createElement(fA,{alignItems:"center",justifyContent:"center",size:hc,backgroundColor:"areaBase",borderRadius:"circle"},Nj.default.createElement(Dt.Coin,{size:"50%",color:"borderBase"})),iR=({disableBadge:e,tokenType:A,chain:j})=>e?!1:Ij.get(j).alwaysShowNetworkBadge?!0:!Ae(A),aR=({networkId:e})=>Nj.default.createElement(fA,{right:"-2",bottom:"-2",position:"absolute",borderColor:"elementBase",borderStyle:"solid",borderWidth:2,style:{borderRadius:9}},Nj.default.createElement(mB,{networkID:e,size:18}));n();s();var Jn=q(P()),ab=({image:e,name:A,symbol:j,onPress:t})=>Jn.default.createElement(fA,{backgroundColor:"elementBase",borderRadius:"row",padding:16,onPress:t},Jn.default.createElement(fA,{gap:12},e,Jn.default.createElement(fA,{gap:4,alignItems:"flex-start"},Jn.default.createElement(ge,null,A),Jn.default.createElement(ge,{color:"textDiminished"},j))));var Ri=aj.default.memo(({enabledAddressTypes:e,selectedAccount:A,tokenWithMetadata:j,type:t,onPress:r})=>{let{token:o,addressType:i}=j,{caip19:a,logoURI:u,name:c,symbol:l}=o,{chainId:m}=a,B=dt(a),{t:k}=hA(),f=c??k("assetDetailUnknownToken"),g=(0,aj.useMemo)(()=>{let h=A?.addresses.find(y=>i?y.addressType===i&&y.networkID===m:y.networkID===m)?.address??"";return I.isEVMNetworkID(m)?h.toLowerCase():h},[A,i,m]),E=(0,aj.useCallback)(()=>{r({tokenWithMetadata:j,ownerPublicKey:g})},[r,j,g]);return i&&!e.includes(i)?aj.default.createElement(aj.default.Fragment,null):t==="card"?aj.default.createElement(ab,{onPress:E,image:aj.default.createElement(Bm,{logoURI:u,networkId:a.chainId,type:B}),name:f,symbol:l}):aj.default.createElement(yo,{onPress:E,start:aj.default.createElement(Bm,{logoURI:u,networkId:a.chainId,type:B}),topLeft:{text:f,after:aj.default.createElement(kB,{networkID:a.chainId,address:g})},bottomLeft:l})});var pb=({enabledAddressTypes:e,group:A,groupIndex:j,selectedAccount:t,onTokenPress:r})=>{let o=j===0;return ro.default.createElement(fA,{key:A.groupName,marginTop:o?8:24},ro.default.createElement(ge,{font:Fj?"bodyMedium":"title3Semibold",color:"textDiminished",marginBottom:8},A.groupName),ro.default.createElement(fA,{flexWrap:"wrap",direction:"row",gap:o?0:"list"},A.tokens.map((i,a)=>{let{token:u,addressType:c}=i,l=`${u.symbol}-${u.caip19.chainId}-${a}`;return c&&!e.includes(c)?null:o?ro.default.createElement(fA,{key:l,flexBasis:"50%",paddingLeft:a%2===0?0:4,paddingRight:a%2===0?4:0,paddingBottom:a>=A.tokens.length-2?0:8},ro.default.createElement(Ri,{enabledAddressTypes:e,selectedAccount:t,tokenWithMetadata:A.tokens[a],type:"card",onPress:r})):ro.default.createElement(Ri,{key:l,tokenWithMetadata:A.tokens[a],enabledAddressTypes:e,selectedAccount:t,type:"row",onPress:r})})))};var cb=Yn.default.memo(({groupedTokens:e,enabledAddressTypes:A,selectedAccount:j,onTokenPress:t})=>Yn.default.createElement(Yn.default.Fragment,null,Yn.default.createElement(yc,{marginBottom:16}),e.map((r,o)=>Yn.default.createElement(pb,{enabledAddressTypes:A,group:r,groupIndex:o,key:r.groupName,onTokenPress:t,selectedAccount:j}))));n();s();var Zn=q(P());var ub=Zn.default.memo(({enabledAddressTypes:e,searchedTokens:A,selectedAccount:j,onTokenPress:t})=>Zn.default.createElement(Zn.default.Fragment,null,A.map((r,o)=>Zn.default.createElement(fA,{key:`${r.token.symbol}-${r.token.caip19.chainId}-${o}`,marginBottom:8},Zn.default.createElement(Ri,{enabledAddressTypes:e,selectedAccount:j,tokenWithMetadata:r,type:"row",onPress:t})))));var lb=e=>{let{isLoading:A,isSearching:j,searchedTokens:t,selectedAccount:r,enabledAddressTypes:o,onTokenPress:i,groupedTokens:a}=e;return pj.default.createElement(pj.default.Fragment,null,A?pj.default.createElement(pR,null):j?pj.default.createElement(pj.default.Fragment,null,t.length>0?pj.default.createElement(ub,{searchedTokens:t,selectedAccount:r,enabledAddressTypes:o,onTokenPress:i}):pj.default.createElement(cR,null)):pj.default.createElement(cb,{enabledAddressTypes:o,groupedTokens:a,selectedAccount:r,onTokenPress:i}))},pR=()=>pj.default.createElement(fA,{gap:"list",paddingTop:"screen"},[...Array(3)].map((e,A)=>pj.default.createElement(ho,{key:A,topRight:!1,bottomRight:!1}))),cR=()=>{let{t:e}=hA();return pj.default.createElement(fA,{flex:1,alignItems:"center",justifyContent:"center"},pj.default.createElement(ge,{font:"body",color:"textDiminished",align:"center"},e("noBuyOptionsAvailableInCountry")))};var db={container:Qc({display:"flex",flexDirection:"column",height:"100%"}),listContainer:Qc({overflow:"auto",minHeight:0,paddingTop:16,paddingBottom:80})},mb=({platform:e,navigateToForm:A,onBackPress:j})=>{let{t}=hA(),r=sb({platform:e,version:PA,onClosePress:j,onNextPress:A});return As.default.createElement(fA,{flex:1,className:db.container},As.default.createElement(hk,{id:"search",label:"Search",showLabel:!1,placeholder:t("assetListSearch"),setValue:r.setSearchTerm,value:r.searchTerm||""},As.default.createElement(Dt.Search,{size:16,color:"textDiminished"})),As.default.createElement(fA,{flex:1,className:db.listContainer},As.default.createElement(lb,{...r})))};n();s();n();s();var Bb=q(P());n();s();var UA=q(P());n();s();var _i=q(P()),Fc=({assets:e,name:A,onClick:j,estimatedArrival:t})=>_i.default.createElement(wk,{rows:[{type:"base",start:e.roundIcon?_i.default.createElement(fA,{borderRadius:"circle",padding:8,backgroundColor:"black"},_i.default.createElement(wj,{width:40,height:40,borderRadius:"circle",src:e.icon})):void 0,topLeft:A,bottomLeft:{before:_i.default.createElement(Dt.Clock,{color:"textDiminished",size:14}),text:t},onPress:j}]});var kb=({platform:e,navigateToAllProviders:A,navigateToForm:j})=>{let{t}=hA(),r=J(),o=ij(),i=ij(y=>y.setState),{provider:a,fungible:u}=o,{currencyCode:c}=bA(),{data:l,isFetching:m,isPending:B}=Bc(e,PA,T.language,{token:u?.caip19,fiatCurrencyCode:c,providerId:a?.id}),{provider:k,paymentMethods:f}=l??{},g=k||a,E=(0,UA.useCallback)(y=>{i({paymentMethod:y,provider:g,checkoutQuoteType:"selected"}),r.capture("fiatOnrampPaymentMethodSelected",{data:{paymentMethodId:y.id}}),j()},[r,j,g,i]),h=(0,UA.useMemo)(()=>m||B?UA.default.createElement(UA.default.Fragment,null,[...Array(3)].map((y,F)=>UA.default.createElement(ho,{key:F,topRight:!1,bottomRight:!1}))):f?.length===0?UA.default.createElement(uR,null):UA.default.createElement(UA.default.Fragment,null,f?.map(y=>UA.default.createElement(Fc,{key:y.id,onClick:()=>E(y),...y}))),[m,B,E,f]);return UA.default.createElement(fA,{gap:12},UA.default.createElement(fA,{direction:"row",alignItems:"center",justifyContent:"space-between"},UA.default.createElement(ge,{font:"title1Semibold",color:"textBase",children:t("fiatRampPaymentMethodsTitle")}),UA.default.createElement(Sk,{size:"large",onPress:A},UA.default.createElement(wj,{borderRadius:6,width:20,height:20,src:g?.logo??""}),UA.default.createElement(ge,{font:"captionSemibold",color:"textBase",children:g?.name||t("selectSwapProviderTitle")}))),UA.default.createElement(fA,{gap:12},UA.default.createElement(ge,{font:"label",color:"textDiminished",children:t("buyThirdPartyScreenPaymentMethodDescription")}),UA.default.createElement(fA,{gap:8},h)))},uR=()=>{let{t:e}=hA();return UA.default.createElement(fA,{flex:1,alignItems:"center",justifyContent:"center"},UA.default.createElement(ge,{font:"body",color:"textDiminished",align:"center"},e("buyThirdPartyScreenPaymentMethodEmptyState")))};var fb=({platform:e,navigateToAllProviders:A,navigateToForm:j})=>Bb.default.createElement(kb,{platform:e,navigateToAllProviders:A,navigateToForm:j});n();s();var Eb=q(P());n();s();var Te=q(P());var gb=({platform:e,navigateToPaymentMethods:A})=>{let{t:j}=hA(),t=J(),r=CA("enable-fiat-ramp-provider-quotes"),o=ij(),i=ij(F=>F.setState),{paymentMethod:a,purchaseType:u,purchaseAmount:c,fungible:l,ownerPublicKey:m}=o,{currencyCode:B}=bA(),{data:k,isFetching:f,isPending:g}=fc(e,PA,T.language,{...u==="currency"?{fiatAmount:c}:{tokenAmount:c},token:l?.caip19,fiatCurrencyCode:B,destinationAddress:m&&l?{address:m,chainId:l?.caip19.chainId,resourceType:"address"}:void 0}),E=k?.paymentMethod||a,h=(0,Te.useCallback)(F=>{t.capture("fiatOnrampProviderSelected",{data:{chainId:k?.token?.chainId,providerId:F.id,paymentMethodId:E?.id,destinationAmount:F.quote?.displayDestinationAmount,sourceAmount:F.quote?.displaySourceAmount,asset:k?.token,tag:F.tag}}),i({provider:F,paymentMethod:E,checkoutQuoteType:"selected"}),A?.()},[t,k?.token,i,E,A]),y=(0,Te.useMemo)(()=>k?.providers.map((F,S)=>{let x=F.id===o.provider?.id;return r?{type:"base",start:Te.default.createElement(wj,{width:48,height:48,borderRadius:6,src:F.logo}),topLeft:F.name,topRight:{text:F.quote?.displayDestinationAmount,color:"textBase"},bottomRight:F.quote?.displaySourceAmount?{text:`~${F.quote.displaySourceAmount}`}:void 0,bottomLeft:F.tag&&{text:F.tag,color:S===0?"spotPositive":"textDiminished"},onPress:()=>h(F)}:{type:"radio",active:x,start:Te.default.createElement(wj,{width:24,height:24,borderRadius:6,src:F.logo}),topLeft:F.name,topRight:F.tag,onPress:()=>h(F)}})??[],[o.provider?.id,r,h,k?.providers]);return Te.default.createElement(fA,{gap:16},Te.default.createElement(ge,{font:"label",color:"textDiminished",children:j("buyThirdPartyScreenProvidersDescription")}),Te.default.createElement(fA,{gap:8},f||g?Te.default.createElement(dR,null):k?.providers.length===0?Te.default.createElement(lR,null):y.map(F=>Te.default.createElement(yo,{...F,key:F.topLeft}))))},lR=()=>{let{t:e}=hA();return Te.default.createElement(fA,{flex:1,alignItems:"center",justifyContent:"center"},Te.default.createElement(ge,{font:"body",color:"textDiminished",align:"center"},e("buyThirdPartyScreenProvidersEmptyState")))},dR=()=>[...Array(3)].map((e,A)=>Te.default.createElement(ho,{key:A,topRight:!1,bottomRight:!1}));var yb=({platform:e,navigateToPaymentMethods:A})=>Eb.default.createElement(gb,{platform:e,navigateToPaymentMethods:A});n();s();var fR=q(P());n();s();var BR=q(P());n();s();var ER=q(P());n();s();var gR=q(P());n();s();var es=q(P()),hb=es.default.memo(e=>{let{name:A,tag:j,logo:t,quote:r,onClick:o,index:i}=e,a={start:es.default.createElement(wj,{width:44,height:44,borderRadius:"circle",src:t}),topLeft:A,bottomLeft:j&&{text:j,color:i===0?"spotPositive":"textDiminished"},onPress:()=>o(e)},u=r?{...a,topRight:r.displayDestinationAmount,bottomRight:`\u2248 ${r.displaySourceAmount}`}:{...a,end:es.default.createElement(fA,{direction:"row",alignItems:"center",gap:4},es.default.createElement(Dt.ChevronRight,{color:"textDiminished",size:16}))};return es.default.createElement(yo,{...u})});n();s();n();s();n();s();var oo=q(P());n();s();var Sc=q(P());var wc=({clientPlatform:e,appVersion:A,locale:j,caip19:t,addressType:r,enabled:o=!0,destinationAddress:i})=>{let{data:a,isLoading:u,isError:c,isFetched:l}=aA(),{data:m=[],isLoading:B,isError:k,isFetched:f}=Xn(e,A,j,o),g=(0,Sc.useMemo)(()=>{if(t)return m.find(h=>r&&I.getChainName(GA(t).chainId)===I.bitcoin.name?M(h.token.caip19)===t&&"addressType"in h&&h.addressType===r:M(h.token.caip19)===t)},[r,t,m]),E=(0,Sc.useMemo)(()=>{if(!g)return"";if(i)return i;let h=a?.addresses.find(y=>g?.addressType?y.addressType===g.addressType&&y.networkID===g?.token.caip19.chainId:y.networkID===g?.token.caip19.chainId)?.address??"";return g?.token.caip19.chainId&&I.isEVMNetworkID(g.token.caip19.chainId)&&(h=h.toLowerCase()),h},[i,a?.addresses,g]);return(0,Sc.useMemo)(()=>({tokenToBuy:g,destinationAddress:E,isLoading:u||B,isError:c||k,isFetched:l&&f}),[E,k,c,f,l,B,u,g])};var Fb=({caip19:e,amount:A,clientPlatform:j,redirectURL:t,addressType:r,destinationAddress:o,provider:i,paymentMethod:a,navigateToFiatRampForm:u,onClose:c,captureAnalyticsEvent:l})=>{let{setState:m}=ij(),{tokenToBuy:B,destinationAddress:k,isLoading:f,isError:g,isFetched:E}=wc({clientPlatform:j,appVersion:PA,locale:T.language,caip19:e,addressType:r,destinationAddress:o}),h=(0,oo.useMemo)(()=>{if(B)return{token:B?.token.caip19,providerId:i,paymentMethodId:a,destinationAddress:{address:k,chainId:B?.token.caip19?.chainId,resourceType:"address"}}},[B,i,a,k]),{data:y,isLoading:F}=gc(j,PA,T.language,h??{},!!h&&!!i&&!!a),S=(0,oo.useMemo)(()=>e?F?!1:!!B&&!!k:!0,[e,F,k,B]),x=(0,oo.useCallback)(()=>{!e||!B||!k||m({...Gt,onClose:c??(()=>{}),ownerPublicKey:k,fungible:B?.token,purchaseAmount:A??Gt.purchaseAmount,redirectURL:t,provider:y?.provider,paymentMethod:y?.paymentMethod})},[e,B,k,m,c,A,t,y?.provider,y?.paymentMethod]),O=(0,oo.useCallback)(()=>{if(!e){l?.(),u?.();return}!B||!k||(x(),l?.(),u?.())},[e,l,k,u,x,B]);return(0,oo.useMemo)(()=>({canBuy:S,openBuy:O,saturateState:x,resolvedDestinationAddress:k,token:B,isLoading:f,isError:g,isFetched:E}),[S,k,g,E,f,O,x,B])};n();s();var FR=new Ie("Failed to get FiatRampProviderUrl"),SR=async(e,A,j,t,r)=>{try{let o={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},i=await N.api().headers(o).bearer(r).post("/fiat_ramp/v2/onramp/provider_url",t);if(!AA(i))throw new Ie(i.data.message);return i.data}catch(o){throw o instanceof Ie?o:FR}};n();s();n();s();var Sb=3,bc=()=>{let e=Be.getMultivariateAssignment("latest-terms-of-service-version-number");return e&&p.number().safeParse(Number(e)).success?Number(e):Sb};var fm=()=>{let e=wA(),A=pA();return IA({mutationFn:async t=>{if(!t)await vf(e);else{let r=bc();if(!r)return null;await $f(e,r)}A.setQueryData(["termsHaveBeenAcknowledgedLastSeenVersion"],t)}})};n();s();n();s();var wb=async e=>await e.get("termsHaveBeenAcknowledgedLastSeenVersion");var Di=()=>{let e=wA(),A=async()=>{let j=bc();if(!j)return!1;let t=await wb(e);return!(t===null||t<j)};return X({queryKey:["termsHaveBeenAcknowledgedLastSeenVersion"],queryFn:A})};n();s();n();s();var $R=q(P());n();s();var bb=Eo(J,e=>new gm(e)),gm=class{#A;constructor(A){this.#A=A}onOpen=()=>this.#A.capture("connectHardwareOpen");onSelectedChains=A=>{let j=new Set(A),t=[];for(let o of I.getAllChainIDs())j.has(o)&&t.push(o);let r={numChains:t.length,selectedChains:t.map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(", ")};this.#A.capture("connectHardwareSelectedChains",{data:r})};onDerivedAccounts=A=>{let j={};for(let[t,r]of Object.entries(A.derivedAddresses)){if(!wR(t))continue;let o={numberOfDerivedAccounts:r.addresses.length};r.duration!==void 0&&(o.derivationDuration=r.duration),j[t]=o}this.#A.capture("connectHardwareAccountsDerived",{data:{...j}})};onDiscoveredAccounts=A=>{let{discoveredAccounts:j}=A,t={};for(let r of j){if(r.status==="undiscovered")continue;let o=r.accounts.reduce((i,{derivationPathType:a,hasAccountActivity:u})=>{let c=gr.getAddressType(a);return i[c]={derivationPathType:a,hasAccountActivity:u},i},{});for(let{hasAccountActivity:i,derivationPathType:a}of Object.values(o)){if(!i)continue;let u=t[a]??0;t[a]=u+1}}this.#A.capture("connectHardwareAccountsDiscovered",{data:{numberOfActiveAccounts:t}})};onConnectedAccounts=A=>{let j={};for(let t of A.accounts){let r=[...t.addresses,...t.publicKeys].reduce((o,i)=>{let a=gr.getAddressType(i.pathType);return o[a]=i.pathType,o},{});for(let o of Object.values(r)){let i=j[o]??0;j[o]=i+1}}this.#A.capture("connectHardwareAccountsConnected",{data:{numberOfAccountsImported:A.accounts.length,numberOfAccountsImportedByDerivationPath:j}})}};function wR(e){return typeof e!="string"?!1:Object.keys(Vc).includes(e)}n();s();n();s();var rWA=["firstTimeOnboarding","isResettingApp"],Ib=["seed","seedless","privateKey"],oWA="https://phantom-wallet.zendesk.com/hc/en-us/articles/33478025712531";n();s();n();s();var Ic="@phantom/onboarding",Ct={firstTimeOnboarding:[`${Ic}:first-time-onboarding`],isResettingApp:[`${Ic}:is-resetting-app`],deriveLedgerAccounts:[`${Ic}:derive-ledger-accounts`],discoverLedgerAccounts:[`${Ic}:discover-ledger-accounts`]};n();s();n();s();n();s();n();s();var vR="/discover/v1",qR={Accept:"application/json"},xR=e=>{if(!e||!Array.isArray(e.accounts))return!1;for(let A of e.accounts)if(!(typeof A.address=="string"&&typeof A.amount=="string"&&(!A.lastActivityTimestamp||typeof A.lastActivityTimestamp=="number")&&A.chain&&typeof A.chain.id=="string"&&new Set(I.getAllNetworkIDs()).has(A.chain.id)&&typeof A.chain.name=="string"&&typeof A.chain.symbol=="string"&&typeof A.chain.imageUrl=="string"))return!1;return!0},TR=e=>!!e&&typeof e.message=="string",Em=async e=>{if(!e.accounts.length)throw new Error("Must send at least 1 account for discovery");let A=await N.api().headers(qR).post(vR,e),j=A.data;if(!AA(A))throw TR(j)?new Error(j.message):new Error(`Unable to discover accounts with args: ${JSON.stringify(e)}`);if(xR(j))return j;throw new Error(`Invalid discover accounts response: ${JSON.stringify(j)}`)};var PR="fetch-multi-chain-accounts-by-seed",GR=()=>["bitcoinTaproot","bitcoinNativeSegwit"],CR=()=>["bip44Change","bip44","deprecated"],OR=()=>["bip44Ethereum","bip44EthereumSecondary","bip44EthereumTertiary"],MR=()=>["bip44Sui"],RR=(e,A)=>GR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=gr.getAddressType(j),i=is({publicKey:r,addressType:o});return{chainType:o,chainId:tA.Bitcoin.Mainnet,address:i,publicKey:Buffer.from(r).toString("hex"),pathParams:t}}),_R=(e,A)=>OR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=gr.getAddressType(j),i=is({publicKey:r,addressType:"eip155"});return{chainType:o,pathType:j,address:i,publicKey:Buffer.from(r).toString("hex"),pathParams:t}}),DR=(e,A)=>CR().map(j=>{let t={pathType:j,index:e},r=A.derivePathType(j,e),o;switch(j){case"bip44Root":case"bip44":case"bip44Change":o=r.publicKey;break;case"deprecated":o=Wm(r.secretKey).publicKey;break}let i=is({publicKey:o,addressType:"solana"});return{chainType:"solana",chainId:tA.Solana.Mainnet,address:i,publicKey:Buffer.from(o).toString("hex"),pathParams:t}}),NR=(e,A)=>MR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=is({publicKey:r,addressType:"sui"});return{chainType:"sui",chainId:tA.Sui.Mainnet,address:o,publicKey:Jm(r),pathParams:t}}),LR=1e4,$b=async(e,A=!0)=>{let j=Object.assign({},...e);try{let t=Object.values(j).map(({account:m})=>({address:m.address,chainId:m.chainId})),r;A?r=(await Bo(async()=>pk(Em({accounts:t}),LR),()=>!0,2)).accounts:r=(await Em({accounts:t})).accounts;let o={};for(let m of r){let{account:B}=j[`${m.chain.id}-${m.address}`],k=B.publicKey,f=B.chainType,g=Ji(B.pathParams),E={...m,publicKey:k,chainType:f,derivationPathType:B.pathParams.pathType,hasAccountActivity:!!m.lastActivityTimestamp||parseFloat(m.amount)>0};o[g]=[...o[g]||[],E]}Object.keys(o).forEach(m=>{o[m]=o[m].sort((B,k)=>I.compareNetworkID(B.chain.id,k.chain.id))});let i=Object.values(o),a=i.filter(m=>m.some(B=>B.hasAccountActivity)),u=!!a.length;return(u?a:i).map(m=>{let B=m[0];return{status:"discovered",seedIndex:j[`${B.chain.id}-${B.address}`].account.pathParams.index??-1,isSelectedByDefault:u,accounts:m}})}catch{let t=Object.values(j).map(({account:a})=>a),r={};for(let a of t){let{account:u}=j[`${a.chainId}-${a.address}`],c=Ji(u.pathParams),l={...a,chain:{id:a.chainId,name:I.getNetworkName(a.chainId),symbol:I.getTokenSymbol(a.chainId)},chainType:gr.getAddressType(u.pathParams.pathType),derivationPathType:u.pathParams.pathType,hasAccountActivity:!1};r[c]=[...r[c]||[],l]}return Object.keys(r).forEach(a=>{r[a]=r[a].sort((u,c)=>I.compareNetworkID(u.chain.id,c.chain.id))}),Object.values(r).map(a=>{let u=a[0];return{status:"undiscovered",seedIndex:j[`${u.chain.id}-${u.address}`].account.pathParams.index??-1,accounts:a,isSelectedByDefault:!1}})}},KR=async({hdWallet:e,startIndex:A,endIndex:j,enabledAddressTypes:t,enabledChains:r})=>{let o=[];for(let i=A;i<=j;++i){let a={};if(t.includes("bip122_p2wpkh"))for(let u of RR(i,e))a[`${tA.Bitcoin.Mainnet}-${u.address}`]={account:u};if(t.includes("eip155")){let u=_R(i,e),c=r.filter(l=>I.isEVMNetworkID(I[l].mainnetID));for(let l of c){let m=I[l];for(let{address:B,publicKey:k,chainType:f,pathParams:g}of u)a[`${m.mainnetID}-${B}`]={account:{chainType:f,chainId:m.mainnetID,address:B,publicKey:k,pathParams:g}}}}if(t.includes("solana"))for(let u of DR(i,e))a[`${u.chainId}-${u.address}`]={account:u};if(t.includes("sui"))for(let u of NR(i,e))a[`${u.chainId}-${u.address}`]={account:u};o.push(a)}return $b(o)};function jJA({batchSize:e,hdWallet:A,enabledAddressTypes:j,enabledChains:t}){let r=!!A&&j.length!=0;return Xi({enabled:r,queryKey:[PR,e],queryFn:async({pageParam:u=0})=>{try{if(e<1)throw new Error(`Need positive batchSize: ${e}`);if(!A)throw new Error("Missing HDWallet");let c=[],l=[],m=u===0,B=u,k=!0;for(;k;){let f=B,g=B+e-1,h=(await KR({hdWallet:A,startIndex:f,endIndex:g,enabledAddressTypes:j,enabledChains:t})).flat(1);B+=e,k=!1;for(let y of h)c.push(y),(y.status==="undiscovered"||y.isSelectedByDefault)&&l.push(y),m&&y.status==="discovered"&&y.isSelectedByDefault&&(k=!0)}if(m&&l.length===0&&c.length>1){let f=c[0],g=f.accounts.map(h=>({...h,hasAccountActivity:!1})),E={status:"undiscovered",seedIndex:f.seedIndex,accounts:g,isSelectedByDefault:!1};l.push(E)}return l}catch(c){throw c instanceof Error&&b.captureError(c,"account"),c}},getNextPageParam:(u,c)=>{let l=c.length,m=l?c[0]:[],B=m.length?UR(m[m.length-1].seedIndex,e):0;return l===1?B:B+e*(l-1)},gcTime:0,staleTime:0,initialPageParam:0})}var UR=(e,A)=>Math.ceil(e/A)*A+A;n();s();n();s();var HR=()=>{let e=wA(),A=async()=>{let t=await e.get("firstTimeOnboarding");return t===null?!0:t.isFirstTimeOnboarding},{data:j}=X({queryKey:Ct.firstTimeOnboarding,queryFn:A});return j},QR=()=>{let e=wA(),A=pA();return IA({mutationFn:async t=>{await e.set("firstTimeOnboarding",{isFirstTimeOnboarding:t}),qf(e,t?void 0:Date.now()),A.setQueryData(Ct.firstTimeOnboarding,t)}})};n();s();var VR=()=>{let e=wA(),A=async()=>{let t=await e.get("isResettingApp");return t===null?{isResettingApp:!1,isFirstTimeResettingApp:!1}:t},{data:j}=X({queryKey:Ct.isResettingApp,queryFn:A});return j},zR=()=>{let e=wA(),A=pA();return IA({mutationFn:async t=>{let o=(await e.get("isResettingApp"))?.isFirstTimeResettingApp??!1;await e.set("isResettingApp",{isResettingApp:t,isFirstTimeResettingApp:o}),A.setQueryData(Ct.isResettingApp,{isResettingApp:t,isFirstTimeResettingApp:o})}})},XR=()=>{let e=wA(),A=pA();return IA({mutationFn:async t=>{let o=(await e.get("isResettingApp"))?.isResettingApp??!1;await e.set("isResettingApp",{isResettingApp:o,isFirstTimeResettingApp:t}),A.setQueryData(Ct.isResettingApp,{isResettingApp:o,isFirstTimeResettingApp:t})}})};n();s();var WR=q(oI()),JR=q(P());n();s();var no=q(P());function ym({userProfileError:e=void 0,userProfile:A,selectedAccount:j,accounts:t=[]}){b.addBreadcrumb("Auth","Checking whether user is eligible to claim a username","info");let r=e instanceof kk;if(Vi()||!j||!!e&&!r)return b.addBreadcrumb("Auth","Skipping claim username eligibility check","info"),{isEligible:!1,publicAddresses:{},accounts:[]};let i={};j?.addresses.forEach(B=>{i[B.networkID]=B.address});let a=!!j&&Ib.includes(j.type),u=Array.isArray(t)&&t.length>0,c=Object.keys(i).length>0,m=!A&&a&&(u&&c);return b.addBreadcrumb("Auth",`Eligible for Claim Username: ${m}`,"info"),{isEligible:m,publicAddresses:i,accounts:t}}var YR=({onSuccess:e,onError:A}={})=>{let{t:j}=hA(),{mutateAsync:t,isIdle:r,isPending:o,error:i}=mk(),a=Aa(),u=gk(F=>F.username),{data:c,error:l}=fk(),{data:m,refetch:B}=aA(),{data:k,refetch:f}=ck(),{isEligible:g}=(0,no.useMemo)(()=>ym({userProfileError:l,userProfile:c,selectedAccount:m,accounts:k}),[c,l,m,k]),E=(0,no.useCallback)(async()=>{try{let F=await a.getUserProfile(),{data:S}=await f(),{data:x}=await B(),{isEligible:O}=ym({userProfile:F,selectedAccount:x,accounts:S});return O}catch{return!1}},[f,B,a]),h=(0,no.useMemo)(()=>i instanceof Error&&i.message!=="Unknown error"?i.message:j("settingsClaimUsernameError"),[i,j]),y=(0,no.useCallback)(async()=>{let{isEligible:F,publicAddresses:S}=ym({userProfileError:l,userProfile:c,selectedAccount:m,accounts:k});if(!F)throw A?.(),new Bk;t({username:u,icon:ZR(),addresses:S}).then(()=>e?.()).catch(()=>A?.())},[k,c,l,t,A,e,m,u]);return(0,no.useMemo)(()=>({handleClaimUsername:y,getClaimUsernameEligibility:E,isClaimUsernameEligible:g,claimUsernameErrorMessage:h,isClaimingUsernamePending:o,isClaimUsernameIdle:r}),[y,E,g,h,r,o])},ZR=()=>`https://assets.phantom.app/assets/phemojis/variant${A_(1,337)}.png`,A_=(e,A)=>(e=Math.ceil(e),A=Math.floor(A),Math.floor(Math.random()*(A-e)+e));n();s();var e_=(e,A)=>{let{data:j}=aA(),t=CA("enable-cash"),r=j?.isReadOnly,o=A&&parseFloat(A)>0;return e===0&&(!t||!o)&&!r};n();s();var j_=()=>{let{data:e,isLoading:A}=Di(),{mutate:j}=fm();return{shouldShowTermsOfServiceUpdateInterstitial:!A&&!e,setTermsAcknowledgement:j}};n();s();var t_=()=>{let{data:e}=au(),{data:A}=ru({enabled:!!e?.expired}),{data:j=[]}=uk("recoverable-only");return{shouldShowVerifyPinPrompt:yk("SeedlessPinVerification","enable-seedless-pin-verification-interstitial",()=>!!A&&!!e&&e.expired&&j.length>0&&!Vi())}};n();s();n();s();var $c=q(P());var r_=["enable","reject"],o_=({continueSwap:e,dismiss:A})=>{let j=J(),{setSlippageSetting:t}=MA(),r=(0,$c.useCallback)(i=>{switch(A(),i){case"enable":j.capture("autoSlippageOptIn",{data:{step:"enabledAutoSlippage"}}),t({type:"auto"}),bn();break;case"reject":j.capture("autoSlippageOptIn",{data:{step:"rejectedAutoSlippage"}}),t({type:"fixed"}),e();break}},[e,A,t,j]),o=(0,$c.useMemo)(()=>r_.map(i=>({label:T.t(i==="enable"?"swapSlippageOptInEnableOption":"swapSlippageOptInRejectOption"),variant:i==="enable"?"primary":"secondary",onPress:()=>r(i)})),[r]);return{title:T.t("swapSlippageOptInTitle"),description:T.t("swapSlippageOptInSubtitle"),learnMoreText:T.t("commandLearnMore"),learnMoreUrl:mp,options:o}};n();s();var vb=q(P());var n_=({goToAssetSelect:e})=>{let{setSearchQuery:A}=$();return(0,vb.useCallback)(j=>{j==="buy"&&A(""),e(j)},[e,A])};n();s();var Ni=q(P());var qb="auto-provider-defaulted-to-toast",s_=({showDefaultAutoProvider:e})=>{let{hasDefaultedToBestQuote:A}=iA(),{message:j,hideToast:t}=zA(),r=$(i=>i.setSelectedBaseProvider),o=(0,Ni.useRef)(A);(0,Ni.useEffect)(()=>{o.current=A},[A]),(0,Ni.useEffect)(()=>{A&&setTimeout(()=>{o.current&&(r(xe),j({id:qb,message:T.t("swapProviderAutoUpdateTitle"),icon:"info",onPress:()=>{t(qb),e()}}))},2e3)},[A,j,t,e,r])};n();s();var xb=q(P());n();s();var js=q(P());var i_=H(1);function vc(e,A,j){let t=J(),[r,o]=(0,js.useState)(!1),i=(0,js.useCallback)(async()=>{await t.capture("swapperToggleBestPriceRatio",{data:{unitCurrency:r?"buy token":"sell token"}}),o(!r)},[t,r]),a=$(c=>c.sellFungible),u=$(c=>c.buyFungible);return(0,js.useMemo)(()=>{let c=!1,l="";if(A&&j){let m=u?.data,B=a?.data;if(m&&B){let{buyAmount:k,sellAmount:f}=j,g=kA(k,m.decimals),E=kA(f,B.decimals),h=g.dividedBy(E),y=`1 ${B.symbol} \u2248 ${Tr(h)} ${m.symbol}`,F=`1 ${m.symbol} \u2248 ${Tr(i_.dividedBy(h))} ${B.symbol}`;c=new H(j.buyAmount).isEqualTo(e),l=r?F:y}}return{isBestRate:c,rate:l,flip:i}},[e,j,r,A,a,u,i])}var a_=({selectProvider:e})=>{let{currentQuote:A,quoteResponse:j}=iA(),{currencySymbol:t,fromUsd:r}=bA(),o=A?.buyAmount??"",i=vc(o,j,A),a=Uo(OA(A)),u=A?.baseProvider.name??"";return{details:(0,xb.useMemo)(()=>A?dA(A)?c_({quote:A,selectProvider:e,exchangeRate:i,currencySymbol:t,fromUsd:r}):p_({provider:u,sources:a,exchangeRate:i,selectProvider:e}):[],[A,u,a,i,e,t,r]),footnote:T.t("swapProviderPricingFootnote")}},p_=({provider:e,sources:A,exchangeRate:j,selectProvider:t})=>[{label:T.t("swapProviderPricingProvider"),value:e,icon:"chevron-right",onPress:t},{label:T.t("swapProviderPricingMarket"),value:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip}],c_=({quote:e,selectProvider:A,exchangeRate:j,currencySymbol:t,fromUsd:r})=>{let o=e.baseProvider.name,i=ln(e).toString(),a=rj(nt(e));return[{label:T.t("swapProviderPricingProvider"),value:o,icon:"chevron-right",onPress:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip},{label:T.t("swapProviderPricingFees"),value:`${t}${r(Number(i),2)} ${T.t("swapProvidersFee")}`},{label:T.t("swapProviderPricingTime"),value:a}]};n();s();n();s();n();s();var ts=q(P());n();s();var Gb=q(P());n();s();var Tb=q(P());var u_={status:!1,timestamp:""},Pb=()=>{let{data:e}=ne({key:"hasViewedAutoSlippageOptIn",queryKey:uA.hasViewedAutoSlippageOptIn()}),{mutateAsync:A}=le({key:"hasViewedAutoSlippageOptIn",queryKey:uA.hasViewedAutoSlippageOptIn()}),j=(0,Tb.useCallback)(t=>void A({status:t,timestamp:new Date().toISOString()}),[A]);return{viewedOptInState:e??u_,setViewedOptInState:j}};var Cb=()=>{let{viewedOptInState:e,setViewedOptInState:A}=Pb(),{selectedSetting:j}=MA(),{reviewInterceptors:t,supportedCustomSimulationToastErrorTypes:r}=fi(),o=TA(),{connection:i}=cj(),a=wA(),u=Sj(),c=T.language,l=J(),m=qt(),B=pA(),k=cr(),f=$(x=>x.gasEstimation.estimateWithBuffer),g=MA(),{storePairs:E}=Ve(),h=Lj(),{data:[y]}=_A(["enable-ext-swap-commands"]),F=Rt("kill-swapper-simulation")??!1;return{executeInterceptors:(0,Gb.useCallback)((x,O,v,D)=>{for(let G of t)if(G.intercept({hasViewedAutoSlippageOptIn:e.status,selectedSetting:j.type,setHasViewedAutoSlippageOptIn:A,showOverlay:x,swapper:o,connection:i,storage:a,vaultProxy:u,locale:c,analytics:l,resetSwapper:m,queryClient:B,showFungibleDetails:O,showBuyFungibleScreen:v,swapAnalytics:k,gasEstimation:f,slippageSettings:g,navigateToSwapper:D,supportedCustomSimulationToastErrorTypes:r,storePairs:E,isMobile:We,enableExtSwapCommands:y,authRepository:h,isSimulationKilled:F})==="interrupt")return"interrupt";return"continue"},[t,e.status,j.type,A,o,i,a,u,c,l,m,B,k,f,g,r,E,y,h,F])}};n();s();var hm=q(P());n();s();var Rb=q(P());n();s();function Ob(e){if(e===void 0)return Kj.colors.legacy.textDiminished;let A=parseFloat(e.toFixed(2));switch(!0){case A>=5:return Kj.colors.legacy.spotNegative;case(A>=1&&e<5):return Kj.colors.legacy.spotWarning;case(e>=0&&e<1):return Kj.colors.legacy.spotPositive;default:return Kj.colors.legacy.textDiminished}}n();s();function Mb(e){if(e===void 0)return"-";switch(!0){case e>=1e3:return">1000%";case(e>=.01&&e<1e3):return`${e.toFixed(2)}%`;case(e>0&&e<.01):return"<0.01%";case e===0:return"0%";default:return"-"}}function qc(e){return(0,Rb.useMemo)(()=>{let A="",j="";if(e===void 0)return;let t=e*100;return A=Ob(t),j=Mb(t),{color:A,text:j,percentage:t}},[e])}n();s();var xc=({priceImpact:e,slippage:A,transferFees:j,shouldShowFees:t,shouldShowPriceImpact:r,shouldShowSlippage:o})=>{let i=Fj?m_:d_;return[...l_({priceImpact:e,slippage:A,transferFees:j}),...i({shouldShowSlippage:o,shouldShowFees:t,shouldShowPriceImpact:r})]},l_=({priceImpact:e,slippage:A,transferFees:j})=>{let t=[];return e&&e.percentage>hd&&t.push("highPriceImpact"),A&&A.percentage>=Fd&&t.push("highSlippage"),(j?.totalPercentFees??0)>0&&t.push("transferFees"),t},d_=({shouldShowSlippage:e,shouldShowFees:A,shouldShowPriceImpact:j})=>{let t=[];return t.push("providerPressable"),t.push("exchangeRate"),e&&t.push("slippagePressable"),A&&t.push("fees"),j&&t.push("priceImpact"),t},m_=({shouldShowSlippage:e,shouldShowFees:A,shouldShowPriceImpact:j})=>{let t=[];return t.push("pricing"),A&&t.push("fees"),j&&t.push("priceImpact"),e&&t.push("slippagePressable"),t};n();s();function Tc(e,A){let j="",t="";if(e===void 0)return;j=k_(e);let r=A==="auto"?`${T.t("swapSettingsAuto")} \u2022 `:"";return t=B_(e),{color:j,text:t,percentage:e,prefix:r}}function k_(e){let A=parseFloat(e.toFixed(2));switch(!0){case A>2:return Kj.colors.legacy.spotNegative;case(A>=1&&e<=2):return Kj.colors.legacy.spotWarning;default:return Kj.colors.legacy.textDiminished}}function B_(e){switch(!0){case e>=1e3:return">1000%";case(e>=.01&&e<1e3):return`${e.toFixed(2)}%`;case(e>0&&e<.01):return"<0.01%";case e===0:return"0%";default:return"-"}}var _b=()=>{let{currentQuote:e,quoteResponse:A}=iA(),j=qc(ar(e)),{selectedSetting:t}=MA(),r=(0,hm.useMemo)(()=>Tc(A?.slippageTolerance,t.type),[A?.slippageTolerance,t.type]),o=$(c=>c.sellFungible),i=$(c=>c.buyFungible),a=(0,hm.useMemo)(()=>An([o,i]),[o,i]);return{logSwapHomeState:()=>{let c=xc({priceImpact:j,slippage:r,transferFees:a,shouldShowFees:!0,shouldShowPriceImpact:!!j,shouldShowSlippage:!!r}),l={slippage:JSON.stringify(r),priceImpact:JSON.stringify(j),rows:c};b.addBreadcrumb("swapper","swap-home","info",_t(l))}}};n();s();var Db=q(P());n();s();function Pc({sellFungible:e,totalFees:A,minRequiredBalance:j,currentQuote:t}){let r=e?.type?Ae(e?.type):!1,{source:o,destination:i}=j;if(r){let a=new w(t?.sellAmount??0);return A.plus(a)}else{let a=o.plus(i);return A.plus(a)}}var Nb=()=>{let{currentQuote:e}=iA(),{totalFees:A}=Oj(),j=$(a=>a.sellFungible),t=$(a=>a.buyFungible),r=mr(j),o=dr({sellFungible:j,buyFungible:t});return(0,Db.useMemo)(()=>Pc({sellFungible:j,totalFees:A.maxAmount??A.amount,minRequiredBalance:{source:r,destination:o},currentQuote:e}),[j,A,r,o,e])};n();s();function Gc({sellFungible:e,sellNativeFungible:A,totalNativeRequirement:j}){let t=e?.data.chain.id,r=A?Ne(A.data.amount,A.data.decimals):"-",o=A?Ne(j,A.data.decimals):"-";return{networkId:t,balance:r,required:o}}n();s();function Lb({quoteResponse:e,hasInsufficientBalance:A,insufficientBalanceArgs:j,isTermsAcknowledged:t,logSwapHomeState:r,goToInsufficientBalance:o,goToSwapTermsOfService:i,onSwap:a,executeInterceptors:u}){if(e)A?o(j):(r(),t?u()==="continue"&&a():i());else return}var Fm=({goToSwapTermsOfService:e,goToInsufficientBalance:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i})=>{let{quoteResponse:a}=iA(),u=$(S=>S.sellFungible),c=u?.data.chain.id,{data:l}=Di(),{logSwapHomeState:m}=_b(),{fungible:B}=vj({key:c?vo(c,void 0):void 0}),k=Nb(),f=(0,ts.useMemo)(()=>new w(B?.data.amount??0).lt(k),[B,k]),g=(0,ts.useMemo)(()=>Gc({sellFungible:u,sellNativeFungible:B,totalNativeRequirement:k}),[u,B,k]),E=ip({goToConfirmation:j}),{executeInterceptors:h}=Cb(),y=(0,ts.useCallback)(()=>h(t,r,o,i),[h,t,r,o,i]);return{onClick:(0,ts.useCallback)(()=>Lb({quoteResponse:a,hasInsufficientBalance:f,insufficientBalanceArgs:g,isTermsAcknowledged:l,logSwapHomeState:m,goToInsufficientBalance:A,goToSwapTermsOfService:e,onSwap:E,executeInterceptors:y}),[a,f,g,l,m,A,e,E,y])}};n();s();var Li=q(P()),Sm=q(In());n();s();n();s();var Kb=({sellFungible:e,totalFees:A,transactionSpeedsToUnitCost:j,currentQuote:t,isBridge:r,minRequiredBalance:o,customPriorityFee:i,customTip:a})=>{let u=e?mn({sellFungible:e,totalFees:A.amount,transactionSpeedsToUnitCost:I.isEVMNetworkID(e.data.chain.id)?j:void 0,isBridge:r,minRequiredBalance:o,customPriorityFee:i,customTip:a}):"0",c=e?.data.decimals;return t?.sellAmount?new H(kA(t.sellAmount,c??0)).isLessThanOrEqualTo(new H(u)):!0};var Ub=({sellFungible:e,isFetchingQuote:A,quoteResponse:j,currentQuote:t,gasEstimation:r,maxGasEstimation:o,hasNoRoutes:i,totalFees:a,transactionSpeedsToUnitCost:u,isBridge:c,minRequiredBalance:l,shouldSkipSwapReview:m,numTransactions:B,customPriorityFee:k,customTip:f})=>{let g=Kb({sellFungible:e,totalFees:a,transactionSpeedsToUnitCost:u,currentQuote:t,isBridge:c,minRequiredBalance:l,customPriorityFee:k,customTip:f});switch(g_({quoteResponse:j,sellFungible:e,currentQuote:t,hasNoRoutes:i,hasEnoughAssets:g,isFetchingQuote:A,gasEstimation:r,maxGasEstimation:o,shouldSkipSwapReview:m,numTransactions:B})){case"notSwappable":return{title:T.t("swapReviewFlowActionButtonPrimary"),type:"secondary",disabled:!0};case"swappable":return{title:T.t("swapReviewFlowActionButtonPrimary"),type:"primary",disabled:!1};case"reviewable":return{title:T.t("swapFlowActionButtonText"),type:"primary",disabled:!1};case"notReviewable":return{title:T.t("swapFlowActionButtonText"),type:"secondary",disabled:!0};case"insufficientBalance":return{title:T.t("swapReviewInsufficientBalance"),type:"alert",disabled:!0};case"noRoutes":return{title:T.t("swapNoQuotesFound"),type:"secondary",disabled:!0}}},f_=({sellFungible:e})=>{let A=e?.data.chain.id??tA.Solana.Mainnet;return I.isEVMNetworkID(A)};function g_({quoteResponse:e,sellFungible:A,currentQuote:j,hasNoRoutes:t,hasEnoughAssets:r,isFetchingQuote:o,gasEstimation:i,maxGasEstimation:a,shouldSkipSwapReview:u,numTransactions:c}){if(!r)return"insufficientBalance";if(t)return"noRoutes";let l=f_({sellFungible:A}),m=!!(i&&(i??[]).length>=c&&(a??[]).length>=c);return!e||!A||!j||l&&!m||o?u?"notSwappable":"notReviewable":u?"swappable":"reviewable"}function E_({goToInsufficientBalance:e,goToSwapTermsOfService:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i}){let{currentQuote:a,isFetchingQuote:u,quoteResponse:c}=iA(),l=$(cA=>cA.hasNoRoutes),m=$(cA=>cA.sellFungible),B=m?.data.chain.id,{estimate:k,estimateWithBuffer:f}=$(cA=>cA.gasEstimation),g=$(cA=>cA.buyFungible),E=g?.data.chain.id,h=xA(B,E),{totalFees:y}=Oj(),{data:F}=Io({networkID:B}),S=mr(m),x=dr({sellFungible:m,buyFungible:g}),O=$(cA=>cA.sellAmount),v=$(cA=>cA.setIsFetchingQuote),D=$n(),G=(0,Sm.default)(D),C=(0,Sm.default)(O);(0,Li.useEffect)(()=>{O!==C&&O&&D&&G&&v(!0)},[O,C,v,D,G]);let{data:_}=aA(),V=(0,Li.useMemo)(()=>_?.addresses??[],[_]),z=(0,Li.useMemo)(()=>V.find(cA=>cA.networkID===m?.data.chain.id)?.address??"",[V,m]),{data:L}=Jj({callerAddress:z,quote:a,sellFungible:m}),{data:R}=He(),{data:W}=Qe(),{title:Q,type:jA,disabled:Z}=Ub({sellFungible:m,currentQuote:a,quoteResponse:c,isFetchingQuote:u,isBridge:h,gasEstimation:k,maxGasEstimation:f,hasNoRoutes:l,totalFees:y,transactionSpeedsToUnitCost:F,minRequiredBalance:{source:S,destination:x},shouldSkipSwapReview:!0,numTransactions:L?.transactions?.length??0,customPriorityFee:wt(R??0),customTip:wt(W??0)}),{onClick:mA}=Fm({goToInsufficientBalance:e,goToSwapTermsOfService:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i});return{disabled:Z,title:Q,type:jA,onClick:mA}}n();s();n();s();var Ki=q(P());n();s();var Hb=({buyNetwork:e,sellNetwork:A,executionDuration:j,priceImpact:t,slippage:r})=>{let o=[];return o.push("provider"),o.push("exchangeRate"),e&&A&&e!==A&&o.push("network"),r&&o.push("slippage"),o.push("fees"),j>0&&o.push("executionDuration"),t&&o.push("priceImpact"),o};function y_({isSwapReview:e,showProviders:A,showSwapSettings:j,showSwapPricing:t}){let{bestBuyAmount:r,currentQuote:o,hasNoRoutes:i,quoteResponse:a,quotes:u,isFetchingQuote:c}=iA(),l=vc(r,a,o),m=qc(ar(o)),{slippageSetting:B,slippageTolerance:k}=bi(),f=(0,Ki.useMemo)(()=>Tc(k,B.type),[k,B.type]),g=Uo(OA(o)),E=nt(o),h=rj(E),[y]=(0,Ki.useState)(h),F=a?.sellToken?.chainId?I.getChainName(a.sellToken.chainId):void 0,S=a?.buyToken?.chainId?I.getChainName(a.buyToken.chainId):void 0,x=Oj(),O=I7(x),v=$(L=>L.sellFungible),D=$(L=>L.buyFungible),G=(0,Ki.useMemo)(()=>An([v,D]),[v,D]),C=!!x.phantomFee.pct,V={exchangeRate:l,priceImpact:m,slippage:f,provider:g,fees:x,executionDuration:E,uiEstimatedTime:y,isFetchingQuote:c,sellNetwork:F,buyNetwork:S,feeBreakdown:O,selectProviderEnabled:!e&&!!g,isSwapReview:e,showProviders:A,showSwapSettings:j,showSwapPricing:t,transferFees:G},z=e?Hb({exchangeRate:l,priceImpact:m,slippage:f,buyNetwork:S,sellNetwork:F,executionDuration:E}):xc({priceImpact:m,slippage:f,transferFees:G,shouldShowFees:!0,shouldShowPriceImpact:!!m,shouldShowSlippage:!!f});return{exchangeRate:l,hasNoRoutes:i,priceImpact:m,slippage:f,provider:g,fees:x,nrOfQuotes:u.length,executionDuration:E,isFetchingQuote:c,sellNetwork:F,buyNetwork:S,rows:z,sharedRowProps:V,displayPhantomFeeRow:C}}n();s();var pt=q(P());n();s();n();s();var Cc=class{getRow({quote:A,buyToken:j}){let t=`${_e(kA(A.buyAmount,j.decimals),Ij.get(j.networkId).formDisplayPrecision)} ${j.symbol}`;return{type:"standard",key:A.baseProvider.id,logoUri:A.baseProvider.logoUri,topLeft:{text:A.baseProvider.name},topRight:{text:t,color:"textDiminished"}}}getAutoRow(){return{type:"standard",key:xe,topLeft:{text:T.t("selectSwapProviderAutoLabel")},topRight:{text:T.t("selectSwapProviderAutoDescription"),color:"textDiminished"}}}},wm=class extends Cc{getRow(A){let{quote:j,currencySymbol:t,fromUsd:r}=A;if(!dA(j))throw new Error("Quote is not a bridge quote");let o=super.getRow(A),i=rj(nt(j)),a=ln(j).toString();return{...o,type:"bridge",bottomLeft:{text:i},bottomRight:{text:`${t}${r(Number(a),2)} ${T.t("swapProvidersFee")}`}}}getAutoRow(){return{type:"bridge",key:xe,topLeft:{text:T.t("selectSwapProviderAutoLabel")},topRight:{text:T.t("selectSwapProviderAutoDescription"),color:"textDiminished"},bottomLeft:{text:T.t("selectSwapProviderAutoTBD")},bottomRight:{text:T.t("selectSwapProviderAutoTBD")}}}},bm=new Cc,Im=new wm;var Oc=({quoteResponse:e,buyToken:A,currencySymbol:j,setSelectedProvider:t,fromUsd:r})=>{let o=e.type==="xchain",i=o?Im.getAutoRow():bm.getAutoRow(),a={...i,onPress:()=>t(i.key)},u=e.quotes.reduce((c,l)=>{let B=(o?Im:bm).getRow({quote:l,buyToken:A,currencySymbol:j,fromUsd:r});return[...c,{...B,onPress:()=>t(l.baseProvider.id)}]},[]);return[a,...u]};var h_=({dismiss:e})=>{let{fromUsd:A,currencySymbol:j}=bA(),t=J(),r=TA(),o=Pj(f=>f.setPreferredProvider),i=Pj(f=>f.preferredProvider),[a,u]=(0,pt.useState)(i??xe),[c,l]=(0,pt.useState)(r.getQuoteProcessorState());(0,pt.useEffect)(()=>{let f=r.subscribeQuoteProcessor({onStateChange(g,E){l(E)}});return()=>f()},[r]);let m=(0,pt.useMemo)(()=>{let f=c.type;if(f!=="firstQuoteReceived"&&f!=="quoteProcessed")return[];let{response:g,input:E}=c,{buy:h}=E;return Oc({quoteResponse:g,buyToken:{networkId:h.data.chain.id,decimals:h.data.decimals,symbol:h.data.symbol??""},currencySymbol:j,setSelectedProvider:u,fromUsd:A})},[c,j,A]),B=(0,pt.useCallback)(()=>{let f=a===xe?void 0:a;o(f),t.capture("swapperProviderSelected",{data:{provider:f}}),e()},[a,o,e,t]),k=(0,pt.useMemo)(()=>[{theme:"secondary",disabled:!1,label:T.t("commandCancel"),onPress:e},{theme:"primary",disabled:a===(i??xe),label:T.t("commandApply"),onPress:B}],[B,e,a,i]);return{selectedProvider:a,rows:m,buttons:k}};n();s();var so=q(P());var F_=({dismiss:e})=>{let{fromUsd:A,currencySymbol:j}=bA(),t=J(),r=$(f=>f.quoteResponse),o=$(f=>f.buyFungible),i=$(f=>f.selectedBaseProvider),a=$(f=>f.setSelectedBaseProvider),u=Pj(f=>f.setPreferredProvider),[c,l]=(0,so.useState)(i),m=(0,so.useMemo)(()=>!r||!o?[]:Oc({quoteResponse:r,buyToken:{networkId:o.data.chain.id,decimals:o.data.decimals,symbol:o.data.symbol??""},currencySymbol:j,setSelectedProvider:l,fromUsd:A}),[r,o,j,A,l]),B=(0,so.useCallback)(()=>{a(c),u(c),t.capture("swapperProviderSelected",{data:{provider:c}}),e()},[c,a,u,e,t]),k=(0,so.useMemo)(()=>[{background:"element",disabled:!1,label:T.t("commandCancel"),onPress:e},{background:"spot",disabled:c===i,label:T.t("commandApply"),onPress:B}],[B,e,c,i]);return{selectedProvider:c,rows:m,buttons:k}};n();s();var rs=q(P());var Ui=VA(e=>({isInitializeComplete:!0,swapMode:void 0,setSwapMode:A=>e({swapMode:A,isInitializeComplete:!1}),setIsInitializeComplete:A=>e({isInitializeComplete:A})})),S_=Ui.getState().setSwapMode,w_=()=>Ui(e=>e.isInitializeComplete===!1),b_=()=>{let e=TA(),A=go(),j=$t(),{pairs:t}=Ve(),r=(0,rs.useMemo)(()=>A.find(c=>j.includes(c))??"solana:101",[A,j]),o=Ui(c=>c.swapMode),i=Ui(c=>c.setSwapMode),a=Ui(c=>c.setIsInitializeComplete);(0,rs.useEffect)(()=>e.subscribeToken({onStateChange:l=>{l.type==="initializeCompleted"&&a(!0)}}),[e,a]);let u=(0,rs.useMemo)(()=>{if(!t)return{sellCaip19:void 0,buyCaip19:void 0};let c=B=>B&&A.includes(B.data.chain.id)&&j.includes(B.data.chain.id),l=c(t.sellFungible)?t.sellFungible:void 0,m=c(t.buyFungible)?t.buyFungible:void 0;return{sellCaip19:l?M(U(l)):void 0,buyCaip19:m?M(U(m)):void 0}},[t,A,j]);return(0,rs.useMemo)(()=>{if(o)return o;let c,l=I_(u);return l?c=l:c={type:"swap",network:r,takerCaip19:void 0,takerDestinationCaip19:void 0},i(c),c},[r,u,o,i])},I_=e=>e.sellCaip19&&e.buyCaip19?{type:"swap",network:GA(e.sellCaip19).chainId,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:void 0,takerDestinationCaip19:void 0}:null;function $_(e,A){if(e||A)return{type:"swap",network:GA(e??A).chainId,...e&&{sellCaip19:e},...A&&{buyCaip19:A},takerCaip19:void 0,takerDestinationCaip19:void 0}}n();s();var HA=q(P());n();s();function Mc(e,A,j,t){if(j==="sell")return t.includes("insufficientBalance");let r=e?.sellAmount,o=A.find(i=>i.percentage===1)?.amount.toString();return!!r&&!!o&&new w(r).gt(o)}var v_=(e,A)=>{let{tokenState:j,quotedAmounts:t,quoteProcessorState:r,sellPercentages:o,inputErrors:i,setAmount:a}=xd(e,A),u=CA("enable-be-swapper-max-amount"),[c,l]=(0,HA.useState)(void 0),[m,B]=(0,HA.useState)(""),[k,f]=(0,HA.useState)("crypto"),[g,E]=(0,HA.useState)("sell"),h=(0,HA.useRef)(!1),{currencySymbol:y,toUsd:F,fromUsd:S}=bA(),x=ta(),{balanceDisplayStrategy:O}=fi(),v=pi(),D=ui(),G=TA(),C=(0,HA.useCallback)((rA,Y,sA)=>{if(l(void 0),rA===""){B(rA),a({amount:"0",denomination:k,perspective:Y,tokenStateOverride:sA});return}let EA=De(rA);__(EA)&&(B(EA),a({amount:k==="fiat"?String(F(EA)):EA,denomination:k,perspective:Y,tokenStateOverride:sA}))},[k,B,a,F]),_=(0,HA.useCallback)((rA,Y)=>{g==="buy"&&E("sell"),l(rA);let sA=rA.getAmountForDenomination(k),EA=S(sA.toString());B(D_(new H(EA),k,Y)),a({amount:sA.toString(),denomination:k,perspective:"sell"})},[l,g,k,a,S]),V=(0,HA.useCallback)(()=>{G.switchTokens()},[G]),z=(0,HA.useCallback)(rA=>{let Y=O_({perspective:g,currencyDenomination:k,quotedAmounts:t,fromUsd:S});Y&&C(Y.toString(),g,rA)},[k,g,C,t,S]);(0,HA.useEffect)(()=>G.subscribeToken({onStateChange:(Y,sA,EA)=>{Y.type==="switchTokens"&&(z(EA),h.current=!0,u&&G.refreshPair({swapMode:Y.mode,cashAddresses:v,settings:D})),u&&Y.type==="changeToken"&&(h.current=!0,G.refreshPair({swapMode:Y.mode,cashAddresses:v,settings:D}))}}),[G,z,v,D,u]),(0,HA.useEffect)(()=>{h.current&&(h.current=!1,C(m,g))},[o]);let L=(0,HA.useCallback)(()=>{let rA=k==="crypto"?"fiat":"crypto";if(f(rA),!!t)switch(rA){case"crypto":let Y=vm(g,t);B(Y.toString());break;case"fiat":let sA=$m(g,t)?.toFixed(2)??"0",EA=S(sA);B(String(EA));break}},[k,g,t,S]),R=(0,HA.useMemo)(()=>kp(),[]),{sellAsset:W,buyAsset:Q}=Qb(j),jA=Fi({sellAsset:W,buyAsset:Q,currencyDenomination:k}),Z=(0,HA.useMemo)(()=>C_(["sell","buy"],rA=>q_({perspective:rA,tokenState:j,quoteProcessorState:r,currencyDenomination:k,currentPerspective:g,inputAmount:m,inputErrors:i,isBalanceHidden:x,balanceDisplayStrategy:O,sellPercentages:o,currencyDenominationSupportRules:R,isBuyAmountEditable:jA,quotedAmounts:t,currencySymbol:y,fromUsd:S})),[k,m,i,x,O,o,g,r,t,j,R,jA,y,S]),mA=(0,HA.useCallback)(()=>{C("",g)},[C,g]);(0,HA.useEffect)(()=>{let rA=G.subscribeToken({onStateChange(Y,sA,EA){!Oe(sA)||!Oe(EA)||Y.type==="changeToken"&&sA.sellToken.data.tokenAddress!==EA.sellToken.data.tokenAddress&&mA()}});return()=>rA()},[G,mA]),(0,HA.useEffect)(()=>G.subscribeAccountChange({onAccountChange:Y=>{mA(),G.stopQuoteProcessor();let sA=G.getTokenState(),EA=Y.addresses[0];Oe(sA)&&EA&&G.initializeSwap({swapMode:{type:"swap",network:EA.networkID,takerCaip19:void 0,takerDestinationCaip19:void 0},cashAddresses:v,settings:D})}}),[G,mA,v,D]);let cA=(0,HA.useCallback)(rA=>{if(E(rA),!t||!Oe(j))return;let{sellAsset:Y,buyAsset:sA}=Qb(j);if(!(rA==="sell"?Y:sA))return;let lA,QA;switch(k){case"crypto":lA=vm(rA,t).toString(),QA=lA;break;case"fiat":let ce=$m(rA,t)?.toFixed(2)??"0";lA=String(S(ce)),QA=ce;break}B(lA),a({amount:QA,denomination:k,perspective:rA})},[k,t,j,S,B,a]);return{inputAmount:m,tokens:Z,currencyDenomination:k,inputPerspective:g,tokenState:j,quotedAmounts:t,quoteProcessorState:r,inputErrors:i,currentSellPercentage:c,sellPercentages:o,switchTokens:V,setInputAmount:C,switchCurrencyDenomination:L,setSellPercentage:_,clearInput:mA,setInputPerspective:cA}};function q_({perspective:e,tokenState:A,quoteProcessorState:j,currencyDenomination:t,currentPerspective:r,inputAmount:o,inputErrors:i,isBalanceHidden:a,balanceDisplayStrategy:u,sellPercentages:c,currencyDenominationSupportRules:l,isBuyAmountEditable:m,quotedAmounts:B,currencySymbol:k,fromUsd:f}){if(!Oe(A))return;let g=P_(e,B),E=G_(e,r,A,o,B),h=t==="crypto"?g:new H(f(E)).toFixed(2),y=R_(o);e===r?h=o:y.gt(0)||(h="");let F=l.every(C=>C.isSupported(e,A.sellToken,A.sellTokenPrice?.usd,A.buyToken,A.buyTokenPrice?.usd)),S=e==="sell"?A.sellToken:A.buyToken,x=t==="crypto"?`${k}${new H(f(E)).toFixed(2)}`:T_(g,S),O=c.find(C=>C.percentage===1)?.amount.toString(),v=e==="sell"?O:void 0,D=x_(B,c,r,i);return{perspective:e,fungible:S,balance:M_(S,u,a,v),amount:h,secondaryAmount:y.gt(0)?x:"",isAmountLoading:j.type==="starting"&&e!==r,isSecondaryAmountLoading:j.type==="starting",hasAmountWarning:D,isAmountEditable:e==="sell"?!0:m,supportsCurrencyDenominationSwitching:F,amountPrefix:t==="fiat"?k:void 0,percentages:e==="sell"?c:[],warnings:e==="buy"?A.warnings:[]}}function x_(e,A,j,t){return Mc(e,A,j,t)?!0:t.length>0}function T_(e,A){let j=Ij.get(A.data.chain.id).formDisplayPrecision;return`${_e(new H(e),j)} ${A.data.symbol??""}`}function P_(e,A){return A?vm(e,A).toString():"0"}function G_(e,A,j,t,r){if(r)return $m(e,r)?.toString()??"0";{if(e!==A||!Oe(j))return"0";let o=e==="sell"?j.sellTokenPrice:j.buyTokenPrice;return o?.usd?new H(t).times(o.usd).toString():"0"}}function $m(e,A){switch(e){case"sell":return A?.sellAmountUsd;case"buy":return A?.buyAmountUsd}}function vm(e,A){switch(e){case"sell":return A.sellAmount;case"buy":return A.buyAmount}}function C_(e,A){return e.reduce((j,t,r)=>{let o=A(t,r,e);return o!=null&&j.push(o),j},[])}function O_({perspective:e,currencyDenomination:A,quotedAmounts:j,fromUsd:t}){if(j)switch(e){case"sell":return A==="crypto"?j.buyAmount:j.buyAmountUsd?new H(t(j.buyAmountUsd.toString(),2)):void 0;case"buy":return A==="crypto"?j.sellAmount:j.sellAmountUsd?new H(t(j.sellAmountUsd.toString(),2)):void 0}}function M_(e,A,j,t){let r=t?H(t):e.data?.balance;if(!(!r||j))return NA(e)?ja(r):A.format(r,e.data?.symbol??"")}function R_(e){return e==null?new H(0):e===""?new H(0):new H(e)}function __(e){try{let A=new H(e);return A.isFinite()?!A.isNegative():!1}catch{return!1}}function Qb(e){return Oe(e)?{sellAsset:e.sellToken,buyAsset:e.buyToken}:{sellAsset:void 0,buyAsset:void 0}}var D_=(e,A,j)=>A==="fiat"?e.gte(.01)?e.decimalPlaces(2).toString():e.decimalPlaces(5,H.ROUND_UP).toString():e.decimalPlaces(j.data.decimals).toString();n();s();var Wb=q(P());n();s();var xm=q(P());n();s();var Dc=q(P());n();s();n();s();var Rc=class{constructor(A,j){this.gaslessSwapFeeResult=A;this.insufficientFundsInterceptor=j}intercept(A){return this.gaslessSwapFeeResult.success?"continue":this.insufficientFundsInterceptor.intercept(A)}};n();s();var _c=class{intercept({hasInsufficientFunds:A,showInsufficientFunds:j}){return A?(j(),"interrupt"):"continue"}};var Vb=e=>{let A=new _c,j=N_(e);return j?[new Rc(j,A)]:[A]},N_=e=>{if(e.type!=="firstQuoteReceived"&&e.type!=="quoteProcessed")return;let A=e.quote;if(Le(A))return A.gaslessSwapFeeResult};var zb=e=>{let A=(0,Dc.useMemo)(()=>Vb(e.quoteProcessorState),[e.quoteProcessorState]);return{executeSwapInterceptors:(0,Dc.useCallback)(()=>{for(let t of A){let r=t.intercept(e);if(r==="interrupt")return r}return"continue"},[A,e])}};n();s();var qm=q(P());var Xb=(e,A)=>{let{sellFungible:j,buyFungible:t}=L_(e),r=U_(A),o=mr(j),i=dr({sellFungible:j,buyFungible:t}),a=(0,qm.useMemo)(()=>K_(A),[A]),u=j?.data.chain.id,{fungible:c}=vj({key:u?vo(u,void 0):void 0,enableSorting:!1,enablePrices:!1});return(0,qm.useMemo)(()=>{if(!j||!c||!t||!r)return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:void 0};if(NA(j)||NA(t))return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:Id(A)};let l=Pc({sellFungible:j,totalFees:a,minRequiredBalance:{source:o,destination:i},currentQuote:r}),m=Id(A);return{hasInsufficientFunds:new w(c?.data.amount??0).lt(l),insufficientFundsArgs:Gc({sellFungible:j,sellNativeFungible:c,totalNativeRequirement:l}),analyticsFields:m}},[j,t,r,a,o,i,c,A])};function L_(e){return e.type!=="pair"?{sellFungible:void 0,buyFungible:void 0}:{sellFungible:e.sellToken,buyFungible:e.buyToken}}function K_(e){return e.type!=="quoteProcessed"?new w(0):e.nextProcessedQuote.fees.fees.reduce((A,j)=>A.plus(j.amount),new w(0))}function U_(e){if(e.type==="quoteProcessed")return e.quote}var Tm=({performSwap:e,goToInsufficientFunds:A,tokenState:j,quoteProcessorState:t})=>{let{hasInsufficientFunds:r,insufficientFundsArgs:o,analyticsFields:i}=Xb(j,t),a=(0,xm.useCallback)(()=>o&&A(o,i),[A,o,i]),{executeSwapInterceptors:u}=zb({hasInsufficientFunds:r,showInsufficientFunds:a,quoteProcessorState:t});return{swap:(0,xm.useCallback)(()=>{u()==="continue"&&e()},[u,e])}};var Pm=class{constructor(A,j){this.resetSwapper=A;this.storePairs=j}onStateChange(A,j,t,r){A.type==="executeSwapStarted"&&(this.resetSwapper(),this.storePairs(A.executingQuote.sell,A.executingQuote.buy))}},Gm=class{constructor(A){this.swapper=A}onStateChange(A,j,t,r){let{sell:o,quote:i}=t.executingQuote;if(A.type==="transactionConfirmed"){let a=o.data.balance?new w(o.data.balance):void 0;if(!a)return;let u=new w(i.sellAmount).shiftedBy(-o.data.decimals),c=a.minus(u);this.swapper.updateBalances({sellTokenBalance:c,sellTokenCaip19:M(U(o))})}}},H_=({swapMode:e,quotedAmounts:A,tokenState:j,inputErrors:t,quoteProcessorState:r,currentPerspective:o,sellPercentages:i,showFungibleDetails:a,showBuyFungibleScreen:u,retryAndNavigateToSwapper:c,resetSwapper:l,goToInsufficientFunds:m,preprocessor:B})=>{let k=TA(),f=x7(),{storePairs:g}=Ve(),E=(0,Wb.useCallback)(()=>{f({showFungibleDetails:a,showBuyFungibleScreen:u,showRetrySwap:c,swapMode:e,executeSwapStateListeners:[new Pm(l,g),new Gm(k)],quotedAmounts:A,uiContext:"swapperClassic",preprocessor:B})},[f,a,u,c,e,l,g,A,k,B]),{swap:h}=Tm({performSwap:E,goToInsufficientFunds:m,tokenState:j,quoteProcessorState:r});return{buttonState:Q_(j,t,A,r,o,i),swap:h}},Q_=(e,A,j,t,r,o)=>e.type!=="pair"?{type:"untradable",label:""}:t.type==="error"?{type:"untradable",label:T.t("swapNoQuotesFound")}:Mc(j,o,r,A)?{type:"insufficientBalance",label:T.t("swapReviewInsufficientBalance")}:t.type!=="quoteProcessed"?{type:"loading",label:T.t("swapReviewFlowActionButtonPrimary")}:j?{type:"tradable",label:T.t("swapReviewFlowActionButtonPrimary")}:{type:"untradable",label:T.t("swapReviewFlowActionButtonPrimary")};n();s();var Nc=q(P());n();s();var Br=()=>!0,Jb={tokens:Br,prices:tB,collectibles:cB,currency:qk,staking:BB,swapper:b7,transferFungibleLoggingContext:Br,user:dk,[Pk]:Br,[Ek]:Br,[Mi]:Br,[fB]:Br,[Ss]:Br,[gj]:Br,"test-debug-query":po},Yb=e=>{if(e.queryKey.length===0)return!1;let A=String(e.queryKey[0]);return e.state.status!=="success"?!1:Jb[A]?Jb[A](e):!1};var Zb=new jk({defaultOptions:{mutations:{retry:!1,networkMode:"offlineFirst"},queries:{retry:!1,staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,networkMode:"offlineFirst"}}}),V_=Ak({underlyingStorage:new Qk,throttleMs:1e3,enableDebugLogs:po()}),z_=({children:e})=>(dg([[Wk,Zb]]),e),qoe=e=>Nc.default.createElement(tk,{client:Zb,persistOptions:{persister:V_,dehydrateOptions:{shouldDehydrateQuery:Yb},buster:X_,maxAge:1/0}},Nc.default.createElement(Xk,null,Nc.default.createElement(z_,null,e.children))),X_="25.2.0";n();s();var Hi=q(Rm()),AI=q(P()),re=q(nI());var W_=async(e,A,j)=>{let t=A.fold(i=>Buffer.from(i.buffer).toString("base64")),r=je("importPrivateKeyAccount",[e,t,j]),o=await b.startSpan("importPrivateKeyAccount",()=>Ot(re.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importPrivateKeyAccount: Invalid response from background script")},Koe=async(e,A,j)=>{let t=e.getEntropy(),r=je("importSeedAccount",[Hi.default.encode(t),A,j]);t.fill(0);let o=await b.startSpan("importSeedAccount",()=>Ot(re.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importS*edAccount: Invalid response from background script")},Uoe=async(e,A,j)=>{let t=e.getEntropy(),r=je("importSocialSeedAccount",[Hi.default.encode(t),A,j]);t.fill(0);let o=await b.startSpan("importSeedlessAccount",()=>Ot(re.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importS*edlessAccount: Invalid response from background script")},Hoe=async e=>{let A=e.getEntropy(),j=je("isExistingSeed",Hi.default.encode(A));A.fill(0);let t=await b.startSpan("isExistingSeed",()=>Ot(re.default.runtime,j));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="boolean"||t.result===null)return t.result;throw new Error("isExistingS*ed: Invalid response from background script")},J_=async e=>{let A=je("addAccountForSeed",[e]),j=await b.startSpan("addAccountForSeed",async()=>Me(await re.default.runtime.sendMessage(Xe(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addAccountForS*ed: Invalid response from background script")},Y_=async e=>{let A=je("addAccountForSeedless",[e]),j=await b.startSpan("addAccountForSeedless",async()=>Me(await re.default.runtime.sendMessage(Xe(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addAccountForS*ed: Invalid response from background script")},Z_=async(e,A)=>{let j=je("addLedgerAccounts",[e,A]),t=await b.startSpan("connectLedgerAccounts",async()=>Me(await re.default.runtime.sendMessage(Xe(j))));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="string")return JSON.parse(t.result);throw new Error("connectLedgerAccounts: Invalid response from background script")},AD=async e=>{let A=je("importReadOnlyAccount",e),j=await b.startSpan("addReadonlyAccount",async()=>Me(await re.default.runtime.sendMessage(Xe(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addReadonlyAccount: Invalid response from background script")},Qoe=async(e,A,j)=>{let t=je("exportPrivateKey",[e,A,j]),r=await b.startSpan("exportPrivateKey",async()=>Me(await re.default.runtime.sendMessage(Xe(t))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return $e.from(Buffer.from(r.result,"hex"));throw new Error("exportPrivateKey: Invalid response from background script")},Voe=async(e,A)=>{let j=je("exportEntropy",[e,A]),t=await b.startSpan("exportEntropy",async()=>Me(await re.default.runtime.sendMessage(Xe(j))));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="string")return $e.from(Buffer.from(t.result,"hex"));throw new Error("exportEntropy: Invalid response from background script")},eD=async()=>{let e=je("deriveAddresses",void 0),A=await Ot(re.default.runtime,e);if("error"in A)throw new Error(A.error.message);return A.result},jD=async e=>{let A=je("removeAccount",e),j=await Ot(re.default.runtime,A);if("error"in j)throw new Error(j.error.message);return j.result},tD=async(e,A)=>{let j=je("reorderAccount",{identifier:e,toIndex:A}),t=await Ot(re.default.runtime,j);if("error"in t)throw new Error(t.error.message);return t.result},rD=async()=>{let e=je("getAllAccounts",void 0),A=Me(await re.default.runtime.sendMessage(Xe(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string"){let j=JSON.parse(A.result);return nk({accounts:j}).accounts}throw new Error("fetchAllAccounts: Invalid response from background script")},oD=async()=>{let e=je("getAllSeeds",void 0),A=Me(await re.default.runtime.sendMessage(Xe(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string")return JSON.parse(A.result);throw new Error("fetchAllSe*dMetas: Invalid response from background script")},nD=async()=>{let e=je("getAllSeedlessSeeds",void 0),A=Me(await re.default.runtime.sendMessage(Xe(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string")return JSON.parse(A.result);throw new Error("fetchAllSe*dlessMetas: Invalid response from background script")},sD=async e=>{let A=je("getAuthenticationPublicKey",{secretIdentifier:e}),j=Me(await re.default.runtime.sendMessage(Xe(A)));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("getAuthenticationPublicK*y: Invalid response from background script")},iD=async()=>{let e=je("checkVaultIntegrity",void 0),A=Me(await re.default.runtime.sendMessage(Xe(e)));if("error"in A)throw new Error(A.error.message);return A.result},aD=async(e,A)=>{let j=ik.parse(A);"chainType"in j&&j.chainType==="solana"&&j.signingType==="transaction"&&typeof j.message!="string"&&(j.message=Hi.default.encode(j.message));let t=je("sign",{accountIdentifier:e,params:j}),r=Me(await re.default.runtime.sendMessage(Xe(t)));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return Me(r.result);throw new Error("sign: Invalid response from background script")},eI={addAccountForSeed:J_,addReadonlyAccount:AD,importPrivateKeyAccount:W_,connectLedgerAccounts:Z_,fetchAllAccounts:rD,fetchAllSeedMetas:oD,fetchAllSeedlessMetas:nD,connectSolanaSeedVaultAccounts:()=>{throw new Error("Solana Seed Vault is not supported on browser extension.")},deriveAddresses:eD,removeAccount:async e=>{if(!await jD(e))throw new Error("Error while removing account")},reorderAccount:async(e,A)=>{if(!await tD(e,A))throw new Error("Error while reordering account")},sign:aD,getAuthenticationPublicKey:sD,addAccountForSeedless:Y_,checkVaultIntegrity:iD,getCashAddress:async()=>{throw new Error("getCashAddress: Not implemented on browser extension")},getAgentAddress:async()=>{throw new Error("getAgentAddress: Not implemented on browser extension")},getCashKMSAccount:async()=>{throw new Error("getCashKMSAccount: Not implemented on browser extension")},getKMSInstance:()=>{throw new Error("getKMSInstance: Not implemented on browser extension")}},zoe=()=>eI;function Xoe({children:e}){return AI.default.createElement(ok,{vault:eI},e)}export{rWA as a,oWA as b,$b as c,jJA as d,EI as e,yI as f,wB as g,ju as h,dI as i,ru as j,hI as k,ou as l,IB as m,FI as n,$B as o,nu as p,bI as q,ks as r,zj as s,cu as t,Co as u,vI as v,du as w,mu as x,ku as y,qI as z,g$ as A,Uu as B,t_ as C,G$ as D,qe as E,Bl as F,Ne as G,$r as H,ul as I,R$ as J,_$ as K,D$ as L,eg as M,J$ as N,K$ as O,cg as P,fl as Q,$NA as R,Ci as S,S8 as T,Am as U,zM as V,oS as W,bp as X,pS as Y,fj as Z,_p as _,mj as $,zA as aa,xe as ba,$ as ca,dv as da,dA as ea,MA as fa,Hr as ga,iA as ha,kn as ia,oG as ja,TA as ka,Oe as la,He as ma,nh as na,Qe as oa,sh as pa,bt as qa,K6 as ra,sG as sa,Td as ta,B1 as ua,fi as va,S1 as wa,w1 as xa,$1 as ya,NC as za,c7 as Aa,ze as Ba,$t as Ca,Zd as Da,Jr as Ea,q1 as Fa,x1 as Ga,gi as Ha,M1 as Ia,ip as Ja,L1 as Ka,mC as La,xn as Ma,yC as Na,hC as Oa,dF as Pa,bC as Qa,g7 as Ra,BF as Sa,IC as Ta,$C as Ua,E7 as Va,gF as Wa,vC as Xa,qC as Ya,U1 as Za,PC as _a,X1 as $a,I7 as ab,qt as bb,a7 as cb,OC as db,LC as eb,W1 as fb,KC as gb,wi as hb,VF as ib,XF as jb,WC as kb,oO as lb,YC as mb,nM as nb,Q7 as ob,iM as pb,J7 as qb,Y7 as rb,Z7 as sb,YM as tb,ZM as ub,im as vb,g8 as wb,v8 as xb,G8 as yb,M8 as zb,N8 as Ab,L8 as Bb,pm as Cb,cm as Db,um as Eb,ij as Fb,gc as Gb,Fb as Hb,mb as Ib,fb as Jb,yb as Kb,SR as Lb,HR as Mb,QR as Nb,VR as Ob,zR as Pb,XR as Qb,fm as Rb,Di as Sb,YR as Tb,e_ as Ub,j_ as Vb,E_ as Wb,y_ as Xb,o_ as Yb,n_ as Zb,s_ as _b,h_ as $b,F_ as ac,a_ as bc,S_ as cc,w_ as dc,b_ as ec,$_ as fc,v_ as gc,H_ as hc,Yb as ic,Zb as jc,qoe as kc,Koe as lc,Uoe as mc,Hoe as nc,Qoe as oc,Voe as pc,nD as qc,zoe as rc,Xoe as sc};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.development.js:
  (**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.development.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=chunk-ZYPI3ESJ.js.map
