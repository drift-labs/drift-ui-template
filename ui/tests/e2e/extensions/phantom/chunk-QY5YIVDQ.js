import{a as Qj}from"./chunk-MUAOONPW.js";import{a as Z,d as uB}from"./chunk-BY77CZR3.js";import{a as fa}from"./chunk-CEYX4EEL.js";import{P as BB,a as yk,k as hk,s as ru,t as lB,u as us,v as ou,w as De,x as dB}from"./chunk-Q2MU5Q7Q.js";import{a as ck,f as Jc}from"./chunk-CCUQPG33.js";import{B as cs,H as oB,I as cj,L as bA,Va as pB,_ as nB,_a as fB,b as Au,c as zk,ca as Ae,d as Xk,da as Ij,ea as uj,h as Wk,l as eB,la as $j,ma as aB,na as eu,o as ma,oa as ju,p as lt,q as ka,r as jB,s as be,t as tB,v as Ba,x as $o,y as rB}from"./chunk-IHXFHG2Y.js";import{a as mB,b as kB}from"./chunk-MYAJJRTU.js";import{Ba as _e,Da as HA,F as da,Q as hr,R as sB,S as Fr,_ as iB,c as ZA,ca as V,d as Jk,ga as tu,m as bj,oa as cB,q as Yk,qa as Sr,s as Zk,x as AB,xa as vo,ya as qo}from"./chunk-QCKHHJ5F.js";import{a as bk,f as Ik,g as $k}from"./chunk-HPK5Q66L.js";import{c as Yc,d as ut,g as Tk,j as Hk,k as la,m as ee}from"./chunk-ZWNJSFU4.js";import{a as We,b as Me,c as Ct}from"./chunk-MZPVJTUS.js";import{a as Qk}from"./chunk-YI2NXTPE.js";import{$ as xk,U as oa,e as me,n as vk,na,r as qk}from"./chunk-R5GARSZH.js";import{a as pI}from"./chunk-F24UB3BO.js";import{$a as pA,A as zc,Ab as Bk,B as ps,Bb as fk,Cb as gk,Ia as go,J as Xc,K as sk,Ob as ta,P as ik,Qa as uk,Rb as Er,Vb as UA,Wa as lk,Xb as Ek,Y as Lj,Ya as dk,Z as oe,aa as ea,c as ok,fa as ak,j as nk,k as wj,lb as Eo,sb as mk,tb as yo,u as Zi,vb as ja,y as Aa,yb as kk}from"./chunk-VOCOWPRG.js";import{Mb as Nk,N as yr,O as mA,Ob as Lk,Qb as Kk,S as Mk,Sb as aa,T as Rk,Tb as Uk,U as sa,Ub as bo,Vb as pa,W as _k,a as fo,bb as Dt,d as Pk,f as Uj,lb as ia,mb as wo,n as Gk,o as Ck,pc as ca,rc as Hj,s as Ok,tb as Zc,tc as ua,u as So,ub as Dk,uc as Io,v as BI}from"./chunk-F63TUCMM.js";import{a as pk,e as Vk,i as Nt}from"./chunk-CJHTJRVG.js";import{$b as lo,C as zi,Ca as Wm,E as Nm,Ea as Ot,F as Lm,Fa as oA,Fb as we,G as pe,Ga as fr,Gb as Ym,Gc as PA,Hc as is,Ic as Mt,J as Km,K as co,Kc as _A,L as Um,Lc as Te,N as Hm,Oc as Rt,Pc as b,Rd as Q,T as Qm,Tb as ss,U as kA,Xb as Zm,Zb as I,_ as N,_b as pt,_c as yA,_d as J,ac as Ak,ba as eA,bc as xe,bd as ek,cc as TA,cd as jk,da as uo,dc as M,dd as as,e as aI,ea as Vm,ec as gr,fa as zm,fd as Vc,ga as Wi,hc as mo,id as tk,jd as cA,ld as wA,mb as Jm,md as Ji,nd as rk,od as X,rd as Yi,sc as Re,wc as ko,xa as Xm,xc as Bo}from"./chunk-PJ6PRBE2.js";import{B as Dm,R as S,S as U,e as _m,i as os,u as po}from"./chunk-DHKCVHRA.js";import{$ as cI,$a as ra,B as xA,Ba as _t,Ca as gA,D as Fj,Da as Pe,E as Sj,F as Je,Ga as ho,Lb as Sk,Ob as dI,Pb as mI,Qa as lI,Rb as kI,S as T,Vb as Fo,X as hA,Y as DA,ac as wk,c as P,ca as uI,kb as ct,l as p,n as ns,p as Qc,q as Xi,sb as Fk,wa as Wc,ya as Kj}from"./chunk-UTOBJRXZ.js";import{c as hj,d as iI,f as q,h as n,i as d,m as Buffer,n as s}from"./chunk-SVG5OEFH.js";var Gh=hj(Ph=>{"use strict";n();s();var Sn=P();function UG(e,A){return e===A&&(e!==0||1/e===1/A)||e!==e&&A!==A}var HG=typeof Object.is=="function"?Object.is:UG,QG=Sn.useState,VG=Sn.useEffect,zG=Sn.useLayoutEffect,XG=Sn.useDebugValue;function WG(e,A){var j=A(),t=QG({inst:{value:j,getSnapshot:A}}),r=t[0].inst,o=t[1];return zG(function(){r.value=j,r.getSnapshot=A,zd(r)&&o({inst:r})},[e,j,A]),VG(function(){return zd(r)&&o({inst:r}),e(function(){zd(r)&&o({inst:r})})},[e]),XG(j),j}function zd(e){var A=e.getSnapshot;e=e.value;try{var j=A();return!HG(e,j)}catch{return!0}}function JG(e,A){return A()}var YG=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?JG:WG;Ph.useSyncExternalStore=Sn.useSyncExternalStore!==void 0?Sn.useSyncExternalStore:YG});var Oh=hj(Ch=>{"use strict";n();s();d.NODE_ENV!=="production"&&function(){function e(k,f){return k===f&&(k!==0||1/k===1/f)||k!==k&&f!==f}function A(k,f){l||r.startTransition===void 0||(l=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var g=f();if(!m){var E=f();o(g,E)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),m=!0)}E=i({inst:{value:g,getSnapshot:f}});var h=E[0].inst,y=E[1];return u(function(){h.value=g,h.getSnapshot=f,j(h)&&y({inst:h})},[k,g,f]),a(function(){return j(h)&&y({inst:h}),k(function(){j(h)&&y({inst:h})})},[k]),c(g),g}function j(k){var f=k.getSnapshot;k=k.value;try{var g=f();return!o(k,g)}catch{return!0}}function t(k,f){return f()}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var r=P(),o=typeof Object.is=="function"?Object.is:e,i=r.useState,a=r.useEffect,u=r.useLayoutEffect,c=r.useDebugValue,l=!1,m=!1,B=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?t:A;Ch.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:B,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Wd=hj((XcA,Xd)=>{"use strict";n();s();d.NODE_ENV==="production"?Xd.exports=Gh():Xd.exports=Oh()});var Rh=hj(Mh=>{"use strict";n();s();var tp=P(),ZG=Wd();function A1(e,A){return e===A&&(e!==0||1/e===1/A)||e!==e&&A!==A}var e1=typeof Object.is=="function"?Object.is:A1,j1=ZG.useSyncExternalStore,t1=tp.useRef,r1=tp.useEffect,o1=tp.useMemo,n1=tp.useDebugValue;Mh.useSyncExternalStoreWithSelector=function(e,A,j,t,r){var o=t1(null);if(o.current===null){var i={hasValue:!1,value:null};o.current=i}else i=o.current;o=o1(function(){function u(k){if(!c){if(c=!0,l=k,k=t(k),r!==void 0&&i.hasValue){var f=i.value;if(r(f,k))return m=f}return m=k}if(f=m,e1(l,k))return f;var g=t(k);return r!==void 0&&r(f,g)?(l=k,f):(l=k,m=g)}var c=!1,l,m,B=j===void 0?null:j;return[function(){return u(A())},B===null?void 0:function(){return u(B())}]},[A,j,t,r]);var a=j1(e,o[0],o[1]);return r1(function(){i.hasValue=!0,i.value=a},[a]),n1(a),a}});var Dh=hj(_h=>{"use strict";n();s();d.NODE_ENV!=="production"&&function(){function e(c,l){return c===l&&(c!==0||1/c===1/l)||c!==c&&l!==l}typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var A=P(),j=Wd(),t=typeof Object.is=="function"?Object.is:e,r=j.useSyncExternalStore,o=A.useRef,i=A.useEffect,a=A.useMemo,u=A.useDebugValue;_h.useSyncExternalStoreWithSelector=function(c,l,m,B,k){var f=o(null);if(f.current===null){var g={hasValue:!1,value:null};f.current=g}else g=f.current;f=a(function(){function h(G){if(!y){if(y=!0,F=G,G=B(G),k!==void 0&&g.hasValue){var v=g.value;if(k(v,G))return w=v}return w=G}if(v=w,t(F,G))return v;var _=B(G);return k!==void 0&&k(v,_)?(F=G,v):(F=G,w=_)}var y=!1,F,w,x=m===void 0?null:m;return[function(){return h(l())},x===null?void 0:function(){return h(x())}]},[l,m,B,k]);var E=r(c,f[0],f[1]);return i(function(){g.hasValue=!0,g.value=E},[E]),u(E),E},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var Nh=hj((ruA,Jd)=>{"use strict";n();s();d.NODE_ENV==="production"?Jd.exports=Rh():Jd.exports=Dh()});var In=hj(c7=>{"use strict";n();s();Object.defineProperty(c7,"__esModule",{value:!0});var v0=P();function W1(e){var A=v0.useRef();return v0.useEffect(function(){A.current=e}),A.current}c7.default=W1});var Rw=hj((n4A,Mw)=>{n();s();function j8(e,A,j,t){for(var r=-1,o=e==null?0:e.length;++r<o;){var i=e[r];A(t,i,j(i),e)}return t}Mw.exports=j8});var Dw=hj((a4A,_w)=>{n();s();var t8=mI();function r8(e,A,j,t){return t8(e,function(r,o,i){A(t,r,j(r),i)}),t}_w.exports=r8});var Lw=hj((u4A,Nw)=>{n();s();var o8=Rw(),n8=Dw(),s8=lI(),i8=uI();function a8(e,A){return function(j,t){var r=i8(j)?o8:n8,o=A?A():{};return r(j,e,s8(t,2),o)}}Nw.exports=a8});var om=hj((m4A,Kw)=>{n();s();var p8=cI(),c8=Lw(),u8=c8(function(e,A,j){p8(e,j,A)});Kw.exports=u8});n();s();var xo=q(P()),gB=(0,xo.createContext)(null);function fI({children:e,seedlessRepository:A}){return xo.default.createElement(gB.Provider,{value:{seedlessRepository:A}},e)}function gI(){let e=(0,xo.useContext)(gB);if(!e)throw new Error("useSeedlessContext must be used within a SeedlessProvider");return e}function zA(){return gI().seedlessRepository}n();s();n();s();var EI=p.record(p.string(),p.number()),yI=p.object({type:p.union([p.literal("Buffer"),p.literal("Object")]),data:p.array(p.number())}),hI=p.union([EI,yI]),EB=p.object({seeds:p.array(p.tuple([p.string(),hI]))}),yB=e=>FI(e)?new Uint8Array(Buffer.from(e.data)):new Uint8Array(Object.values(e)),FI=e=>!!e&&typeof e=="object"&&Xc("type",e)&&typeof e.type=="string"&&Xc("data",e)&&Array.isArray(e.data)&&e.data.every(A=>!Number.isNaN(parseInt(A))),hB=p.object({deviceId:p.string(),encryptionKey:p.string().length(44).base64()});n();s();n();s();var Vj="/seedless",SI="https://phantom-wallet.zendesk.com/hc/en-us/articles/32775281256851";var FB="/seedless";n();s();var To=class extends Error{reasonString;reasonCode;constructor(A){super("Failed to backup share from Juicebox"),this.reasonCode=A,this.reasonString=nu[A]}},Po=class extends Error{guessesRemaining;reasonString;reasonCode;constructor(A,j){super("Failed to recover share from Juicebox"),this.guessesRemaining=j,this.reasonCode=A,this.reasonString=Lt[A]}},ls=class extends Error{reasonString;reasonCode;constructor(A){super("Failed to delete share from Juicebox"),this.reasonCode=A,this.reasonString=SB[A]}},nu=(r=>(r[r.InvalidAuth=0]="InvalidAuth",r[r.UpgradeRequired=1]="UpgradeRequired",r[r.Assertion=2]="Assertion",r[r.Transient=3]="Transient",r))(nu||{}),Lt=(a=>(a[a.InvalidPin=0]="InvalidPin",a[a.NotRegistered=1]="NotRegistered",a[a.InvalidAuth=2]="InvalidAuth",a[a.UpgradeRequired=3]="UpgradeRequired",a[a.Assertion=4]="Assertion",a[a.Transient=5]="Transient",a[a.CooldownTimer=6]="CooldownTimer",a))(Lt||{}),SB=(o=>(o[o.InvalidAuth=0]="InvalidAuth",o[o.UpgradeRequired=1]="UpgradeRequired",o[o.RateLimitExceeded=2]="RateLimitExceeded",o[o.Assertion=3]="Assertion",o[o.Transient=4]="Transient",o))(SB||{}),wI=e=>ds(e)||wB(e)||bB(e),ds=e=>e instanceof Po,wB=e=>e instanceof To,bB=e=>e instanceof ls;globalThis.JuiceboxGetAuthToken=async e=>{let A=Buffer.from(e).toString("hex");return globalThis.JuiceboxTokens[A]};var su=class{encoder;provider;constructor(A){this.encoder=new TextEncoder,this.provider=A}async getJwts(A){let j=await N.api().bearer(A).post(`${FB}/v1/juiceboxtoken`);(eA(j)||j.status===304)&&this.provider.setJuiceboxTokens(j.data)}async sendJuiceboxShare(A,j,t,r){await this.getJwts(r);try{await this.provider.backupShare(A,j,this.encoder.encode(t),this.encoder.encode("phantom"),7),b.addBreadcrumb("se*dless","Successful backup share to Juicebox","debug")}catch(o){b.addBreadcrumb("se*dless","Failed to backup share to Juicebox","error");let i=new To(o);throw b.captureError(i,"se*dless"),i}return!0}async getJuiceboxShare(A,j,t){await this.getJwts(t);try{let r=await this.provider.recoverShare(A,this.encoder.encode(j),this.encoder.encode("phantom"));return b.addBreadcrumb("se*dless","Successfully recovered share from Juicebox","debug"),r}catch(r){let o=r.reason,i=r.guessesRemaining!==void 0?r.guessesRemaining:r.guesses_remaining;b.addBreadcrumb("se*dless","Failed to recover share from Juicebox","error");let a=new Po(o,i);throw b.captureError(a,"se*dless"),a}}async deleteShare(A,j){await this.getJwts(j);try{await this.provider.deleteShare(A),b.addBreadcrumb("se*dless","Successfully deleted share from Juicebox","debug")}catch(t){b.addBreadcrumb("se*dless","Failed to delete share from Juicebox","error");let r=new ls(t);throw b.captureError(r,"se*dless"),r}}};n();s();n();s();var iu="@phantom/seedless",wr={hasSeedlessBundle:["seedless",`${iu}:has_seedless_bundle`],needsBundleUpdate:["seedless",`${iu}:needs_bundle_update`],timeLeftCooldown:["seedless",`${iu}:time_left_cooldown`]};function au({enabled:e=!0}={}){let A=wr.hasSeedlessBundle,j=zA(),t=ea();return X({enabled:t&&e,queryKey:A,queryFn:async()=>await j.hasSeedlessBundle()})}n();s();n();s();var Go=async e=>{await e.invalidateQueries({queryKey:wr.hasSeedlessBundle})},Kt=async e=>{await e.invalidateQueries({queryKey:wr.needsBundleUpdate})};function bI(){let e=zA(),A=cA(),j=J();return wA({mutationFn:async({entropy:t,pin:r})=>await e.backup(t,r),onSuccess:async()=>{j.capture("seedlessBackupSuccess"),await Go(A),await Kt(A)},onError:()=>{j.capture("seedlessBackupError")}})}n();s();function pu(){let e=zA(),A=cA(),j=J();return wA({mutationFn:async r=>await e.recover(r),onSuccess:async()=>{j.capture("seedlessRecoverSuccess"),await Kt(A)},onError:()=>{j.capture("seedlessRecoverError")}})}n();s();function IB(){let e=zA(),A=J();return wA({mutationFn:async t=>{await e.verifyPin(t)},onSuccess:()=>{b.addBreadcrumb("se*dless","Successfully verified PIN","info"),A.capture("seedlessVerifyPinSuccess")},onError:()=>{b.addBreadcrumb("se*dless","Failed to verify PIN","error"),A.capture("seedlessVerifyPinError")}})}n();s();function II(){let e=zA(),A=cA();return wA({mutationFn:async()=>await e.deleteBundle(),onSuccess:async()=>{await Go(A),await Kt(A)}})}n();s();function $B(){let e=zA(),A=J();return wA({mutationFn:async t=>await e.resetBundleFromDevice(t.pin,t.seedlessEntropies),onSuccess:()=>{b.addBreadcrumb("se*dless","Successfully reset bundle from device","info"),A.capture("seedlessResetPinSuccess")},onError:()=>{b.addBreadcrumb("se*dless","Failed to reset bundle from device","error"),A.capture("seedlessResetPinError")}})}n();s();var $I=1e3,vI=500;function cu(){let e=wr.timeLeftCooldown,A=zA(),j=ea();return X({enabled:j,queryKey:e,queryFn:async()=>await A.timeLeftCooldown(),refetchInterval:$I,refetchOnMount:"always",staleTime:vI})}n();s();var Ea=q(P()),vB=1e3,uu=()=>{let[e,A]=(0,Ea.useState)(0);return(0,Ea.useEffect)(()=>{if(!e)return;let j=setInterval(async()=>{A(e-vB)},vB);return()=>clearInterval(j)},[e]),{cooldownTimer:e,setCooldownTimer:A}};n();s();var qB=q(P());var qI=()=>{let e=cA(),A=zA(),j=Lj(),t=ja(),r=go();return(0,qB.useCallback)(async()=>{await j.deleteAllAuthFactors(),await t.patchUserProfile({privacyState:"invisible",addresses:r.reduce((o,i)=>(o[i]="",o),{})}),await A.deleteAllBundles(),await A.deleteJuiceboxShare(),await Go(e),await Kt(e)},[A,j,t,e,r])};n();s();var lu=q(P());var xI="seedless-pin-verification-timer-in-ms",TI=p.string().transform(e=>Number(e)).pipe(p.number()).nullish().catch(null),du=()=>{let e=zA(),A=(0,lu.useMemo)(()=>Te.getMultivariateAssignment(xI,{dependent_flag:"enable-seedless-pin-verification-interstitial",variation_served:"true"}),[]),j=(0,lu.useMemo)(()=>TI.parse(A)??2592e6,[A]),t=async()=>{let{expired:r,timestampInMs:o}=await e.getPinVerificationTimer({pinVerificationExpiryInMs:j});return{expired:r,timestampInMs:o}};return X({queryKey:["seedlessPinVerificationLockTimerInMs"],queryFn:t,refetchInterval:j??2592e6,staleTime:j??2592e6})};n();s();var ks=()=>{let e=cA(),A=zA();return wA({mutationFn:async()=>{b.addBreadcrumb("se*dless","Resetting PIN verification timer","info"),await A.setPinVerificationTimer(Date.now())},onSuccess:async()=>{b.addBreadcrumb("se*dless","Successfully reset PIN verification timer","info"),await e.invalidateQueries({queryKey:["seedlessPinVerificationLockTimerInMs"]})},onError:()=>{b.addBreadcrumb("se*dless","Failed to reset PIN verification timer","error")}})};n();s();var Bu=q(P());n();s();var Ut=e=>{let A=mu(e),j=JSON.stringify(A);return uo(Yi(j))};function Bs(e){return/^\d+$/.test(e)}var zj=e=>e.length!==4?!1:Bs(e),mu=e=>{if(Array.isArray(e))return e.map(A=>typeof A=="object"?mu(A):A).sort();if(typeof e=="object"&&e!==null){let A={},j=Object.keys(e).sort();for(let t of j)A[t]=mu(e[t]);return A}else return e},ku=e=>{let A=Math.max(0,Math.floor(e/1e3)),j=Math.floor(A/60).toString(),t=A%60>9?`${A%60}`:`0${A%60}`;return{minutes:j,seconds:t}};n();s();var fu=q(P());n();s();var Ht=q(P());n();s();var Co=class extends Error{result;constructor(A){super(`Unable to recover seedless bundle: ${A.type}`),this.result=A}},ya=class extends Error{result;constructor(A){super(`Unable to backup seedless bundle: ${A.type}`),this.result=A}},Oo=e=>e instanceof Co,PI=e=>Oo(e)&&e.result.type==="unauthorized",gu=e=>Oo(e)&&e.result.type==="error-juicebox-recover"&&e.result.reason===0,Eu=e=>Oo(e)&&e.result.type==="cooldown",yu=e=>Oo(e)&&e.result.type==="upgrade-required",hu=e=>Oo(e)&&e.result.type==="error-juicebox-recover"&&e.result.reason===1;var GI=({hasEnrolledAuthentication:e,onOnboardingDone:A,onOnboardingProtect:j,onImportAndSyncAccounts:t,onForgot:r,onNotRegisteredError:o})=>{let{t:i}=hA(),a=J(),{refetch:u}=cu(),{mutateAsync:c}=ks(),{mutateAsync:l}=pu(),m=PA("enable-cleanup-on-not-registered-error"),[B,k]=(0,Ht.useState)(!1),[f,g]=(0,Ht.useState)({isInvalidPin:!1,triesLeft:void 0,pin:""}),[E,h]=(0,Ht.useState)(!1),{cooldownTimer:y,setCooldownTimer:F}=uu(),{minutes:w,seconds:x}=ku(y),[G,v]=(0,Ht.useState)(null);return(0,Ht.useEffect)(()=>{!f.triesLeft||f.triesLeft>0||r()},[f.triesLeft,r]),(0,Ht.useEffect)(()=>{(async()=>{let{data:D=0}=await u();return D})().then(D=>F(D))},[]),{isLoading:E,isError:B,handleInput:O=>{g(D=>({...D,isInvalidPin:O!==""&&!Bs(O),pin:O}))},onSubmit:async()=>{if(!E){if(!zj(f.pin)){g(O=>({...O,isInvalidPin:!0,triesLeft:void 0,pin:""}));return}try{h(!0),k(!1),g(D=>({...D,isInvalidPin:!1,triesLeft:void 0}));let{entropy:O}=await l(f.pin);await t(O),await c(),a.capture("seedlessEnterPinContinue"),!e&&A?A():j?.()}catch(O){if(gu(O)||Eu(O)){let D;if("guessesRemaining"in O.result&&(D=O.result.guessesRemaining),D===0){g(L=>({...L,isInvalidPin:!0,triesLeft:D,pin:""})),r();return}let H=!1;"reason"in O.result&&O.result.reason===0&&(H=!0);let{data:z=0}=await u();F(z),a.capture("seedlessPinError",{data:{triesLeft:D,cooldownTimer:z}}),g(L=>({...L,isInvalidPin:H,triesLeft:D,pin:""}))}else if(yu(O))k(!0),v({title:i("seedlessRecoverErrorUpgradeRequiredTitle"),description:i("seedlessRecoverErrorUpgradeRequiredDescription")});else if(hu(O)&&o&&m){b.captureError(O,"se*dless");try{await o(f.pin)}catch(D){b.captureError(D,"se*dless"),k(!0),v({title:i("seedlessEnterPinUnknownErrorPrimaryText"),description:i("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:i("seedlessTryAgain")})}}else b.captureError(O,"se*dless"),k(!0),v({title:i("seedlessEnterPinUnknownErrorPrimaryText"),description:i("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:i("seedlessTryAgain")})}finally{h(!1)}}},onForgot:r,pinAttemptsLeft:f.triesLeft,isPinError:f.isInvalidPin,hasCooldownTimer:y>0,disabled:y>0||f.isInvalidPin||!f.pin||f.pin.length<4,pin:f.pin,continueButtonText:i("seedlessContinueText"),forgotButtonText:i("seedlessVerifyPinForgotButtonText"),attemptsLeftText:i("seedlessEnterPinNumTriesLeft",{numTries:f.triesLeft}),cooldownTimerText:i("seedlessEnterPinCooldown",{minutesLeft:w,secondsLeft:x}),invalidPinText:i("seedlessEnterPinInvalidPinError"),title:i("seedlessEnterPinPrimaryText"),loadingTitle:i("seedlessLoadingWalletPrimaryText"),loadingDescription:i("seedlessLoadingWalletSecondaryText"),errorTitle:G?G.title:i("seedlessLoadingWalletErrorPrimaryText"),errorDescription:G?G.description:i("seedlessErrorSecondaryText"),tryAgainButtonText:G?G.buttonText:i("seedlessTryAgain")}};n();s();n();s();var rL=new Error("timeout while waiting for mutex to become available"),oL=new Error("mutex already locked"),CI=new Error("request for lock canceled"),OI=function(e,A,j,t){function r(o){return o instanceof j?o:new j(function(i){i(o)})}return new(j||(j=Promise))(function(o,i){function a(l){try{c(t.next(l))}catch(m){i(m)}}function u(l){try{c(t.throw(l))}catch(m){i(m)}}function c(l){l.done?o(l.value):r(l.value).then(a,u)}c((t=t.apply(e,A||[])).next())})},Fu=class{constructor(A,j=CI){this._value=A,this._cancelError=j,this._weightedQueues=[],this._weightedWaiters=[]}acquire(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);return new Promise((j,t)=>{this._weightedQueues[A-1]||(this._weightedQueues[A-1]=[]),this._weightedQueues[A-1].push({resolve:j,reject:t}),this._dispatch()})}runExclusive(A,j=1){return OI(this,void 0,void 0,function*(){let[t,r]=yield this.acquire(j);try{return yield A(t)}finally{r()}})}waitForUnlock(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);return new Promise(j=>{this._weightedWaiters[A-1]||(this._weightedWaiters[A-1]=[]),this._weightedWaiters[A-1].push(j),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(A){this._value=A,this._dispatch()}release(A=1){if(A<=0)throw new Error(`invalid weight ${A}: must be positive`);this._value+=A,this._dispatch()}cancel(){this._weightedQueues.forEach(A=>A.forEach(j=>j.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var A;for(let j=this._value;j>0;j--){let t=(A=this._weightedQueues[j-1])===null||A===void 0?void 0:A.shift();if(!t)continue;let r=this._value,o=j;this._value-=j,j=this._value+1,t.resolve([r,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(A){let j=!1;return()=>{j||(j=!0,this.release(A))}}_drainUnlockWaiters(){for(let A=this._value;A>0;A--)this._weightedWaiters[A-1]&&(this._weightedWaiters[A-1].forEach(j=>j()),this._weightedWaiters[A-1]=[])}},MI=function(e,A,j,t){function r(o){return o instanceof j?o:new j(function(i){i(o)})}return new(j||(j=Promise))(function(o,i){function a(l){try{c(t.next(l))}catch(m){i(m)}}function u(l){try{c(t.throw(l))}catch(m){i(m)}}function c(l){l.done?o(l.value):r(l.value).then(a,u)}c((t=t.apply(e,A||[])).next())})},fs=class{constructor(A){this._semaphore=new Fu(1,A)}acquire(){return MI(this,void 0,void 0,function*(){let[,A]=yield this._semaphore.acquire();return A})}runExclusive(A){return this._semaphore.runExclusive(()=>A())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};n();s();n();s();var ke=[];for(let e=0;e<256;++e)ke.push((e+256).toString(16).slice(1));function xB(e,A=0){return(ke[e[A+0]]+ke[e[A+1]]+ke[e[A+2]]+ke[e[A+3]]+"-"+ke[e[A+4]]+ke[e[A+5]]+"-"+ke[e[A+6]]+ke[e[A+7]]+"-"+ke[e[A+8]]+ke[e[A+9]]+"-"+ke[e[A+10]]+ke[e[A+11]]+ke[e[A+12]]+ke[e[A+13]]+ke[e[A+14]]+ke[e[A+15]]).toLowerCase()}n();s();var Su,RI=new Uint8Array(16);function wu(){if(!Su){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Su=self.crypto.getRandomValues.bind(self.crypto)}return Su(RI)}n();s();n();s();var _I=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),bu={randomUUID:_I};function DI(e,A,j){if(bu.randomUUID&&!A&&!e)return bu.randomUUID();e=e||{};let t=e.random??e.rng?.()??wu();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){if(j=j||0,j<0||j+16>A.length)throw new RangeError(`UUID byte range ${j}:${j+15} is out of buffer bounds`);for(let r=0;r<16;++r)A[j+r]=t[r];return A}return xB(t)}var ha=DI;n();s();async function TB(e,A,j){let t=await e.decryptionKeySharePhantom.foldAsync(async c=>Buffer.from(new Uint8Array(c)).toString("base64")),r=Buffer.from(e.encryptedAccounts,"hex").toString("base64"),o=Buffer.from(e.encryptionKey,"hex").toString("base64"),i={ciphertext:r,encryptionKey:o,share:t,externalId:A,mode:"JUICEBOX"},a=await N.api().bearer(j).headers({"Content-Type":"application/json"}).post(`${Vj}/v1/bundles`,i),u=eA(a);return u||b.addBreadcrumb("se*dless","Failed to backup bundle to backend","error",{status:a.status,statusText:a.statusText}),u}async function Mo(e,A){let j=await N.api().bearer(A).get(`${Vj}/v1/bundles/${e}?mode=JUICEBOX`);if(j.status===404)throw new Error("bundle not found");if(!eA(j)){b.addBreadcrumb("se*dless","Failed to recover bundle from backend","error",{status:j.status,statusText:j.statusText});let t=new Error("Got invalid response from seedless backend: "+j.statusText);throw b.captureError(t,"se*dless"),t}if(!("share"in j.data)){b.addBreadcrumb("se*dless","No share found in bundle","error");let t=new Error("Did not receive share from seedless backend");throw b.captureError(t,"se*dless"),t}try{let t=we.from(new Uint8Array(Buffer.from(j.data.share,"base64"))),r=Buffer.from(j.data.ciphertext,"base64").toString("hex"),o=Buffer.from(j.data.encryptionKey,"base64").toString("hex");return{id:j.data.externalId,encryptedAccounts:r,encryptionKey:o,decryptionKeyShare1:t}}catch{throw new Error("Unable to parse bundle. Incorrect format.")}}async function PB(e){let A=await N.api().bearer(e).get(`${Vj}/v1/bundles?mode=JUICEBOX`);if(!eA(A))throw b.addBreadcrumb("se*dless","Failed to recover all seedless bundles","error",{status:A.status,statusText:A.statusText}),new Error("Failed to recover all seedless bundles.");try{if(!Array.isArray(A.data))throw new Error("Seedless bundles are not an array.");return A.data.map(j=>{if(typeof j!="object"||j===null||!("externalId"in j))throw new Error("No externalId found in bundle.");let t=j.externalId;if(typeof t!="string")throw new Error("External ID is not a string.");return{id:t}})}catch{throw new Error("Unable to parse seedless bundles. Incorrect format.")}}async function Fa(e,A){let j=await N.api().bearer(A).get(`${Vj}/v1/bundles/${e}?mode=JUICEBOX&populate=none`);if(b.addBreadcrumb("se*dless","Checking if user has a se*dless bundle","info"),eA(j))return b.addBreadcrumb("se*dless","A se*dless bundle has been found for this user","info",{status:j.status,statusText:j.statusText}),!0;if(j.status===404)return b.addBreadcrumb("se*dless","No se*dless bundle found for user","info",{status:j.status,statusText:j.statusText}),!1;let t=new Error("Failed to check for se*dless bundle.");throw b.captureError(t,"se*dless"),t}async function Sa(e,A){let j=await N.api().bearer(A).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${Vj}/v1/bundles/${e}`,{mode:"JUICEBOX"});if(b.addBreadcrumb("se*dless",`Deleting se*dless bundle: ${e}`,"info"),eA(j))return b.addBreadcrumb("se*dless","A se*dless bundle has been deleted for this user","info",{status:j.status,statusText:j.statusText}),!0;if(j.status===404)return b.addBreadcrumb("se*dless","No se*dless bundle found for user","info",{status:j.status,statusText:j.statusText}),!1;let t=new Error("Failed to delete se*dless bundle.");throw b.captureError(t,"se*dless"),t}async function GB(e){let A=await N.api().bearer(e).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${Vj}/v1/bundles`,{mode:"JUICEBOX"});if(b.addBreadcrumb("se*dless","Deleting se*dless bundle","info"),eA(A))return b.addBreadcrumb("se*dless","All se*dless bundles, if they exist, have been deleted for this user","info",{status:A.status,statusText:A.statusText,data:A.data}),!0;let j=new Error("Failed to delete all se*dless bundles.");throw b.captureError(j,"se*dless"),j}async function Iu(e,A){let j=await N.api().bearer(e).get(`${Vj}/v1/device-encryption-keys/${A}`);if(j.status===404)return b.addBreadcrumb("se*dless","No device encryption key found for user","info"),null;if(!eA(j))throw new Error("Unable to get device encryption key.");try{let{encryptionKey:t}=hB.parse(j.data);return we.from(new Uint8Array(Buffer.from(t,"base64")))}catch{throw new Error("Unable to parse device encryption key from response.")}}async function CB(e,A,j){let t=await N.api().bearer(e).post(`${Vj}/v1/device-encryption-keys`,{deviceId:A,encryptionKey:j.fold(r=>Buffer.from(r).toString("base64"))});if(!eA(t))throw new Error("Unable to set device encryption key.")}async function OB(e,A){let j=await N.api().bearer(e).delete(`${Vj}/v1/device-encryption-keys/${A}`);if(!eA(j))throw new Error("Unable to delete device encryption key.")}n();s();n();s();n();s();n();s();n();s();function Ro(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function $u(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function vu(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function je(e,...A){if(!vu(e))throw new Error("Uint8Array expected");if(A.length>0&&!A.includes(e.length))throw new Error(`Uint8Array expected of length ${A}, not of length=${e.length}`)}function qu(e,A=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(A&&e.finished)throw new Error("Hash#digest() has already been called")}function MB(e,A){je(e);let j=A.outputLen;if(e.length<j)throw new Error(`digestInto() expects output buffer of length at least ${j}`)}var dt=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),RB=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),NI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!NI)throw new Error("Non little-endian hardware is not supported");function xu(e){if(typeof e!="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function wa(e){if(typeof e=="string")e=xu(e);else if(vu(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function _B(...e){let A=0;for(let t=0;t<e.length;t++){let r=e[t];je(r),A+=r.length}let j=new Uint8Array(A);for(let t=0,r=0;t<e.length;t++){let o=e[t];j.set(o,r),r+=o.length}return j}function DB(e,A){if(A==null||typeof A!="object")throw new Error("options must be defined");return Object.assign(e,A)}function NB(e,A){if(e.length!==A.length)return!1;let j=0;for(let t=0;t<e.length;t++)j|=e[t]^A[t];return j===0}var Tu=(e,A)=>(Object.assign(A,e),A);function Pu(e,A,j,t){if(typeof e.setBigUint64=="function")return e.setBigUint64(A,j,t);let r=BigInt(32),o=BigInt(4294967295),i=Number(j>>r&o),a=Number(j&o),u=t?4:0,c=t?0:4;e.setUint32(A+u,i,t),e.setUint32(A+c,a,t)}n();s();var Be=(e,A)=>e[A++]&255|(e[A++]&255)<<8,Gu=class{constructor(A){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,A=wa(A),je(A,32);let j=Be(A,0),t=Be(A,2),r=Be(A,4),o=Be(A,6),i=Be(A,8),a=Be(A,10),u=Be(A,12),c=Be(A,14);this.r[0]=j&8191,this.r[1]=(j>>>13|t<<3)&8191,this.r[2]=(t>>>10|r<<6)&7939,this.r[3]=(r>>>7|o<<9)&8191,this.r[4]=(o>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|u<<5)&8065,this.r[8]=(u>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Be(A,16+2*l)}process(A,j,t=!1){let r=t?0:2048,{h:o,r:i}=this,a=i[0],u=i[1],c=i[2],l=i[3],m=i[4],B=i[5],k=i[6],f=i[7],g=i[8],E=i[9],h=Be(A,j+0),y=Be(A,j+2),F=Be(A,j+4),w=Be(A,j+6),x=Be(A,j+8),G=Be(A,j+10),v=Be(A,j+12),_=Be(A,j+14),C=o[0]+(h&8191),O=o[1]+((h>>>13|y<<3)&8191),D=o[2]+((y>>>10|F<<6)&8191),H=o[3]+((F>>>7|w<<9)&8191),z=o[4]+((w>>>4|x<<12)&8191),L=o[5]+(x>>>1&8191),R=o[6]+((x>>>14|G<<2)&8191),W=o[7]+((G>>>11|v<<5)&8191),K=o[8]+((v>>>8|_<<8)&8191),rA=o[9]+(_>>>5|r),Y=0,fA=Y+C*a+O*(5*E)+D*(5*g)+H*(5*f)+z*(5*k);Y=fA>>>13,fA&=8191,fA+=L*(5*B)+R*(5*m)+W*(5*l)+K*(5*c)+rA*(5*u),Y+=fA>>>13,fA&=8191;let AA=Y+C*u+O*a+D*(5*E)+H*(5*g)+z*(5*f);Y=AA>>>13,AA&=8191,AA+=L*(5*k)+R*(5*B)+W*(5*m)+K*(5*l)+rA*(5*c),Y+=AA>>>13,AA&=8191;let nA=Y+C*c+O*u+D*a+H*(5*E)+z*(5*g);Y=nA>>>13,nA&=8191,nA+=L*(5*f)+R*(5*k)+W*(5*B)+K*(5*m)+rA*(5*l),Y+=nA>>>13,nA&=8191;let jA=Y+C*l+O*c+D*u+H*a+z*(5*E);Y=jA>>>13,jA&=8191,jA+=L*(5*g)+R*(5*f)+W*(5*k)+K*(5*B)+rA*(5*m),Y+=jA>>>13,jA&=8191;let sA=Y+C*m+O*l+D*c+H*u+z*a;Y=sA>>>13,sA&=8191,sA+=L*(5*E)+R*(5*g)+W*(5*f)+K*(5*k)+rA*(5*B),Y+=sA>>>13,sA&=8191;let CA=Y+C*B+O*m+D*l+H*c+z*u;Y=CA>>>13,CA&=8191,CA+=L*a+R*(5*E)+W*(5*g)+K*(5*f)+rA*(5*k),Y+=CA>>>13,CA&=8191;let lA=Y+C*k+O*B+D*m+H*l+z*c;Y=lA>>>13,lA&=8191,lA+=L*u+R*a+W*(5*E)+K*(5*g)+rA*(5*f),Y+=lA>>>13,lA&=8191;let re=Y+C*f+O*k+D*B+H*m+z*l;Y=re>>>13,re&=8191,re+=L*c+R*u+W*a+K*(5*E)+rA*(5*g),Y+=re>>>13,re&=8191;let YA=Y+C*g+O*f+D*k+H*B+z*m;Y=YA>>>13,YA&=8191,YA+=L*l+R*c+W*u+K*a+rA*(5*E),Y+=YA>>>13,YA&=8191;let qe=Y+C*E+O*g+D*f+H*k+z*B;Y=qe>>>13,qe&=8191,qe+=L*m+R*l+W*c+K*u+rA*a,Y+=qe>>>13,qe&=8191,Y=(Y<<2)+Y|0,Y=Y+fA|0,fA=Y&8191,Y=Y>>>13,AA+=Y,o[0]=fA,o[1]=AA,o[2]=nA,o[3]=jA,o[4]=sA,o[5]=CA,o[6]=lA,o[7]=re,o[8]=YA,o[9]=qe}finalize(){let{h:A,pad:j}=this,t=new Uint16Array(10),r=A[1]>>>13;A[1]&=8191;for(let a=2;a<10;a++)A[a]+=r,r=A[a]>>>13,A[a]&=8191;A[0]+=r*5,r=A[0]>>>13,A[0]&=8191,A[1]+=r,r=A[1]>>>13,A[1]&=8191,A[2]+=r,t[0]=A[0]+5,r=t[0]>>>13,t[0]&=8191;for(let a=1;a<10;a++)t[a]=A[a]+r,r=t[a]>>>13,t[a]&=8191;t[9]-=8192;let o=(r^1)-1;for(let a=0;a<10;a++)t[a]&=o;o=~o;for(let a=0;a<10;a++)A[a]=A[a]&o|t[a];A[0]=(A[0]|A[1]<<13)&65535,A[1]=(A[1]>>>3|A[2]<<10)&65535,A[2]=(A[2]>>>6|A[3]<<7)&65535,A[3]=(A[3]>>>9|A[4]<<4)&65535,A[4]=(A[4]>>>12|A[5]<<1|A[6]<<14)&65535,A[5]=(A[6]>>>2|A[7]<<11)&65535,A[6]=(A[7]>>>5|A[8]<<8)&65535,A[7]=(A[8]>>>8|A[9]<<5)&65535;let i=A[0]+j[0];A[0]=i&65535;for(let a=1;a<8;a++)i=(A[a]+j[a]|0)+(i>>>16)|0,A[a]=i&65535}update(A){qu(this);let{buffer:j,blockLen:t}=this;A=wa(A);let r=A.length;for(let o=0;o<r;){let i=Math.min(t-this.pos,r-o);if(i===t){for(;t<=r-o;o+=t)this.process(A,o);continue}j.set(A.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===t&&(this.process(j,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(A){qu(this),MB(A,this),this.finished=!0;let{buffer:j,h:t}=this,{pos:r}=this;if(r){for(j[r++]=1;r<16;r++)j[r]=0;this.process(j,0,!0)}this.finalize();let o=0;for(let i=0;i<8;i++)A[o++]=t[i]>>>0,A[o++]=t[i]>>>8;return A}digest(){let{buffer:A,outputLen:j}=this;this.digestInto(A);let t=A.slice(0,j);return this.destroy(),t}};function LI(e){let A=(t,r)=>e(r).update(wa(t)).digest(),j=e(new Uint8Array(32));return A.outputLen=j.outputLen,A.blockLen=j.blockLen,A.create=t=>e(t),A}var LB=LI(e=>new Gu(e));n();s();var UB=e=>Uint8Array.from(e.split("").map(A=>A.charCodeAt(0))),KI=UB("expand 16-byte k"),UI=UB("expand 32-byte k"),HI=dt(KI),HB=dt(UI),WL=HB.slice();function tA(e,A){return e<<A|e>>>32-A}function Cu(e){return e.byteOffset%4===0}var ba=64,QI=16,QB=2**32-1,KB=new Uint32Array;function VI(e,A,j,t,r,o,i,a){let u=r.length,c=new Uint8Array(ba),l=dt(c),m=Cu(r)&&Cu(o),B=m?dt(r):KB,k=m?dt(o):KB;for(let f=0;f<u;i++){if(e(A,j,t,l,i,a),i>=QB)throw new Error("arx: counter overflow");let g=Math.min(ba,u-f);if(m&&g===ba){let E=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let h=0,y;h<QI;h++)y=E+h,k[y]=B[y]^l[h];f+=ba;continue}for(let E=0,h;E<g;E++)h=f+E,o[h]=r[h]^c[E];f+=g}}function Ou(e,A){let{allowShortKeys:j,extendNonceFn:t,counterLength:r,counterRight:o,rounds:i}=DB({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},A);if(typeof e!="function")throw new Error("core must be a function");return Ro(r),Ro(i),$u(o),$u(j),(a,u,c,l,m=0)=>{je(a),je(u),je(c);let B=c.length;if(l||(l=new Uint8Array(B)),je(l),Ro(m),m<0||m>=QB)throw new Error("arx: counter overflow");if(l.length<B)throw new Error(`arx: output (${l.length}) is shorter than data (${B})`);let k=[],f=a.length,g,E;if(f===32)g=a.slice(),k.push(g),E=HB;else if(f===16&&j)g=new Uint8Array(32),g.set(a),g.set(a,16),E=HI,k.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);Cu(u)||(u=u.slice(),k.push(u));let h=dt(g);if(t){if(u.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(E,h,dt(u.subarray(0,16)),h),u=u.subarray(16)}let y=16-r;if(y!==u.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){let w=new Uint8Array(12);w.set(u,o?0:12-u.length),u=w,k.push(u)}let F=dt(u);for(VI(e,E,h,F,c,l,m,i);k.length>0;)k.pop().fill(0);return l}}function XB(e,A,j,t,r,o=20){let i=e[0],a=e[1],u=e[2],c=e[3],l=A[0],m=A[1],B=A[2],k=A[3],f=A[4],g=A[5],E=A[6],h=A[7],y=r,F=j[0],w=j[1],x=j[2],G=i,v=a,_=u,C=c,O=l,D=m,H=B,z=k,L=f,R=g,W=E,K=h,rA=y,Y=F,fA=w,AA=x;for(let jA=0;jA<o;jA+=2)G=G+O|0,rA=tA(rA^G,16),L=L+rA|0,O=tA(O^L,12),G=G+O|0,rA=tA(rA^G,8),L=L+rA|0,O=tA(O^L,7),v=v+D|0,Y=tA(Y^v,16),R=R+Y|0,D=tA(D^R,12),v=v+D|0,Y=tA(Y^v,8),R=R+Y|0,D=tA(D^R,7),_=_+H|0,fA=tA(fA^_,16),W=W+fA|0,H=tA(H^W,12),_=_+H|0,fA=tA(fA^_,8),W=W+fA|0,H=tA(H^W,7),C=C+z|0,AA=tA(AA^C,16),K=K+AA|0,z=tA(z^K,12),C=C+z|0,AA=tA(AA^C,8),K=K+AA|0,z=tA(z^K,7),G=G+D|0,AA=tA(AA^G,16),W=W+AA|0,D=tA(D^W,12),G=G+D|0,AA=tA(AA^G,8),W=W+AA|0,D=tA(D^W,7),v=v+H|0,rA=tA(rA^v,16),K=K+rA|0,H=tA(H^K,12),v=v+H|0,rA=tA(rA^v,8),K=K+rA|0,H=tA(H^K,7),_=_+z|0,Y=tA(Y^_,16),L=L+Y|0,z=tA(z^L,12),_=_+z|0,Y=tA(Y^_,8),L=L+Y|0,z=tA(z^L,7),C=C+O|0,fA=tA(fA^C,16),R=R+fA|0,O=tA(O^R,12),C=C+O|0,fA=tA(fA^C,8),R=R+fA|0,O=tA(O^R,7);let nA=0;t[nA++]=i+G|0,t[nA++]=a+v|0,t[nA++]=u+_|0,t[nA++]=c+C|0,t[nA++]=l+O|0,t[nA++]=m+D|0,t[nA++]=B+H|0,t[nA++]=k+z|0,t[nA++]=f+L|0,t[nA++]=g+R|0,t[nA++]=E+W|0,t[nA++]=h+K|0,t[nA++]=y+rA|0,t[nA++]=F+Y|0,t[nA++]=w+fA|0,t[nA++]=x+AA|0}function zI(e,A,j,t){let r=e[0],o=e[1],i=e[2],a=e[3],u=A[0],c=A[1],l=A[2],m=A[3],B=A[4],k=A[5],f=A[6],g=A[7],E=j[0],h=j[1],y=j[2],F=j[3];for(let x=0;x<20;x+=2)r=r+u|0,E=tA(E^r,16),B=B+E|0,u=tA(u^B,12),r=r+u|0,E=tA(E^r,8),B=B+E|0,u=tA(u^B,7),o=o+c|0,h=tA(h^o,16),k=k+h|0,c=tA(c^k,12),o=o+c|0,h=tA(h^o,8),k=k+h|0,c=tA(c^k,7),i=i+l|0,y=tA(y^i,16),f=f+y|0,l=tA(l^f,12),i=i+l|0,y=tA(y^i,8),f=f+y|0,l=tA(l^f,7),a=a+m|0,F=tA(F^a,16),g=g+F|0,m=tA(m^g,12),a=a+m|0,F=tA(F^a,8),g=g+F|0,m=tA(m^g,7),r=r+c|0,F=tA(F^r,16),f=f+F|0,c=tA(c^f,12),r=r+c|0,F=tA(F^r,8),f=f+F|0,c=tA(c^f,7),o=o+l|0,E=tA(E^o,16),g=g+E|0,l=tA(l^g,12),o=o+l|0,E=tA(E^o,8),g=g+E|0,l=tA(l^g,7),i=i+m|0,h=tA(h^i,16),B=B+h|0,m=tA(m^B,12),i=i+m|0,h=tA(h^i,8),B=B+h|0,m=tA(m^B,7),a=a+u|0,y=tA(y^a,16),k=k+y|0,u=tA(u^k,12),a=a+u|0,y=tA(y^a,8),k=k+y|0,u=tA(u^k,7);let w=0;t[w++]=r,t[w++]=o,t[w++]=i,t[w++]=a,t[w++]=E,t[w++]=h,t[w++]=y,t[w++]=F}var XI=Ou(XB,{counterRight:!1,counterLength:4,allowShortKeys:!1}),WI=Ou(XB,{counterRight:!1,counterLength:8,extendNonceFn:zI,allowShortKeys:!1});var JI=new Uint8Array(16),VB=(e,A)=>{e.update(A);let j=A.length%16;j&&e.update(JI.subarray(j))},YI=new Uint8Array(32);function zB(e,A,j,t,r){let o=e(A,j,YI),i=LB.create(o);r&&VB(i,r),VB(i,t);let a=new Uint8Array(16),u=RB(a);Pu(u,0,BigInt(r?r.length:0),!0),Pu(u,8,BigInt(t.length),!0),i.update(a);let c=i.digest();return o.fill(0),c}var WB=e=>(A,j,t)=>(je(A,32),je(j),{encrypt:(o,i)=>{let a=o.length,u=a+16;i?je(i,u):i=new Uint8Array(u),e(A,j,o,i,1);let c=zB(e,A,j,i.subarray(0,-16),t);return i.set(c,a),i},decrypt:(o,i)=>{let a=o.length,u=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");i?je(i,u):i=new Uint8Array(u);let c=o.subarray(0,-16),l=o.subarray(-16),m=zB(e,A,j,c,t);if(!NB(l,m))throw new Error("invalid tag");return e(A,j,c,i,1),i}}),rK=Tu({blockSize:64,nonceLength:12,tagLength:16},WB(XI)),Mu=Tu({blockSize:64,nonceLength:24,tagLength:16},WB(WI));n();s();n();s();var br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function JB(e=32){if(br&&typeof br.getRandomValues=="function")return br.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Ru(){if(br&&typeof br.subtle=="object"&&br.subtle!=null)return br.subtle;throw new Error("crypto.subtle must be defined")}function _u(e){return Ro(e.nonceLength),(A,...j)=>({encrypt:(t,...r)=>{let{nonceLength:o}=e,i=JB(o),a=e(A,i,...j).encrypt(t,...r),u=_B(i,a);return a.fill(0),u},decrypt:(t,...r)=>{let{nonceLength:o}=e,i=t.subarray(0,o),a=t.subarray(o);return e(A,i,...j).decrypt(a,...r)}})}var YB={async encrypt(e,A,j,t){let r=Ru(),o=await r.importKey("raw",e,A,!0,["encrypt"]),i=await r.encrypt(j,o,t);return new Uint8Array(i)},async decrypt(e,A,j,t){let r=Ru(),o=await r.importKey("raw",e,A,!0,["decrypt"]),i=await r.decrypt(j,o,t);return new Uint8Array(i)}},Xj={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function ZI(e,A,j){if(e===Xj.CBC)return{name:Xj.CBC,iv:A};if(e===Xj.CTR)return{name:Xj.CTR,counter:A,length:64};if(e===Xj.GCM)return j?{name:Xj.GCM,iv:A,additionalData:j}:{name:Xj.GCM,iv:A};throw new Error("unknown aes block mode")}function Du(e){return(A,j,t)=>{je(A),je(j);let r={name:e,length:A.length*8},o=ZI(e,j,t);return{encrypt(i){return je(i),YB.encrypt(A,r,o,i)},decrypt(i){return je(i),YB.decrypt(A,r,o,i)}}}}var dK=Du(Xj.CBC),mK=Du(Xj.CTR),kK=Du(Xj.GCM);n();s();n();s();function Nu(e){return self.crypto.getRandomValues(new Uint8Array(e))}var $a=new Uint8Array([0,255,200,8,145,16,208,54,90,62,216,67,153,119,254,24,35,32,7,112,161,108,12,127,98,139,64,70,199,75,224,14,235,22,232,173,207,205,57,83,106,39,53,147,212,78,72,195,43,121,84,40,9,120,15,33,144,135,20,42,169,156,214,116,180,124,222,237,177,134,118,164,152,226,150,143,2,50,28,193,51,238,239,129,253,48,92,19,157,41,23,196,17,68,140,128,243,115,66,30,29,181,240,18,209,91,65,162,215,44,233,213,89,203,80,168,220,252,242,86,114,166,101,47,159,155,61,186,125,194,69,130,167,87,182,163,122,117,79,174,63,55,109,71,97,190,171,211,95,176,88,175,202,94,250,133,228,77,138,5,251,96,183,123,184,38,74,103,198,26,248,105,37,179,219,189,102,221,241,210,223,3,141,52,217,146,13,99,85,170,73,236,188,149,60,132,11,245,230,231,229,172,126,110,185,249,218,142,154,201,36,225,10,21,107,58,160,81,244,234,178,151,158,93,34,136,148,206,25,1,113,76,165,227,197,49,187,204,31,45,59,82,111,246,46,137,247,192,104,27,100,4,6,191,131,56]),ZB=new Uint8Array([1,229,76,181,251,159,252,18,3,52,212,196,22,186,31,54,5,92,103,87,58,213,33,90,15,228,169,249,78,100,99,238,17,55,224,16,210,172,165,41,51,89,59,48,109,239,244,123,85,235,77,80,183,42,7,141,255,38,215,240,194,126,9,140,26,106,98,11,93,130,27,143,46,190,166,29,231,157,45,138,114,217,241,39,50,188,119,133,150,112,8,105,86,223,153,148,161,144,24,187,250,122,176,167,248,171,40,214,21,142,203,242,19,230,120,97,63,137,70,13,53,49,136,163,65,128,202,23,95,83,131,254,195,155,69,57,225,245,158,25,94,182,207,75,56,4,185,43,226,193,74,221,72,12,208,125,61,88,222,124,216,20,107,135,71,232,121,132,115,60,189,146,201,35,139,151,149,68,220,173,64,101,134,162,164,204,127,236,192,175,145,253,247,79,129,47,91,234,168,28,2,209,152,113,237,37,227,36,6,104,179,147,44,111,62,108,10,184,206,174,116,177,66,180,30,211,73,233,156,200,198,199,34,110,219,32,191,67,81,82,102,178,118,96,218,197,243,246,170,205,154,160,117,84,14,1]);function Ia(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");return e^A}function A$(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(A===0)throw new Error("cannot divide by zero");let j=$a[e],t=$a[A],r=(j-t+255)%255,o=ZB[r];return e===0?0:o}function Lu(e,A){if(!Number.isInteger(e)||e<0||e>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");let j=$a[e],t=$a[A],r=(j+t)%255,o=ZB[r];return e===0||A===0?0:o}function e$(e,A,j){if(e.length!==A.length)throw new Error("sample length mistmatch");let t=e.length,r=0,o=0;for(let i=0;i<t;i++){r=1;for(let a=0;a<t;++a){if(i===a)continue;let u=Ia(j,e[a]),c=Ia(e[i],e[a]),l=A$(u,c);r=Lu(r,l)}o=Ia(o,Lu(A[i],r))}return o}function j$(e,A,j){if(A===0)throw new Error("cannot evaluate secret polynomial at zero");let t=e[j];for(let r=j-1;r>=0;r--){let o=e[r];t=Ia(Lu(t,A),o)}return t}function Af(){return Nu(1)[0]}function t$(){for(;;){let e=Af();if(e>0)return e}}function r$(e,A){let j=new Uint8Array(A+1);j[0]=e;for(let t=1;t<=A;t++){let r=t===A;j[t]=r?t$():Af()}return j}function o$(){let e=new Uint8Array(255);for(let j=0;j<255;j++)e[j]=j+1;let A=Nu(255);for(let j=0;j<255;j++){let t=A[j]%255,r=e[j];e[j]=e[t],e[t]=r}return e}var Ye={instanceOf(e,A,j){if(e.constructor!==A)throw new TypeError(j)},inRange(e,A,j,t){if(!(A<j&&e>=A&&e<j))throw new RangeError(t)},greaterThanOrEqualTo(e,A,j){if(e<A)throw new Error(j)},equalTo(e,A,j){if(e!==A)throw new Error(j)}};async function ef(e,A,j){Ye.instanceOf(e,Uint8Array,"secret must be a Uint8Array"),Ye.greaterThanOrEqualTo(e.byteLength,1,"secret cannot be empty"),Ye.instanceOf(A,Number,"shares must be a number"),Ye.inRange(A,2,256,"shares must be at least 2 and at most 255"),Ye.instanceOf(j,Number,"threshold must be a number"),Ye.inRange(j,2,256,"threshold must be at least 2 and at most 255"),Ye.greaterThanOrEqualTo(A,j,"shares cannot be less than threshold");let t=[],r=e.byteLength,o=o$();for(let a=0;a<A;a++){let u=new Uint8Array(r+1);u[r]=o[a],t.push(u)}let i=j-1;for(let a=0;a<r;a++){let u=e[a],c=r$(u,i);for(let l=0;l<A;++l){let m=o[l],B=j$(c,m,i);t[l][a]=B}}return t}async function jf(e){Ye.instanceOf(e,Array,"shares must be an Array"),Ye.inRange(e.length,2,256,"shares must have at least 2 and at most 255 elements");let A=e[0];Ye.instanceOf(A,Uint8Array,"each share must be a Uint8Array");for(let c of e)Ye.instanceOf(c,Uint8Array,"each share must be a Uint8Array"),Ye.greaterThanOrEqualTo(c.byteLength,2,"each share must be at least 2 bytes"),Ye.equalTo(c.byteLength,A.byteLength,"all shares must have the same byte length");let j=e.length,t=A.byteLength,r=t-1,o=new Uint8Array(r),i=new Uint8Array(j),a=new Uint8Array(j),u=new Set;for(let c=0;c<j;c++){let m=e[c][t-1];if(u.has(m))throw new Error("shares must contain unique values but a duplicate was found");u.add(m),i[c]=m}for(let c=0;c<r;c++){for(let l=0;l<j;++l)a[l]=e[l][c];o[c]=e$(i,a,0)}return o}var tf=async(e,A)=>{if(e.length!==32)throw new Error("encryption key must be 32 bytes");s$(e);let j={seeds:[]};for(let c of A){let l="unused",m=c.fold(B=>new Uint8Array(B));j.seeds.push([l,m])}let t=_u(Mu)(e),r=xu(JSON.stringify(j)),o=t.encrypt(r),[i,a]=await ef(e,2,2);return{encryptedAccounts:uo(o),decryptionKeySharePhantom:we.from(i),decryptionKeyShareExternal:we.from(a),encryptionKey:"unused"}},Qt=class extends Error{reason;constructor(A){super(`Unable to decrypt seedless bundle: ${A}`),this.reason=A}},va=async e=>{let A;try{A=await n$(e.decryptionKeySharePhantom,e.decryptionKeyShareExternal)}catch{throw new Qt("incompatible-shares")}let j;try{j=_u(Mu)(A).decrypt(Vm(e.encryptedAccounts))}catch{throw new Qt("incorrect-decryption-key")}let t;try{t=JSON.parse(Buffer.from(j).toString())}catch{throw new Qt("invalid-json")}let r=EB.safeParse(t);if(!r.success)throw new Qt("invalid-format");return r.data.seeds.map(a=>{let u=a[1],c=yB(u);return we.from(c)})},n$=async(e,A)=>{let j=e.fold(o=>new Uint8Array(o)),t=A.fold(o=>new Uint8Array(o));return await jf([j,t])},s$=e=>{if(e.every(A=>A===0))throw new Error("encryption key must not be all zeros")};n();s();var rf={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var of={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var nf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var sf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev/"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var af={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f76005fd-80e5-483e-9d84-c09ef7c60ba3",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var pf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"153ebe7b-400c-4d27-be76-139248bb3acd",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var cf={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f577175c-3f1e-4f4a-91d1-cb30aaa0d5d4",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var uf=[rf,of],m$=uf.reduce((e,A)=>(e[Ut(A)]=A,e),{}),lf=[nf,sf,af,pf,cf],k$=lf.reduce((e,A)=>(e[Ut(A)]=A,e),{});function qa(){return Qc()?m$:k$}function Ir(){let e=Qc()?uf:lf;return e[e.length-1]}var qj={success:{type:"success",didBackup:!0},unauthorized:{type:"unauthorized",didBackup:!1},bundleAlreadyExists:{type:"bundle-already-exists",didBackup:!1},errorBackendCheck:{type:"error-backend-check",didBackup:!1},invalidPin:{type:"invalid-pin-format",didBackup:!1},errorEncryptionFailed:{type:"error-encryption-failed",didBackup:!1},errorBackendUpload:{type:"error-backend-upload",didBackup:!1},errorJuiceboxUpload:{type:"error-juicebox-upload",didBackup:!1},recoveredFromJuiceboxError:{type:"recovered-juicebox-error",didBackup:!1},errorBackendDelete:{type:"error-backend-delete",didBackup:!1}},_o=async(e,{pin:A,entropy:j})=>{if(!zj(A))return qj.invalidPin;let t;try{if(t=await e.authRepository.getUser(),!t)return qj.unauthorized}catch{return qj.unauthorized}let r=Ir(),o=Ut(r);try{if(await Fa(o,t.accessToken))return qj.bundleAlreadyExists}catch{return qj.errorBackendCheck}let i;try{let l=Wi(32);i=await tf(l,[j])}catch{return qj.errorEncryptionFailed}try{if(!await TB(i,o,t.accessToken))return qj.errorBackendUpload}catch{return qj.errorBackendUpload}let a=i.decryptionKeyShareExternal.fold(l=>new Uint8Array(l)),u=await e.juiceboxClient(),c=!0;try{c=await u.sendJuiceboxShare(Ir(),a,A,t.accessToken)}catch{c=!1}if(!c)try{return await Sa(o,t.accessToken),qj.recoveredFromJuiceboxError}catch{return qj.errorBackendDelete}return qj.success};n();s();var mf="seedlessJuiceboxPinCooldownTimer",Ku=".phantom.seedless.juiceboxPinCooldownTimer",gs=async e=>{let A=await e.get(mf),j=await e.get(Ku),t=j?.timeRemaining||A,r=j?.guessesRemaining;return!t||t<0?{timeRemaining:0,guessesRemaining:r}:{timeRemaining:t-Date.now(),guessesRemaining:r}},kf=async(e,A)=>{let j=f$(e);if(!j)return;let t=Date.now()+j*1e3;A.set(Ku,{version:2,timeRemaining:t,guessesRemaining:e})},Bf=async e=>{await e.remove(mf),await e.remove(Ku)},f$=e=>g$[e],g$={[7]:0,[6]:0,[5]:30,[4]:60,[3]:120,[2]:300,[1]:300};n();s();n();s();var ff=async(e,A,j)=>{let t=[];try{t=await PB(e)}catch{return{status:"error-fetch-all-seedless-bundles"}}let r=t.filter(o=>o.id!==j).map(o=>o.id);if(r.length===0)return{status:"no-other-bundles-found"};for(let o of r)try{let i=await Mo(o,e),a=await va({encryptedAccounts:i.encryptedAccounts,encryptionKey:i.encryptionKey,decryptionKeySharePhantom:i.decryptionKeyShare1,decryptionKeyShareExternal:we.from(A)});if(a.length===0)continue;return{status:"found-valid-bundle",entropies:a}}catch{continue}return{status:"error-no-decryptable-accounts"}};var E$=e=>{let A="unknown";return e instanceof Error&&(e.message.includes("bundle not found")?A="bundle-not-found":e.message.includes("Got invalid response from seedless backend")?A="non-ok-response":e.message.includes("Did not receive share from seedless backend")?A="no-share-in-bundle":e.message.includes("Unable to parse bundle. Incorrect format.")&&(A="incorrect-format")),{type:"error-backend-recover",reason:A}},Ef=async(e,A,{pin:j,ignoreCooldown:t=!1})=>{let{authRepository:r,juiceboxClient:o,storage:i}=e,{timeRemaining:a,guessesRemaining:u}=await gs(i);if(a>0&&!t)return{type:"cooldown",timeRemaining:a,guessesRemaining:u};if(!zj(j))return{type:"invalid-pin-format"};let c=await r.getUser();if(!c)return{type:"unauthorized"};let{accessToken:l}=c,m;try{m=await Mo("latest",l)}catch(y){return E$(y)}let B=qa()[m.id];if(!B)return{type:"upgrade-required"};let k=await o(),f;try{f=new Uint8Array(await k.getJuiceboxShare(B,j,l)),await Bf(i)}catch(y){let F=y?.reasonCode,w=y?.guessesRemaining;if(ds(y))if(!t&&w&&w<=5){await kf(w,i);let{timeRemaining:G}=await gs(i);return{type:"cooldown",timeRemaining:G,guessesRemaining:w}}else return{type:"error-juicebox-recover",reason:F,guessesRemaining:w};else return{type:"error-juicebox-recover",reason:F||"unknown"}}if(f.every(y=>y===0))return{type:"error-juicebox-share-zero"};let E;try{E=await va({encryptedAccounts:m.encryptedAccounts,encryptionKey:m.encryptionKey,decryptionKeySharePhantom:m.decryptionKeyShare1,decryptionKeyShareExternal:we.from(f)})}catch(y){let F;y instanceof Qt?F=y.reason:F="unknown";let w=await ff(l,f,m.id);if(w.status==="found-valid-bundle")b.addBreadcrumb("se*dless","Recovered from older bundle","info"),E=w.entropies;else return w.status==="no-other-bundles-found"?{type:"error-decrypt-accounts",reason:F}:{type:"error-decrypt-accounts",reason:w.status}}if(E.length===0)return{type:"error-no-entropies"};let h=await _o(e,{entropy:E[0],pin:j});return A.emitRotationResult(h),{type:"success",entropy:E[0]}};n();s();var xa=class extends ik{emitRotationResult(A){this.emitEvent("seedlessRotationResult",{type:A.type,didRotate:A.didBackup})}emitRecoverResult(A){let j=A.type,t;"reason"in A&&(typeof A.reason=="string"?t=A.reason:t=Lt[A.reason]),this.emitEvent("seedlessRecoverResult",{type:j,reason:t})}emitBackupResult(A){this.emitEvent("seedlessBackupResult",{type:A.type,didBackup:A.didBackup})}};var F$=e=>{let A=new xa,j=new fs,t={backup:(i,a)=>j.runExclusive(async()=>await w$(e,i,a,A)),recover:i=>j.runExclusive(async()=>await yf(e,i,!1,A)),verifyPin:i=>j.runExclusive(async()=>await b$(e,i,!0,A)),resetBundleFromDevice:(i,a)=>j.runExclusive(async()=>await S$(e,i,a))},r=new fs;return{...t,hasSeedlessBundle:i=>$$(e,i),deleteBundle:()=>Hu(e,"latest"),deleteAllBundles:()=>Hu(e,"all"),deleteJuiceboxShare:()=>v$(e),needsBundleUpdate:()=>I$(e),timeLeftCooldown:()=>q$(e),getPinVerificationTimer:({pinVerificationExpiryInMs:i})=>x$({...e,pinVerificationExpiryInMs:i}),setPinVerificationTimer:i=>T$(e,i),...{getDeviceEncryptionKey:()=>r.runExclusive(async()=>await P$(e))},generateDeviceEncryptionKey:Ff,setDeviceEncryptionKey:i=>wf(e,i),deleteDeviceEncryptionKey:()=>G$(e),getOrCreateSeedlessDeviceID:()=>Sf(e),subscribe:(i,a)=>A.subscribe(i,a)}},Uu={},S$=async(e,A,j)=>{if(!zj(A))throw new Error("Invalid PIN provided. Only numbers are accepted.");await Hu(e);let t=await _o(e,{pin:A,entropy:j[0]});if(t.type!=="success"&&t.type!=="bundle-already-exists")throw new Error(`Failed to backup bundle: ${t.type}`);return{entropy:j[0]}},w$=async(e,A,j,t)=>{let r=await _o(e,{pin:j,entropy:A});if(t.emitBackupResult(r),r.type!=="success")throw new ya(r)},yf=async(e,A,j=!1,t)=>{let r=await Ef(e,t,{pin:A,ignoreCooldown:j});if(t.emitRecoverResult(r),r.type!=="success")throw new Co(r);return{entropy:r.entropy}},b$=async(e,A,j=!0,t)=>{await yf(e,A,j,t)},I$=async({authRepository:e})=>{let A=await e.getUser();if(!A)throw new Error("User is not logged in, cannot check for seedless bundle update");let{accessToken:j}=A,t,r=Ut(Ir());try{t=await Mo("latest",j)}catch(i){if(i instanceof Error&&i.message==="bundle not found")return!1;throw i}return!!qa()[t.id]&&t.id!==r},$$=async(e,A="latest")=>{let j=await e.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot check for se*dless bundle");let{accessToken:t}=j;return await Fa(A,t)},Hu=async(e,A="latest")=>{let j=await e.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot delete se*dless bundle");let{accessToken:t}=j;if(A==="all")return await GB(t);let r=Ut(Ir());return await Sa(r,t)},v$=async e=>{let A=await e.authRepository.getUser();if(!A)throw new Error("User is not logged in, cannot delete juicebox share");let{accessToken:j}=A;await(await e.juiceboxClient()).deleteShare(Ir(),j)},q$=async({storage:e})=>{let{timeRemaining:A}=await gs(e);return A},x$=async({storage:e,pinVerificationExpiryInMs:A})=>{let j=Date.now(),t=await e.get("seedlessPinVerificationLockTimerInMs")??Date.now();return{expired:j>=t+(A??2592e6),timestampInMs:t}},T$=async({storage:e},A)=>{await e.set("seedlessPinVerificationLockTimerInMs",A)},Qu=async e=>(await e.get("seedlessDeviceID"))?.deviceID??null,hf=async(e,A)=>{await e.set("seedlessDeviceID",{version:1,deviceID:A})},Ff=()=>{let e=Wi(32);try{return Promise.resolve(we.from(e))}finally{e.fill(0)}},Sf=async({storage:e})=>{let A=await Qu(e);return A||(A=ha(),await hf(e,A)),A},P$=async e=>{let{authRepository:A}=e,j=await A.getUser();if(!j)throw new Error("User not logged in, cannot retrieve device encryption key.");let t=await Sf(e),r=Uu[t];if(r)return r;let o=await Iu(j.accessToken,t);return o||(o=await Ff(),await wf(e,o)),Uu[t]=o,o},wf=async({authRepository:e,storage:A},j)=>{let t=await e.getUser();if(!t)throw new Error("User not logged in, cannot set device encryption key.");let r=await Qu(A);return r||(r=ha(),await hf(A,r)),await CB(t.accessToken,r,j),Uu[r]=j,j},G$=async({authRepository:e,storage:A})=>{let j=await e.getUser();if(!j)throw new Error("User not logged in, cannot delete device encryption key.");let t=await Qu(A);if(!t)return null;let r=await Iu(j.accessToken,t);return r?(await OB(j.accessToken,t),r):null};n();s();n();s();var Vu={};iI(Vu,{default:()=>zu});var zu="./juicebox-sdk_bg-LUYFYBUJ.wasm";bk(Vu);var bf=!1,O$=async()=>{if(bf)return;let e=await import("./juicebox-sdk_bg-M4WLVVX3.js"),A=await WebAssembly.instantiateStreaming(fetch(zu),{"./juicebox-sdk_bg.js":e});e.__wbg_set_wasm(A.instance.exports),bf=!0};function If(e){globalThis.JuiceboxTokens=e}If({});var Xu=class{setJuiceboxTokens(A){If(A)}async backupShare(A,j,t,r,o){await(await this.client(A)).register(t,j,r,o)}async recoverShare(A,j,t){return await(await this.client(A)).recover(j,t)}async deleteShare(A){await(await this.client(A)).delete()}async client(A){return await O$(),new Ik(new $k(A),[])}};n();s();n();s();n();s();var M$=p.object({balance:p.boolean(),history:p.boolean()}),V5=p.record(p.string(),M$),Es=class extends Error{constructor(A){super(A),this.name="SetTermsAcknowledgementError"}};var $f=async(e,A)=>{try{return await e.set("termsHaveBeenAcknowledgedLastSeenVersion",A)}catch{throw new Es("Error Setting Terms Acknowledgement")}},vf=async e=>await e.get("termsHaveBeenAcknowledgedLastSeenVersion")??0,qf=async e=>{try{return await e.remove("termsHaveBeenAcknowledgedLastSeenVersion")}catch{throw new Es("Error Clearing Terms Acknowledgement")}};async function R$(e){return(await e.get("onboardedAt"))?.onboardedAt}async function xf(e,A=Date.now()){A&&!await R$(e)?await e.set("onboardedAt",{onboardedAt:A}):A||await e.remove("onboardedAt")}n();s();var Tf=p.enum(["Native","Fungible","SemiFungible","NonFungible","Unknown"]),mt=p.object({id:p.string(),displayName:p.string().optional(),logoURI:p.union([p.string(),p.null()]).optional(),tokenType:Tf,decimals:p.number().optional(),symbol:p.string().optional(),isSpam:p.boolean().optional()}),Pf=p.object({id:pt,displayName:p.string(),logoURI:p.union([p.string(),p.null()]).optional()}),Pa=p.object({token:mt,amount:p.string(),to:pt,from:pt}),Ju=p.literal("UNCLASSIFIED_APP_INTERACTION"),Yu=p.literal("TOKEN_SEND"),Zu=p.literal("TOKEN_BURN"),Al=p.literal("TOKEN_SWAP"),el=p.literal("TOKEN_UNWRAP"),jl=p.literal("WITHDRAW_STAKE"),tl=p.literal("DEACTIVATE_STAKE"),rl=p.literal("STAKE"),ol=p.literal("COLLECTIBLE_LIST"),nl=p.literal("COLLECTIBLE_BUY_ITEM"),sl=p.literal("COLLECTIBLE_CANCEL_BID"),il=p.literal("COLLECTIBLE_BID_ITEM"),al=p.literal("COLLECTIBLE_UNLIST"),pl=p.literal("COLLECTIBLE_SELL_ITEM"),cl=p.literal("CANCEL_TX"),ul=p.literal("TOKEN_APPROVAL"),ll=p.literal("CANCEL_ORDER"),dl=p.literal("COLLECTION_APPROVAL"),ml=p.literal("BRIDGE_INIT"),_$=p.union([Ju,Yu,Zu,Al,el,jl,tl,rl,ol,nl,sl,il,al,pl,cl,ul,ll,dl,ml]),Gf=p.object({transactionType:Ju,balanceChanges:p.array(Pa),dapp:p.union([Uj,p.null()]).optional()}),Cf=p.object({transactionType:Yu,balanceChanges:p.array(Pa).nonempty(),dapp:p.union([Uj,p.null()]).optional()}),Of=p.object({transactionType:Zu,dapp:p.union([Uj,p.null()]).optional(),token:mt,amount:p.string()}),Mf=p.object({transactionType:Al,dapp:p.union([Uj,p.null()]).optional(),receiveToken:mt,sendToken:mt,receiveAmount:p.string(),sendAmount:p.string()}),Rf=p.object({transactionType:el,token:mt,amount:p.string()}),_f=p.object({transactionType:jl,stakeAccount:pt,amount:p.string()}),Df=p.object({transactionType:tl,stakeAccount:pt,amount:p.string()}),Nf=p.object({transactionType:rl,stakeAccount:pt,amount:p.string(),validatorName:p.string().optional(),validatorWebsite:p.string().optional(),keybaseUsername:p.string().optional()}),Lf=p.object({transactionType:cl}),Do=p.object({dapp:p.union([Uj,p.null()]),itemAmount:p.string().optional(),item:mt,forAmount:p.string(),forAsset:mt,listingUrl:p.string().optional()}),Kf=Do.merge(p.object({transactionType:ol})),Uf=Do.merge(p.object({transactionType:nl})),Hf=Do.merge(p.object({transactionType:sl})),Qf=Do.merge(p.object({transactionType:il})),Vf=Do.merge(p.object({transactionType:al})),zf=Do.merge(p.object({transactionType:pl})),Xf=p.object({transactionType:ul,dapp:p.union([Uj,p.null()]).optional(),token:mt,value:p.string().optional(),isApproved:p.boolean()}),Wf=p.object({transactionType:ll,dapp:p.union([Uj,p.null()]).optional(),orderId:p.string()}),Jf=p.object({transactionType:dl,collection:Pf,dapp:p.union([Uj,p.null()]).optional(),isApproved:p.boolean()}),Yf=p.object({transactionType:ml,dapp:p.union([Uj,p.null()]).optional(),balanceChanges:p.array(Pa).nonempty(),explorerUrl:p.string().optional()}),Zf=p.enum(["success","failed"]),Ag=p.object({networkFee:p.string().optional(),networkFeePayer:p.string().optional(),status:Zf,errorMessage:p.union([p.string(),p.null()]),blockNumber:p.string(),chainId:Ot,transactionId:p.string()}),Ga=p.object({timestamp:p.number(),owner:pt,id:pt,interactionData:p.union([Gf,Cf,Of,Mf,Rf,_f,Df,Nf,Kf,Uf,Hf,Qf,Vf,zf,Lf,Xf,Wf,Jf,Yf]),chainMeta:Ag}),Ie=e=>e.split("/")[1]?.split(":").slice(1).join(":");n();s();var Ne=(e,A)=>{let j=new S(e).div(yr(A)).toNumber();return fa(j)};n();s();var $r=e=>{switch(e){case"SemiFungible":case"NonFungible":return!0;default:return!1}},kl=(e,A)=>{let j=Ie(e.to),t=Ie(e.from),r=A.some(i=>i.address.toLowerCase()===j.toLowerCase()),o=A.some(i=>i.address.toLowerCase()===t.toLowerCase());return r&&!o};n();s();var Bl=q(P());n();s();var eg=({interactionData:e,isError:A,selectedAccountAddresses:j,getKnownAddressLabel:t,start:r,networkID:o})=>{let a=e.balanceChanges[0],{token:{symbol:u,displayName:c,tokenType:l,decimals:m},amount:B}=a,k=kl(a,j),f=$r(l),E=D$({isCollectible:f,sign:k?"+":"-",amount:B,decimals:m,tokenSymbol:u,tokenType:l,isError:A});if(k){let F=Ie(a.from),w=zc(F,void 0,t(F,o));return{topLeft:{text:`${T.t("transactionsReceived")} ${f?c||T.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${E}`,color:"spotPositive"},bottomLeft:{text:T.t("transactionsFromParagraphInterpolated",{from:w,defaultValue:`From ${w}`})},start:r}}let h=Ie(a.to),y=zc(h,void 0,t(h,o));return{topLeft:{text:A?T.t("transactionsSendFailed"):`${T.t("transactionsSent")} ${f?c||T.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${E}`,color:"textBase"},bottomLeft:{text:T.t("transactionsToParagraphInterpolated",{to:y,defaultValue:`To ${y}`})},start:r}};function D$({isCollectible:e,sign:A,amount:j,decimals:t,tokenSymbol:r,tokenType:o,isError:i}){return i||t===void 0||o==="NonFungible"?"":e?`${A}${Ne(j,t)}`:`${A}${Ne(j,t)}${r?` ${Qj(r,6)}`:""}`}var N$=["So11111111111111111111111111111111111111112","501"],L$=(e,A,j,t,r)=>{let{interactionData:o,chainMeta:i}=e,{transactionType:a}=o,u=i.status==="failed",c=i.chainId,l=I.getTokenSymbol(c),m=I.getTokenDecimals(c),B=A("historyUnknownDappName"),k=Bl.default.createElement(j,{activityItem:e,size:"small",isDetailViewOrSvg:!1});switch(a){case"TOKEN_SEND":return eg({interactionData:o,isError:u,selectedAccountAddresses:r,getKnownAddressLabel:t,start:k,networkID:c});case"TOKEN_BURN":{let{amount:f,token:g}=o,E="";return g.displayName?f==="1"?E=g.displayName:E=`${g.displayName} (${f})`:E=A("richTransactionDetailUnknownNFT"),{topLeft:{text:u?`${A("transactionsFailedBurn")}`:`${A("transactionsBurned")}`},bottomLeft:{text:E},start:k}}case"TOKEN_UNWRAP":{let{amount:f,token:g}=o;return{topLeft:{text:u?`${A("transactionsUnwrappedFailed")}`:`${A("transactionsUnwrapped")}`},topRight:{text:u?"":`${Ne(f,g.decimals??0)} ${g.symbol}`,color:"textBase"},start:k}}case"TOKEN_SWAP":{let{receiveAmount:f,receiveToken:g,sendAmount:E,sendToken:h,dapp:y}=o,F=y?y.displayName:A("historyUnknownDappName"),w=ps(Ie(h.id)||""),x=ps(Ie(g.id)||""),G="";!u&&g.decimals!==void 0&&(G=`+${Ne(f,g.decimals)} ${Qj(g.symbol||x,6)}`);let v="";return!u&&h.decimals!==void 0&&(v=`-${Ne(E,h.decimals)} ${Qj(h.symbol||w,6)}`),{topLeft:{text:A(u?"transactionsFailedSwap":"transactionsSwapped")},topRight:{text:G,color:"spotPositive"},bottomLeft:{text:F},bottomRight:{text:v,color:"textBase"},start:k}}case"BRIDGE_INIT":{let f=o.dapp?o.dapp.displayName:B,E=o.balanceChanges[0],{token:{symbol:h,decimals:y},amount:F}=E,w=h?` ${Qj(h,6)}`:"";if(!u&&y!==void 0){let x=`-${Ne(F,y)}${w}`;return{topLeft:{text:u?A("transactionBridgeInitiatedFailed"):`${A("transactionBridgeInitiated")}`},bottomLeft:{text:f},topRight:{text:`${x}`,color:"textBase"},start:k}}return{topLeft:{text:u?A("transactionBridgeInitiatedFailed"):`${A("transactionBridgeInitiated")}`},bottomLeft:{text:f},start:k}}case"WITHDRAW_STAKE":{let{amount:f,stakeAccount:g}=o,E=Ie(g),h=I.getTokenSymbol(c);return{topLeft:{text:A(u?"transactionsWithdrawStakeFailed":"transactionsWithdrawStake")},topRight:{text:u?"":`${Ne(f,m)} ${Qj(h,6)}`,color:"textBase"},bottomLeft:{text:Aa(E,4)},start:k}}case"DEACTIVATE_STAKE":{let{stakeAccount:f}=o,g=Ie(f);return{topLeft:{text:A(u?"transactionsDeactivateStakeFailed":"transactionsDeactivateStake")},bottomLeft:{text:Aa(g,4)},start:k}}case"STAKE":{let{amount:f,stakeAccount:g,validatorName:E}=o,h=Ie(g);return{topLeft:{text:A(u?"transactionsStakedFailed":"transactionsStaked")},topRight:{text:u?"":`${Ne(f,m)} ${Qj(l,6)}`,color:"textBase"},bottomLeft:{text:E||Aa(h,4)},start:k}}case"COLLECTIBLE_LIST":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsListedFailed"):A("transactionsListedInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_BUY_ITEM":{let{dapp:f,itemAmount:g,item:E,forAsset:h,forAmount:y}=o,F=f?f.displayName:A("historyUnknownDappName"),w=jg(y,h.decimals,Qj(h.symbol||"",6)),x=E.symbol||ps(Ie(E.id)),G=g&&E.tokenType==="SemiFungible"?`+${g} ${x}`:`+${x}`;return{topLeft:{text:A(u?"transactionsBuyFailed":"transactionsBoughtCollectible")},topRight:{text:u?"":G,color:"spotPositive"},bottomRight:{text:u?"":`${w}`,color:"textBase"},bottomLeft:{text:F},start:k}}case"COLLECTIBLE_CANCEL_BID":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsCancelBidOnFailed"):A("transactionsCancelBidOnInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_BID_ITEM":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsBidFailed"):A("transactionsBidOnInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_UNLIST":{let{dapp:f,item:g}=o,E=f?f.displayName:A("historyUnknownDappName"),h=g.displayName||A("richTransactionDetailUnknownNFT");return{topLeft:{text:u?A("transactionsUnlistedFailed"):A("transactionsUnlistedInterpolated",{name:h})},bottomLeft:{text:E},start:k}}case"COLLECTIBLE_SELL_ITEM":{let{dapp:f,itemAmount:g,item:E,forAsset:h,forAmount:y}=o,F=f?f.displayName:A("historyUnknownDappName"),w=h.decimals!==void 0?`+${Ne(y,h.decimals)} ${Qj(h.symbol||"",6)}`:A("transactionsUnknownAmount"),x=E.symbol||ps(Ie(E.id)),G=g&&E.tokenType==="SemiFungible"?`-${g} ${x}`:`-${x}`;return{topLeft:{text:A(u?"transactionsSoldFailed":"transactionsSoldCollectible")},topRight:{text:u?"":`${w}`,color:"spotPositive"},bottomRight:{text:u?"":G,color:"textBase"},bottomLeft:{text:F},start:k}}case"CANCEL_TX":return{topLeft:{text:A(u?"transactionCancelledFailed":"transactionCancelled")},start:k};case"TOKEN_APPROVAL":{let{dapp:f,token:g,isApproved:E}=o,h=$r(g.tokenType)?g.displayName:g.symbol,y;return u?E?$r(g.tokenType)?y=A("transactionApproveTokenFailed",{tokenSymbol:h}):y=A("transactionApprovalFailed"):$r(g.tokenType)?y=A("transactionRevokeApproveTokenFailed",{tokenSymbol:h}):y=A("transactionRevokeFailed"):E?y=A("transactionApproveToken",{tokenSymbol:h}):y=A("transactionRevokeApproveToken",{tokenSymbol:h}),{topLeft:{text:y},bottomLeft:{text:f?f.displayName:B,color:"textIncidental"},start:k}}case"COLLECTION_APPROVAL":{let{collection:f,isApproved:g,dapp:E}=o,h=f.displayName,y;return u?g?y=A("transactionApproveTokenFailed",{tokenSymbol:h}):y=A("transactionRevokeApproveTokenFailed",{tokenSymbol:h}):g?y=A("transactionApproveToken",{tokenSymbol:h}):y=A("transactionRevokeApproveToken",{tokenSymbol:h}),{topLeft:{text:y},bottomLeft:{text:E?E.displayName:B,color:"textIncidental"},start:k}}case"CANCEL_ORDER":{let{dapp:f}=o;return{topLeft:{text:A(u?"transactionCancelOrderFailed":"transactionCancelOrder")},bottomLeft:{text:f?.displayName||A("historyUnknownDappName"),color:"textIncidental"},start:k}}case"UNCLASSIFIED_APP_INTERACTION":{let{dapp:f}=o,g=f?f.displayName:B;return{topLeft:{text:A(u?"transactionsFailedAppInteraction":"transactionsAppInteraction")},bottomLeft:{text:g},start:k}}}},K$=(e,A)=>{let{display:j,type:t}=e,{topLeft:r,topRight:o,bottomLeft:i,bottomRight:a}=j.summary,u=Bl.default.createElement(A,{logoUri:j.summary.logoUri,pendingTransactionType:t,size:"small"});return{topLeft:r,topRight:o,bottomLeft:i,bottomRight:a,start:u}},fl=(e,A,j)=>{let t=(e??[]).map(Dk);if(A){let r=t.find(o=>o.chainId===A)?.address;if(r){let o={chainId:A,address:r};j&&(o.filters=[{type:"token",value:j}]),t=[o]}}return t},gl=e=>{if(!e)return;let A=V(e);if(A.resourceType!=="nativeToken")return e.type==="SPL"?e.data.splTokenAccountPubkey:A.address},U$=(e,A)=>{let j=Ie(e.id);return N$.includes(j)&&(e.tokenType="Native"),e.tokenType==="Native"?{chainId:A,slip44:I.getSlip44(A),resourceType:"nativeToken"}:{chainId:A,address:j,resourceType:"address"}},jg=(e,A,j)=>{if(!e||!A)return T.t("transactionsUnknownAmount");let t=mA(e,A),r=t.abs(),o=t.isZero()?"":t.isPositive()?"-":"+",i=_e(r);return`${o}${i} ${j}`};n();s();var ys=q(P());var H$=p.object({orderIds:p.array(p.object({bytesValue:p.string(),bytesArrayValue:p.string(),stringValue:p.string()}))}),Q$=async(e,A)=>{if(A==="LI.FI")return{label:T.t("transactionBridgeStatusLink",{dappName:"LI.FI"}),value:`https://explorer.li.fi/tx/${e}`};if(A==="deBridge")try{let j=await N.get(`https://stats-api.dln.trade/api/Transaction/${e}/orderIds`),t=H$.safeParse(j.data);if(!t.success){b.captureError(new Error("Failed to parse deBridge response"),"history");return}let r=t.data.orderIds[0]?.stringValue;if(!r){b.captureError(new Error("No orderId found in deBridge response"),"history");return}return{label:T.t("transactionBridgeStatusLink",{dappName:"DeBridge"}),value:`https://app.debridge.finance/order?orderId=${r}`}}catch(j){b.captureError(new Error(`Could not fetch bridge explorer url: ${j}`),"history");return}},V$=(e,A)=>{let[j,t]=(0,ys.useState)(),[r,o]=(0,ys.useState)(!1);return(0,ys.useEffect)(()=>{e&&A&&(async()=>{o(!0);try{let a=await Q$(e,A);t(a)}finally{o(!1)}})()},[e,A]),{bridgeUrl:j,isLoading:r}};n();s();n();s();n();s();var lj={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!0};var tg={...lj};n();s();var rg={...lj};n();s();var og={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};n();s();var ng={...lj,showTimeToMineRowInPendingTransactionDetail:!0};n();s();var sg={...lj};n();s();var ig={...lj};n();s();var ag={...lj};n();s();var pg={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};n();s();var cg={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};var z$=new Bo({solana:pg,ethereum:ng,polygon:ag,monad:ig,base:rg,arbitrum:tg,bitcoin:og,sui:cg,hypercore:sg}),ug=ko(z$);n();s();n();s();n();s();n();s();var dg=q(P(),1);var lg=new WeakMap;function mg(e,A){let j=zk(A),t=X$(j);for(let[r,o]of e)(!t.has(r)||A?.dangerouslyForceHydrate)&&(t.add(r),j.set(r,o))}var X$=e=>{let A=lg.get(e);return A||(A=new WeakSet,lg.set(e,A)),A};var yg=q(P());n();s();var gg=q(P());n();s();var W$=10,J$="/history/v2",No=class extends Error{message="406: Cache bust!"},Fs=class extends Error{message="Server response malformed."},Ca=class extends Error{},Oa=class extends Error{},El=p.object({next:p.union([p.null(),p.string()]),results:p.array(Ga)}),kg=async e=>{let A=await N.api().retry(3,2e3).post(`${J$}`,e);if(A.status===406)throw new No;if(A.status>=400&&A.status<500)throw new Oa(`FetchActivityItem: Status code: ${A.status}`);if(A.status>=500)throw new Ca(`FetchActivityItem: Status code: ${A.status}`);return A.data},Bg=e=>!Array.isArray(e.results)||typeof e.next!="string"&&e.next!==null,Ma=async e=>{let A=await kg(e);if(Bg(A))throw new Fs;for(;A.results?.length<W$&&A.next;){if(Bg(A))throw new Fs;let j=await kg({next:A.next,isSpam:e.isSpam});A.next=j.next,A.results=[...A.results,...j.results]}try{return El.parse(A)}catch(j){let t=j,r=[],o=t.issues;for(let u=0;u<o.length;++u){let c=o[u].path;if(c[0]!=="results")throw b.captureError(t,"history"),t;let l=c[1];if(typeof l!="number")throw b.captureError(t,"history"),t;r.push(l)}r.sort(function(u,c){return c-u});let i=r.map(u=>A.results[u]).map(u=>u.interactionData?.transactionType||""),a=[];for(let u=0;u<r.length;++u){let c=r[u],l=A.results[c],m={timestamp:l?.timestamp,owner:l?.owner,id:l?.id,chainMeta:l?.chainMeta,interactionData:{transactionType:"UNCLASSIFIED_APP_INTERACTION",balanceChanges:[]}};try{Ga.parse(m),A.results[c]=m,a.push(c)}catch{}}for(let u=0;u<r.length;++u){let c=r[u];a.indexOf(c)===-1&&A.results.splice(c,1)}r.length&&console.error(`Removed history items, ${i.join(",")}`);try{return El.parse(A)}catch(u){let c=u;throw b.captureError(c,"history"),c}}};var Y$=3e5,Ss="fetch-infinite-activity-items",Eg=({accounts:e,isSpam:A})=>[Ss,e,A],Z$=(e,A)=>{e.removeQueries({queryKey:A})},yl=({accounts:e,isSpam:A})=>{let j=cA();(0,gg.useEffect)(()=>()=>{j.cancelQueries({queryKey:[Ss],exact:!1})},[j]);let t=Eg({accounts:e,isSpam:A});return Ji({queryKey:t,queryFn:async({pageParam:i})=>{try{let a;i&&i!==""?a=await Ma({next:i,isSpam:A}):a=await Ma({accounts:e||[],isSpam:A});let u=a.results.map(c=>(c.interactionData.transactionType==="TOKEN_SEND"&&c.interactionData.balanceChanges.sort(Av(e)),c));return{...a,results:u}}catch(a){a instanceof No&&Z$(j,t),b.captureError(a,"history")}},getNextPageParam:i=>i?.next,staleTime:Y$,retry:!1,enabled:!!e?.length&&e.every(i=>!I.isLocalNetworkID(i.chainId)),initialPageParam:""})};function Av(e){return(A,j)=>{let t=fg(A,e),r=fg(j,e);return t?-1:r?1:0}}function fg(e,A){let j=e.to.split("/address:")[1],t=e.from.split("/address:")[1];return A.some(r=>r.address.toLowerCase()===j.toLowerCase()||r.address.toLowerCase()===t.toLowerCase())}var ev=({fungible:e,isSpam:A=!1})=>{let{data:j=ok,status:t}=dk(),r=j.isDeveloperMode,o=gl(e),{data:i}=Er({address:e?.data.walletAddress,networkID:e?.data.chain.id}),a=(0,yg.useMemo)(()=>fl(i?[i]:[],e?.data.chain.id,o),[i,e?.data.chain.id,o]),u=yl({accounts:a,isSpam:A}),c=u.isPending||t==="pending";return{activityItemsData:u,isLoadingHistory:c,isDeveloperMode:r}};n();s();var hl=e=>e.replace(/^(^[\w-_]*:\/\/)?(?:www\.)?/i,"").split("/")[0];n();s();n();s();var $e="Auto";var $A={buyFungible:void 0,buyUsdValue:void 0,sellFungible:void 0,sellUsdValue:void 0,sellAmount:"",uiSellAmountCryptoInput:"",amountType:"sell",quoteResponse:void 0,selectedProviderIndex:0,selectedBaseProvider:$e,gasEstimation:{isFetching:!1,estimate:void 0,estimateWithBuffer:void 0},hasNoRoutes:!1,isFetchingQuote:!1,error:null,searchQuery:"",numSearchResults:0,primaryCurrency:"crypto",uiSellAmountLocalFiatInput:"",uiBuyAmountCryptoInput:"",uiBuyAmountLocalFiatInput:"",canInputFiatSellAmount:!1,swapFilter:void 0},$=UA(e=>({...$A,resetQuote:()=>e({quoteResponse:$A.quoteResponse,isFetchingQuote:$A.isFetchingQuote,hasNoRoutes:$A.hasNoRoutes,selectedProviderIndex:$A.selectedProviderIndex,error:$A.error,uiSellAmountLocalFiatInput:$A.uiSellAmountLocalFiatInput,selectedBaseProvider:$A.selectedBaseProvider}),resetSwapper:()=>e({quoteResponse:$A.quoteResponse,gasEstimation:$A.gasEstimation,error:$A.error,sellAmount:"",uiSellAmountCryptoInput:"",uiBuyAmountCryptoInput:$A.uiBuyAmountCryptoInput,swapFilter:$A.swapFilter,selectedBaseProvider:$A.selectedBaseProvider,selectedProviderIndex:$A.selectedProviderIndex}),setBuyFungible:A=>e({buyFungible:A}),setBuyUsdValue:A=>e({buyUsdValue:A}),setHasNoRoutes:A=>e({hasNoRoutes:A}),setIsFetchingQuote:A=>e({isFetchingQuote:A}),setQuoteResponse:A=>e({quoteResponse:A,hasNoRoutes:!1}),setSelectedProviderIndex:A=>e({selectedProviderIndex:A}),setSelectedBaseProvider:A=>e({selectedBaseProvider:A}),setGasEstimation:({estimate:A,estimateWithBuffer:j,isFetching:t})=>e(r=>({gasEstimation:{...r.gasEstimation,...A!==void 0&&{estimate:A},...j!==void 0&&{estimateWithBuffer:j},...t!==void 0&&{isFetching:t}}})),setSellAmount:A=>e({sellAmount:A}),setAmountType:A=>e({amountType:A}),setSellUsdValue:A=>e({sellUsdValue:A}),setSellFungible:A=>e({sellFungible:A}),setUiSellAmountCryptoInput:A=>e({uiSellAmountCryptoInput:A}),setError:A=>e({error:A}),setSearchQuery:A=>e({searchQuery:A}),setNumSearchResults:A=>e({numSearchResults:A}),setPrimaryCurrency:A=>e({primaryCurrency:A}),setUiSellAmountLocalFiatInput:A=>e({uiSellAmountLocalFiatInput:A}),setUiBuyAmountCryptoInput:A=>e({uiBuyAmountCryptoInput:A}),setUiBuyAmountLocalFiatInput:A=>e({uiBuyAmountLocalFiatInput:A}),setCanInputFiatSellAmount:A=>e({canInputFiatSellAmount:A}),setSwapFilter:A=>e({swapFilter:A}),switchTokensForSell:()=>{e(A=>{let j=A.sellFungible??A.buyFungible,t=A.buyFungible??A.sellFungible,r=A.uiBuyAmountCryptoInput,o=A.uiBuyAmountLocalFiatInput;return{sellFungible:t,buyFungible:j,uiSellAmountCryptoInput:r,uiSellAmountLocalFiatInput:o,uiBuyAmountCryptoInput:$A.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:$A.uiBuyAmountLocalFiatInput,sellAmount:r,swapFilter:void 0,selectedBaseProvider:A.selectedBaseProvider}})},switchTokensForBuy:()=>{e(A=>{let j=A.sellFungible??A.buyFungible,t=A.buyFungible??A.sellFungible,r=A.uiSellAmountCryptoInput,o=A.uiSellAmountLocalFiatInput;return{sellFungible:t,buyFungible:j,uiSellAmountCryptoInput:$A.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:$A.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:r,uiBuyAmountLocalFiatInput:o,sellAmount:r,swapFilter:void 0,selectedBaseProvider:A.selectedBaseProvider}})},resetUiAmounts:()=>e({uiSellAmountCryptoInput:$A.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:$A.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:$A.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:$A.uiBuyAmountLocalFiatInput,sellAmount:$A.sellAmount,selectedBaseProvider:$A.selectedBaseProvider}),setPairAndAmount:({sell:A,buy:j,swapAmount:t})=>e(r=>{let o="uiSellAmountCryptoInput";return t.perspective==="sell"?r.primaryCurrency==="crypto"?o="uiSellAmountCryptoInput":o="uiSellAmountLocalFiatInput":r.primaryCurrency==="crypto"?o="uiBuyAmountCryptoInput":o="uiBuyAmountLocalFiatInput",{...r,sellFungible:A,buyFungible:j,[o]:t.amount,sellAmount:t.amount}})}));n();s();n();s();var Ra=p.object({name:p.string(),message:p.string()}),Fg=p.object({chainId:Ot,name:p.string(),symbol:p.string(),decimals:p.number(),logoURI:p.optional(p.string()),includesBridge:p.optional(p.boolean())}),jv=Fg.extend({address:p.string(),resourceType:p.literal("address")}),tv=Fg.extend({slip44:p.string(),resourceType:p.literal("nativeToken")}),JH=p.union([jv,tv]),Sg=p.object({id:p.string(),name:p.string(),logoUri:p.string()}),rv=p.union([p.enum(["network","phantom","gasless","ata","gasless_network","tips","priority_fee"]),p.string()]),ov=p.object({name:p.string(),percentage:p.number(),amount:p.number(),type:rv}),nv=p.object({name:p.string(),proportion:p.string()}),wg=p.object({sellAmount:p.string(),buyAmount:p.string(),rfqProps:p.optional(p.object({expireAt:p.number(),quoteId:p.string()})),analyticsContext:p.optional(p.string())}),Fl=wg.extend({priceImpact:p.number(),sources:p.array(nv),fees:p.array(ov),slippageTolerance:p.optional(p.number()),baseProvider:Sg}),sv=p.object({success:p.boolean(),error:p.string().optional(),data:p.object({ataFeeUSD:p.number().optional(),networkFeeUSD:p.number().optional(),totalAmountUSD:p.number().optional()}).optional()}),_a=Fl.extend({transactionData:p.array(p.string()),gaslessSignature:p.optional(p.string()),gaslessSwapFeeResult:p.optional(sv)}),iv=_a,Sl=Fl.extend({allowanceTarget:p.string(),exchangeAddress:p.string(),gas:p.number(),value:p.string(),transactionData:p.string()}),wl=Fl.extend({transactionData:p.array(p.string())}),hg=p.object({name:p.string(),amount:p.string(),token:xe,percentage:p.string(),included:p.boolean(),amountUSD:p.optional(p.string())}),av=p.object({name:p.string(),key:p.string(),logoURI:p.string()}),bg=p.object({name:p.string(),symbol:p.string()}),pv=p.object({transactionData:p.string(),buyToken:xe,sellToken:xe,nonIncludedNonGasFees:p.string(),feeCosts:p.array(hg),chainId:Ot,tool:av,value:p.optional(p.string()),allowanceTarget:p.optional(p.string()),approvalMetadata:p.optional(bg),approvalExactAmount:p.optional(p.string()),exchangeAddress:p.optional(p.string()),gasCosts:p.optional(p.array(p.number())),includedFeeCosts:p.optional(p.array(hg))}),bl=wg.extend({baseProvider:Sg,executionDuration:p.number(),tags:p.array(p.string()),steps:p.array(pv)}),cv=p.union([_a,Sl,wl,bl,iv]),ws=p.enum(["solana","eip155","sui","xchain"]),bs=p.object({type:ws,taker:xe,buyToken:xe,sellToken:xe,slippageTolerance:p.number(),simulationTolerance:p.optional(p.number()),gasBuffer:p.optional(p.number()),quotes:p.array(cv),tradeFee:p.optional(p.array(p.number())),estimateGasFee:p.optional(p.array(p.number())),includesAllProviders:p.optional(p.boolean())}),uv=p.enum(["swap-approval","swap","bridge-approval","bridge"]),lv=p.enum(["swap","bridge"]),dv=p.enum(["swap","bridge"]),Il=p.object({sellToken:xe,buyToken:xe,approvalMetadata:p.optional(bg)}),mv=p.object({type:p.literal("solana"),transactions:p.array(p.string()),transactionTypes:p.array(lv),transactionPairs:p.optional(p.array(Il))});var kv=p.object({type:p.literal("evm"),transactions:p.array(po),transactionTypes:p.array(uv),transactionPairs:p.optional(p.array(Il))}),Bv=p.object({type:p.literal("sui"),transactions:p.array(p.string()),transactionTypes:p.array(dv),transactionPairs:p.optional(p.array(Il))}),YH=p.union([mv,kv,Bv]);var $l=p.object({name:p.string(),amount:p.string()}).strict(),Da=p.object({name:p.string(),feeUsd:p.number().nullish(),amount:p.string(),time:p.object({text:p.string(),isFast:p.boolean()}),logoURI:p.string()}),ZH=p.union([$l,Da]);var fv=e=>Da.safeParse(e).success;n();s();function dA(e){return bl.safeParse(e).success}var Ke=e=>_a.safeParse(e).success,Ig=e=>Ke(e);function Ze(e){return Sl.safeParse(e).success}function kt(e){return wl.safeParse(e).success}function $g(e){return e?"gaslessSignature"in e:!1}function Wj(e){return Ke(e)||Ze(e)||kt(e)}n();s();var qg=q(P());n();s();var Is=q(P());var vg=()=>{let[e,A]=(0,Is.useState)(!1),j=$(u=>u.selectedProviderIndex),t=$(u=>u.selectedBaseProvider),r=$(u=>u.quoteResponse),o=(0,Is.useMemo)(()=>r?r.quotes:[],[r]),i=(0,Is.useMemo)(()=>{if(Sj){if(!r||r.quotes.length===0)return 0;let u=gv(r,t);return u===-1?(A(t!==$e),0):(A(!1),u)}return j},[r,t,j]),a=o.length>0?o[i]:void 0;return{selectedQuoteIndex:i,selectedBaseProvider:Sj?t:"",currentQuote:a,hasDefaultedToBestQuote:e}},gv=(e,A)=>e.quotes.findIndex(j=>j.baseProvider.id===A);function aA(){let e=$(c=>c.quoteResponse),A=$(c=>c.hasNoRoutes),j=$(c=>c.isFetchingQuote),t=(0,qg.useMemo)(()=>e?e.quotes:[],[e]),r=t[0]?.buyAmount??"",{selectedQuoteIndex:o,selectedBaseProvider:i,currentQuote:a,hasDefaultedToBestQuote:u}=vg();return{bestBuyAmount:r,currentQuote:a,hasNoRoutes:A,quoteResponse:e,quotes:t,selectedProviderIndex:o,selectedBaseProvider:i,isFetchingQuote:j,hasDefaultedToBestQuote:u}}n();s();n();s();n();s();n();s();n();s();var Lo="cash-account",Ev="grouped-balances",Ko=[Lo,Ev],vr={account:(e,A)=>[Lo,"account",{userId:e,isCashEnabled:A}],cashKMSAccount:(e,A)=>[Lo,"kms-account",{user:e,isCashEnabled:A}],bankDetails:(e,A)=>[Lo,"bankDetails",{user:e,isCashEnabled:A}],enrollment:(e,A)=>[Lo,"enrollment",{userId:e,isCashEnabled:A}],groupedBalances:(e,A)=>[...Ko,{userID:e,addresses:A}]};var vl=(e,A)=>{let j=Te.isFeatureEnabled("enable-cash");return e.invalidateQueries({queryKey:vr.account(A,j)})},ql=e=>e.invalidateQueries({queryKey:Ko});n();s();n();s();n();s();function xg(e){return e.toLowerCase().replace(/(^|\s|\.)(\w)/g,(A,j,t)=>j+t.toUpperCase())}n();s();var Na=(o=>(o.NotEnrolled="not_enrolled",o.Unverified="unverified",o.Verified="verified",o.Suspended="suspended",o.Closed="closed",o))(Na||{}),Tl=(a=>(a.Crypto="crypto",a.CryptoRecover="crypto_recover",a.Banking="banking",a.Fiat="fiat",a.Cards="cards",a.PaymentLinks="payment_links",a.AccountManagement="account_management",a))(Tl||{}),Pl=(t=>(t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified",t))(Pl||{}),qr=(u=>(u.PhantomUsername="phantom_username",u.Signup="signup",u.Tos="tos",u.Kyc="kyc",u.EmailVerification="email_verification",u.DataSharingConsent="data_sharing_consent",u.L1KycVerification="l1_kyc_verification",u.L2DocumentVerification="l2_document_verification",u))(qr||{}),$s=(u=>(u.Pending="pending",u.Completed="completed",u.Verified="verified",u.Failed="failed",u.Rejected="rejected",u.NotStarted="not_started",u.Expired="expired",u.NotApplicable="not_applicable",u))($s||{}),Tg=p.nativeEnum(Na),yv=p.nativeEnum(Tl),Pg=p.nativeEnum(Pl),hv=p.nativeEnum(qr),Fv=p.nativeEnum($s),Sv=p.object({type:hv,status:Fv.nullish().transform(Z),description:p.string().nullish().transform(Z),url:p.string().nullish().transform(Z),errorMessage:p.string().nullish().transform(Z),metadata:p.record(p.string(),p.any()).nullish().transform(Z)}),xl=(o=>(o.NotStarted="not_started",o.Pending="pending",o.Failed="failed",o.Rejected="rejected",o.Verified="verified",o))(xl||{}),wv=p.object({kycStartedAt:p.string().nullish().transform(Z),idVerificationStatus:p.nativeEnum(xl).nullish().transform(Z),kycVerificationStatus:p.nativeEnum(xl).nullish().transform(Z)}),bv=p.object({consentTimestamp:p.string().nullish().transform(Z),consented:p.boolean().nullish().transform(Z)}),Iv=p.object({kycMetadata:wv.nullish().transform(Z),dataSharingMetadata:bv.nullish().transform(Z)}),$v=p.object({type:p.string(),required:p.boolean(),description:p.string().nullish().transform(Z)}),Gg=p.object({type:p.nativeEnum(qr),required:p.boolean(),description:p.string(),data:p.object({type:p.union([p.literal("data_sharing_consent"),p.literal("l1_kyc_verification"),p.literal("l2_document_verification")]).nullish().transform(Z),currentStatus:p.nativeEnum($s).nullish().transform(Z),authIntentId:p.string().nullish().transform(Z),consentRequired:p.boolean().nullish().transform(Z)}).nullish().transform(Z)}),La=(i=>(i.NotStarted="not_started",i.Pending="pending",i.Failed="failed",i.RegionLocked="region_locked",i.Completed="completed",i.CardReady="card_ready",i))(La||{}),Ka=p.object({accountStatus:Tg,features:p.array(yv).optional().default([]),availableTransitions:p.array(Tg).optional().default([]),canAdvance:p.boolean().optional().default(!1),currentTier:Pg.nullish().transform(Z),nextTier:Pg.nullish().transform(Z),nextTierDescription:p.string().nullish().transform(Z),nextTierRequirements:p.array(Sv).optional().default([]),nextTierRequiredFields:p.record(p.string(),$v).nullish().transform(Z),nextSteps:p.array(Gg).optional().default([]),verificationState:p.nativeEnum(La).nullish().transform(Z),metadata:Iv.nullish().transform(Z)});var Gl=(t=>(t.NotSubmitted="not_submitted",t.Accepted="accepted",t.NotAccepted="not_accepted",t))(Gl||{}),Cl=(o=>(o.NotSubmitted="not_submitted",o.Incomplete="incomplete",o.PendingReview="pending",o.Approved="approved",o.Rejected="rejected",o))(Cl||{}),Ol=(a=>(a.Crypto="crypto",a.CryptoRecover="crypto_recover",a.Banking="banking",a.Fiat="fiat",a.Cards="cards",a.PaymentLinks="payment_links",a.AccountManagement="account_management",a))(Ol||{}),vv=e=>Object.values(Ol).includes(e),Tr=(i=>(i.Pending="pending",i.Processing="processing",i.Completed="completed",i.Failed="failed",i.Canceled="canceled",i.Unknown="unknown",i))(Tr||{});var xr=class extends Error{constructor(A){super(`Cash account not found for user ${A}. User is not enrolled in cash account.`),this.name="CashAccountNotFoundError"}},Ua=class extends Error{zodError;responseData;constructor(A,j){let t=A.issues.map(r=>`${r.path.length>0?r.path.join("."):"root"}: ${r.message}`).join("; ");super(`Cash account validation failed: ${t}`),this.name="CashAccountValidationError",this.zodError=A,this.responseData=j}},Ha=p.object({id:p.string(),balance:p.string(),primaryEmail:p.string().nullish().transform(Z),accountStatus:p.string().nullish().transform(Z),addressDetails:p.object({address:p.string()}),features:p.array(p.string()).transform(e=>e.filter(vv)),limits:p.object({dailyFiatTransfer:p.string().nullish().transform(Z),monthlyFiatTransfer:p.string().nullish().transform(Z)}).nullish().transform(Z),waitlistDetails:p.object({waitlist:p.boolean(),priorityWaitlist:p.boolean()}).nullish().transform(Z),isRegionLocked:p.boolean().nullish().transform(Z),linkDetails:p.object({cryptoCustomerId:p.string().nullish().transform(Z),authIntentId:p.string().nullish().transform(Z),linkEmail:p.string().nullish().transform(Z)}).nullish().transform(Z)});var qv=p.object({sourceCurrency:p.string().nullish().transform(Z),destinationCurrency:p.string().nullish().transform(Z),destinationBlockchain:p.string().nullish().transform(Z),destinationAddress:p.string().nullish().transform(Z),accountNumber:p.string().nullish().transform(Z),routingNumber:p.string().nullish().transform(Z),accountType:p.string().nullish().transform(Z),bankName:p.string().nullish().transform(Z),bankAddress:p.string().nullish().transform(Z),bankBeneficiaryName:p.string().transform(xg).nullish().transform(Z),bankBeneficiaryAddress:p.string().nullish().transform(Z)}),xv=p.object({price:p.number(),priceChange24h:p.number(),lastUpdatedAt:p.string().transform(e=>new Date(e))}),Tv=p.object({account:p.string(),quantity:p.number(),quantityString:p.string()}),Pv=p.object({address:p.string(),quantity:p.number(),quantityString:p.string(),lastTransferredDate:p.string().nullish().transform(Z),subaccounts:p.array(Tv).nullish().transform(Z)}),Gv=p.object({isMutable:p.boolean().nullish().transform(Z),creators:p.array(p.string()).nullish().transform(Z),tokenProgram:p.string().nullish().transform(Z),extensions:p.array(p.any()).nullish().transform(Z),compression:p.record(p.any()).nullish().transform(Z)}),Og=p.object({caip19:p.string(),name:p.string(),symbol:p.string(),decimals:p.number(),spamStatus:p.string().nullish().default(""),logoUri:p.string().nullish().default(""),totalQuantity:p.number(),totalQuantityString:p.string(),price:xv.nullish().transform(Z),queriedWalletBalances:p.array(Pv),extraMetadata:Gv}),Cv=p.object({email:p.string().email(),cashAccountAddress:p.string(),idempotencyKey:p.string()}),Ov=p.object({enrollmentDetails:p.object({kycStatus:p.nativeEnum(Cl),kycUrl:p.string(),tosStatus:p.nativeEnum(Gl),tosUrl:p.string()})});var Mv=p.object({account:p.string(),quantity:p.number(),quantityString:p.string()}),Rv=p.object({address:p.string(),quantity:p.number(),quantityString:p.string(),lastTransferredDate:p.string().nullish().transform(Z),subaccounts:p.array(Mv).nullish().transform(Z)}),_v=p.object({isMutable:p.boolean().nullish().default(null),creators:p.array(p.unknown()).nullish().transform(Z),tokenProgram:p.string().nullish().transform(Z),extensions:p.array(p.unknown()).nullish().transform(Z)}),Cg=p.object({caip19:p.string(),name:p.string(),symbol:p.string(),decimals:p.number(),logoUri:p.string(),spamStatus:p.string(),totalQuantity:p.number(),totalQuantityString:p.string(),queriedWalletBalances:p.array(Rv),extraMetadata:_v.nullish().transform(Z),price:p.object({price:p.number(),priceChange24h:p.number().nullish().transform(Z),lastUpdatedAt:p.coerce.date(),marketCap:p.number().nullish().transform(Z)}).nullish()}),Dv=p.object({stablecoins:p.array(Cg),otherTokens:p.array(Cg),totalStablecoinsValueUsd:p.string().nullish().transform(Z),totalOtherTokensValueUsd:p.string().nullish().transform(Z)}),Qa=(j=>(j.UNVERIFIED="unverified",j.VERIFIED="verified",j))(Qa||{}),Ml=(r=>(r.AlreadyExists="already_exists",r.InProgress="in_progress",r.Pending="pending",r.Completed="completed",r))(Ml||{}),Nv=p.object({targetState:p.nativeEnum(Qa),data:p.object({email:p.string().email().optional(),cashAccountAddress:p.string().optional()}),idempotencyKey:p.string().optional()}),Lv=p.object({currentState:p.nativeEnum(Qa).nullish().transform(Z),status:p.nativeEnum(Ml).nullish().transform(Z),nextSteps:Ka.shape.nextSteps.nullish().transform(Z),account:Ha.nullish().transform(Z)}),Kv=p.object({requirementType:p.nativeEnum(qr),evidence:p.object({authIntentId:p.string(),providerCustomerId:p.string(),dataSharing:p.object({consented:p.boolean()})})}),Uv=p.object({nextSteps:Ka.shape.nextSteps,account:Ha});var vs=e=>{let{data:A}=oe(),{userID:j}=A??{},{data:[t],isLoading:r}=_A(["enable-cash"]);return X({...e,queryKey:vr.account(j,t),queryFn:j&&!r&&t&&e?.enabled!==!1?async()=>{try{let o=await N.api().bearer(!0).get(`/cash/v1/users/${j}/cash-account`);if(o.status===404||o.status===403)throw new xr(j);let i=Ha.safeParse(o.data);if(!i.success)throw new Ua(i.error,o.data);return i.data}catch(o){let i=o?.response?.status||o?.response?.data?.statusCode;throw i===404||i===403?new xr(j):(o instanceof xr||b.captureError(o,"cashAccount"),o)}}:as})};n();s();n();s();n();s();n();s();n();s();var Qv=q(P());n();s();n();s();var Vv=q(P());var zv=(e,A,j)=>{let t=i=>{if(i.caip19!==A)return i;let u=new S(i.totalQuantity).plus(j),c=u.isLessThan(0)?new S(0):u;return{...i,totalQuantity:c.toNumber(),totalQuantityString:c.toString(),queriedWalletBalances:i.queriedWalletBalances}},r=e.stablecoins.some(i=>i.caip19===A),o=e.otherTokens.some(i=>i.caip19===A);return!r&&!o?e:{...e,stablecoins:r?e.stablecoins.map(t):e.stablecoins,otherTokens:o?e.otherTokens.map(t):e.otherTokens}};function _l(e,A,j){e.getQueriesData({queryKey:Ko,exact:!1}).forEach(([r,o])=>{if(o){let i=zv(o,A,j);e.setQueryData(r,i)}})}var ot=q(P());n();s();n();s();n();s();var Jv=["SwapperNoQuotes","UnsupportedCountry","UnknownError"],_g=(e,A,j,t)=>{e instanceof DA&&Jv.includes(e.code)||(!A||A>=400&&A<500)&&b.addBreadcrumb(j,JSON.stringify(t),"info")};n();s();var Dg=async(e,A,j=void 0)=>{if(eA(e))return Promise.resolve();let t;try{t=e.data}catch{throw new DA({key:j})}let r=Ra.safeParse(t);throw r.success?(b.addBreadcrumb(A,JSON.stringify(r.data),"info"),new DA({key:r.data.name})):new DA({key:j})};n();s();var Ng=e=>{let A=new DA({key:"SwapperNoQuotes"});if(ws.safeParse(e?.type).success===!1)throw b.captureError(new Error("Failed to parse a valid quote type."),"swapper"),new Error("Invalid input");let j=bs.safeParse(e);if(!j.success)throw b.captureError(new Error("Failed to parse a valid swap quotes response."),"swapper"),A;if(j.data.quotes.length===0)throw A;return j.data};var Lg="swap-quotes";async function Va({sellTokenCaip19:e,buyTokenCaip19:A,taker:j,takerDestination:t,exactOut:r,sellAmount:o,sellAmountUsd:i,slippageTolerance:a,signal:u,enableAutoSlippage:c,priorityFee:l,tipAmount:m,phantomCashAccount:B}){let k;try{gr(j)&&(j.address=j.address.toLowerCase()),t&&gr(t)&&(t.address=t.address.toLowerCase()),gr(A)&&(A.address=A.address.toLowerCase()),gr(e)&&(e.address=e.address.toLowerCase());let f="/swap/v2/quotes",g={sellToken:e,buyToken:A,taker:j,takerDestination:t,exactOut:r,sellAmount:o,sellAmountUsd:i,slippageTolerance:a,autoSlippage:c,priorityFee:l,tipAmount:m,phantomCashAccount:B},E=await N.api().post(f,g,{signal:u});return k=E.status,await Dg(E,Lg,"SwapperNoQuotes"),Ng(E.data)}catch(f){let g=f instanceof DA?f:new DA;throw _g(g,k,Lg,{sellToken:e,buyToken:A,sellAmount:o,sellAmountUsd:i,slippageTolerance:a}),g}}var za=class{getQuotes(A){return Va({sellTokenCaip19:A.sell,buyTokenCaip19:A.buy,taker:A.taker,takerDestination:A.takerDestination,sellAmount:A.amount,sellAmountUsd:A.amountUsd,slippageTolerance:A.slippageTolerance,signal:A.signal,exactOut:A.exactOutEnabled,priorityFee:A.priorityFee,tipAmount:A.tipAmount,enableAutoSlippage:A.autoSlippageEnabled,phantomCashAccount:A.phantomCashAccount})}};n();s();n();s();n();s();var fe=[];for(let e=0;e<256;++e)fe.push((e+256).toString(16).slice(1));function Kg(e,A=0){return(fe[e[A+0]]+fe[e[A+1]]+fe[e[A+2]]+fe[e[A+3]]+"-"+fe[e[A+4]]+fe[e[A+5]]+"-"+fe[e[A+6]]+fe[e[A+7]]+"-"+fe[e[A+8]]+fe[e[A+9]]+"-"+fe[e[A+10]]+fe[e[A+11]]+fe[e[A+12]]+fe[e[A+13]]+fe[e[A+14]]+fe[e[A+15]]).toLowerCase()}n();s();var Dl,Yv=new Uint8Array(16);function Nl(){if(!Dl){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Dl=self.crypto.getRandomValues.bind(self.crypto)}return Dl(Yv)}n();s();n();s();var Zv=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),Ll={randomUUID:Zv};function Aq(e,A,j){if(Ll.randomUUID&&!A&&!e)return Ll.randomUUID();e=e||{};let t=e.random??e.rng?.()??Nl();if(t.length<16)throw new Error("Random bytes length must be >= 16");if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){if(j=j||0,j<0||j+16>A.length)throw new RangeError(`UUID byte range ${j}:${j+15} is out of buffer bounds`);for(let r=0;r<16;++r)A[j+r]=t[r];return A}return Kg(t)}var Aj=Aq;n();s();n();s();n();s();n();s();n();s();n();s();n();s();n();s();n();s();function jq(e){if(e.length>=255)throw new TypeError("Alphabet too long");let A=new Uint8Array(256);for(let c=0;c<A.length;c++)A[c]=255;for(let c=0;c<e.length;c++){let l=e.charAt(c),m=l.charCodeAt(0);if(A[m]!==255)throw new TypeError(l+" is ambiguous");A[m]=c}let j=e.length,t=e.charAt(0),r=Math.log(j)/Math.log(256),o=Math.log(256)/Math.log(j);function i(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let l=0,m=0,B=0,k=c.length;for(;B!==k&&c[B]===0;)B++,l++;let f=(k-B)*o+1>>>0,g=new Uint8Array(f);for(;B!==k;){let y=c[B],F=0;for(let w=f-1;(y!==0||F<m)&&w!==-1;w--,F++)y+=256*g[w]>>>0,g[w]=y%j>>>0,y=y/j>>>0;if(y!==0)throw new Error("Non-zero carry");m=F,B++}let E=f-m;for(;E!==f&&g[E]===0;)E++;let h=t.repeat(l);for(;E<f;++E)h+=e.charAt(g[E]);return h}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let l=0,m=0,B=0;for(;c[l]===t;)m++,l++;let k=(c.length-l)*r+1>>>0,f=new Uint8Array(k);for(;c[l];){let y=A[c.charCodeAt(l)];if(y===255)return;let F=0;for(let w=k-1;(y!==0||F<B)&&w!==-1;w--,F++)y+=j*f[w]>>>0,f[w]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");B=F,l++}let g=k-B;for(;g!==k&&f[g]===0;)g++;let E=new Uint8Array(m+(k-g)),h=m;for(;g!==k;)E[h++]=f[g++];return E}function u(c){let l=a(c);if(l)return l;throw new Error("Non-base"+j+" character")}return{encode:i,decodeUnsafe:a,decode:u}}var Ug=jq;var tq="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Xa=Ug(tq);n();s();var rq=p.object({id:p.string(),state:p.nativeEnum(Tr)}).passthrough(),Kl=class extends Error{constructor(j,t,r){super(j);this.activityId=t;this.userId=r;this.name="CashActivityError"}},qs=class extends Error{constructor(A,j){super(`Cash activity ${A} not found for user ${j}`),this.name="CashActivityNotFoundError"}},Hg=async({userID:e,activityId:A,accessToken:j})=>{let t=await N.api().bearer(j).get(`/cash/v1/users/${e}/cash-activity/${A}`);if(t.status===404)throw new qs(A,e);let r=rq.safeParse(t.data);if(!r.success)throw new Kl(`Failed to parse cash activity response: ${r.error.message}`,A,e);return r.data};n();s();var oq=p.object({activityId:p.string(),transactionId:p.string()}),nq=3,sq=1e3,Qg=async({accessToken:e,userID:A,idempotencyKey:j,signedTransaction:t,skipActivityRecording:r,skipNotification:o,swapInfo:i})=>{if(!e)throw new Error("Access token is required");if(!A)throw new Error("User ID is required");return fo(async()=>{let a=await N.api().bearer(e).post(`/cash/v1/users/${A}/cash-account/send`,{idempotencyKey:j,chainId:"solana:101",signedTransaction:Xa.encode(Nm(t)?t.serialize():t.serialize({requireAllSignatures:!1,verifySignatures:!1})),encoding:"base58",skipActivityRecording:r,skipNotification:o,...i&&{swapInfo:i}}),u=oq.safeParse(a.data);if(!u.success)throw new Error("Failed to parse transaction response");return u.data},()=>!0,nq,sq)};var iq=8,aq=Q({seconds:1.5}),pq=e=>e==="failed"||e==="canceled"||e==="completed",cq=e=>e==="completed";var xs=async({unsignedTransaction:e,vaultProxy:A,accountIdentifier:j,signerAddress:t,idempotencyKey:r,isCash:o=!0,accessToken:i,userID:a,skipActivityRecording:u,skipNotification:c,swapInfo:l})=>{let m;typeof e=="string"?m=pe(e,"bs58"):m=e;let B=await uq(A,t);b.addBreadcrumb("cashTransfer","Signing transaction ...","info"),b.addBreadcrumb("cashTransfer",`Using vault proxy signing (isCash: ${o}, isCashKMS: ${B})`,"info");let k;o&&B?k={isCash:o,isCashKMS:B,data:{chainType:"solana",signingType:"transaction",message:new Uint8Array(zi(m))}}:o?k={isCash:o,data:{chainType:"solana",signingType:"transaction",message:new Uint8Array(zi(m))}}:k={chainType:"solana",signingType:"transaction",message:new Uint8Array(zi(m))};let f=await A.sign(j,k);if(f.status==="error")throw new Error(f.message);let{signature:g}=f;if(!g)throw new Error("Failed to sign transaction: No signature returned");m.addSignature(new kA.PublicKey(t),Xa.decode(g));let E=m;b.addBreadcrumb("cashTransfer","Signed transaction","info"),b.addBreadcrumb("cashTransfer","Broadcasting transaction ...","info");let{activityId:h,transactionId:y}=await Qg({accessToken:i,userID:a,idempotencyKey:r,signedTransaction:E,skipActivityRecording:u,skipNotification:c,swapInfo:l});b.addBreadcrumb("cashTransfer","Polling for cash activity...","info");try{await fo(async()=>{let F=await Hg({userID:a,activityId:h,accessToken:i});if(pq(F.state)){if(cq(F.state))return b.addBreadcrumb("cashTransfer",`Activity reached success terminal state: ${F.state}`,"info"),F;{let w=`Activity reached failed terminal state: ${F.state}.`;throw b.addBreadcrumb("cashTransfer",w,"info"),new Error(w)}}else throw new Error(`Activity state is ${F.state}, waiting for a terminal state.`)},F=>F instanceof qs||!!(F instanceof Error&&F.message.includes("waiting for")),iq,aq,!0)}catch(F){throw b.addBreadcrumb("cashTransfer",`Failed to poll for cash activity: ${F}`,"error"),new Error(`Transaction broadcast succeeded but activity confirmation failed: ${F}`)}return b.addBreadcrumb("cashTransfer","Broadcasted transaction","info"),y};async function uq(e,A){try{let t=(await e.getCashKMSAccount()).account.address;return A===t}catch{return b.addBreadcrumb("cashTransfer","Unable to get Cash-KMS account.","error"),!1}}n();s();var eE=q(P());n();s();var Vg=q(P());n();s();function IA(e){let A=e.reduce((j,t)=>j.add(t.name),new Set);return Array.from(A).join(" + ")}function Uo(e){return(0,Vg.useMemo)(()=>IA(e),[e])}n();s();n();s();var Ue="swapper";var zg=[Ue,"quotes"],uA={quotesScope:()=>zg,quotes:({sellTokenCaip19:e,buyTokenCaip19:A,taker:j,amountValue:t,amountType:r,slippageTolerance:o,priorityFee:i,tipAmount:a,takerDestination:u,enableAutoSlippage:c,preferredProvider:l,phantomCashAccount:m})=>[...zg,{sellToken:e,buyToken:A,taker:j,takerDestination:u,amountValue:t,amountType:r,slippageTolerance:o,priorityFee:i,tipAmount:a,enableAutoSlippage:c,preferredProvider:l,phantomCashAccount:m}],transactions:e=>[Ue,"transactions",e],presence:e=>[Ue,"presence",e],slippageTolerance:()=>[Ue,"slippageTolerance"],priorityFee:()=>[Ue,"priorityFee"],tipAmount:()=>[Ue,"tipAmount"],lastSubmittedPairs:()=>[Ue,"lastSubmittedPairsV2"],lastSelectedTokens:()=>[Ue,"lastSelectedTokens"],slippageSettings:()=>[Ue,"slippageSettings"],priorityFeeSettings:()=>[Ue,"priorityFeeSettings"],tipSettings:()=>[Ue,"tipSettings"],hasViewedAutoSlippageOptIn:()=>[Ue,"hasViewedAutoSlippageOptIn"],optimisticUpdates:()=>[Ue,"optimisticUpdates"],autoSlippageMigrationVersion:()=>[Ue,"autoSlippageMigrationVersion"]};n();s();var Ul=(r=>(r[r.Always=1/0]="Always",r[r.Short=Q({days:1})]="Short",r[r.Medium=Q({days:3})]="Medium",r[r.Long=Q({days:7})]="Long",r))(Ul||{}),Xg=(o=>(o[o.Immediate=0]="Immediate",o[o.Short=Q({minutes:1})]="Short",o[o.Medium=Q({minutes:2.5})]="Medium",o[o.Long=Q({minutes:60})]="Long",o[o.Never=1/0]="Never",o))(Xg||{}),Ts=(t=>(t[t.Short=Q({seconds:20})]="Short",t[t.Medium=Q({minutes:2.5})]="Medium",t[t.Long=Q({minutes:5})]="Long",t))(Ts||{});var Jg=async({callerAddress:e,contractAddress:A,networkId:j,sellAmount:t,allowanceTarget:r,approvalExactAmount:o,exchangeAddress:i,value:a,transactionData:u,type:c})=>{let l=[],m=[];if(A&&(await Nk({callerAddress:e,spender:r,networkId:j,contractAddress:A})).lt(o??t.toString())){let f=await Lk({callerAddress:e,spender:r,networkId:j,contractAddress:A,exactAmount:o});l.push(f),m.push(`${c}-approval`)}let B=po.parse({type:"0x2",from:e,data:u,chainId:I.getEVMNetworkIDValue(j),to:i,...a==="0"?{}:{value:`0x${new U(a).toString(16)}`}});return l.push(B),m.push(c),{transactions:l,transactionTypes:m}},Ps=async({networkId:e,callerAddress:A,quote:j})=>{let{sellAmount:t,steps:r}=j,o=[],i=[],a=[];for(let u of r){let{allowanceTarget:c,exchangeAddress:l,value:m,transactionData:B,sellToken:k,buyToken:f,approvalMetadata:g}=u,E=k.resourceType==="address"?k.address:null,h=I.compareNetworkID(k.chainId,f.chainId)===0?"swap":"bridge";if(!c||!l||!B||!m)throw new Error("Missing bridge step data for EVM bridge quote.");let y=await Jg({callerAddress:A,contractAddress:E,networkId:e,sellAmount:t,allowanceTarget:c,approvalExactAmount:u.approvalExactAmount,exchangeAddress:l,value:m,transactionData:B,type:h});o.push(...y.transactions),i.push(...y.transactionTypes),a.push({sellToken:k,buyToken:f,approvalMetadata:g}),y.transactionTypes.length==2&&y.transactionTypes.find(F=>F.includes("approval"))&&a.push({sellToken:k,buyToken:f,approvalMetadata:g})}return{type:"evm",transactions:o,transactionTypes:i,transactionPairs:a}},Gs=async({quote:e,connection:A})=>{let j=[],t=[],r=[];for(let o of e.steps){let{transactionData:i,sellToken:a,buyToken:u}=o,c=I.compareNetworkID(a.chainId,u.chainId)===0?"swap":"bridge",l=await Yg(i,A);j.push(Zc.serialize(l).transaction),t.push(c),r.push({sellToken:a,buyToken:u})}return{type:"solana",transactions:j,transactionTypes:t,transactionPairs:r}},Cs=async({networkId:e,callerAddress:A,quote:j,sellFungible:t})=>{let r=t.type==="ERC20"&&t?.data.tokenAddress?t.data.tokenAddress:null,{allowanceTarget:o,exchangeAddress:i,sellAmount:a,value:u}=j;return{type:"evm",...await Jg({callerAddress:A,contractAddress:r,networkId:e,sellAmount:a,allowanceTarget:o,exchangeAddress:i,value:u,transactionData:j.transactionData,type:"swap"})}},Os=async({quote:e})=>{let A=[],j=[],t=[];for(let r of e.steps){let{transactionData:o,sellToken:i,buyToken:a}=r,u=I.compareNetworkID(i.chainId,a.chainId)===0?"swap":"bridge";A.push(o),j.push(u),t.push({sellToken:i,buyToken:a})}return{type:"sui",transactions:A,transactionTypes:j,transactionPairs:t}},Yg=async(e,A)=>{let j=pe(e,"bs58");return await wo(j,{connection:A,transactionType:"Swap"})},Ho=async({quote:e,connection:A})=>{let j=e.transactionData.map(i=>Yg(i,A)),r=(await Promise.all(j)).map(i=>Zc.serialize(i).transaction);return{type:"solana",transactionTypes:r.map(()=>"swap"),transactions:r}},Zg=async({quote:e,connection:A})=>Ho({quote:e,connection:A}),Ms=async({quote:e})=>({type:"sui",transactionTypes:Array(e.transactionData.length).fill("swap"),transactions:e.transactionData}),Jj=({callerAddress:e,sellFungible:A,quote:j})=>{let{connection:t}=cj(),r=uA.transactions(j);return X({queryKey:r,enabled:!!j&&!!A,gcTime:0,staleTime:0,refetchInterval:Ts.Short,async queryFn(){try{if(!j)throw new Error("Missing quote");if(!A)throw new Error("Missing sell token");let o=A.data.chain.id;if(Wj(j)){if(I.isEVMNetworkID(o)&&Ze(j))return await Cs({networkId:o,callerAddress:e,quote:j,sellFungible:A});if(I.isSolanaNetworkID(o)&&Ke(j))return Ho({quote:j,connection:t});if(I.isSuiNetworkID(o)&&kt(j))return Ms({quote:j});throw new Error(`Single network swap quote not supported for network ID ${o}`)}if(dA(j)){if(I.isEVMNetworkID(o))return await Ps({networkId:o,callerAddress:e,quote:j});if(I.isSolanaNetworkID(o))return await Gs({quote:j,connection:t});if(I.isSuiNetworkID(o))return await Os({quote:j});throw new Error(`Bridge quote not supported for network ID ${o}`)}throw new Error("Swap quote type not supported")}catch(o){throw o instanceof Error&&b.captureError(o,"swapper"),o}}})};n();s();n();s();var Qo=e=>e.steps.map(A=>A.tool);var OA=e=>e?dA(e)?Qo(e):e?.sources??[]:[];function jE({sender:e}){let{t:A}=hA(),{currentQuote:j}=aA(),t=$(m=>m.buyFungible),r=$(m=>m.sellFungible),o=Uo(OA(j)),{data:i}=Jj({callerAddress:e,quote:j,sellFungible:r}),a=i?.transactionPairs?.flatMap(m=>[...Fr(m.sellToken)??[],...Fr(m.buyToken)??[]])??[],u=[...new Set(a)],{fungibles:c}=uj({keys:u});return{pendingActivityRows:(0,eE.useMemo)(()=>Bt({swapTransactions:i,sellFungible:r,buyFungible:t,fungibles:c,t:A,currentQuote:j,provider:o}),[i,r,t,c,A,j,o])}}function Bt({swapTransactions:e,sellFungible:A,buyFungible:j,fungibles:t,currentQuote:r,provider:o,t:i}){let a={pendingSwapActivityRows:[],pendingApprovalActivityRows:[]};return e?e.type==="evm"?e.transactionTypes.reduce((u,c,l)=>{let m=A,B=j,k,f=e.transactionPairs;if(f&&f[l]){let g=f[l];m=Wa(g.sellToken,t)??A,B=Wa(g.buyToken,t)??j,k=g.approvalMetadata}if(c.includes("approval")){let g=m?.data.symbol??"";u.pendingApprovalActivityRows.push({topLeft:k?{text:`${i("transactionsPendingApproving")} ${k.symbol}`}:{text:`${i("transactionsPendingApproving")} ${g}`}})}else m&&B&&u.pendingSwapActivityRows.push(AE({sellFungible:m,buyFungible:B,sellAmount:r?.sellAmount,buyAmount:r?.buyAmount,provider:o,isBridge:c.includes("bridge"),t:i}));return u},a):e.transactionTypes.reduce((u,c,l)=>{let m=A,B=j,k=e.transactionPairs;if(k&&k[l]){let f=k[l];m=Wa(f.sellToken,t)??A,B=Wa(f.buyToken,t)??j}return m&&B&&u.pendingSwapActivityRows.push(AE({sellFungible:m,buyFungible:B,sellAmount:r?.sellAmount,buyAmount:r?.buyAmount,provider:o,isBridge:c.includes("bridge"),t:i})),u},a):a}var AE=({sellFungible:e,buyFungible:A,sellAmount:j,buyAmount:t,provider:r,isBridge:o,t:i})=>{let a=e.data.symbol,u=A.data.symbol,c=mA(j??0,e.data.decimals??0),l=mA(t??0,A.data.decimals??0);return{topLeft:{text:`${i(o?"transactionsPendingBridging":"transactionsPendingSwapping")} on ${r}`},topRight:{text:`${l} ${u}`,color:"spotPositive"},bottomLeft:{text:`${a} \u2192 ${u}`},bottomRight:{text:`${c} ${a}`}}},Wa=(e,A)=>A.find(j=>(Fr(e)??[]).includes(j.data.key));var Ja=class{constructor(A,j,t,r,o,i,a,u){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i;this.authRepository=a;this.cashAccount=u}async createTransaction(){return Zg({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){let i=j.transactions[0],a=pe(i,"bs58"),u=Hm(a),c=a.message.header.numRequiredSignatures,l=u.slice(0,c),m=this.cashAccount?.addressDetails.address;if(!m)throw new Error("Cash account address not found");let B=l.some(y=>y.toBase58()===m),k=B?m:this.takerAddress,f=await this.authRepository?.getUser();if(!f)throw new Error("User not found for swap");let{accessToken:g,userID:E}=f,h=await xs({unsignedTransaction:i,vaultProxy:r,accountIdentifier:A,signerAddress:k,idempotencyKey:this.executionId,isCash:B,accessToken:g,userID:E,skipActivityRecording:!1,swapInfo:this.getSwapInfo(this.executingQuote,this.quote),waitForActivityState:"completed"});return b.addBreadcrumb("cashTransfer","Broadcasted transaction","info"),{id:h,networkID:this.networkId}}async waitForConfirmation(A){let j=Dt(A.networkID);await Hj({connection:j,signature:A.id})}parsePendingActivity(A,j){let t=IA(OA(A.quote));return Bt({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}getSwapInfo(A,j){let t=A.sell,r=A.buy,o=A.quoteInput,i=t.data.walletAddress,a=r.data.walletAddress;if(!i&&o?.taker){let u=TA(o?.taker);u.resourceType==="address"&&(i=u.address)}if(!a&&o?.takerDestination){let u=TA(o?.takerDestination);u.resourceType==="address"&&(a=u.address)}return{input:{owner:i,mint:t.data.tokenAddress??"",amount:j.sellAmount,symbol:t.data.symbol??void 0,name:t.data.name??void 0,decimals:t.data.decimals,logoUri:t.data.logoUri??void 0},output:{owner:a,mint:r.data.tokenAddress??"",amount:j.buyAmount,symbol:r.data.symbol??void 0,name:r.data.name??void 0,decimals:r.data.decimals,logoUri:r.data.logoUri??void 0}}}};n();s();var Ya=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.evmSwapCommand=i}createTransaction(){return Ps({networkId:this.networkId,callerAddress:this.takerAddress,quote:this.quote})}async swap(A,j,t,r,o){return this.evmSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.evmSwapCommand.waitForConfirmation(A)}};n();s();n();s();var lq=1.3,dq=e=>{switch(e){case oA.Ethereum.Mainnet:case oA.Ethereum.Sepolia:return 8e5;case oA.Polygon.Mainnet:case oA.Polygon.Amoy:return 5e5;case oA.Base.Mainnet:case oA.Base.Sepolia:return 5e5;case oA.Arbitrum.Mainnet:case oA.Arbitrum.Sepolia:return 5e5;default:return 0}},mq=e=>{switch(e){case oA.Ethereum.Mainnet:case oA.Ethereum.Sepolia:return 6e4;case oA.Polygon.Mainnet:case oA.Polygon.Amoy:return 6e4;case oA.Base.Mainnet:case oA.Base.Sepolia:return 6e4;case oA.Arbitrum.Mainnet:case oA.Arbitrum.Sepolia:return 6e4;default:return 0}},kq=(e,A)=>e.steps.flatMap(t=>t.gasCosts??[dq(A)]),Bq=(e,A,j)=>{let t=Ze(A)?[A.gas]:kq(A,j);return e?e.transactionTypes.map(r=>r.includes("approval")?mq(j):t.shift()??0):t},zt={estimateGas:({swapTransactions:e,evmGasEstimation:A,currentQuote:j,scanResult:t,networkID:r,includeGasBuffer:o,gasBuffer:i})=>{let{maxFeePerGas:a,maxPriorityFeePerGas:u}=A,c=Bq(e,j,r),l=t?.advancedDetails?.gas;return t?.advancedDetails?.gasLimit>0&&(c=l),c.map(B=>({maxFeePerGas:a,maxPriorityFeePerGas:u,networkID:r,gasLimit:new S(B).multipliedBy(o?i??lq:1).integerValue(S.ROUND_CEIL)}))}};n();s();var fq=({networkID:e,unsignedTransaction:A,pendingActivityRows:j,accountIdentifier:t,accountSigner:r,storage:o,includeCallPayload:i})=>({accountSigner:r,accountIdentifier:t,networkID:e,unsignedTransaction:A,...i&&{callPayload:{from:A.from,to:A.to,data:A.data,value:A.value}},pendingTransactionInput:{ownerAddress:A.from,networkID:e,data:{nonce:"",unsignedTransaction:A,hash:""},type:"swap",display:{summary:j}},storage:o}),Za=async({transactions:e,transactionTypes:A,networkID:j,gasEstimation:t,pendingApprovalActivityRows:r,pendingSwapActivityRows:o,accountIdentifier:i,accountSigner:a,storage:u})=>{let c=!0,l="";for(let[m,B]of e.entries()){let k=t[m],f={gas:`0x${k.gasLimit.toString(16)}`,maxFeePerGas:`0x${k.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${k.maxPriorityFeePerGas.toString(16)}`},g=po.parse({...B,...f}),h=A[m].includes("approval")?r:o,y=fq({networkID:j,accountIdentifier:i,pendingActivityRows:h.shift(),accountSigner:a,storage:u,unsignedTransaction:g,includeCallPayload:c});try{l="",l=await Kk(y)}catch(F){return{signature:l,error:F instanceof Error?F:new Error("Failed to process EVM swap transaction")}}c&&(c=!1)}return{signature:l}};var tE="standard",A6=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.gasEstimation=i}createTransaction(){return Cs({quote:this.quote,callerAddress:this.takerAddress,networkId:this.networkId,sellFungible:this.executingQuote.sell})}async swap(A,j,t,r,o){let i=this.gasEstimation??await this.estimateGas(this.quote,this.executingQuote.response,tE,j,t);if(!i)throw new Error(`No gas estimation found for ${tE}`);let a=this.parsePendingActivity(this.executingQuote,j),{signature:u,error:c}=await b.startSpan("Process EVM Swap Txns",()=>Za({transactions:j.transactions,transactionTypes:j.transactionTypes,networkID:this.networkId,gasEstimation:i,pendingSwapActivityRows:a.pendingSwapActivityRows,pendingApprovalActivityRows:a.pendingApprovalActivityRows,accountIdentifier:A,accountSigner:r,storage:o}));if(c)throw c;return{networkID:this.networkId,id:u}}async waitForConfirmation(A){await Ok(A.networkID,A.id)}async estimateGas(A,j,t,r,o){let i=await So(this.networkId,!0);if(!i)return;let a=i[t];if(!a)return;let u={networkID:this.networkId,gasLimit:new U(1),maxFeePerGas:a.maxFeePerGas,maxPriorityFeePerGas:a.maxPriorityFeePerGas};return zt.estimateGas({swapTransactions:r,evmGasEstimation:u,currentQuote:A,scanResult:o??void 0,includeGasBuffer:!0,networkID:this.networkId,gasBuffer:j.gasBuffer})}parsePendingActivity(A,j){let t=IA(OA(A.quote));return Bt({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};n();s();var rE=q(_m());n();s();n();s();var gq=({networkID:e,transaction:A,feePayer:j,connection:t,pendingActivityRows:r,accountIdentifier:o,accountSigner:i,storage:a})=>({accountSigner:i,accountIdentifier:o,transaction:A,feePayer:j,connection:t,opts:{skipPreflight:!0},pendingTransactionInput:{ownerAddress:j.toBase58(),networkID:e,data:{signature:""},type:"swap",display:{summary:r}},storage:a}),j6=async({callerAddress:e,connection:A,networkID:j,transactions:t,pendingSwapActivityRows:r,accountIdentifier:o,accountSigner:i,storage:a})=>{let u=new kA.PublicKey(e),c="";for(let[l,m]of t.entries()){let B=pe(m,"bs58"),k=gq({networkID:j,transaction:B,feePayer:u,connection:A,pendingActivityRows:r[l],accountIdentifier:o,accountSigner:i,storage:a});try{c="",c=await Io(k),l!==t.length-1&&await Hj({connection:A,signature:c})}catch(f){return{signature:c??"",error:f instanceof Error?f:new Error("Failed to process solana swap transaction")}}}return{signature:c??""}};var Yj=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i}async createTransaction(){return Ho({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){let i=this.parsePendingActivity(this.executingQuote,j),{signature:a,error:u}=await j6({callerAddress:this.takerAddress,connection:this.connection,networkID:this.networkId,transactions:j.transactions,pendingSwapActivityRows:i.pendingSwapActivityRows,accountIdentifier:A,accountSigner:r,storage:o});if(u)throw u;return{networkID:this.networkId,id:a}}async waitForConfirmation(A){let j=Dt(A.networkID);await Hj({connection:j,signature:A.id})}parsePendingActivity(A,j){let t=IA(OA(A.quote));return Bt({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};var Eq=p.object({signature:p.string()}),t6=class extends Yj{constructor(j,t,r,o,i,a,u){super(j,t,r,o,i,a);this.executingQuote=j;this.takerAddress=t;this.networkId=r;this.quote=o;this.executionId=i;this.connection=a;this.gaslessSignature=u}async swap(j,t,r,o,i){let a=this.quote.transactionData[0];if(!a)throw new Error("No transaction data found in quote");let u=new kA.PublicKey(this.takerAddress),l=this.parsePendingActivity(this.executingQuote,t).pendingSwapActivityRows[0];if(!l)throw new Error("Unable to create pending activity for gasless");let m=await ua({accountIdentifier:j,feePayer:u,connection:this.connection,accountSigner:o,transaction:pe(a,"bs58"),pendingTransactionInput:{ownerAddress:u.toBase58(),networkID:this.networkId,data:{signature:this.gaslessSignature},type:"swap",display:{summary:l}},storage:i,opts:{}});return{id:(await this.submitGaslessSwap(this.gaslessSignature,m)).signature,networkID:this.networkId}}async submitGaslessSwap(j,t){let r=await N.api().post("/gasless-swap/v1/submit",{quoteSignature:j,encoding:"bs58",chainId:this.networkId,transaction:rE.default.encode(t.serialize())}),o=Eq.safeParse(r.data);if(!o.success)throw new Error("Failed to submit gasless swap");return o.data}};n();s();var yq=p.object({quoteId:p.string(),transactionId:p.string()}),r6=class extends Yj{constructor(j,t,r,o,i,a){super(j,t,r,o,i,a);this.executingQuote=j;this.takerAddress=t;this.networkId=r;this.quote=o;this.executionId=i;this.connection=a}async swap(j,t,r,o,i){let a=this.quote.transactionData[0];if(!a)throw new Error("No transaction data found in quote");let u=new kA.PublicKey(this.takerAddress),l=this.parsePendingActivity(this.executingQuote,t).pendingSwapActivityRows[0];if(!l)throw new Error("Unable to create pending activity for rfq");let m=await ua({accountIdentifier:j,feePayer:u,connection:this.connection,accountSigner:o,transaction:pe(a,"bs58"),pendingTransactionInput:{ownerAddress:u.toBase58(),networkID:this.networkId,data:{signature:""},type:"swap",display:{summary:l}},storage:i,opts:{}});return{id:(await this.submitRFQSwap(m)).transactionId,networkID:this.networkId}}async submitRFQSwap(j){let t=Buffer.from(j.serialize()).toString("base64"),r=await N.api().post("/v0/rfq/swap",{chainId:this.networkId,quoteId:this.quote.rfqProps?.quoteId,signedPayload:t},{headers:{"X-Request-Id":this.executionId}}),o=yq.safeParse(r.data);if(!o.success)throw new Error("Failed to submit rfq swap");return o.data}};n();s();var o6=class{constructor(A,j,t,r,o,i){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.connection=i;this.solanaSwapCommand=new Yj(A,j,t,A.quote,o,i)}solanaSwapCommand;createTransaction(){return Gs({quote:this.quote,connection:this.connection})}async swap(A,j,t,r,o){return this.solanaSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.solanaSwapCommand.waitForConfirmation(A)}};n();s();n();s();n();s();var hq=({networkID:e,transaction:A,feePayer:j,pendingActivityRows:t,accountIdentifier:r,accountSigner:o,storage:i})=>({accountSigner:o,accountIdentifier:r,transaction:A,pendingTransactionInput:{ownerAddress:j,networkID:e,data:{digest:""},type:"swap",display:{summary:t}},storage:i}),n6=async({callerAddress:e,networkID:A,transactions:j,pendingSwapActivityRows:t,accountIdentifier:r,accountSigner:o,storage:i})=>{let a="";for(let[u,c]of j.entries()){let l=hq({networkID:A,transaction:bo.deserializeTransactionString(c),feePayer:e,pendingActivityRows:t[u],accountIdentifier:r,accountSigner:o,storage:i});try{a=(await Uk(l)).digest,u!==j.length-1&&await pa(A,a)}catch(m){return{signature:a??"",error:m instanceof Error?m:new Error("Failed to process sui swap transaction")}}}return{signature:a??""}};var zo=class{constructor(A,j,t,r,o){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o}async createTransaction(){return Ms({quote:this.quote})}async swap(A,j,t,r,o){let i=this.parsePendingActivity(this.executingQuote,j),{signature:a,error:u}=await n6({callerAddress:this.takerAddress,networkID:this.networkId,transactions:j.transactions,pendingSwapActivityRows:i.pendingSwapActivityRows,accountIdentifier:A,accountSigner:r,storage:o});if(u)throw u;return{networkID:this.networkId,id:a}}async waitForConfirmation(A){await pa(this.networkId,A.id)}parsePendingActivity(A,j){let t=IA(OA(A.quote));return Bt({swapTransactions:j,sellFungible:A.sell,buyFungible:A.buy,fungibles:[],currentQuote:A.quote,provider:t,t:T.t})}};var s6=class{constructor(A,j,t,r,o){this.executingQuote=A;this.takerAddress=j;this.networkId=t;this.quote=r;this.executionId=o;this.suiSwapCommand=new zo(A,j,t,A.quote,o)}suiSwapCommand;async createTransaction(){return Os({quote:this.quote})}async swap(A,j,t,r,o){return this.suiSwapCommand.swap(A,j,t,r,o)}async waitForConfirmation(A){return this.suiSwapCommand.waitForConfirmation(A)}};var i6=class{create(A,j,t,r,o,i,a){if(Ig(A.quote)&&(HA(A.buy)||HA(A.sell)))return new Ja(A,j,t,A.quote,Aj(),r,o,i);if(I.isSolanaNetworkID(t)&&Ke(A.quote)){let u=new Yj(A,j,t,A.quote,Aj(),r);return A.quote.rfqProps?new r6(A,j,t,A.quote,Aj(),r):A.quote.gaslessSignature?new t6(A,j,t,A.quote,Aj(),r,A.quote.gaslessSignature):u}else{if(I.isEVMNetworkID(t)&&Ze(A.quote))return this.createEvmSwapCommand(A,j,t,a);if(I.isSuiNetworkID(t)&&kt(A.quote))return new zo(A,j,t,A.quote,Aj());if(dA(A.quote)){if(I.isSolanaNetworkID(t))return new o6(A,j,t,A.quote,Aj(),r);if(I.isEVMNetworkID(t)){let u=this.createEvmSwapCommand(A,j,t,a);return new Ya(A,j,t,A.quote,Aj(),u)}else if(I.isSuiNetworkID(t))return new s6(A,j,t,A.quote,Aj())}}throw new Error("Unsupported SwapQuote}")}createEvmSwapCommand(A,j,t,r){let o=r?r.filter(sa):void 0;return o&&o.length===0&&(o=void 0),new A6(A,j,t,A.quote,Aj(),o)}};n();s();n();s();var Rs={name:"SwapperNoQuotes",message:"No quotes found"},Xo=class extends jB{createStreamUrl({amount:A,amountUsd:j,buy:t,sell:r,taker:o,takerDestination:i,slippageTolerance:a,exactOut:u,autoSlippage:c,priorityFee:l,tipAmount:m,isLedger:B,phantomCashAccount:k}){let f=new URLSearchParams({taker:o,takerDestination:i,buyToken:M(V(t)),sellToken:M(V(r)),sellAmount:A,sellAmountUsd:j??"",exactOut:u?"true":"false",autoSlippage:c?"true":"false",clientEnableGaslessSwap:"true",phantomCashAccount:k?"true":"false"});return a&&f.set("slippageTolerance",String(a)),l&&f.set("priorityFee",String(l)),m&&f.set("tipAmount",String(m)),B!==void 0&&f.set("isLedger",String(B)),`${this.getApiEnvironment()}/swap/v2/stream/quotes?${f.toString()}`}handleNewQuoteResponse(A,j){let t=this.safeJsonParse(A);if(!t.success||!t.data){j({type:"error",errorResponse:Rs});return}try{let r=this.parseSwapQuotesResponse(t.data);j({type:"newQuoteResponse",quoteResponse:r})}catch{j({type:"error",errorResponse:Rs})}}handleErrorQuoteResponse(A,j){let t=this.safeJsonParse(A);if(!t.success||!t.data){j({type:"error",errorResponse:Rs});return}try{let r=Ra.safeParse(t.data);j({type:"error",errorResponse:r.success?r.data:Rs})}catch{j({type:"error",errorResponse:Rs})}}parseSwapQuotesResponse(A){let j=new DA({key:"SwapperNoQuotes"});if(ws.safeParse(A?.type).success===!1)throw b.captureError(new Error("Failed to parse a valid quote type."),"swapper"),new Error("Invalid input");let t=bs.safeParse(A);if(!t.success)throw b.captureError(new Error("Failed to parse a valid swap quotes response."),"swapper"),j;if(t.data.includesAllProviders&&t.data.quotes.length===0)throw j;return t.data}};var a6=class extends Xo{eventSource;open(A,j){this.close();let t=this.createStreamUrl(A);this.eventSource=new ka(t,this.getOptionsWithAuth(t));let r=o=>{switch(o.type){case"new-quote-response":this.handleNewQuoteResponse(o.data,j);break;case"error-quote-response":this.handleErrorQuoteResponse(o.data,j);break;case"open":j({type:"open"});break;case"error":j({type:"error",errorResponse:{name:"UnknownError",message:o.message}});break;case"close":j({type:"close"});break}};this.eventSource.addEventListener("new-quote-response",r),this.eventSource.addEventListener("error-quote-response",r),this.eventSource.addEventListener("open",r),this.eventSource.addEventListener("error",r),this.eventSource.addEventListener("close",r)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};n();s();var p6=class extends Xo{eventSource;open(A,j){this.close();let t=this.createStreamUrl(A);this.eventSource=new ka(t,this.getOptionsWithAuth(t));let r=o=>{switch(o.type){case"new-quote-response":this.handleNewQuoteResponse(o.data,j);break;case"error-quote-response":this.handleErrorQuoteResponse(o.data,j);break;case"open":j({type:"open"});break;case"error":j({type:"error",errorResponse:{name:"UnknownError",message:o.message}});break;case"close":j({type:"close"});break}};this.eventSource.addEventListener("new-quote-response",r),this.eventSource.addEventListener("error-quote-response",r),this.eventSource.addEventListener("open",r),this.eventSource.addEventListener("error",r),this.eventSource.addEventListener("close",r)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};n();s();var c6=class{constructor(A){this.producer=A}listeners=new Set;openStream(A){this.listeners.forEach(j=>j.onEvent({type:"openRequested"})),this.producer.close(),this.producer.open(A,j=>{this.listeners.forEach(t=>t.onEvent(j)),j.type==="error"&&this.closeStream()})}closeStream(){this.producer.close()}subscribe(A){this.listeners.add(A)}unsubscribe(A){this.listeners.delete(A)}};n();s();n();s();var vA=(e,A)=>!!e&&!!A&&I.compareNetworkID(e,A)!==0;n();s();n();s();var oE=q(P());n();s();function ne({key:e,queryKey:A,defaultValue:j=null}){let t=yA();return X({enabled:!0,queryKey:A,gcTime:Ul.Long,staleTime:1/0,async queryFn(){try{return await t.get(e)}catch(r){return r instanceof Error&&b.captureError(r,"swapper"),j}}})}function ce({key:e,queryKey:A}){let j=yA(),t=cA();return wA({async mutationFn(r){try{return await j.set(e,r)}catch(o){o instanceof Error&&b.captureError(o,"swapper");return}},async onMutate(r){await t.cancelQueries({queryKey:A});let o=t.getQueryData(A);return t.setQueryData(A,r),{previousValue:o}},onError(r,o,i){t.setQueryData(A,i?.previousValue)}})}var Fq={type:"auto"},MA=()=>{let{slippageSetting:e,isFetched:A,save:j}=Sq();return{isFetched:A,selectedSetting:e??Fq,setSlippageSetting:j}},Sq=()=>{let{data:e,isFetched:A}=ne({key:"slippageSettings",queryKey:uA.slippageSettings()}),{mutateAsync:j}=ce({key:"slippageSettings",queryKey:uA.slippageSettings()}),t=(0,oE.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,slippageSetting:e,save:t}};n();s();async function Wo({transactions:e,locale:A,url:j,deviceId:t,takerAddress:r,networkId:o,slippageType:i,quote:a,quoteResponse:u,isSimulationKilled:c}){try{return c?{status:"skipped"}:{status:"success",result:await la(A,t,{type:"transaction",userAccount:r,params:wq(e),url:j,networkID:o,context:dA(a)?"bridge":$g(a)?"gaslessSwap":"swap",provider:bq(a),slippageType:i,metadata:{swapper:{quoteOutputAmount:a.buyAmount,quoteOutputToken:M(u.buyToken),quoteInputAmount:a.sellAmount,quoteInputToken:M(u.sellToken)}}})}}catch(l){return{status:"error",error:l}}}var wq=e=>{switch(e.type){case"evm":return{transactions:e.transactions};case"solana":return{transactions:e.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}};case"sui":return{transactions:e.transactions,method:"signAndSendTransaction"}}},bq=e=>{let A=dA(e)?Qo(e):e?.sources??[];return IA(A)};n();s();n();s();function ej(e,A,j){if(A.lte(0))return null;let t=M({chainId:e,resourceType:"nativeToken",slip44:I.getSlip44(e)}),r=I.getTokenDecimals(e),o=I.getTokenSymbol(e);if(!t||!r||!o)return null;let i=A.div(yr(r)),a=j[t];return a?.usd?i.times(a.usd).toNumber():null}var Iq={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"};function $q(e,A){return{type:e,amountUsd:new S(A.amountUSD??0),amount:new S(A.amount??0)}}function Jo(e){return e.steps.flatMap(j=>j.includedFeeCosts).reduce((j,t)=>{if(!t)return j;let r=Iq[t.name];return r&&new S(t.amount).gt(0)&&j.push($q(r,t)),j},[])}function Yo(e,A,j){let t=e.steps.reduce((r,o)=>r.plus(o.nonIncludedNonGasFees),new S(0));return t.isZero()?[]:[{type:"nonIncludedNonGas",amountUsd:new S(ej(A,t,j)??0),amount:t}]}var u6=class{constructor(A,j,t,r,o){this.networkID=A;this.account=j;this.priceClient=t;this.quoteInput=r;this.quoteResponse=o}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.calculateNetworkFee(t,A,r,j),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}createSwapTransactions(A){return Ps({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:A})}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new S(t.percentage),amountUsd:new S(0),amount:new S(0)}]:A}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}async calculateNetworkFee(A,j,t,r){let o=await this.estimateGas(j,A,r);if(!o)throw new Error("Unable to estimate gas");if(!t.usd)throw new Error("Price data not found");let i=o[0],a=I.getTokenDecimals(this.networkID),u=i.gasLimit.times(i.maxFeePerGas);return{type:"evmGas",amountUsd:new S(u).shiftedBy(-a).times(t.usd),amount:u}}async estimateGas(A,j,t){let r=await So(this.networkID,!0);if(!r)return;let o=r.standard;if(!o)return;let i={networkID:this.networkID,gasLimit:new S(1),maxFeePerGas:o.maxFeePerGas,maxPriorityFeePerGas:o.maxPriorityFeePerGas},a=await Wo({transactions:j,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?"auto":"fixed",quote:A,quoteResponse:this.quoteResponse,isSimulationKilled:t});return zt.estimateGas({swapTransactions:j,evmGasEstimation:i,currentQuote:A,scanResult:a.status==="success"?a.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let A=this.account.addresses.find(t=>t.networkID===this.networkID);if(!A)throw new Error(`No address found for chain ${this.networkID}`);let j={...A};return mo(j)&&(j.address=j.address.toLowerCase()),j}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};n();s();var l6=class{constructor(A,j,t,r,o){this.networkID=A;this.account=j;this.priceClient=t;this.quoteInput=r;this.quoteResponse=o}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.calculateNetworkFee(t,A,j),o=this.appendPhantomFee([r],A);return{quote:A,fees:{totalFees:this.sumFees(o),fees:o},swapTransactions:t}}createSwapTransactions(A){return Cs({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:A,sellFungible:this.quoteInput.sell})}appendPhantomFee(A,j){let t=j.fees.find(r=>r.type==="phantom");return t?[...A,{type:"phantom",percentage:new S(t.percentage),amountUsd:new S(0),amount:new S(0)}]:A}async calculateNetworkFee(A,j,t){let r=await this.estimateGas(j,A,t);if(!r)throw new Error("Unable to estimate gas");let o=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!o.usd)throw new Error("Price data not found");let i=r[0],a=I.getTokenDecimals(this.networkID),u=i.gasLimit.times(i.maxFeePerGas);return{type:"evmGas",amountUsd:new S(u).shiftedBy(-a).times(o.usd),amount:u}}async estimateGas(A,j,t){let r=await So(this.networkID,!0);if(!r)return;let o=r.standard;if(!o)return;let i={networkID:this.networkID,gasLimit:new S(1),maxFeePerGas:o.maxFeePerGas,maxPriorityFeePerGas:o.maxPriorityFeePerGas},a=await Wo({transactions:j,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?"auto":"fixed",quote:A,quoteResponse:this.quoteResponse,isSimulationKilled:t});return zt.estimateGas({swapTransactions:j,evmGasEstimation:i,currentQuote:A,scanResult:a.status==="success"?a.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let A=this.account.addresses.find(t=>t.networkID===this.networkID);if(!A)throw new Error(`No address found for chain ${this.networkID}`);let j={...A};return mo(j)&&(j.address=j.address.toLowerCase()),j}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};n();s();var d6=class{constructor(A,j,t){this.networkID=A;this.priceClient=j;this.connection=t}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.calculateNetworkFee(t,r),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}createSwapTransactions(A){return Gs({quote:A,connection:this.connection})}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new S(t.percentage),amountUsd:new S(0),amount:new S(0)}]:A}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}async calculateNetworkFee(A,j){if(!j.usd)throw new Error("Price data not found");let t=A.transactions.map(c=>this.processEncodedTx(c,this.networkID,this.connection)),o=(await Promise.all(t)).map(c=>c.networkFeeEstimation.value),i=new S(o[0]);return{type:"solanaNetwork",amountUsd:i.div(new S(kA.LAMPORTS_PER_SOL)).times(j.usd),amount:i}}async processEncodedTx(A,j,t){let r=pe(A,"bs58");return await co(r,t),{networkFeeEstimation:await ca(j,[r.message])}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};n();s();n();s();function nE(e,A){return vq(e.fees,j=>{switch(j.type){case"gasless":return{type:"gasless",amountUsd:new S(0),amount:new S(0),percentage:new S(j.percentage)};case"phantom":return{type:"phantom",percentage:new S(j.percentage),amountUsd:new S(0),amount:new S(0)};case"ata":return new S(j.amount).isZero()?void 0:{type:"ata",amountUsd:new S(j.amount),amount:new S(0)};case"gasless_network":return{type:"solanaGaslessNetwork",amountUsd:new S(j.amount),amount:new S(0)};case"network":{let{amountUsd:t,amount:r}=Hl(j,A);return{type:"solanaNetwork",amountUsd:t,amount:r}}case"tips":{let{amountUsd:t,amount:r}=Hl(j,A);return{type:"tips",amountUsd:t,amount:r}}case"priority_fee":{let{amountUsd:t,amount:r}=Hl(j,A);return{type:"priorityFee",amountUsd:t,amount:r}}default:return}})}function Hl(e,A){let j=new S(e.amount);return{amountUsd:j.div(new S(kA.LAMPORTS_PER_SOL)).times(A),amount:j}}function vq(e,A){return e.reduce((j,t,r)=>{let o=A(t,r,e);return o!=null&&j.push(o),j},[])}var sE=["solanaNetwork","tips","priorityFee"],m6=class{constructor(A,j,t){this.networkID=A;this.priceClient=j;this.connection=t}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let r=(await this.priceClient.getPrice(this.getNativeTokenCaip19())).usd;if(!r)throw new Error(`Price data not found for native token ${this.getNativeTokenCaip19()}`);let o=await this.createSwapTransactions(A),i=nE(A,r),a=await this.processParsedFees(i,r);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:o}}async processParsedFees(A,j){if(A.find(u=>u.type==="solanaGaslessNetwork"))return A;let t=A.filter(u=>!sE.includes(u.type)),r=A.filter(u=>sE.includes(u.type)),o=A.find(u=>u.type==="priorityFee"),i=await this.calculateNetworkFee(o,j),a=this.sumNetworkFees(i,r);return[...t,a]}sumNetworkFees(A,j){return j.reduce((t,r)=>({...t,amount:t.amount.plus(r.amount),amountUsd:t.amountUsd.plus(r.amountUsd)}),A)}createSwapTransactions(A){return Ho({quote:A,connection:this.connection})}getAmountsFromNativeAmount(A,j){let t=new S(A.amount);return{amountUsd:t.div(new S(kA.LAMPORTS_PER_SOL)).times(j),amount:t}}async calculateNetworkFee(A,j){let t=new S(A?.amount??0);return{type:"solanaNetwork",amountUsd:t.div(new S(kA.LAMPORTS_PER_SOL)).times(j),amount:t}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};n();s();n();s();var Zo=class{constructor(A,j){this.networkID=A;this.priceClient=j}getNativeTokenCaip19(){return M({chainId:this.networkID,resourceType:"nativeToken",slip44:I.getSlip44(this.networkID)})}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.calculateNetworkFee(t),o=this.appendPhantomFee([r],A);return{quote:A,fees:{totalFees:this.sumFees(o),fees:o},swapTransactions:t}}createSwapTransactions(A){return Ms({quote:A})}appendPhantomFee(A,j){let t=j.fees.find(r=>r.type==="phantom");return t?[...A,{type:"phantom",percentage:new S(t.percentage),amountUsd:new S(0),amount:new S(0)}]:A}async calculateNetworkFee(A){let j=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!j.usd)throw new Error("Price data not found");let t=new S(0),r=new S(0);try{let o=await Promise.all(A.transactions.map(i=>aa({networkID:this.networkID,transaction:bo.deserializeTransactionString(i)})));r=new S(o.reduce((i,a)=>i+a.gasBudget.toNumber(),0)),t=r.dividedBy(1e9).multipliedBy(j.usd)}catch{return{type:"suiNetwork",amountUsd:new S(0),amount:new S(0)}}return{type:"suiNetwork",amountUsd:t,amount:r}}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};var k6=class{constructor(A,j){this.networkID=A;this.priceClient=j;this.suiProcessQuoteCommand=new Zo(A,j)}suiProcessQuoteCommand;getNativeTokenCaip19(){return this.suiProcessQuoteCommand.getNativeTokenCaip19()}async processQuote(A,j){let t=await this.createSwapTransactions(A),r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=await this.suiProcessQuoteCommand.calculateNetworkFee(t),i=this.appendBridgeFees([o],A,r),a=this.appendPhantomFee(i,A);return{quote:A,fees:{totalFees:this.sumFees(a),fees:a},swapTransactions:t}}appendBridgeFees(A,j,t){let r={[this.getNativeTokenCaip19()]:t},o=Yo(j,this.networkID,r),i=Jo(j);return[...A,...i,...o]}appendPhantomFee(A,j){let t=j.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return t?[...A,{type:"phantom",percentage:new S(t.percentage),amountUsd:new S(0),amount:new S(0)}]:A}createSwapTransactions(A){return Os({quote:A})}sumFees(A){return A.reduce((j,t)=>j.plus(t.amountUsd),new S(0))}};var B6=class{create(A,j,t,r){let o=j.sell.data.chain.id,i=j.buy.data.chain.id,a=vA(o,i);if(I.isSolanaNetworkID(o)){let u=oB(A).connection;return a?new d6(o,this.priceClient,u):new m6(o,this.priceClient,u)}else{if(I.isEVMNetworkID(o))return a?new u6(o,A,this.priceClient,j,t):new l6(o,A,this.priceClient,j,t);if(I.isSuiNetworkID(o))return a?new k6(o,this.priceClient):new Zo(o,this.priceClient)}throw new Error(`Unsupported network ID: ${o}`)}priceClient={getPrice:async A=>(await ma({tokens:[TA(A)]}))[A]};isSupportedNetwork(A){return I.isSolanaNetworkID(A)||I.isEVMNetworkID(A)}},f6=class{create(A,j,t,r){return{processQuote:async(o,i)=>({quote:o,fees:{totalFees:new S(0),fees:[]}})}}};n();s();n();s();n();s();var An=e=>e.reduce((A,j)=>{if(!j||j.type!=="SPL")return A;let t;return j.type==="SPL"&&(t=xq(j)),t?{fees:[...A.fees,t],totalPercentFees:A.totalPercentFees+t.percentFee}:A},{fees:[],totalPercentFees:0}),xq=e=>{if(e.type!=="SPL")return;let j=(e.data.mintExtensions??[]).find(t=>t.extension==="transferFeeConfig");if(j)return{caip19:M(V(e)),fungibleKey:e.data.key,symbol:e.data.symbol??"",name:e.data.name??"",percentFee:j.state.newerTransferFee.transferFeeBasisPoints/100}};n();s();var Tq=e=>e.isGreaterThanOrEqualTo(1)?"0,0.[00]":"0,0.[00000]",Gr=e=>{let A=S(e);return fa(e,Tq(A))};var Pq=.05,Gq=5,Cq=.5;function Ql(e,A,j,t){let{priceImpact:r,quoteSlippageTolerance:o}=Oq(e),i=A.autoSlippage?o??j.slippageTolerance:j.slippageTolerance,a={type:"slippage",slippage:i,slippageType:A.autoSlippage?"auto":"fixed",alert:i&&i>=Gq?"highSlippage":void 0},u={type:"priceImpact",priceImpactPercentage:r.gt(0)?us(r.toNumber()):"-",alert:r&&r.gte(Pq)?"highPriceImpact":void 0,warning:r&&r.gte(Cq)?"veryHighPriceImpact":void 0},l=[Vl(e,A.buy,A.sell),a,u],m=An([A.sell,A.buy]);return m.fees.length>0&&l.push({type:"transferFees",transferFees:m.totalPercentFees,transferTokenSymbol:A.sell.data.symbol??"",alert:"transferFees"}),t&&l.push({type:"fees",quoteFees:t}),l}function Oq(e){return Ke(e)?{priceImpact:e.priceImpact?S(e.priceImpact):S(0),quoteSlippageTolerance:e.slippageTolerance}:Ze(e)?{priceImpact:e.priceImpact?S(e.priceImpact):S(0),quoteSlippageTolerance:e.slippageTolerance}:kt(e)?{priceImpact:e.priceImpact?S(e.priceImpact):S(0),quoteSlippageTolerance:e.slippageTolerance}:{priceImpact:S(0),quoteSlippageTolerance:void 0}}function Vl(e,A,j){let{buyAmount:t,sellAmount:r}=e,o=new S(t).shiftedBy(-A.data.decimals).dividedBy(new S(r).shiftedBy(-j.data.decimals));return{type:"pricing",ratio:o,exchangeRate:`1 ${j.data.symbol} \u2248 ${Gr(o)} ${A.data.symbol}`,exchangeRateFlipped:`1 ${A.data.symbol} \u2248 ${Gr(S(1).dividedBy(o))} ${j.data.symbol}`}}n();s();var g6=class{queue=[];processing=!1;enqueue(A){this.queue.push(A),this.processNext()}clearQueue(){this.queue=[],this.processing=!1}async processNext(){if(this.processing||this.queue.length===0)return;this.processing=!0;let A=this.queue.shift();if(A)try{await A()}catch(j){console.error("Error processing task:",j)}this.processing=!1,this.processNext()}};n();s();var _s=class{constructor(A){this.entries=A;for(let j of A)j.alert&&this.alerts.push(j.alert),j.warning&&this.warnings.push(j.warning)}alerts=[];warnings=[]};n();s();var iE=(l=>(l.SwapperNoQuotes="SwapperNoQuotes",l.InsufficientSellAmount="InsufficientSellAmount",l.CrossChainUnavailable="CrossChainUnavailable",l.TokenNotTradable="TokenNotTradable",l.NotEnoughSuiObjects="NotEnoughSuiObjects",l.FromTokenIsHoneyPotToken="FromTokenIsHoneyPotToken",l.ToTokenIsHoneyPotToken="ToTokenIsHoneyPotToken",l.InsufficientLiquidity="InsufficientLiquidity",l.SwapInitializationFailed="SwapInitializationFailed",l.pSolHighImpactError="pSolHighImpactError",l))(iE||{}),Ds=class e extends Error{name;type;constructor(A,j,t){super(j),this.name=A,this.type=t}static fromErrorResponse(A,j){return(r=>Object.values(iE).includes(r))(A)?new e(A,j,A):new e(A,j)}};var Mq="swap-quotes",E6=class{constructor(A,j){this.quoteStreamer=A;this.commandFactory=j}state={type:"idle"};listeners=[];swapTransactionQueue=new g6;start(A,j){this.setState({type:"starting",input:A,account:j}),this.quoteStreamer.subscribe(this.quoteStreamListener),this.quoteStreamer.openStream(A)}stop(){this.swapTransactionQueue.clearQueue(),this.setState({type:"idle"}),this.quoteStreamer.closeStream(),this.quoteStreamer.unsubscribe(this.quoteStreamListener)}quoteStreamListener={onEvent:A=>{switch(A.type){case"newQuoteResponse":switch(this.state.type){case"starting":let r=this.findPreferredQuote(this.state.input,A.quoteResponse);this.setState({type:"firstQuoteReceived",input:this.state.input,quote:r,response:A.quoteResponse,account:this.state.account,quoteDetails:new _s(Ql(r,this.state.input,A.quoteResponse))}),this.enqueueQuoteToProcess(this.state.input,A.quoteResponse,this.state.account);break;case"quoteProcessed":this.enqueueQuoteToProcess(this.state.input,A.quoteResponse,this.state.account,this.state.prevProcessedQuote);break}break;case"error":let j=Ds.fromErrorResponse(A.errorResponse.name,A.errorResponse.message),t=new DA({key:j.name});switch(b.addBreadcrumb(Mq,JSON.stringify(j.name),"info"),this.state.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"error",error:t,quoteError:j,account:this.state.account,input:this.state.input});break}break;case"openRequested":break;case"close":this.setState({type:"idle"});break}}};enqueueQuoteToProcess(A,j,t,r){this.swapTransactionQueue.enqueue(()=>this.processQuote(j,A,t,r))}async processQuote(A,j,t,r){try{let o=this.findPreferredQuote(j,A),a=await this.commandFactory.create(t,j,A,j.isSimulationKilled).processQuote(o,j.isSimulationKilled);switch(this.state.type){case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"quoteProcessed",input:j,response:A,quote:o,prevProcessedQuote:r,nextProcessedQuote:a,account:t,quoteDetails:new _s(Ql(o,j,A,a.fees))});break}return a}catch(o){throw b.captureError(o,"swapper"),o}}subscribe(A){this.listeners.push(A)}unsubscribe(A){this.listeners=this.listeners.filter(j=>j!==A)}getState(){return this.state}findPreferredQuote(A,j){let t=A.preferredProvider;return t&&j.quotes.find(r=>r.baseProvider.id===t)||j.quotes[0]}setState(A){let j=this.state;this.state=A,this.listeners.forEach(t=>t.onStateChange(j,A))}};n();s();n();s();n();s();n();s();function nn(e){let A=e.length;for(;--A>=0;)e[A]=0}var Rq=0,VE=1,_q=2,Dq=3,Nq=258,Bd=29,ei=256,Vs=ei+1+Bd,tn=30,fd=19,zE=2*Vs+1,Cr=15,zl=16,Lq=7,gd=256,XE=16,WE=17,JE=18,id=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),b6=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Kq=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),YE=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Uq=512,gt=new Array((Vs+2)*2);nn(gt);var Us=new Array(tn*2);nn(Us);var zs=new Array(Uq);nn(zs);var Xs=new Array(Nq-Dq+1);nn(Xs);var Ed=new Array(Bd);nn(Ed);var I6=new Array(tn);nn(I6);function Xl(e,A,j,t,r){this.static_tree=e,this.extra_bits=A,this.extra_base=j,this.elems=t,this.max_length=r,this.has_stree=e&&e.length}var ZE,Ay,ey;function Wl(e,A){this.dyn_tree=e,this.max_code=0,this.stat_desc=A}var jy=e=>e<256?zs[e]:zs[256+(e>>>7)],Ws=(e,A)=>{e.pending_buf[e.pending++]=A&255,e.pending_buf[e.pending++]=A>>>8&255},He=(e,A,j)=>{e.bi_valid>zl-j?(e.bi_buf|=A<<e.bi_valid&65535,Ws(e,e.bi_buf),e.bi_buf=A>>zl-e.bi_valid,e.bi_valid+=j-zl):(e.bi_buf|=A<<e.bi_valid&65535,e.bi_valid+=j)},et=(e,A,j)=>{He(e,j[A*2],j[A*2+1])},ty=(e,A)=>{let j=0;do j|=e&1,e>>>=1,j<<=1;while(--A>0);return j>>>1},Hq=e=>{e.bi_valid===16?(Ws(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},Qq=(e,A)=>{let j=A.dyn_tree,t=A.max_code,r=A.stat_desc.static_tree,o=A.stat_desc.has_stree,i=A.stat_desc.extra_bits,a=A.stat_desc.extra_base,u=A.stat_desc.max_length,c,l,m,B,k,f,g=0;for(B=0;B<=Cr;B++)e.bl_count[B]=0;for(j[e.heap[e.heap_max]*2+1]=0,c=e.heap_max+1;c<zE;c++)l=e.heap[c],B=j[j[l*2+1]*2+1]+1,B>u&&(B=u,g++),j[l*2+1]=B,!(l>t)&&(e.bl_count[B]++,k=0,l>=a&&(k=i[l-a]),f=j[l*2],e.opt_len+=f*(B+k),o&&(e.static_len+=f*(r[l*2+1]+k)));if(g!==0){do{for(B=u-1;e.bl_count[B]===0;)B--;e.bl_count[B]--,e.bl_count[B+1]+=2,e.bl_count[u]--,g-=2}while(g>0);for(B=u;B!==0;B--)for(l=e.bl_count[B];l!==0;)m=e.heap[--c],!(m>t)&&(j[m*2+1]!==B&&(e.opt_len+=(B-j[m*2+1])*j[m*2],j[m*2+1]=B),l--)}},ry=(e,A,j)=>{let t=new Array(Cr+1),r=0,o,i;for(o=1;o<=Cr;o++)r=r+j[o-1]<<1,t[o]=r;for(i=0;i<=A;i++){let a=e[i*2+1];a!==0&&(e[i*2]=ty(t[a]++,a))}},Vq=()=>{let e,A,j,t,r,o=new Array(Cr+1);for(j=0,t=0;t<Bd-1;t++)for(Ed[t]=j,e=0;e<1<<id[t];e++)Xs[j++]=t;for(Xs[j-1]=t,r=0,t=0;t<16;t++)for(I6[t]=r,e=0;e<1<<b6[t];e++)zs[r++]=t;for(r>>=7;t<tn;t++)for(I6[t]=r<<7,e=0;e<1<<b6[t]-7;e++)zs[256+r++]=t;for(A=0;A<=Cr;A++)o[A]=0;for(e=0;e<=143;)gt[e*2+1]=8,e++,o[8]++;for(;e<=255;)gt[e*2+1]=9,e++,o[9]++;for(;e<=279;)gt[e*2+1]=7,e++,o[7]++;for(;e<=287;)gt[e*2+1]=8,e++,o[8]++;for(ry(gt,Vs+1,o),e=0;e<tn;e++)Us[e*2+1]=5,Us[e*2]=ty(e,5);ZE=new Xl(gt,id,ei+1,Vs,Cr),Ay=new Xl(Us,b6,0,tn,Cr),ey=new Xl(new Array(0),Kq,0,fd,Lq)},oy=e=>{let A;for(A=0;A<Vs;A++)e.dyn_ltree[A*2]=0;for(A=0;A<tn;A++)e.dyn_dtree[A*2]=0;for(A=0;A<fd;A++)e.bl_tree[A*2]=0;e.dyn_ltree[gd*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},ny=e=>{e.bi_valid>8?Ws(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},aE=(e,A,j,t)=>{let r=A*2,o=j*2;return e[r]<e[o]||e[r]===e[o]&&t[A]<=t[j]},Jl=(e,A,j)=>{let t=e.heap[j],r=j<<1;for(;r<=e.heap_len&&(r<e.heap_len&&aE(A,e.heap[r+1],e.heap[r],e.depth)&&r++,!aE(A,t,e.heap[r],e.depth));)e.heap[j]=e.heap[r],j=r,r<<=1;e.heap[j]=t},pE=(e,A,j)=>{let t,r,o=0,i,a;if(e.sym_next!==0)do t=e.pending_buf[e.sym_buf+o++]&255,t+=(e.pending_buf[e.sym_buf+o++]&255)<<8,r=e.pending_buf[e.sym_buf+o++],t===0?et(e,r,A):(i=Xs[r],et(e,i+ei+1,A),a=id[i],a!==0&&(r-=Ed[i],He(e,r,a)),t--,i=jy(t),et(e,i,j),a=b6[i],a!==0&&(t-=I6[i],He(e,t,a)));while(o<e.sym_next);et(e,gd,A)},ad=(e,A)=>{let j=A.dyn_tree,t=A.stat_desc.static_tree,r=A.stat_desc.has_stree,o=A.stat_desc.elems,i,a,u=-1,c;for(e.heap_len=0,e.heap_max=zE,i=0;i<o;i++)j[i*2]!==0?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):j[i*2+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,j[c*2]=1,e.depth[c]=0,e.opt_len--,r&&(e.static_len-=t[c*2+1]);for(A.max_code=u,i=e.heap_len>>1;i>=1;i--)Jl(e,j,i);c=o;do i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Jl(e,j,1),a=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=a,j[c*2]=j[i*2]+j[a*2],e.depth[c]=(e.depth[i]>=e.depth[a]?e.depth[i]:e.depth[a])+1,j[i*2+1]=j[a*2+1]=c,e.heap[1]=c++,Jl(e,j,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Qq(e,A),ry(j,u,e.bl_count)},cE=(e,A,j)=>{let t,r=-1,o,i=A[0*2+1],a=0,u=7,c=4;for(i===0&&(u=138,c=3),A[(j+1)*2+1]=65535,t=0;t<=j;t++)o=i,i=A[(t+1)*2+1],!(++a<u&&o===i)&&(a<c?e.bl_tree[o*2]+=a:o!==0?(o!==r&&e.bl_tree[o*2]++,e.bl_tree[XE*2]++):a<=10?e.bl_tree[WE*2]++:e.bl_tree[JE*2]++,a=0,r=o,i===0?(u=138,c=3):o===i?(u=6,c=3):(u=7,c=4))},uE=(e,A,j)=>{let t,r=-1,o,i=A[0*2+1],a=0,u=7,c=4;for(i===0&&(u=138,c=3),t=0;t<=j;t++)if(o=i,i=A[(t+1)*2+1],!(++a<u&&o===i)){if(a<c)do et(e,o,e.bl_tree);while(--a!==0);else o!==0?(o!==r&&(et(e,o,e.bl_tree),a--),et(e,XE,e.bl_tree),He(e,a-3,2)):a<=10?(et(e,WE,e.bl_tree),He(e,a-3,3)):(et(e,JE,e.bl_tree),He(e,a-11,7));a=0,r=o,i===0?(u=138,c=3):o===i?(u=6,c=3):(u=7,c=4)}},zq=e=>{let A;for(cE(e,e.dyn_ltree,e.l_desc.max_code),cE(e,e.dyn_dtree,e.d_desc.max_code),ad(e,e.bl_desc),A=fd-1;A>=3&&e.bl_tree[YE[A]*2+1]===0;A--);return e.opt_len+=3*(A+1)+5+5+4,A},Xq=(e,A,j,t)=>{let r;for(He(e,A-257,5),He(e,j-1,5),He(e,t-4,4),r=0;r<t;r++)He(e,e.bl_tree[YE[r]*2+1],3);uE(e,e.dyn_ltree,A-1),uE(e,e.dyn_dtree,j-1)},Wq=e=>{let A=4093624447,j;for(j=0;j<=31;j++,A>>>=1)if(A&1&&e.dyn_ltree[j*2]!==0)return 0;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return 1;for(j=32;j<ei;j++)if(e.dyn_ltree[j*2]!==0)return 1;return 0},lE=!1,Jq=e=>{lE||(Vq(),lE=!0),e.l_desc=new Wl(e.dyn_ltree,ZE),e.d_desc=new Wl(e.dyn_dtree,Ay),e.bl_desc=new Wl(e.bl_tree,ey),e.bi_buf=0,e.bi_valid=0,oy(e)},sy=(e,A,j,t)=>{He(e,(Rq<<1)+(t?1:0),3),ny(e),Ws(e,j),Ws(e,~j),j&&e.pending_buf.set(e.window.subarray(A,A+j),e.pending),e.pending+=j},Yq=e=>{He(e,VE<<1,3),et(e,gd,gt),Hq(e)},Zq=(e,A,j,t)=>{let r,o,i=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=Wq(e)),ad(e,e.l_desc),ad(e,e.d_desc),i=zq(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=j+5,j+4<=r&&A!==-1?sy(e,A,j,t):e.strategy===4||o===r?(He(e,(VE<<1)+(t?1:0),3),pE(e,gt,Us)):(He(e,(_q<<1)+(t?1:0),3),Xq(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),pE(e,e.dyn_ltree,e.dyn_dtree)),oy(e),t&&ny(e)},Ax=(e,A,j)=>(e.pending_buf[e.sym_buf+e.sym_next++]=A,e.pending_buf[e.sym_buf+e.sym_next++]=A>>8,e.pending_buf[e.sym_buf+e.sym_next++]=j,A===0?e.dyn_ltree[j*2]++:(e.matches++,A--,e.dyn_ltree[(Xs[j]+ei+1)*2]++,e.dyn_dtree[jy(A)*2]++),e.sym_next===e.sym_end),ex=Jq,jx=sy,tx=Zq,rx=Ax,ox=Yq,nx={_tr_init:ex,_tr_stored_block:jx,_tr_flush_block:tx,_tr_tally:rx,_tr_align:ox},sx=(e,A,j,t)=>{let r=e&65535|0,o=e>>>16&65535|0,i=0;for(;j!==0;){i=j>2e3?2e3:j,j-=i;do r=r+A[t++]|0,o=o+r|0;while(--i);r%=65521,o%=65521}return r|o<<16|0},Js=sx,ix=()=>{let e,A=[];for(var j=0;j<256;j++){e=j;for(var t=0;t<8;t++)e=e&1?3988292384^e>>>1:e>>>1;A[j]=e}return A},ax=new Uint32Array(ix()),px=(e,A,j,t)=>{let r=ax,o=t+j;e^=-1;for(let i=t;i<o;i++)e=e>>>8^r[(e^A[i])&255];return e^-1},ue=px,Rr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Nr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:cx,_tr_stored_block:pd,_tr_flush_block:ux,_tr_tally:Jt,_tr_align:lx}=nx,{Z_NO_FLUSH:Yt,Z_PARTIAL_FLUSH:dx,Z_FULL_FLUSH:mx,Z_FINISH:dj,Z_BLOCK:dE,Z_OK:ge,Z_STREAM_END:mE,Z_STREAM_ERROR:jt,Z_DATA_ERROR:kx,Z_BUF_ERROR:Yl,Z_DEFAULT_COMPRESSION:Bx,Z_FILTERED:fx,Z_HUFFMAN_ONLY:y6,Z_RLE:gx,Z_FIXED:Ex,Z_DEFAULT_STRATEGY:yx,Z_UNKNOWN:hx,Z_DEFLATED:q6}=Nr,Fx=9,Sx=15,wx=8,bx=29,Ix=256,cd=Ix+1+bx,$x=30,vx=19,qx=2*cd+1,xx=15,EA=3,Wt=258,tt=Wt+EA+1,Tx=32,rn=42,yd=57,ud=69,ld=73,dd=91,md=103,Or=113,Ls=666,Ce=1,sn=2,_r=3,an=4,Px=3,Mr=(e,A)=>(e.msg=Rr[A],A),kE=e=>e*2-(e>4?9:0),Xt=e=>{let A=e.length;for(;--A>=0;)e[A]=0},Gx=e=>{let A,j,t,r=e.w_size;A=e.hash_size,t=A;do j=e.head[--t],e.head[t]=j>=r?j-r:0;while(--A);A=r,t=A;do j=e.prev[--t],e.prev[t]=j>=r?j-r:0;while(--A)},Cx=(e,A,j)=>(A<<e.hash_shift^j)&e.hash_mask,Zt=Cx,jj=e=>{let A=e.state,j=A.pending;j>e.avail_out&&(j=e.avail_out),j!==0&&(e.output.set(A.pending_buf.subarray(A.pending_out,A.pending_out+j),e.next_out),e.next_out+=j,A.pending_out+=j,e.total_out+=j,e.avail_out-=j,A.pending-=j,A.pending===0&&(A.pending_out=0))},tj=(e,A)=>{ux(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,A),e.block_start=e.strstart,jj(e.strm)},FA=(e,A)=>{e.pending_buf[e.pending++]=A},Ns=(e,A)=>{e.pending_buf[e.pending++]=A>>>8&255,e.pending_buf[e.pending++]=A&255},kd=(e,A,j,t)=>{let r=e.avail_in;return r>t&&(r=t),r===0?0:(e.avail_in-=r,A.set(e.input.subarray(e.next_in,e.next_in+r),j),e.state.wrap===1?e.adler=Js(e.adler,A,r,j):e.state.wrap===2&&(e.adler=ue(e.adler,A,r,j)),e.next_in+=r,e.total_in+=r,r)},iy=(e,A)=>{let j=e.max_chain_length,t=e.strstart,r,o,i=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-tt?e.strstart-(e.w_size-tt):0,c=e.window,l=e.w_mask,m=e.prev,B=e.strstart+Wt,k=c[t+i-1],f=c[t+i];e.prev_length>=e.good_match&&(j>>=2),a>e.lookahead&&(a=e.lookahead);do if(r=A,!(c[r+i]!==f||c[r+i-1]!==k||c[r]!==c[t]||c[++r]!==c[t+1])){t+=2,r++;do;while(c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&c[++t]===c[++r]&&t<B);if(o=Wt-(B-t),t=B-Wt,o>i){if(e.match_start=A,i=o,o>=a)break;k=c[t+i-1],f=c[t+i]}}while((A=m[A&l])>u&&--j!==0);return i<=e.lookahead?i:e.lookahead},on=e=>{let A=e.w_size,j,t,r;do{if(t=e.window_size-e.lookahead-e.strstart,e.strstart>=A+(A-tt)&&(e.window.set(e.window.subarray(A,A+A-t),0),e.match_start-=A,e.strstart-=A,e.block_start-=A,e.insert>e.strstart&&(e.insert=e.strstart),Gx(e),t+=A),e.strm.avail_in===0)break;if(j=kd(e.strm,e.window,e.strstart+e.lookahead,t),e.lookahead+=j,e.lookahead+e.insert>=EA)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=Zt(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=Zt(e,e.ins_h,e.window[r+EA-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<EA)););}while(e.lookahead<tt&&e.strm.avail_in!==0)},ay=(e,A)=>{let j=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,t,r,o,i=0,a=e.strm.avail_in;do{if(t=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,r=e.strstart-e.block_start,t>r+e.strm.avail_in&&(t=r+e.strm.avail_in),t>o&&(t=o),t<j&&(t===0&&A!==dj||A===Yt||t!==r+e.strm.avail_in)))break;i=A===dj&&t===r+e.strm.avail_in?1:0,pd(e,0,0,i),e.pending_buf[e.pending-4]=t,e.pending_buf[e.pending-3]=t>>8,e.pending_buf[e.pending-2]=~t,e.pending_buf[e.pending-1]=~t>>8,jj(e.strm),r&&(r>t&&(r=t),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,t-=r),t&&(kd(e.strm,e.strm.output,e.strm.next_out,t),e.strm.next_out+=t,e.strm.avail_out-=t,e.strm.total_out+=t)}while(i===0);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),i?an:A!==Yt&&A!==dj&&e.strm.avail_in===0&&e.strstart===e.block_start?sn:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(kd(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,j=o>e.w_size?e.w_size:o,r=e.strstart-e.block_start,(r>=j||(r||A===dj)&&A!==Yt&&e.strm.avail_in===0&&r<=o)&&(t=r>o?o:r,i=A===dj&&e.strm.avail_in===0&&t===r?1:0,pd(e,e.block_start,t,i),e.block_start+=t,jj(e.strm)),i?_r:Ce)},Zl=(e,A)=>{let j,t;for(;;){if(e.lookahead<tt){if(on(e),e.lookahead<tt&&A===Yt)return Ce;if(e.lookahead===0)break}if(j=0,e.lookahead>=EA&&(e.ins_h=Zt(e,e.ins_h,e.window[e.strstart+EA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),j!==0&&e.strstart-j<=e.w_size-tt&&(e.match_length=iy(e,j)),e.match_length>=EA)if(t=Jt(e,e.strstart-e.match_start,e.match_length-EA),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=EA){e.match_length--;do e.strstart++,e.ins_h=Zt(e,e.ins_h,e.window[e.strstart+EA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Zt(e,e.ins_h,e.window[e.strstart+1]);else t=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(t&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=e.strstart<EA-1?e.strstart:EA-1,A===dj?(tj(e,!0),e.strm.avail_out===0?_r:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},en=(e,A)=>{let j,t,r;for(;;){if(e.lookahead<tt){if(on(e),e.lookahead<tt&&A===Yt)return Ce;if(e.lookahead===0)break}if(j=0,e.lookahead>=EA&&(e.ins_h=Zt(e,e.ins_h,e.window[e.strstart+EA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=EA-1,j!==0&&e.prev_length<e.max_lazy_match&&e.strstart-j<=e.w_size-tt&&(e.match_length=iy(e,j),e.match_length<=5&&(e.strategy===fx||e.match_length===EA&&e.strstart-e.match_start>4096)&&(e.match_length=EA-1)),e.prev_length>=EA&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-EA,t=Jt(e,e.strstart-1-e.prev_match,e.prev_length-EA),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Zt(e,e.ins_h,e.window[e.strstart+EA-1]),j=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=EA-1,e.strstart++,t&&(tj(e,!1),e.strm.avail_out===0))return Ce}else if(e.match_available){if(t=Jt(e,0,e.window[e.strstart-1]),t&&tj(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return Ce}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(t=Jt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<EA-1?e.strstart:EA-1,A===dj?(tj(e,!0),e.strm.avail_out===0?_r:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},Ox=(e,A)=>{let j,t,r,o,i=e.window;for(;;){if(e.lookahead<=Wt){if(on(e),e.lookahead<=Wt&&A===Yt)return Ce;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=EA&&e.strstart>0&&(r=e.strstart-1,t=i[r],t===i[++r]&&t===i[++r]&&t===i[++r])){o=e.strstart+Wt;do;while(t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&t===i[++r]&&r<o);e.match_length=Wt-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=EA?(j=Jt(e,1,e.match_length-EA),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(j=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),j&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=0,A===dj?(tj(e,!0),e.strm.avail_out===0?_r:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn},Mx=(e,A)=>{let j;for(;;){if(e.lookahead===0&&(on(e),e.lookahead===0)){if(A===Yt)return Ce;break}if(e.match_length=0,j=Jt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,j&&(tj(e,!1),e.strm.avail_out===0))return Ce}return e.insert=0,A===dj?(tj(e,!0),e.strm.avail_out===0?_r:an):e.sym_next&&(tj(e,!1),e.strm.avail_out===0)?Ce:sn};function At(e,A,j,t,r){this.good_length=e,this.max_lazy=A,this.nice_length=j,this.max_chain=t,this.func=r}var Ks=[new At(0,0,0,0,ay),new At(4,4,8,4,Zl),new At(4,5,16,8,Zl),new At(4,6,32,32,Zl),new At(4,4,16,16,en),new At(8,16,32,32,en),new At(8,16,128,128,en),new At(8,32,128,256,en),new At(32,128,258,1024,en),new At(32,258,258,4096,en)],Rx=e=>{e.window_size=2*e.w_size,Xt(e.head),e.max_lazy_match=Ks[e.level].max_lazy,e.good_match=Ks[e.level].good_length,e.nice_match=Ks[e.level].nice_length,e.max_chain_length=Ks[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=EA-1,e.match_available=0,e.ins_h=0};function _x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=q6,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(qx*2),this.dyn_dtree=new Uint16Array((2*$x+1)*2),this.bl_tree=new Uint16Array((2*vx+1)*2),Xt(this.dyn_ltree),Xt(this.dyn_dtree),Xt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xx+1),this.heap=new Uint16Array(2*cd+1),Xt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*cd+1),Xt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var ji=e=>{if(!e)return 1;let A=e.state;return!A||A.strm!==e||A.status!==rn&&A.status!==yd&&A.status!==ud&&A.status!==ld&&A.status!==dd&&A.status!==md&&A.status!==Or&&A.status!==Ls?1:0},py=e=>{if(ji(e))return Mr(e,jt);e.total_in=e.total_out=0,e.data_type=hx;let A=e.state;return A.pending=0,A.pending_out=0,A.wrap<0&&(A.wrap=-A.wrap),A.status=A.wrap===2?yd:A.wrap?rn:Or,e.adler=A.wrap===2?0:1,A.last_flush=-2,cx(A),ge},cy=e=>{let A=py(e);return A===ge&&Rx(e.state),A},Dx=(e,A)=>ji(e)||e.state.wrap!==2?jt:(e.state.gzhead=A,ge),uy=(e,A,j,t,r,o)=>{if(!e)return jt;let i=1;if(A===Bx&&(A=6),t<0?(i=0,t=-t):t>15&&(i=2,t-=16),r<1||r>Fx||j!==q6||t<8||t>15||A<0||A>9||o<0||o>Ex||t===8&&i!==1)return Mr(e,jt);t===8&&(t=9);let a=new _x;return e.state=a,a.strm=e,a.status=rn,a.wrap=i,a.gzhead=null,a.w_bits=t,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+EA-1)/EA),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=A,a.strategy=o,a.method=j,cy(e)},Nx=(e,A)=>uy(e,A,q6,Sx,wx,yx),Lx=(e,A)=>{if(ji(e)||A>dE||A<0)return e?Mr(e,jt):jt;let j=e.state;if(!e.output||e.avail_in!==0&&!e.input||j.status===Ls&&A!==dj)return Mr(e,e.avail_out===0?Yl:jt);let t=j.last_flush;if(j.last_flush=A,j.pending!==0){if(jj(e),e.avail_out===0)return j.last_flush=-1,ge}else if(e.avail_in===0&&kE(A)<=kE(t)&&A!==dj)return Mr(e,Yl);if(j.status===Ls&&e.avail_in!==0)return Mr(e,Yl);if(j.status===rn&&j.wrap===0&&(j.status=Or),j.status===rn){let r=q6+(j.w_bits-8<<4)<<8,o=-1;if(j.strategy>=y6||j.level<2?o=0:j.level<6?o=1:j.level===6?o=2:o=3,r|=o<<6,j.strstart!==0&&(r|=Tx),r+=31-r%31,Ns(j,r),j.strstart!==0&&(Ns(j,e.adler>>>16),Ns(j,e.adler&65535)),e.adler=1,j.status=Or,jj(e),j.pending!==0)return j.last_flush=-1,ge}if(j.status===yd){if(e.adler=0,FA(j,31),FA(j,139),FA(j,8),j.gzhead)FA(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),FA(j,j.gzhead.time&255),FA(j,j.gzhead.time>>8&255),FA(j,j.gzhead.time>>16&255),FA(j,j.gzhead.time>>24&255),FA(j,j.level===9?2:j.strategy>=y6||j.level<2?4:0),FA(j,j.gzhead.os&255),j.gzhead.extra&&j.gzhead.extra.length&&(FA(j,j.gzhead.extra.length&255),FA(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(e.adler=ue(e.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=ud;else if(FA(j,0),FA(j,0),FA(j,0),FA(j,0),FA(j,0),FA(j,j.level===9?2:j.strategy>=y6||j.level<2?4:0),FA(j,Px),j.status=Or,jj(e),j.pending!==0)return j.last_flush=-1,ge}if(j.status===ud){if(j.gzhead.extra){let r=j.pending,o=(j.gzhead.extra.length&65535)-j.gzindex;for(;j.pending+o>j.pending_buf_size;){let a=j.pending_buf_size-j.pending;if(j.pending_buf.set(j.gzhead.extra.subarray(j.gzindex,j.gzindex+a),j.pending),j.pending=j.pending_buf_size,j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex+=a,jj(e),j.pending!==0)return j.last_flush=-1,ge;r=0,o-=a}let i=new Uint8Array(j.gzhead.extra);j.pending_buf.set(i.subarray(j.gzindex,j.gzindex+o),j.pending),j.pending+=o,j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex=0}j.status=ld}if(j.status===ld){if(j.gzhead.name){let r=j.pending,o;do{if(j.pending===j.pending_buf_size){if(j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r)),jj(e),j.pending!==0)return j.last_flush=-1,ge;r=0}j.gzindex<j.gzhead.name.length?o=j.gzhead.name.charCodeAt(j.gzindex++)&255:o=0,FA(j,o)}while(o!==0);j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r)),j.gzindex=0}j.status=dd}if(j.status===dd){if(j.gzhead.comment){let r=j.pending,o;do{if(j.pending===j.pending_buf_size){if(j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r)),jj(e),j.pending!==0)return j.last_flush=-1,ge;r=0}j.gzindex<j.gzhead.comment.length?o=j.gzhead.comment.charCodeAt(j.gzindex++)&255:o=0,FA(j,o)}while(o!==0);j.gzhead.hcrc&&j.pending>r&&(e.adler=ue(e.adler,j.pending_buf,j.pending-r,r))}j.status=md}if(j.status===md){if(j.gzhead.hcrc){if(j.pending+2>j.pending_buf_size&&(jj(e),j.pending!==0))return j.last_flush=-1,ge;FA(j,e.adler&255),FA(j,e.adler>>8&255),e.adler=0}if(j.status=Or,jj(e),j.pending!==0)return j.last_flush=-1,ge}if(e.avail_in!==0||j.lookahead!==0||A!==Yt&&j.status!==Ls){let r=j.level===0?ay(j,A):j.strategy===y6?Mx(j,A):j.strategy===gx?Ox(j,A):Ks[j.level].func(j,A);if((r===_r||r===an)&&(j.status=Ls),r===Ce||r===_r)return e.avail_out===0&&(j.last_flush=-1),ge;if(r===sn&&(A===dx?lx(j):A!==dE&&(pd(j,0,0,!1),A===mx&&(Xt(j.head),j.lookahead===0&&(j.strstart=0,j.block_start=0,j.insert=0))),jj(e),e.avail_out===0))return j.last_flush=-1,ge}return A!==dj?ge:j.wrap<=0?mE:(j.wrap===2?(FA(j,e.adler&255),FA(j,e.adler>>8&255),FA(j,e.adler>>16&255),FA(j,e.adler>>24&255),FA(j,e.total_in&255),FA(j,e.total_in>>8&255),FA(j,e.total_in>>16&255),FA(j,e.total_in>>24&255)):(Ns(j,e.adler>>>16),Ns(j,e.adler&65535)),jj(e),j.wrap>0&&(j.wrap=-j.wrap),j.pending!==0?ge:mE)},Kx=e=>{if(ji(e))return jt;let A=e.state.status;return e.state=null,A===Or?Mr(e,kx):ge},Ux=(e,A)=>{let j=A.length;if(ji(e))return jt;let t=e.state,r=t.wrap;if(r===2||r===1&&t.status!==rn||t.lookahead)return jt;if(r===1&&(e.adler=Js(e.adler,A,j,0)),t.wrap=0,j>=t.w_size){r===0&&(Xt(t.head),t.strstart=0,t.block_start=0,t.insert=0);let u=new Uint8Array(t.w_size);u.set(A.subarray(j-t.w_size,j),0),A=u,j=t.w_size}let o=e.avail_in,i=e.next_in,a=e.input;for(e.avail_in=j,e.next_in=0,e.input=A,on(t);t.lookahead>=EA;){let u=t.strstart,c=t.lookahead-(EA-1);do t.ins_h=Zt(t,t.ins_h,t.window[u+EA-1]),t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++;while(--c);t.strstart=u,t.lookahead=EA-1,on(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=EA-1,t.match_available=0,e.next_in=i,e.input=a,e.avail_in=o,t.wrap=r,ge},Hx=Nx,Qx=uy,Vx=cy,zx=py,Xx=Dx,Wx=Lx,Jx=Kx,Yx=Ux,Zx="pako deflate (from Nodeca project)",Hs={deflateInit:Hx,deflateInit2:Qx,deflateReset:Vx,deflateResetKeep:zx,deflateSetHeader:Xx,deflate:Wx,deflateEnd:Jx,deflateSetDictionary:Yx,deflateInfo:Zx},AT=(e,A)=>Object.prototype.hasOwnProperty.call(e,A),eT=function(e){let A=Array.prototype.slice.call(arguments,1);for(;A.length;){let j=A.shift();if(j){if(typeof j!="object")throw new TypeError(j+"must be non-object");for(let t in j)AT(j,t)&&(e[t]=j[t])}}return e},jT=e=>{let A=0;for(let t=0,r=e.length;t<r;t++)A+=e[t].length;let j=new Uint8Array(A);for(let t=0,r=0,o=e.length;t<o;t++){let i=e[t];j.set(i,r),r+=i.length}return j},x6={assign:eT,flattenChunks:jT},ly=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ly=!1}var Ys=new Uint8Array(256);for(let e=0;e<256;e++)Ys[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ys[254]=Ys[254]=1;var tT=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let A,j,t,r,o,i=e.length,a=0;for(r=0;r<i;r++)j=e.charCodeAt(r),(j&64512)===55296&&r+1<i&&(t=e.charCodeAt(r+1),(t&64512)===56320&&(j=65536+(j-55296<<10)+(t-56320),r++)),a+=j<128?1:j<2048?2:j<65536?3:4;for(A=new Uint8Array(a),o=0,r=0;o<a;r++)j=e.charCodeAt(r),(j&64512)===55296&&r+1<i&&(t=e.charCodeAt(r+1),(t&64512)===56320&&(j=65536+(j-55296<<10)+(t-56320),r++)),j<128?A[o++]=j:j<2048?(A[o++]=192|j>>>6,A[o++]=128|j&63):j<65536?(A[o++]=224|j>>>12,A[o++]=128|j>>>6&63,A[o++]=128|j&63):(A[o++]=240|j>>>18,A[o++]=128|j>>>12&63,A[o++]=128|j>>>6&63,A[o++]=128|j&63);return A},rT=(e,A)=>{if(A<65534&&e.subarray&&ly)return String.fromCharCode.apply(null,e.length===A?e:e.subarray(0,A));let j="";for(let t=0;t<A;t++)j+=String.fromCharCode(e[t]);return j},oT=(e,A)=>{let j=A||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,A));let t,r,o=new Array(j*2);for(r=0,t=0;t<j;){let i=e[t++];if(i<128){o[r++]=i;continue}let a=Ys[i];if(a>4){o[r++]=65533,t+=a-1;continue}for(i&=a===2?31:a===3?15:7;a>1&&t<j;)i=i<<6|e[t++]&63,a--;if(a>1){o[r++]=65533;continue}i<65536?o[r++]=i:(i-=65536,o[r++]=55296|i>>10&1023,o[r++]=56320|i&1023)}return rT(o,r)},nT=(e,A)=>{A=A||e.length,A>e.length&&(A=e.length);let j=A-1;for(;j>=0&&(e[j]&192)===128;)j--;return j<0||j===0?A:j+Ys[e[j]]>A?j:A},Zs={string2buf:tT,buf2string:oT,utf8border:nT};function sT(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var dy=sT,my=Object.prototype.toString,{Z_NO_FLUSH:iT,Z_SYNC_FLUSH:aT,Z_FULL_FLUSH:pT,Z_FINISH:cT,Z_OK:$6,Z_STREAM_END:uT,Z_DEFAULT_COMPRESSION:lT,Z_DEFAULT_STRATEGY:dT,Z_DEFLATED:mT}=Nr;function ti(e){this.options=x6.assign({level:lT,method:mT,chunkSize:16384,windowBits:15,memLevel:8,strategy:dT},e||{});let A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dy,this.strm.avail_out=0;let j=Hs.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(j!==$6)throw new Error(Rr[j]);if(A.header&&Hs.deflateSetHeader(this.strm,A.header),A.dictionary){let t;if(typeof A.dictionary=="string"?t=Zs.string2buf(A.dictionary):my.call(A.dictionary)==="[object ArrayBuffer]"?t=new Uint8Array(A.dictionary):t=A.dictionary,j=Hs.deflateSetDictionary(this.strm,t),j!==$6)throw new Error(Rr[j]);this._dict_set=!0}}ti.prototype.push=function(e,A){let j=this.strm,t=this.options.chunkSize,r,o;if(this.ended)return!1;for(A===~~A?o=A:o=A===!0?cT:iT,typeof e=="string"?j.input=Zs.string2buf(e):my.call(e)==="[object ArrayBuffer]"?j.input=new Uint8Array(e):j.input=e,j.next_in=0,j.avail_in=j.input.length;;){if(j.avail_out===0&&(j.output=new Uint8Array(t),j.next_out=0,j.avail_out=t),(o===aT||o===pT)&&j.avail_out<=6){this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;continue}if(r=Hs.deflate(j,o),r===uT)return j.next_out>0&&this.onData(j.output.subarray(0,j.next_out)),r=Hs.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===$6;if(j.avail_out===0){this.onData(j.output);continue}if(o>0&&j.next_out>0){this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;continue}if(j.avail_in===0)break}return!0};ti.prototype.onData=function(e){this.chunks.push(e)};ti.prototype.onEnd=function(e){e===$6&&(this.result=x6.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function hd(e,A){let j=new ti(A);if(j.push(e,!0),j.err)throw j.msg||Rr[j.err];return j.result}function kT(e,A){return A=A||{},A.raw=!0,hd(e,A)}function BT(e,A){return A=A||{},A.gzip=!0,hd(e,A)}var fT=ti,gT=hd,ET=kT,yT=BT,hT=Nr,FT={Deflate:fT,deflate:gT,deflateRaw:ET,gzip:yT,constants:hT},h6=16209,ST=16191,wT=function(A,j){let t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y,F,w,x,G,v,_,C,O,D=A.state;t=A.next_in,C=A.input,r=t+(A.avail_in-5),o=A.next_out,O=A.output,i=o-(j-A.avail_out),a=o+(A.avail_out-257),u=D.dmax,c=D.wsize,l=D.whave,m=D.wnext,B=D.window,k=D.hold,f=D.bits,g=D.lencode,E=D.distcode,h=(1<<D.lenbits)-1,y=(1<<D.distbits)-1;A:do{f<15&&(k+=C[t++]<<f,f+=8,k+=C[t++]<<f,f+=8),F=g[k&h];e:for(;;){if(w=F>>>24,k>>>=w,f-=w,w=F>>>16&255,w===0)O[o++]=F&65535;else if(w&16){x=F&65535,w&=15,w&&(f<w&&(k+=C[t++]<<f,f+=8),x+=k&(1<<w)-1,k>>>=w,f-=w),f<15&&(k+=C[t++]<<f,f+=8,k+=C[t++]<<f,f+=8),F=E[k&y];j:for(;;){if(w=F>>>24,k>>>=w,f-=w,w=F>>>16&255,w&16){if(G=F&65535,w&=15,f<w&&(k+=C[t++]<<f,f+=8,f<w&&(k+=C[t++]<<f,f+=8)),G+=k&(1<<w)-1,G>u){A.msg="invalid distance too far back",D.mode=h6;break A}if(k>>>=w,f-=w,w=o-i,G>w){if(w=G-w,w>l&&D.sane){A.msg="invalid distance too far back",D.mode=h6;break A}if(v=0,_=B,m===0){if(v+=c-w,w<x){x-=w;do O[o++]=B[v++];while(--w);v=o-G,_=O}}else if(m<w){if(v+=c+m-w,w-=m,w<x){x-=w;do O[o++]=B[v++];while(--w);if(v=0,m<x){w=m,x-=w;do O[o++]=B[v++];while(--w);v=o-G,_=O}}}else if(v+=m-w,w<x){x-=w;do O[o++]=B[v++];while(--w);v=o-G,_=O}for(;x>2;)O[o++]=_[v++],O[o++]=_[v++],O[o++]=_[v++],x-=3;x&&(O[o++]=_[v++],x>1&&(O[o++]=_[v++]))}else{v=o-G;do O[o++]=O[v++],O[o++]=O[v++],O[o++]=O[v++],x-=3;while(x>2);x&&(O[o++]=O[v++],x>1&&(O[o++]=O[v++]))}}else if(w&64){A.msg="invalid distance code",D.mode=h6;break A}else{F=E[(F&65535)+(k&(1<<w)-1)];continue j}break}}else if(w&64)if(w&32){D.mode=ST;break A}else{A.msg="invalid literal/length code",D.mode=h6;break A}else{F=g[(F&65535)+(k&(1<<w)-1)];continue e}break}}while(t<r&&o<a);x=f>>3,t-=x,f-=x<<3,k&=(1<<f)-1,A.next_in=t,A.next_out=o,A.avail_in=t<r?5+(r-t):5-(t-r),A.avail_out=o<a?257+(a-o):257-(o-a),D.hold=k,D.bits=f},jn=15,BE=852,fE=592,gE=0,Ad=1,EE=2,bT=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),IT=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$T=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),vT=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),qT=(e,A,j,t,r,o,i,a)=>{let u=a.bits,c=0,l=0,m=0,B=0,k=0,f=0,g=0,E=0,h=0,y=0,F,w,x,G,v,_=null,C,O=new Uint16Array(jn+1),D=new Uint16Array(jn+1),H=null,z,L,R;for(c=0;c<=jn;c++)O[c]=0;for(l=0;l<t;l++)O[A[j+l]]++;for(k=u,B=jn;B>=1&&O[B]===0;B--);if(k>B&&(k=B),B===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,a.bits=1,0;for(m=1;m<B&&O[m]===0;m++);for(k<m&&(k=m),E=1,c=1;c<=jn;c++)if(E<<=1,E-=O[c],E<0)return-1;if(E>0&&(e===gE||B!==1))return-1;for(D[1]=0,c=1;c<jn;c++)D[c+1]=D[c]+O[c];for(l=0;l<t;l++)A[j+l]!==0&&(i[D[A[j+l]]++]=l);if(e===gE?(_=H=i,C=20):e===Ad?(_=bT,H=IT,C=257):(_=$T,H=vT,C=0),y=0,l=0,c=m,v=o,f=k,g=0,x=-1,h=1<<k,G=h-1,e===Ad&&h>BE||e===EE&&h>fE)return 1;for(;;){z=c-g,i[l]+1<C?(L=0,R=i[l]):i[l]>=C?(L=H[i[l]-C],R=_[i[l]-C]):(L=96,R=0),F=1<<c-g,w=1<<f,m=w;do w-=F,r[v+(y>>g)+w]=z<<24|L<<16|R|0;while(w!==0);for(F=1<<c-1;y&F;)F>>=1;if(F!==0?(y&=F-1,y+=F):y=0,l++,--O[c]===0){if(c===B)break;c=A[j+i[l]]}if(c>k&&(y&G)!==x){for(g===0&&(g=k),v+=m,f=c-g,E=1<<f;f+g<B&&(E-=O[f+g],!(E<=0));)f++,E<<=1;if(h+=1<<f,e===Ad&&h>BE||e===EE&&h>fE)return 1;x=y&G,r[x]=k<<24|f<<16|v-o|0}}return y!==0&&(r[v+y]=c-g<<24|64<<16|0),a.bits=k,0},Qs=qT,xT=0,ky=1,By=2,{Z_FINISH:yE,Z_BLOCK:TT,Z_TREES:F6,Z_OK:Dr,Z_STREAM_END:PT,Z_NEED_DICT:GT,Z_STREAM_ERROR:mj,Z_DATA_ERROR:fy,Z_MEM_ERROR:gy,Z_BUF_ERROR:CT,Z_DEFLATED:hE}=Nr,T6=16180,FE=16181,SE=16182,wE=16183,bE=16184,IE=16185,$E=16186,vE=16187,qE=16188,xE=16189,v6=16190,ft=16191,ed=16192,TE=16193,jd=16194,PE=16195,GE=16196,CE=16197,OE=16198,S6=16199,w6=16200,ME=16201,RE=16202,_E=16203,DE=16204,NE=16205,td=16206,LE=16207,KE=16208,RA=16209,Ey=16210,yy=16211,OT=852,MT=592,RT=15,_T=RT,UE=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function DT(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Lr=e=>{if(!e)return 1;let A=e.state;return!A||A.strm!==e||A.mode<T6||A.mode>yy?1:0},hy=e=>{if(Lr(e))return mj;let A=e.state;return e.total_in=e.total_out=A.total=0,e.msg="",A.wrap&&(e.adler=A.wrap&1),A.mode=T6,A.last=0,A.havedict=0,A.flags=-1,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new Int32Array(OT),A.distcode=A.distdyn=new Int32Array(MT),A.sane=1,A.back=-1,Dr},Fy=e=>{if(Lr(e))return mj;let A=e.state;return A.wsize=0,A.whave=0,A.wnext=0,hy(e)},Sy=(e,A)=>{let j;if(Lr(e))return mj;let t=e.state;return A<0?(j=0,A=-A):(j=(A>>4)+5,A<48&&(A&=15)),A&&(A<8||A>15)?mj:(t.window!==null&&t.wbits!==A&&(t.window=null),t.wrap=j,t.wbits=A,Fy(e))},wy=(e,A)=>{if(!e)return mj;let j=new DT;e.state=j,j.strm=e,j.window=null,j.mode=T6;let t=Sy(e,A);return t!==Dr&&(e.state=null),t},NT=e=>wy(e,_T),HE=!0,rd,od,LT=e=>{if(HE){rd=new Int32Array(512),od=new Int32Array(32);let A=0;for(;A<144;)e.lens[A++]=8;for(;A<256;)e.lens[A++]=9;for(;A<280;)e.lens[A++]=7;for(;A<288;)e.lens[A++]=8;for(Qs(ky,e.lens,0,288,rd,0,e.work,{bits:9}),A=0;A<32;)e.lens[A++]=5;Qs(By,e.lens,0,32,od,0,e.work,{bits:5}),HE=!1}e.lencode=rd,e.lenbits=9,e.distcode=od,e.distbits=5},by=(e,A,j,t)=>{let r,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),t>=o.wsize?(o.window.set(A.subarray(j-o.wsize,j),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>t&&(r=t),o.window.set(A.subarray(j-t,j-t+r),o.wnext),t-=r,t?(o.window.set(A.subarray(j-t,j),0),o.wnext=t,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},KT=(e,A)=>{let j,t,r,o,i,a,u,c,l,m,B,k,f,g,E=0,h,y,F,w,x,G,v,_,C=new Uint8Array(4),O,D,H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Lr(e)||!e.output||!e.input&&e.avail_in!==0)return mj;j=e.state,j.mode===ft&&(j.mode=ed),i=e.next_out,r=e.output,u=e.avail_out,o=e.next_in,t=e.input,a=e.avail_in,c=j.hold,l=j.bits,m=a,B=u,_=Dr;A:for(;;)switch(j.mode){case T6:if(j.wrap===0){j.mode=ed;break}for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&2&&c===35615){j.wbits===0&&(j.wbits=15),j.check=0,C[0]=c&255,C[1]=c>>>8&255,j.check=ue(j.check,C,2,0),c=0,l=0,j.mode=FE;break}if(j.head&&(j.head.done=!1),!(j.wrap&1)||(((c&255)<<8)+(c>>8))%31){e.msg="incorrect header check",j.mode=RA;break}if((c&15)!==hE){e.msg="unknown compression method",j.mode=RA;break}if(c>>>=4,l-=4,v=(c&15)+8,j.wbits===0&&(j.wbits=v),v>15||v>j.wbits){e.msg="invalid window size",j.mode=RA;break}j.dmax=1<<j.wbits,j.flags=0,e.adler=j.check=1,j.mode=c&512?xE:ft,c=0,l=0;break;case FE:for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.flags=c,(j.flags&255)!==hE){e.msg="unknown compression method",j.mode=RA;break}if(j.flags&57344){e.msg="unknown header flags set",j.mode=RA;break}j.head&&(j.head.text=c>>8&1),j.flags&512&&j.wrap&4&&(C[0]=c&255,C[1]=c>>>8&255,j.check=ue(j.check,C,2,0)),c=0,l=0,j.mode=SE;case SE:for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.head&&(j.head.time=c),j.flags&512&&j.wrap&4&&(C[0]=c&255,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,j.check=ue(j.check,C,4,0)),c=0,l=0,j.mode=wE;case wE:for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.head&&(j.head.xflags=c&255,j.head.os=c>>8),j.flags&512&&j.wrap&4&&(C[0]=c&255,C[1]=c>>>8&255,j.check=ue(j.check,C,2,0)),c=0,l=0,j.mode=bE;case bE:if(j.flags&1024){for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.length=c,j.head&&(j.head.extra_len=c),j.flags&512&&j.wrap&4&&(C[0]=c&255,C[1]=c>>>8&255,j.check=ue(j.check,C,2,0)),c=0,l=0}else j.head&&(j.head.extra=null);j.mode=IE;case IE:if(j.flags&1024&&(k=j.length,k>a&&(k=a),k&&(j.head&&(v=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(t.subarray(o,o+k),v)),j.flags&512&&j.wrap&4&&(j.check=ue(j.check,t,k,o)),a-=k,o+=k,j.length-=k),j.length))break A;j.length=0,j.mode=$E;case $E:if(j.flags&2048){if(a===0)break A;k=0;do v=t[o+k++],j.head&&v&&j.length<65536&&(j.head.name+=String.fromCharCode(v));while(v&&k<a);if(j.flags&512&&j.wrap&4&&(j.check=ue(j.check,t,k,o)),a-=k,o+=k,v)break A}else j.head&&(j.head.name=null);j.length=0,j.mode=vE;case vE:if(j.flags&4096){if(a===0)break A;k=0;do v=t[o+k++],j.head&&v&&j.length<65536&&(j.head.comment+=String.fromCharCode(v));while(v&&k<a);if(j.flags&512&&j.wrap&4&&(j.check=ue(j.check,t,k,o)),a-=k,o+=k,v)break A}else j.head&&(j.head.comment=null);j.mode=qE;case qE:if(j.flags&512){for(;l<16;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&4&&c!==(j.check&65535)){e.msg="header crc mismatch",j.mode=RA;break}c=0,l=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),e.adler=j.check=0,j.mode=ft;break;case xE:for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}e.adler=j.check=UE(c),c=0,l=0,j.mode=v6;case v6:if(j.havedict===0)return e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,GT;e.adler=j.check=1,j.mode=ft;case ft:if(A===TT||A===F6)break A;case ed:if(j.last){c>>>=l&7,l-=l&7,j.mode=td;break}for(;l<3;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}switch(j.last=c&1,c>>>=1,l-=1,c&3){case 0:j.mode=TE;break;case 1:if(LT(j),j.mode=S6,A===F6){c>>>=2,l-=2;break A}break;case 2:j.mode=GE;break;case 3:e.msg="invalid block type",j.mode=RA}c>>>=2,l-=2;break;case TE:for(c>>>=l&7,l-=l&7;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if((c&65535)!==(c>>>16^65535)){e.msg="invalid stored block lengths",j.mode=RA;break}if(j.length=c&65535,c=0,l=0,j.mode=jd,A===F6)break A;case jd:j.mode=PE;case PE:if(k=j.length,k){if(k>a&&(k=a),k>u&&(k=u),k===0)break A;r.set(t.subarray(o,o+k),i),a-=k,o+=k,u-=k,i+=k,j.length-=k;break}j.mode=ft;break;case GE:for(;l<14;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.nlen=(c&31)+257,c>>>=5,l-=5,j.ndist=(c&31)+1,c>>>=5,l-=5,j.ncode=(c&15)+4,c>>>=4,l-=4,j.nlen>286||j.ndist>30){e.msg="too many length or distance symbols",j.mode=RA;break}j.have=0,j.mode=CE;case CE:for(;j.have<j.ncode;){for(;l<3;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.lens[H[j.have++]]=c&7,c>>>=3,l-=3}for(;j.have<19;)j.lens[H[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,O={bits:j.lenbits},_=Qs(xT,j.lens,0,19,j.lencode,0,j.work,O),j.lenbits=O.bits,_){e.msg="invalid code lengths set",j.mode=RA;break}j.have=0,j.mode=OE;case OE:for(;j.have<j.nlen+j.ndist;){for(;E=j.lencode[c&(1<<j.lenbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(F<16)c>>>=h,l-=h,j.lens[j.have++]=F;else{if(F===16){for(D=h+2;l<D;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(c>>>=h,l-=h,j.have===0){e.msg="invalid bit length repeat",j.mode=RA;break}v=j.lens[j.have-1],k=3+(c&3),c>>>=2,l-=2}else if(F===17){for(D=h+3;l<D;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=h,l-=h,v=0,k=3+(c&7),c>>>=3,l-=3}else{for(D=h+7;l<D;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=h,l-=h,v=0,k=11+(c&127),c>>>=7,l-=7}if(j.have+k>j.nlen+j.ndist){e.msg="invalid bit length repeat",j.mode=RA;break}for(;k--;)j.lens[j.have++]=v}}if(j.mode===RA)break;if(j.lens[256]===0){e.msg="invalid code -- missing end-of-block",j.mode=RA;break}if(j.lenbits=9,O={bits:j.lenbits},_=Qs(ky,j.lens,0,j.nlen,j.lencode,0,j.work,O),j.lenbits=O.bits,_){e.msg="invalid literal/lengths set",j.mode=RA;break}if(j.distbits=6,j.distcode=j.distdyn,O={bits:j.distbits},_=Qs(By,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,O),j.distbits=O.bits,_){e.msg="invalid distances set",j.mode=RA;break}if(j.mode=S6,A===F6)break A;case S6:j.mode=w6;case w6:if(a>=6&&u>=258){e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,wT(e,B),i=e.next_out,r=e.output,u=e.avail_out,o=e.next_in,t=e.input,a=e.avail_in,c=j.hold,l=j.bits,j.mode===ft&&(j.back=-1);break}for(j.back=0;E=j.lencode[c&(1<<j.lenbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(y&&!(y&240)){for(w=h,x=y,G=F;E=j.lencode[G+((c&(1<<w+x)-1)>>w)],h=E>>>24,y=E>>>16&255,F=E&65535,!(w+h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=w,l-=w,j.back+=w}if(c>>>=h,l-=h,j.back+=h,j.length=F,y===0){j.mode=NE;break}if(y&32){j.back=-1,j.mode=ft;break}if(y&64){e.msg="invalid literal/length code",j.mode=RA;break}j.extra=y&15,j.mode=ME;case ME:if(j.extra){for(D=j.extra;l<D;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.length+=c&(1<<j.extra)-1,c>>>=j.extra,l-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=RE;case RE:for(;E=j.distcode[c&(1<<j.distbits)-1],h=E>>>24,y=E>>>16&255,F=E&65535,!(h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(!(y&240)){for(w=h,x=y,G=F;E=j.distcode[G+((c&(1<<w+x)-1)>>w)],h=E>>>24,y=E>>>16&255,F=E&65535,!(w+h<=l);){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}c>>>=w,l-=w,j.back+=w}if(c>>>=h,l-=h,j.back+=h,y&64){e.msg="invalid distance code",j.mode=RA;break}j.offset=F,j.extra=y&15,j.mode=_E;case _E:if(j.extra){for(D=j.extra;l<D;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}j.offset+=c&(1<<j.extra)-1,c>>>=j.extra,l-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){e.msg="invalid distance too far back",j.mode=RA;break}j.mode=DE;case DE:if(u===0)break A;if(k=B-u,j.offset>k){if(k=j.offset-k,k>j.whave&&j.sane){e.msg="invalid distance too far back",j.mode=RA;break}k>j.wnext?(k-=j.wnext,f=j.wsize-k):f=j.wnext-k,k>j.length&&(k=j.length),g=j.window}else g=r,f=i-j.offset,k=j.length;k>u&&(k=u),u-=k,j.length-=k;do r[i++]=g[f++];while(--k);j.length===0&&(j.mode=w6);break;case NE:if(u===0)break A;r[i++]=j.length,u--,j.mode=w6;break;case td:if(j.wrap){for(;l<32;){if(a===0)break A;a--,c|=t[o++]<<l,l+=8}if(B-=u,e.total_out+=B,j.total+=B,j.wrap&4&&B&&(e.adler=j.check=j.flags?ue(j.check,r,B,i-B):Js(j.check,r,B,i-B)),B=u,j.wrap&4&&(j.flags?c:UE(c))!==j.check){e.msg="incorrect data check",j.mode=RA;break}c=0,l=0}j.mode=LE;case LE:if(j.wrap&&j.flags){for(;l<32;){if(a===0)break A;a--,c+=t[o++]<<l,l+=8}if(j.wrap&4&&c!==(j.total&4294967295)){e.msg="incorrect length check",j.mode=RA;break}c=0,l=0}j.mode=KE;case KE:_=PT;break A;case RA:_=fy;break A;case Ey:return gy;case yy:default:return mj}return e.next_out=i,e.avail_out=u,e.next_in=o,e.avail_in=a,j.hold=c,j.bits=l,(j.wsize||B!==e.avail_out&&j.mode<RA&&(j.mode<td||A!==yE))&&by(e,e.output,e.next_out,B-e.avail_out),m-=e.avail_in,B-=e.avail_out,e.total_in+=m,e.total_out+=B,j.total+=B,j.wrap&4&&B&&(e.adler=j.check=j.flags?ue(j.check,r,B,e.next_out-B):Js(j.check,r,B,e.next_out-B)),e.data_type=j.bits+(j.last?64:0)+(j.mode===ft?128:0)+(j.mode===S6||j.mode===jd?256:0),(m===0&&B===0||A===yE)&&_===Dr&&(_=CT),_},UT=e=>{if(Lr(e))return mj;let A=e.state;return A.window&&(A.window=null),e.state=null,Dr},HT=(e,A)=>{if(Lr(e))return mj;let j=e.state;return j.wrap&2?(j.head=A,A.done=!1,Dr):mj},QT=(e,A)=>{let j=A.length,t,r,o;return Lr(e)||(t=e.state,t.wrap!==0&&t.mode!==v6)?mj:t.mode===v6&&(r=1,r=Js(r,A,j,0),r!==t.check)?fy:(o=by(e,A,j,j),o?(t.mode=Ey,gy):(t.havedict=1,Dr))},VT=Fy,zT=Sy,XT=hy,WT=NT,JT=wy,YT=KT,ZT=UT,AP=HT,eP=QT,jP="pako inflate (from Nodeca project)",Et={inflateReset:VT,inflateReset2:zT,inflateResetKeep:XT,inflateInit:WT,inflateInit2:JT,inflate:YT,inflateEnd:ZT,inflateGetHeader:AP,inflateSetDictionary:eP,inflateInfo:jP};function tP(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var rP=tP,Iy=Object.prototype.toString,{Z_NO_FLUSH:oP,Z_FINISH:nP,Z_OK:Ai,Z_STREAM_END:nd,Z_NEED_DICT:sd,Z_STREAM_ERROR:sP,Z_DATA_ERROR:QE,Z_MEM_ERROR:iP}=Nr;function ri(e){this.options=x6.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});let A=this.options;A.raw&&A.windowBits>=0&&A.windowBits<16&&(A.windowBits=-A.windowBits,A.windowBits===0&&(A.windowBits=-15)),A.windowBits>=0&&A.windowBits<16&&!(e&&e.windowBits)&&(A.windowBits+=32),A.windowBits>15&&A.windowBits<48&&(A.windowBits&15||(A.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new dy,this.strm.avail_out=0;let j=Et.inflateInit2(this.strm,A.windowBits);if(j!==Ai)throw new Error(Rr[j]);if(this.header=new rP,Et.inflateGetHeader(this.strm,this.header),A.dictionary&&(typeof A.dictionary=="string"?A.dictionary=Zs.string2buf(A.dictionary):Iy.call(A.dictionary)==="[object ArrayBuffer]"&&(A.dictionary=new Uint8Array(A.dictionary)),A.raw&&(j=Et.inflateSetDictionary(this.strm,A.dictionary),j!==Ai)))throw new Error(Rr[j])}ri.prototype.push=function(e,A){let j=this.strm,t=this.options.chunkSize,r=this.options.dictionary,o,i,a;if(this.ended)return!1;for(A===~~A?i=A:i=A===!0?nP:oP,Iy.call(e)==="[object ArrayBuffer]"?j.input=new Uint8Array(e):j.input=e,j.next_in=0,j.avail_in=j.input.length;;){for(j.avail_out===0&&(j.output=new Uint8Array(t),j.next_out=0,j.avail_out=t),o=Et.inflate(j,i),o===sd&&r&&(o=Et.inflateSetDictionary(j,r),o===Ai?o=Et.inflate(j,i):o===QE&&(o=sd));j.avail_in>0&&o===nd&&j.state.wrap>0&&e[j.next_in]!==0;)Et.inflateReset(j),o=Et.inflate(j,i);switch(o){case sP:case QE:case sd:case iP:return this.onEnd(o),this.ended=!0,!1}if(a=j.avail_out,j.next_out&&(j.avail_out===0||o===nd))if(this.options.to==="string"){let u=Zs.utf8border(j.output,j.next_out),c=j.next_out-u,l=Zs.buf2string(j.output,u);j.next_out=c,j.avail_out=t-c,c&&j.output.set(j.output.subarray(u,u+c),0),this.onData(l)}else this.onData(j.output.length===j.next_out?j.output:j.output.subarray(0,j.next_out));if(!(o===Ai&&a===0)){if(o===nd)return o=Et.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(j.avail_in===0)break}}return!0};ri.prototype.onData=function(e){this.chunks.push(e)};ri.prototype.onEnd=function(e){e===Ai&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=x6.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Fd(e,A){let j=new ri(A);if(j.push(e),j.err)throw j.msg||Rr[j.err];return j.result}function aP(e,A){return A=A||{},A.raw=!0,Fd(e,A)}var pP=ri,cP=Fd,uP=aP,lP=Fd,dP=Nr,mP={Inflate:pP,inflate:cP,inflateRaw:uP,ungzip:lP,constants:dP},{Deflate:kP,deflate:BP,deflateRaw:fP,gzip:gP}=FT,{Inflate:EP,inflate:yP,inflateRaw:hP,ungzip:FP}=mP,SP=kP,wP=BP,bP=fP,IP=gP,$P=EP,vP=yP,qP=hP,xP=FP,TP=Nr,Sd={Deflate:SP,deflate:wP,deflateRaw:bP,gzip:IP,Inflate:$P,inflate:vP,inflateRaw:qP,ungzip:xP,constants:TP};n();s();var P6=class{maxSize=5;items=[];enqueue(A,j,t){let r=this.processQuoteResponse(A,j,t?.join(","));this.items.push(r),this.items.length>this.maxSize&&this.items.shift()}getItems(){return[...this.items]}size(){return this.items.length}clear(){this.items=[]}processQuoteResponse(A,j,t){return{quotes:A.quotes.map(o=>({amountIn:o.sellAmount,amountOut:o.buyAmount,tokenIn:M(A.sellToken),tokenOut:M(A.buyToken),provider:o.baseProvider.name})),timestamp:Date.now(),selectedProvider:j,alerts:t}}};var PP="Sq+",wd=class{queue=new P6;addQuoteResponse(A,j,t){this.queue.enqueue(A,j,t)}reset(){this.queue.clear()}getQuotes(){return this.queue.getItems()}logState(A){let j=this.getStateData(A);b.addBreadcrumb("generic",`${PP}${j}`,"info")}processQuoteProcessorState(A){switch(A.type){case"starting":this.reset();break;case"quoteProcessed":this.addQuoteResponse(A.response,A.input.preferredProvider,[...A.quoteDetails.alerts,...A.quoteDetails.warnings].map(j=>j.toString()));break;default:break}}getStateData(A){let j=this.queue.getItems(),t=this.compactData(j,A),r=Sd.gzip(JSON.stringify(t));return Buffer.from(r).toString("base64")}compactData(A,j){return A.length===0?null:{items:A.map(t=>({q:t.quotes.map(r=>({i:r.amountIn,o:r.amountOut,p:r.provider,ti:r.tokenIn,to:r.tokenOut})),t:t.timestamp,sp:t.selectedProvider,a:t.alerts})),th:j}}expandData(A){return A.items.map(j=>({quotes:j.q.map(t=>({amountIn:t.i,amountOut:t.o,tokenIn:t.ti,tokenOut:t.to,provider:t.p})),timestamp:j.t,selectedProvider:j.sp,alerts:j.a}))}decode(A){try{let j=Buffer.from(A,"base64"),t=Sd.inflate(j,{to:"string"}),r=JSON.parse(t);return r?{items:this.expandData(r),txnHash:r.th}:{items:[]}}catch(j){return console.error("Failed to decode compressed data:",j),{items:[]}}}},xj=new wd;n();s();n();s();var SA=class extends Error{code;detailMessage;constructor(A,j){super(A),this.code=A,this.detailMessage=j}};var GP="slippageToleranceExceeded",CP="INSUFFICIENT_FUNDS",OP=Ck,MP="insufficient lamports",RP="lower balance than rent-exempt minimum",_P=Gk,DP="Transaction confirmation failed",NP=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],LP="Ledger user rejected action",KP="Ledger Sign Error";function UP(e){try{return Number(e.split('"Custom":')[1].split("}")[0])}catch{return null}}function HP(e){switch(UP(e.message)){case 301:return"slippageToleranceExceeded";case 6e3:return"EmptyRoute";case 6001:return"slippageToleranceExceeded";case 6002:return"InvalidCalculation";case 6003:return"MissingPlatformFeeAccount";case 6004:return"InvalidSlippage";case 6005:return"NotEnoughPercent";case 6006:return"InvalidInputIndex";case 6007:return"InvalidOutputIndex";case 6008:return"NotEnoughAccountKeys";case 6009:return"NonZeroMinimumOutAmountNotSupported";case 6010:return"InvalidRoutePlan";case 6011:return"InvalidReferralAuthority";case 6012:return"LedgerTokenAccountDoesNotMatch";case 6013:return"InvalidTokenLedger";case 6014:return"IncorrectTokenProgramID";case 6015:return"TokenProgramNotProvided";case 6016:return"SwapNotSupported";case 6017:return"ExactOutAmountNotMatched";case 6018:return"SourceAndDstinationMintCannotBeTheSame";default:return null}}function QP(e){return NP.some(j=>e.message.includes(j))?"LedgerConnectionError":e.message.includes(LP)?"LedgerRejectAction":e.message.includes(KP)?"LedgerUnknownSignError":e.message.toLowerCase().includes("ledger")?"LedgerUnknownError":null}function Ar(e){if(e===void 0)return new SA("UnknownError","No error provided");if(e instanceof SA)return e;let A=VP(e);if(A.message.includes(CP))return new SA("INSUFFICIENT_FUNDS");if(zP(A.message))return new SA("slippageToleranceExceeded");if(A.message==="Scan results are not valid")return new SA("Scan results are not valid");if([OP,MP,_P,RP].some(u=>A.message.includes(u)))return new SA("NotEnoughSol");let o=HP(A);if(o!==null)return new SA(o);if(A.message.includes(DP))return new SA("Transaction confirmation failed");let a=QP(A);return a!==null?new SA(a):new SA("UnknownError",A.message)}function VP(e){return typeof e=="string"?new Error(e):typeof e=="object"&&"logs"in e&&e.logs?.length?new Error(e.logs.join(`
`)):e}function zP(e){return e.includes(GP)}n();s();n();s();var $y=3;function G6(){try{let e=Te.getMultivariateAssignment("swapper-high-slippage-threshold"),A=Number(e);return!e||isNaN(A)?$y:A}catch{return $y}}var vy=({currentQuote:e,quoteResponse:A,gasEstimation:j,swapTransactions:t,scanResults:r,isSwapSimulationDisabled:o,slippageTolerance:i})=>{if(!e)throw new SA("Trying to execute swap with no current quote");if(!A)throw new SA("Trying to execute swap with no quote response");if(I.isEVMNetworkID(A.sellToken.chainId)&&(!j||j?.length===0||j?.length<(t?.transactions.length??1)))throw new SA("No gas estimation available");if(!t)throw new SA("No swap transactions available");if(r.state!=="valid"&&(b.addBreadcrumb("swapper","swapSimulationNotValid","info",Rt({scanResults:r.state})),!o)){let u=["Scan results are not valid","AccountFrozen","INSUFFICIENT_FUNDS","INSUFFICIENT_GAS","slippageToleranceExceeded","SIMULATION_TIMEOUT","MissingArgument","STALE_QUOTE","SimulationUnknownError"];if(WP(r.state)&&u.includes(r.state.code)){if(XP(r.state,i))return;throw r.state}else throw new SA("Scan results are not valid")}};function XP(e,A){return e.code==="slippageToleranceExceeded"&&A&&A>=G6()}function WP(e){return e instanceof SA}var JP={swap:{solana:"executeSolanaSwap",evm:"executeEvmSwap",sui:"executeSuiSwap"},bridge:{solana:"executeSolanaBridge",evm:"executeEvmBridge",sui:"executeSuiBridge"}},bd=(e,A)=>JP[e?"bridge":"swap"][A??"solana"],qy=async({isBridge:e,addressType:A,isSwapSimulationDisabled:j,sender:t,currentQuote:r,quoteResponse:o,gasEstimation:i,swapTransactions:a,scanResults:u,pendingActivityRows:c,connection:l,logSwapFailureNoSignature:m,logTransactionSubmitted:B,onTransactionReceiptReceived:k,onTransactionSubmissionError:f,resetToInitialState:g,slippageTolerance:E,swapFungibles:h})=>{await b.startSpan(bd(e,a?.type),async()=>{g();let y;try{vy({currentQuote:r,quoteResponse:o,gasEstimation:i,swapTransactions:a,scanResults:u,isSwapSimulationDisabled:j,slippageTolerance:E});let F=await h({type:A,callerAddress:t,swapTransactions:a,pendingSwapActivityRows:c.pendingSwapActivityRows,pendingApprovalActivityRows:c.pendingApprovalActivityRows,gasEstimation:i,connection:l});if(k(F),F.error)throw F.id||m(),y=F.id,F.error;B(F),xj.logState(F.id)}catch(F){let w=Ar(F);f(w,y)}})};n();s();n();s();n();s();n();s();var yt=(u=>(u.SlippageExceeded="SLIPPAGE_EXCEEDED",u.InsufficientFunds="INSUFFICIENT_FUNDS",u.InsufficientGas="INSUFFICIENT_GAS",u.AccountFrozen="ACCOUNT_FROZEN",u.SimulationTimeout="SIMULATION_TIMEOUT",u.StaleQuote="STALE_QUOTE",u.UnknownError="UNKNOWN_ERROR",u.SimulationFailed="SIMULATION_FAILED",u))(yt||{}),pn=class e extends Error{constructor(j,t,r){super(j);this.scannedTransactionResult=t;this.type=r;t&&(this.detailMessage=t.simulationError?.humanReadableError??(t.warnings.length>0?t.warnings[0].message:void 0)),this.type=r}detailMessage;static fromError(j){return j instanceof e?j:new e(j.message)}static fromScannedTransactionResult(j,t){return(o=>Object.values(yt).includes(o))(j)?new e(j,t,j):new e(j,t)}};n();s();var Kr=class e extends Error{constructor(j,t){super(j);this.type=t}static fromError(j){return new e(j.message)}static fromType(j){return new e(j,j)}};var xy="https://phantom.com",C6=class{constructor(A,j,t){this.swapCommand=A;this.send=j;this.executingQuote=t;this.takerAddress=A.takerAddress,this.networkId=A.networkId,this.quote=A.quote,this.executionId=A.executionId}takerAddress;networkId;quote;executionId;createTransaction(){return this.send({type:"executeSwapStarted",executionId:this.executionId,executingQuote:this.executingQuote}),this.swapCommand.createTransaction()}async fetchSimulation(A){let{transactions:j,deviceId:t,isSimulationKilled:r}=A,o=me(T.language)??"en";if(I.isSuiNetworkID(this.networkId))return{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0};let i=await Wo({transactions:j,locale:o,url:xy,deviceId:t,takerAddress:this.takerAddress,networkId:this.networkId,slippageType:this.executingQuote.slippageType,quote:this.quote,quoteResponse:this.executingQuote.response,isSimulationKilled:r});return i.status==="success"?i.result:null}async simulate(A,j,t,r){try{this.send({type:"simulationRequestStarted",executionId:this.executionId,executingQuote:this.executingQuote,networkId:this.networkId});let o=await this.fetchSimulation({transactions:A,deviceId:t,isSimulationKilled:r});if(!o)return this.send({type:"simulationSkipped",executionId:this.executionId,networkId:this.networkId}),null;switch(o.error){case void 0:break;case"SIMULATION_FAILED":break;case"SLIPPAGE_EXCEEDED":if(this.executingQuote.response.slippageTolerance>=G6())break;default:throw pn.fromScannedTransactionResult(o.error,o)}return this.send({type:"simulationPassed",scannedTransactionResult:o,executionId:this.executionId,networkId:this.networkId}),o}catch(o){throw this.send({type:"simulationFailed",error:pn.fromError(o),executionId:this.executionId,networkId:this.networkId,url:xy}),o}}async swap(A,j,t,r,o){this.send({type:"transactionSubmissionStarted",executionId:this.executionId});try{let i=await this.swapCommand.swap(A,j,t,r,o);if(!i.id)throw Kr.fromType("noSignature");return this.send({type:"transactionSubmissionSuccess",txReceipt:i,executionId:this.executionId}),i}catch(i){let a=i instanceof Kr?i:Kr.fromError(i);throw this.send({type:"transactionSubmissionFailed",error:a,executionId:this.executionId}),a}}async waitForConfirmation(A){this.send({type:"transactionConfirmationStarted",executionId:this.executionId,txReceipt:A});try{let j=await this.swapCommand.waitForConfirmation(A);return this.send({type:"transactionConfirmed",executionId:this.executionId,txReceipt:A}),j}catch(j){throw this.send({type:"transactionConfirmationFailed",error:j,txReceipt:A,executionId:this.executionId}),j}}};n();s();n();s();var O6=class extends Error{constructor(A,j){let r=(Array.isArray(j)?j:[j]).join(", ");super(`Can't transition to ${r} from ${A.type}`)}},M6=class{state=new Map;listeners=new Set;send(A){A.type==="executeSwapStarted"&&this.state.set(A.executionId,{type:"idle",executingQuote:A.executingQuote});let j=this.state.get(A.executionId);if(!j)throw new Error(`No previous state found for execution id: ${A.executionId}`);let t=j;try{return t=this.detectNextState(j,A),t.type==="transactionConfirmed"?this.state.delete(A.executionId):this.state.set(A.executionId,t),t}catch{return j}finally{this.notifyListeners(A,j,t,this.state)}}notifyListeners(A,j,t,r){try{this.listeners.forEach(o=>o.onStateChange(A,j,t,r))}catch{}}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}detectNextState(A,j){switch(j.type){case"executeSwapStarted":return rt(A,"idle"),{type:"started",executingQuote:j.executingQuote};case"simulationRequestStarted":return rt(A,"started"),{type:"simulating",executingQuote:A.executingQuote};case"simulationPassed":return rt(A,"simulating"),{type:"simulated",scannedTransactionResult:j.scannedTransactionResult,executingQuote:A.executingQuote};case"simulationFailed":return rt(A,"simulating"),{type:"simulationFailed",error:j.error,executingQuote:A.executingQuote};case"simulationSkipped":return rt(A,"simulating"),{type:"simulationSkipped",executingQuote:A.executingQuote};case"transactionSubmissionStarted":return YP(A,["simulated","simulationSkipped"]),{type:"submittingTransaction",executingQuote:A.executingQuote,scannedTransactionResult:A.type==="simulated"?A.scannedTransactionResult:void 0};case"transactionSubmissionFailed":return rt(A,"submittingTransaction"),{type:"transactionSubmissionFailed",error:j.error,executingQuote:A.executingQuote,scannedTransactionResult:A.scannedTransactionResult};case"transactionSubmissionSuccess":return rt(A,"submittingTransaction"),{type:"transactionSubmitted",txReceipt:j.txReceipt,executingQuote:A.executingQuote,scannedTransactionResult:A.scannedTransactionResult};case"transactionConfirmationStarted":return rt(A,"transactionSubmitted"),{type:"confirmingTransaction",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,executingQuote:A.executingQuote};case"transactionConfirmationFailed":return rt(A,"transactionSubmitted"),{type:"transactionNotConfirmed",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,error:j.error,executingQuote:A.executingQuote};case"transactionConfirmed":return rt(A,"confirmingTransaction"),{type:"transactionConfirmed",txReceipt:A.txReceipt,scannedTransactionResult:A.scannedTransactionResult,executingQuote:A.executingQuote}}}};function rt(e,A){if(e.type!==A)throw new O6(e,A)}function YP(e,A){if(!A.includes(e.type))throw new O6(e,A)}n();s();function Py(e){return e.type==="quote"}n();s();n();s();var ZP={"Could not find any routes":"noRoute"},R6=class e extends Error{type;constructor(A,j){super(j??A),this.type=A}static fromMessage(A){let j=A?ZP[A]??"undefinedError":"undefinedError";return new e(j,A)}};var Ur=class extends Error{constructor(A,j){super(`Can't transition to ${j} from ${A.type}`)}},_6=class{state;listeners=new Set;constructor(A){this.state=A??{type:"idle"}}send(A){let j=this.state;try{return j=this.detectNextState(this.state,A),this.state=j,j}catch{return this.state}finally{this.notifyListeners(A,this.state,j)}}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}notifyListeners(A,j,t){try{this.listeners.forEach(r=>r.onStateChange(A,j,t))}catch{}}detectNextState(A,j){switch(j.type){case"setPair":return{type:"pair",buy:j.buy,sell:j.sell,amount:j.amount};case"quoteRequestStarted":switch(A.type){case"pair":case"quote":case"quoteError":return{type:"fetchingQuote",buy:A.buy,sell:A.sell,amount:j.amount,slippageType:j.slippageType};default:throw new Ur(A,j.type)}case"quoteRequestError":if(A.type!=="fetchingQuote")throw new Ur(A,j.type);return{type:"quoteError",buy:A.buy,sell:A.sell,amount:A.amount,error:j.error,slippageType:A.slippageType};case"quoteResponseReceived":if(A.type!=="fetchingQuote")throw new Ur(A,j.type);let t=j.response.quotes[0];return t?{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:t,amount:A.amount,slippageType:A.slippageType}:{type:"quoteError",buy:A.buy,sell:A.sell,amount:A.amount,error:new R6("noRoute"),slippageType:A.slippageType};case"quoteResponseStreamed":switch(A.type){case"pair":case"fetchingQuote":case"quote":case"quoteError":return{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:j.quote,amount:{amount:j.quoteInput.amount,perspective:j.quoteInput.exactOut?"buy":"sell"},slippageType:j.quoteInput.autoSlippage?"auto":"fixed",input:j.quoteInput};default:throw new Ur(A,j.type)}case"userSelectedQuote":if(A.type!=="quote")throw new Ur(A,j.type);return{type:"quote",quote:j.quote,buy:A.buy,sell:A.sell,response:A.response,amount:A.amount,slippageType:A.slippageType}}}};n();s();n();s();var Cy=p.object({buyToken:p.custom(),sellToken:p.custom(),buyTokenPrice:p.custom().optional(),sellTokenPrice:p.custom().optional(),maxSellAmount:p.string().optional()}),ni=class e extends Error{constructor(j,t){super(t??j.name);this.type=j}static fromError(j){return new e({name:"unknown"},j.message)}};var jr=class{async initialize(A,j,t,r){let o=j.reduce((u,c)=>(u[c.networkID]=c.address,u),{}),i=await N.api().headers({"Content-Type":"application/json"}).timeout(Q({seconds:20})).post("/swap/v2/initialize",{...A,addresses:o,cashAddresses:t,...r?{settings:r}:{}});if(i.status!==200)throw new DA({key:"SwapInitializationFailed"});let a=Cy.safeParse(i.data);if(!a.success)throw new DA({key:"SwapInitializationFailed"});return a.data}};n();s();function Oy(e){if(e.type!=="pair")return;let A=M(V(e.buyToken)),j=M(V(e.sellToken)),t,r;return e.mode.type==="swap"?(t=e.mode.takerDestinationCaip19,r=e.mode.takerCaip19):e.mode.type==="buy"?(t=void 0,r=e.mode.takerCaip19):e.mode.type==="sell"&&(t=e.mode.takerDestinationCaip19,r=void 0),{type:"swap",network:A?TA(A).chainId:I.solana.mainnetID,sellCaip19:A,buyCaip19:j,takerCaip19:t,takerDestinationCaip19:r}}n();s();n();s();n();s();n();s();n();s();n();s();var Id=5,$d=5,My={id:I.solana.mainnetID,imageUrl:I.solana.iconUrl,name:I.solana.name,symbol:I.solana.tokenSymbol},tr={type:"SolanaNative",data:{amount:"0",balance:new U(0),chain:My,decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:"VERIFIED"}},vd={type:"SPL",data:{amount:"0",balance:new U(0),chain:My,decimals:6,key:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",splTokenAccountPubkey:"EAF7dH8Jy43Xgp68PhyybKhfKxk46NFRkWN4PMCLqMfS",symbol:"USDC",tokenAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",walletAddress:"",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:"VERIFIED"}},Ry={type:"SuiNative",data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/sui/info/logo.png",name:"Sui",symbol:"SUI",balance:new U(0),key:"SuiNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:"VERIFIED"}},_y={type:"SuiCoin",data:{chain:{id:I.sui.mainnetID,name:I.sui.name,symbol:I.sui.tokenSymbol,imageUrl:I.sui.iconUrl},walletAddress:"",contractAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",decimals:6,amount:"0",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new U(0),key:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",tokenAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:"VERIFIED"}},Dy={type:"PolygonNative",data:{chain:{id:I.polygon.mainnetID,name:I.polygon.name,symbol:I.polygon.tokenSymbol,imageUrl:I.polygon.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://wallet-asset.matic.network/img/tokens/matic.svg",name:"Polygon",symbol:I.polygon.tokenSymbol,balance:new U(0),key:"PolygonNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ny={type:"BaseNative",data:{chain:{id:I.base.mainnetID,name:I.base.name,symbol:I.base.tokenSymbol,imageUrl:I.base.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Base",symbol:I.base.tokenSymbol,balance:new U(0),key:"BaseNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ly={type:"ArbitrumNative",data:{chain:{id:I.arbitrum.mainnetID,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol,imageUrl:I.arbitrum.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new U(0),key:"ArbitrumNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:"VERIFIED"}},Ky={type:"ERC20",data:{amount:"0",balance:new U(0),decimals:6,key:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",walletAddress:"",chain:{id:I.polygon.mainnetID,imageUrl:I.polygon.iconUrl,name:I.polygon.name,symbol:I.polygon.tokenSymbol},contractAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",spamStatus:"VERIFIED"}},Uy={type:"ERC20",data:{amount:"0",balance:new U(0),decimals:6,key:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",walletAddress:"",chain:{id:I.base.mainnetID,imageUrl:I.base.iconUrl,name:I.base.name,symbol:I.base.tokenSymbol},contractAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",spamStatus:"VERIFIED"}},Hy={type:"ERC20",data:{amount:"0",balance:new U(0),decimals:6,key:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",walletAddress:"",chain:{id:I.arbitrum.mainnetID,imageUrl:I.arbitrum.iconUrl,name:I.arbitrum.name,symbol:I.arbitrum.tokenSymbol},contractAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",spamStatus:"VERIFIED"}},Qy={type:"EthereumNative",data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new U(0),key:"EthereumNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:"VERIFIED"}},Vy={type:"ERC20",data:{chain:{id:I.ethereum.mainnetID,name:I.ethereum.name,symbol:I.ethereum.tokenSymbol,imageUrl:I.ethereum.iconUrl},walletAddress:"",contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,amount:"1881092",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new U(0),key:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",tokenAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:"VERIFIED"}},si=vd,qd=tr;var D6="https://help.phantom.com/hc/en-us/articles/5985106844435",zy="https://help.phantom.com/hc/en-us/articles/29763090277139";var Hr=18;var un=500,rr={amount:new U(0),amountUsd:null,pct:0};n();s();var or={};var Xy={...or,bridgeMinimumUsdAmounts:0,swapDefaultFee:new U(15e-5*10**18),bridgeDefaultFee:new U(.025*10**18),averageNetworkFee:new U(15e-5*10**18),nativeFungible:Ly,usdcFungible:Hy};n();s();var Wy={...or,bridgeMinimumUsdAmounts:0,swapDefaultFee:new U(15e-5*10**18),bridgeDefaultFee:new U(.025*10**18),averageNetworkFee:new U(15e-5*10**18),nativeFungible:Ny,usdcFungible:Uy};n();s();var Jy={...or,bridgeMinimumUsdAmounts:20,swapDefaultFee:new U(2.5*10**16),bridgeDefaultFee:new U(3.75*10**16),averageNetworkFee:new U(0),nativeFungible:Qy,usdcFungible:Vy};n();s();var Yy={...or,bridgeMinimumUsdAmounts:2,swapDefaultFee:new U(6*10**16),bridgeDefaultFee:new U(6*10**16),averageNetworkFee:new U(.0015*10**18),nativeFungible:Dy,usdcFungible:Ky};n();s();var Zy={bridgeMinimumUsdAmounts:1,swapDefaultFee:new U(3*10**6),bridgeDefaultFee:new U(30*10**6),averageNetworkFee:new U(15e3),nativeFungible:tr,usdcFungible:vd};n();s();var Ah={bridgeMinimumUsdAmounts:1,swapDefaultFee:new U(50*10**6),bridgeDefaultFee:new U(50*10**6),averageNetworkFee:new U(50*10**6),nativeFungible:Ry,usdcFungible:_y};var ZrA=["solana","ethereum","polygon","base","sui","arbitrum"],eG=new Bo({solana:Zy,ethereum:Jy,polygon:Yy,base:Wy,sui:Ah,arbitrum:Xy}),NA=ko(eG);var Qr=(e,A)=>{let j=[];if(jG(e)&&j.push({type:"permanentDelegate",level:"warn",titleKey:"swapAssetWarningPermanentDelegate"}),(e.data.spamStatus==="NOT_VERIFIED"||e.data.spamStatus==="SPAM"||e.data.spamStatus==="POSSIBLE_SPAM")&&j.push({type:"unverified",level:"info",titleKey:"swapAssetWarningUnverified"}),!ZA(e.type)&&A&&tG(A)){let t=NA.get(e.data.chain.id).nativeFungible;j.push({type:"lowBalance",level:"info",titleKey:"swapAssetWarningLowTokenBalance",options:{token:t.data.symbol??"",network:t.data.chain.name}})}return j};function jG(e){let A=e.data;return A?.mintExtensions?A.mintExtensions.some(j=>j.extension==="permanentDelegate"):!1}function tG(e){let A=NA.get(e.data.chain.id);return new S(e.data.amount?e.data.amount:0).lt(A.swapDefaultFee)}n();s();var rG=3,eh=new S(2039280),oG=new S(356190);function N6(e,A){if(!ZA(e.type))return new S(e.data.balance);let{balance:j,decimals:t}=e.data,r=j?new S(j).multipliedBy(10**t):new S(0),o=nG(e,A);return(r.gt(o)?r.minus(o):r).dividedBy(10**t)}function nG(e,A){let j=e.data.chain.id;if(I.isSolanaNetworkID(j))return sG(e,A);if(I.isEVMNetworkID(j))return iG(e,A);if(I.isSuiNetworkID(j))return aG(e,A);throw new Error("Chain not supported by swapper")}function sG(e,A){let{defaultSwapFee:j,networkFeeBuffer:t}=xd(e,A),r=j.plus(t),o=eh,i=!A||new S(A.data.balance).isZero()?eh:new S(0);return r.plus(o).plus(i)}function iG(e,A){let{networkFeeBuffer:j}=xd(e,A),t=pG(e.data.chain.id),r=new S(t.maxFeePerGas),o=new S(t.maxPriorityFeePerGas);return oG.multipliedBy(r.plus(o)).plus(j)}function aG(e,A){let{defaultSwapFee:j,networkFeeBuffer:t}=xd(e,A);return j.plus(t)}function xd(e,A){let j=vA(e.data.chain.id,A?.data.chain.id),t=NA.get(e.data.chain.id),r=j?t.bridgeDefaultFee:t.swapDefaultFee,o=t.averageNetworkFee.multipliedBy(rG);return{defaultSwapFee:r,networkFeeBuffer:o}}function pG(e){if(I.isEthereumNetworkID(e))return{maxFeePerGas:new S("5000000000"),maxPriorityFeePerGas:new S("79000000")};if(I.isPolygonNetworkID(e))return{maxFeePerGas:new S("30000000000"),maxPriorityFeePerGas:new S("30000000000")};if(I.isBaseNetworkID(e))return{maxFeePerGas:new S("25000000"),maxPriorityFeePerGas:new S("1100000")};if(I.isArbitrumNetworkID(e))return{maxFeePerGas:new S("29000000"),maxPriorityFeePerGas:new S("0")};throw new Error("Chain not supported by swapper")}var L6=class{state={type:"idle"};eventListeners=[];send(A){let j=this.state,t=j;try{return t=this.detectNextState(A),this.state=t,t}catch{return j}finally{this.eventListeners.forEach(r=>r.onStateChange(A,j,t))}}detectNextState(A){switch(A.type){case"initializeStarted":return{type:"initializing",mode:A.mode};case"initializeCompleted":if(this.state.type==="initializing"||this.state.type==="refreshing"){let j=new S(A.result.maxSellAmount??A.result.sellToken.data.balance);return{type:"pair",mode:this.state.mode,sellToken:A.result.sellToken,buyToken:A.result.buyToken,sellTokenPrice:A.result.sellTokenPrice,buyTokenPrice:A.result.buyTokenPrice,warnings:Qr(A.result.buyToken),maxSellAmount:j}}throw new Error("Invalid state");case"initializeFailed":if(this.state.type!=="initializing")throw new Error("Invalid state");return{type:"error",error:A.error};case"switchTokens":{if(this.state.type!=="pair")throw new Error("Invalid state");let j=this.state.buyToken,t=this.state.sellToken,r=this.state.buyTokenPrice,o=this.state.sellTokenPrice;return{type:"pair",mode:A.mode,sellToken:j,buyToken:t,sellTokenPrice:r,buyTokenPrice:o,maxSellAmount:N6(j,t),warnings:Qr(t)}}case"changeToken":{if(this.state.type!=="pair")throw new Error("Invalid state");let j=A.perspective==="sell"?A.token:this.state.sellToken,t=A.perspective==="buy"?A.token:this.state.buyToken;return{type:"pair",mode:A.mode,sellToken:j,buyToken:t,sellTokenPrice:A.sellTokenPrice??this.state.buyTokenPrice,buyTokenPrice:A.buyTokenPrice??this.state.sellTokenPrice,maxSellAmount:N6(j,t),warnings:Qr(A.perspective==="buy"?A.token:this.state.buyToken)}}case"updateBalances":{if(this.state.type!=="pair")throw new Error("Invalid state");if(M(V(this.state.sellToken))!==A.sellTokenCaip19)throw new Error("Invalid state");let j={...this.state.sellToken,data:{...this.state.sellToken.data,balance:A.sellTokenBalance}},t=this.state.buyToken;return{type:"pair",mode:this.state.mode,sellToken:j,buyToken:t,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,warnings:Qr(t),maxSellAmount:N6(j,t)}}case"refreshing":if(this.state.type!=="pair")throw new Error("Invalid state");return{type:"refreshing",mode:this.state.mode,sellToken:this.state.sellToken,buyToken:this.state.buyToken,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,maxSellAmount:this.state.maxSellAmount,warnings:this.state.warnings}}}getState(){return this.state}subscribe(A){this.eventListeners.push(A)}unsubscribe(A){this.eventListeners=this.eventListeners.filter(j=>j!==A)}};var ii=class{constructor(A,j,t,r){this.apiClient=A;this.swapCommandFactory=j;this.quoteProcessor=t;this.quoteProcessor.subscribe(this.quoteProcessorListener),this.tokenStateMachine.subscribe(this.tokenStateListener),r&&(this.account=r)}stateMachine=new _6;executeSwapStateMachine=new M6;account;cashAccount;config={slippageType:"auto",slippageTolerance:1.3,isSimulationKilled:!1};swapInitializer=new jr;tokenStateMachine=new L6;accountChangeListeners=[];tokenStateListener={onStateChange:(A,j,t)=>{t.type==="pair"&&(this.setPair(t.buyToken,t.sellToken,{amount:"0",perspective:"sell"}),A.type==="changeToken"&&this.refreshQuoteProcessor())}};refreshPair({swapMode:A,cashAddresses:j,settings:t}){this.initializeSwap({swapMode:A,cashAddresses:j,settings:t,refresh:!0})}initializeSwap({swapMode:A,cashAddresses:j,settings:t,refresh:r=!1}){let o=this.checkAccount();this.getTokenState().type==="pair"&&r?this.tokenStateMachine.send({type:"refreshing"}):this.tokenStateMachine.send({type:"initializeStarted",mode:A}),this.swapInitializer.initialize(A,o.addresses,j,t).then(a=>{this.tokenStateMachine.send({type:"initializeCompleted",result:a})}).catch(a=>{b.captureError(a,"swapper"),a instanceof ni?this.tokenStateMachine.send({type:"initializeFailed",error:a}):this.tokenStateMachine.send({type:"initializeFailed",error:ni.fromError(a)})})}updateBalances({sellTokenBalance:A,sellTokenCaip19:j}){this.getTokenState().type==="pair"&&this.tokenStateMachine.send({type:"updateBalances",sellTokenBalance:A,sellTokenCaip19:j})}getTokenState(){return this.tokenStateMachine.getState()}subscribeToken(A){return this.tokenStateMachine.subscribe(A),()=>this.unsubscribeToken(A)}unsubscribeToken(A){this.tokenStateMachine.unsubscribe(A)}quoteProcessorListener={onStateChange:(A,j)=>{(j.type==="firstQuoteReceived"||j.type==="quoteProcessed")&&this.send({type:"quoteResponseStreamed",response:j.response,quoteInput:j.input,quote:j.quote})}};isValidAmount(A){try{let j=new S(A);return j.isFinite()?!j.isNegative():!1}catch{return!1}}setAmount(A,j){let{amount:t}=A;if(t===""&&(t="0"),!this.isValidAmount(t))return;this.quoteProcessor.stop();let r=this.checkAccount(),o=this.getState(),i={...this.config,...j,isSimulationKilled:j?.isSimulationKilled??this.config.isSimulationKilled??!1};switch(o.type){case"pair":case"quote":case"quoteError":if(t==="0"||t===""){this.send({type:"setPair",buy:o.buy,sell:o.sell,amount:A});return}let a=this.checkChainAddress(o.sell.data),u=this.checkChainAddress(o.buy.data),c={chainId:a.networkID,resourceType:"address",address:a.address},l={chainId:u.networkID,resourceType:"address",address:u.address};try{let m={amount:new S(A.amount).shiftedBy(A.perspective==="buy"?o.buy.data.decimals:o.sell.data.decimals).toString(),amountUsd:S(A.amount).times(A.perspective==="buy"?o.buy.data.price??0:o.sell.data.price??0).toString(),buy:o.buy,sell:o.sell,taker:M(c),takerDestination:M(l),slippageTolerance:i.slippageTolerance,autoSlippage:i.slippageType==="auto",exactOut:A.perspective==="buy",priorityFee:i.priorityFee,tipAmount:i.tipAmount,preferredProvider:i.preferredProvider,isLedger:r.type==="ledger",phantomCashAccount:i.phantomCashAccount??!1,isSimulationKilled:i.isSimulationKilled};this.quoteProcessor.start(m,r)}catch(m){console.error("Error when streaming quotes",m)}break}}setPair(A,j,t){this.send({type:"setPair",buy:A,sell:j,amount:t})}switchTokens(){let A=this.getTokenState();if(A.type!=="pair")return;let j=Oy(A);j&&this.tokenStateMachine.send({type:"switchTokens",mode:j})}setAccount(A){this.account=A,this.accountChangeListeners.forEach(j=>j.onAccountChange(A))}setCashAccount(A){this.cashAccount=A}getAccount(){return this.account}async fetchQuotes({amount:A,amountUsd:j,buy:t,sell:r,slippageTolerance:o,autoSlippageEnabled:i,priorityFee:a,tipAmount:u,signal:c,phantomCashAccount:l}){let m=V(r),B=V(t),k=A.perspective==="buy",f=new S(A.amount).shiftedBy(A.perspective==="buy"?t.data.decimals:r.data.decimals).toString();this.send({type:"quoteRequestStarted",amount:A,slippageType:i?"auto":"fixed"});let g=this.checkChainAddress(r.data),E={chainId:g.networkID,resourceType:"address",address:g.address},h;if(vA(r.data.chain.id,t.data.chain.id)){let y=this.checkChainAddress(t.data);h={chainId:y.networkID,resourceType:"address",address:y.address}}try{let y=await this.apiClient.getQuotes({sell:m,buy:B,amount:f,amountUsd:j,taker:E,takerDestination:h,slippageTolerance:o??0,autoSlippageEnabled:i,exactOutEnabled:k,priorityFee:a,tipAmount:u,signal:c,phantomCashAccount:l});return this.send({type:"quoteResponseReceived",response:y}),y}catch(y){throw this.send({type:"quoteRequestError",error:y}),y}}async swap(A){let{signer:j,storage:t,locale:r,deviceId:o,connection:i,authRepository:a,isSimulationKilled:u,gasEstimation:c,preprocessor:l}=A,m=this.getState();if(!Py(m))throw new Error(`Can't swap from ${m.type}`);this.quoteProcessor.stop();let B=this.checkAccount(),k=this.checkChainAddress(m.sell.data),f={account:B,buy:m.buy,sell:m.sell,amount:m.amount,quote:m.quote,response:m.response,slippageType:m.slippageType,quoteInput:m.input},g=this.swapCommandFactory.create(f,k.address,k.networkID,i,a,this.cashAccount,c),E=new C6(g,y=>this.executeSwapStateMachine.send(y),f),h=await E.createTransaction();await b.startSpan(bd(dA(m.quote),h.type),async()=>{let y=await E.simulate(h,r,o,u),F=async()=>{let w=await E.swap(B.identifier,h,y,j,t);await E.waitForConfirmation(w)};l?await l(F):await F()})}changeToken(A,j,t){let r=this.getTokenState();if(r.type!=="pair")return;let o=j==="buy"?A:r.buyToken,i=j==="sell"?A:r.sellToken,a=V(i),u=V(o),c;r.mode.type==="swap"?c={...r.mode,network:i.data.chain.id,sellCaip19:M(a),buyCaip19:M(u),takerCaip19:j==="sell"?t:r.mode.takerCaip19,takerDestinationCaip19:j==="buy"?t:r.mode.takerDestinationCaip19}:r.mode.type==="buy"?c={...r.mode,buyCaip19:M(u),sellCaip19:M(a),takerCaip19:j==="buy"?t:r.mode.takerCaip19}:r.mode.type==="sell"&&(c={...r.mode,sellCaip19:M(a),buyCaip19:M(u),takerDestinationCaip19:j==="sell"?t:r.mode.takerDestinationCaip19}),ma({tokens:[u,a]}).then(l=>{let m=l[M(u)],B=l[M(a)];this.tokenStateMachine.send({type:"changeToken",mode:c,token:A,perspective:j,buyTokenPrice:m,sellTokenPrice:B})}).catch(l=>{b.captureError(l,"swapper"),this.tokenStateMachine.send({type:"changeToken",mode:c,token:A,perspective:j})})}selectQuote(A){this.send({type:"userSelectedQuote",quote:A})}setQuoteConfig(A){this.config={...this.config,...A},this.refreshQuoteProcessor()}refreshQuoteProcessor(){let A=this.getLastQuoteProcessorSwapAmount();A&&this.setAmount(A)}getLastQuoteProcessorSwapAmount(){let A=this.getQuoteProcessorState();switch(A.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":let j=A.input;return{amount:new S(j.amount).shiftedBy(-1*(j.exactOut?j.buy.data.decimals:j.sell.data.decimals)).toString(),perspective:j.exactOut?"buy":"sell"};default:return}}getState(){return this.stateMachine.getState()}getExecuteState(){return this.executeSwapStateMachine.getState()}stopProcessingQuotes(){this.quoteProcessor.stop()}subscribeExecution(A){return this.executeSwapStateMachine.addListener(A),()=>this.unsubscribeExecution(A)}unsubscribeExecution(A){this.executeSwapStateMachine.removeListener(A)}getQuoteProcessorState(){return this.quoteProcessor.getState()}subscribeQuoteProcessor(A){return this.quoteProcessor.subscribe(A),()=>this.unsubscribeQuoteProcessor(A)}unsubscribeQuoteProcessor(A){this.quoteProcessor.unsubscribe(A)}stopQuoteProcessor(){this.quoteProcessor.stop()}subscribeAccountChange(A){return this.accountChangeListeners.push(A),()=>this.unsubscribeAccountChange(A)}unsubscribeAccountChange(A){this.accountChangeListeners=this.accountChangeListeners.filter(j=>j!==A)}send(A){return this.stateMachine.send(A)}checkAccount(){if(!this.account)throw new Error("Must set a MultiChainAccount");return this.account}checkChainAddress({chain:A,walletAddress:j}){let{id:t}=A;if(j)return{networkID:t,address:j};let o=this.checkAccount().addresses.find(a=>a.networkID===t);if(!o)throw new Error(`No address found for chain ${t}`);let i={...o};return mo(i)&&(i.address=i.address.toLowerCase()),i}};var jh=(0,ot.createContext)(null);function cG({children:e,processorMode:A="noOp"}){let{data:j}=pA(),{data:t}=vs(),r=(0,ot.useMemo)(()=>uG(A),[A]);return(0,ot.useEffect)(()=>{j&&(r.setAccount(j),r.setCashAccount(t))},[j,r,t]),ot.default.createElement(jh.Provider,{value:r},e)}function qA(){let e=(0,ot.useContext)(jh);if(!e)throw new Error("useSwapper must be used within a SwapperProvider");return e}function uG(e){return new ii(new za,new i6,new E6(new c6(Je?new p6:new a6),e==="noOp"?new f6:new B6))}n();s();function Oe(e){return e.type==="pair"||e.type==="changingToken"||e.type==="refreshing"}n();s();var ht=q(P());n();s();var rj=e=>{let A=Math.floor(e/3600),j=Math.floor((e-A*3600)/60),t=e%60;if(A>0)return T.t("swapProviderEstimatedTimeHM",{hours:A,minutes:j});if(j>0){let r=t>0?j+1:j;return T.t("swapProviderEstimatedTimeM",{minutes:r})}return T.t("swapProviderEstimatedTimeS",{seconds:t})};n();s();var K6=e=>e.steps.reduce((A,j)=>A.plus(new U(j.nonIncludedNonGasFees)),new U(0)),ln=e=>e.steps.flatMap(t=>t.feeCosts).reduce((t,r)=>t.plus(r.amountUSD??0),new U(0));n();s();var nt=e=>e&&dA(e)?e.executionDuration:0;var lG=({selectProvider:e})=>{let{currencySymbol:A,fromUsd:j}=bA(),t=qA(),[r,o]=(0,ht.useState)(!1),[i,a]=(0,ht.useState)(t.getQuoteProcessorState());(0,ht.useEffect)(()=>{let m=t.subscribeQuoteProcessor({onStateChange(B,k){a(k)}});return()=>m()},[t]);let[u,c]=(0,ht.useState)(t.getTokenState());return(0,ht.useEffect)(()=>{let m=t.subscribeToken({onStateChange(B,k,f){c(f)}});return()=>m()},[t]),{details:(0,ht.useMemo)(()=>{if(i.type!=="quoteProcessed"&&i.type!=="firstQuoteReceived"||u.type!=="pair")return[];let m=i.quote,B=BG(m),k=m.baseProvider.name,f=kG({currentQuote:m,buyToken:u.buyToken,sellToken:u.sellToken,isFlipped:r,setIsFlipped:o});return dA(m)?mG({quote:m,selectProvider:e,exchangeRate:f,currencySymbol:A,fromUsd:j}):dG({provider:k,sources:B,exchangeRate:f,selectProvider:e})},[i,u,e,A,j,r]),footnote:T.t("swapProviderPricingFootnote")}},dG=({provider:e,sources:A,exchangeRate:j,selectProvider:t})=>[{label:T.t("swapProviderPricingProvider"),value:e,icon:"chevron-right",onPress:t},{label:T.t("swapProviderPricingMarket"),value:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip}],mG=({quote:e,selectProvider:A,exchangeRate:j,currencySymbol:t,fromUsd:r})=>{let o=e.baseProvider.name,i=ln(e).toString(),a=rj(nt(e));return[{label:T.t("swapProviderPricingProvider"),value:o,icon:"chevron-right",onPress:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip},{label:T.t("swapProviderPricingFees"),value:`${t}${r(Number(i),2)} ${T.t("swapProvidersFee")}`},{label:T.t("swapProviderPricingTime"),value:a}]};function kG({currentQuote:e,buyToken:A,sellToken:j,isFlipped:t,setIsFlipped:r}){let{exchangeRate:o,exchangeRateFlipped:i}=Vl(e,A,j);return{rate:t?i:o,flip:()=>r(!t)}}function BG(e){return IA(OA(e))}n();s();n();s();var Ee=q(P());n();s();var th=q(P());n();s();var ai=e=>{let A=e?.addressDetails?.address;return A?{[oA.Solana.Mainnet]:A}:{}};var pi=()=>{let{data:e}=vs();return(0,th.useMemo)(()=>ai(e),[e])};n();s();n();s();function Ft(e){return{chain:"solana",type:"fungible",address:e.type==="SPL"?e.data.mintAddress:void 0,symbol:e.data.symbol??""}}var nr=class{constructor(A,j){this.analytics=A;this.additionalAnalyticsTags=j}captureEvent(A,j){let t={...j,data:{...j.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}swapperOpen(A,j,t){this.captureEvent("swapperOpen",{data:{uiContext:t??"swapperInterstitial",swapMode:A,comingFrom:j}})}swapperClose(A,j){this.captureEvent("swapperClose",{data:{uiContext:j??"swapperInterstitial",reason:A}})}swapperUpdateAsset(A,j){switch(A.type){case"sell":this.captureEvent("swapperUpdateToAsset",{data:Ft(j)});break;case"buy":this.captureEvent("swapperUpdateFromAsset",{data:Ft(j)});break}}swapperSwapDefaultQuoteSelected(A){this.captureEvent("swapperSwapDefaultQuoteSelected",{data:{quotePercentageValue:A}})}swapperDetailPanelClicked(){this.captureEvent("swapperDetailPanelClicked",{data:{uiContext:"swapperInterstitial"}})}swapperToggleQuoteCurrency(){this.captureEvent("swapperToggleQuoteCurrency",{data:{uiContext:"swapperInterstitial"}})}swapperQuotesResult(A,j,t){this.captureEvent("swapperQuotesResult",{data:{...U6(A,t),numQuotes:j.quotes.length,sellToken:M(V(A.sell)),buyToken:M(V(A.buy)),fromNetworkId:A.sell.data.chain.id,toNetworkId:A.buy.data.chain.id,isGasless:j.quotes.some(r=>"gaslessSwapFeeResult"in r&&r.gaslessSwapFeeResult?.success===!0)}})}};function U6(e,A){let j=fG(A);return{isSellTokenVerified:da({minimum:"VERIFIED",spamStatus:e.sell.data.spamStatus}),sellTokenNetworkId:e.sell.data.chain.id,sellTokenSymbol:e.sell.data.symbol??void 0,sellTokenMarketCap:e.sell.data.marketCap,sellTokenAmount:e.amount,isAutoSlippageEnabled:e.autoSlippage,manualSlippagePercent:e.slippageTolerance,isExactOut:e.exactOut,isManualTipInput:e.tipAmount!==void 0,gaslessError:j?.error,gaslessAtaFeeUSD:j?.data?.ataFeeUSD,gaslessNetworkFeeUSD:j?.data?.networkFeeUSD,gaslessTotalAmountUSD:j?.data?.totalAmountUSD}}function Td(e){if(e.type==="quoteProcessed")return U6(e.input,e.quote)}function fG(e){if(Ke(e))return e.gaslessSwapFeeResult}n();s();var dn=q(P());var gG=(0,dn.createContext)(void 0);var Pd=()=>{let e=(0,dn.useContext)(gG);if(!e)throw new Error("useSwapToken must be used within a SwapTokenProvider");return e};n();s();function rh(e,A,j,t,r,o){let a=j.find(c=>c.percentage===1)?.amount;if(r==="sell"&&a&&new U(e).gt(a))return["insufficientBalance"];if(o&&r==="buy"&&a&&new U(A).gt(a))return["insufficientBalance"];let u=t.type==="buy"?t.options?.minimumOrderSize?.quote:t.options?.minimumOrderSize?.base;return u!=null&&new U(e).lt(u)?["minimumBalance"]:[]}n();s();var EG=[.25,.5,1],Gd=class{constructor(A,j,t){this.percentage=A;this.amount=j;this.fiatAmount=t}getAmountForDenomination(A){return A==="crypto"?this.amount:this.fiatAmount}};function oh({maxSellAmount:e,sellTokenPrice:A,allowedPercentages:j=EG}){return j.map(t=>{let r=e.multipliedBy(t);return new Gd(t,r,r.multipliedBy(A?.usd??0))})}n();s();var Cd=q(P());n();s();var Qe=()=>ne({key:"priorityFee",queryKey:uA.priorityFee()}),nh=()=>ce({key:"priorityFee",queryKey:uA.priorityFee()});n();s();var Ve=()=>ne({key:"tipAmount",queryKey:uA.tipAmount()}),sh=()=>ce({key:"tipAmount",queryKey:uA.tipAmount()});n();s();function St(e){return new S(e??0).multipliedBy(10**Zm.tokenDecimals)}n();s();var yG=3,hG=new U(356190),FG=e=>NA.get(e).averageNetworkFee.times(yG);function mn({sellFungible:e,totalFees:A,transactionSpeedsToUnitCost:j,minRequiredBalance:t,customPriorityFee:r,customTip:o,isBridge:i=!1}){let{decimals:a,amount:u,balance:c,chain:l}=e.data,m=u?new U(u):c?new U(c).multipliedBy(yr(a)):new U(0),B=ZA(e.type),k=HA(e),{source:f,destination:g}=t;if(k)return ou(m.toString(),a);let h=SG({isNativeToken:B,network:l,totalFees:A,isBridge:i,transactionSpeedsToUnitCost:j,customPriorityFee:r,customTip:o}).plus(g),y=B?wG(m,h,f):m.toString();return ou(y,a)}function SG({isNativeToken:e,network:A,totalFees:j,isBridge:t,transactionSpeedsToUnitCost:r,customPriorityFee:o,customTip:i}){if(!e)return j;let a=NA.get(A.id),u=t?a.bridgeDefaultFee:a.swapDefaultFee,c=r?.standard;return _k(c)&&(u=hG.multipliedBy(c.maxFeePerGas.plus(c.maxPriorityFeePerGas))),I.isSolanaNetworkID(A.id)&&o&&(u=u.plus(o)),I.isSolanaNetworkID(A.id)&&i&&(u=u.plus(i)),u.plus(FG(A.id))}function wG(e,A,j){let t=j.plus(A);return e.gt(t)?e.minus(t).toString():e.toString()}n();s();var ci=q(P()),ih=e=>{let A=e?.data.chain.id,{data:j}=pA(),t=(0,ci.useMemo)(()=>j?.addresses.find(o=>o.networkID===A),[j,A]),{data:r=0}=Sr(t);return(0,ci.useMemo)(()=>new S(r),[r])},ah=(e,A)=>{let j=e?.data.chain.id,r=A?.data.chain.id??j,{data:o}=pA(),i=(0,ci.useMemo)(()=>o?.addresses.find(u=>u.networkID===r),[o,r]),{data:a=0}=Sr(i);return(0,ci.useMemo)(()=>A?.data.amount||A?.data.balance&&new S(A.data.balance).gt(0)?new S(0):new S(a),[A?.data.amount,A?.data.balance,a])};function ph(e){let A=e.type==="pair"?e.sellToken:null,j=e.type==="pair"?e.buyToken:null,t=ih(A),r=ah(A,j),{data:o}=$o({networkID:A?.data.chain.id}),{data:i}=Qe(),{data:a}=Ve(),u=(0,Cd.useMemo)(()=>!A||!j?!1:vA(A.data.chain.id,j.data.chain.id),[A,j]);return(0,Cd.useMemo)(()=>A?mn({sellFungible:A,totalFees:new S(0),transactionSpeedsToUnitCost:I.isEVMNetworkID(A.data.chain.id)?o:void 0,isBridge:u,minRequiredBalance:{source:t,destination:r},customPriorityFee:St(i??0),customTip:St(a??0)}):"0",[A,o,u,t,r,i,a])}n();s();var Tj=UA(e=>({preferredProvider:void 0,setPreferredProvider:A=>e({preferredProvider:A})}));n();s();var Bh=q(P());n();s();var dh=q(P());n();s();var uh=q(P());n();s();var H6=q(P());var ch=()=>{let e=qA(),[A,j]=(0,H6.useState)(e.getTokenState());return(0,H6.useEffect)(()=>e.subscribeToken({onStateChange(r,o,i){j(i)}}),[e]),A};var lh=()=>{let e=ch();return(0,uh.useMemo)(()=>Oe(e)?{buyToken:e.buyToken,sellToken:e.sellToken}:{buyToken:void 0,sellToken:void 0},[e])};var Q6=()=>{let{buyToken:e,sellToken:A}=lh(),{data:[j]}=_A(["enable-cash"]);return(0,dh.useMemo)(()=>!!(j&&(e&&HA(e)||A&&HA(A))),[e,A,j])};n();s();var wt=()=>ne({key:"slippageTolerance",queryKey:uA.slippageTolerance()}),V6=()=>ce({key:"slippageTolerance",queryKey:uA.slippageTolerance()});n();s();var mh=q(P());var bG={type:"auto"},Vr=()=>{let{priorityFeeSetting:e,isFetched:A,save:j}=IG();return{isFetched:A,selectedSetting:e,setPriorityFeeSetting:j}},IG=()=>{let{data:e,isFetched:A}=ne({key:"priorityFeeSettings",queryKey:uA.priorityFeeSettings()}),{mutateAsync:j}=ce({key:"priorityFeeSettings",queryKey:uA.priorityFeeSettings()}),t=(0,mh.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,priorityFeeSetting:e??bG,save:t}};n();s();var kh=q(P());var $G={type:"auto"},kn=()=>{let{tipSetting:e,isFetched:A,save:j}=vG();return{isFetched:A,selectedSetting:e,setTipSetting:j}},vG=()=>{let{data:e,isFetched:A}=ne({key:"tipSettings",queryKey:uA.tipSettings()}),{mutateAsync:j}=ce({key:"tipSettings",queryKey:uA.tipSettings()}),t=(0,kh.useCallback)(async r=>{await j(r)},[j]);return{isFetched:A,tipSetting:e??$G,save:t}};var fh=()=>{let{selectedSetting:e}=MA(),{data:A}=wt(),{data:j}=Qe(),{selectedSetting:t}=Vr(),{data:r}=Ve(),{selectedSetting:o}=kn(),i=Tj(l=>l.preferredProvider),a=Mt("kill-swapper-simulation")??!1,u=Q6();return(0,Bh.useMemo)(()=>({slippageTolerance:A??void 0,priorityFee:t.type==="fixed"?j??void 0:void 0,tipAmount:o.type==="fixed"?r??void 0:void 0,slippageType:e.type,preferredProvider:i,phantomCashAccount:u,isSimulationKilled:a}),[A,j,t.type,r,o.type,e,i,u,a])};n();s();var gh=q(P());var ui=()=>{let{data:e,isFetched:A}=Qe(),{data:j,isFetched:t}=Ve();return(0,gh.useMemo)(()=>{if(!A||!t||!e&&!j)return;let r={};return e&&(r.priorityFee=new S(e)),j&&(r.tip=new S(j)),r},[A,t,e,j])};var qG=(e,A=[],j,t)=>{let r=qA(),o=J(),i;try{i=Pd().nextGenAnalytics}catch{}let a=(0,Ee.useMemo)(()=>i||new nr(o,j),[o,j,i]),u=pi(),c=ui(),l=PA("enable-be-swapper-max-amount");(0,Ee.useEffect)(()=>{let L=setTimeout(()=>{r.initializeSwap({swapMode:e,cashAddresses:u,settings:c})},100);return()=>clearTimeout(L)},[r,e,u,c]);let[m,B]=(0,Ee.useState)(r.getTokenState());(0,Ee.useEffect)(()=>{let L=r.subscribeToken({onStateChange(R,W,K){B(K)}});return()=>L()},[r]);let[k,f]=(0,Ee.useState)(r.getQuoteProcessorState());(0,Ee.useEffect)(()=>{let L=r.subscribeQuoteProcessor({onStateChange:(R,W)=>{W.type==="firstQuoteReceived"&&a.swapperQuotesResult(W.input,W.response,W.quote),f(W),xj.processQuoteProcessorState(W)}});return()=>{r.stopQuoteProcessor(),L()}},[r,a]);let g=(0,Ee.useMemo)(()=>TG(m,k),[m,k]),E=fh();(0,Ee.useEffect)(()=>{r.setQuoteConfig(E)},[E,r]);let h=ph(m),y=(0,Ee.useMemo)(()=>Oe(m)?oh({sellTokenPrice:m.sellTokenPrice,allowedPercentages:A,maxSellAmount:l?m.maxSellAmount:new S(h)}):[],[m,A,l,h]),F=Tj(L=>L.setPreferredProvider);(0,Ee.useEffect)(()=>{let L=r.subscribeToken({onStateChange(R,W,K){R.type==="initializeStarted"&&F(void 0)}});return()=>L()},[r,F]);let[w,x]=(0,Ee.useState)([]),G=(0,Ee.useCallback)(({amount:L,denomination:R,perspective:W,tokenStateOverride:K})=>{try{let rA=xG(K??m,L,R,W),Y=rh(rA,L,y,e,W,t);x(Y),F(void 0),r.setAmount({amount:rA,perspective:W},{...E,preferredProvider:void 0})}catch(rA){b.captureError(rA,"swapper")}},[r,m,E,F,y,e,t]),{connection:v}=cj(),_=yA(),C=wj(),O=Lj(),D=T.language,H=Mt("kill-swapper-simulation")??!1,z=(0,Ee.useCallback)(async L=>{L.forEach(W=>r.subscribeExecution(W));let R=await o.getDeviceId();await r.swap({signer:C,storage:_,locale:D,deviceId:R,connection:v,authRepository:O,isSimulationKilled:H}),L.forEach(W=>r.unsubscribeExecution(W))},[r,o,C,_,D,v,O,H]);return{setAmount:G,swap:z,tokenState:m,quoteProcessorState:k,quotedAmounts:g,inputErrors:w,sellPercentages:y}};function xG(e,A,j,t){if(!Oe(e))throw new Error("Token state is not a pair");let{sellTokenPrice:r,sellToken:o,buyToken:i,buyTokenPrice:a}=e;switch(j){case"fiat":switch(t){case"buy":if(!a?.usd)throw new Error("Token price not found");return new S(A).dividedBy(a.usd).decimalPlaces(i.data.decimals).toString();case"sell":if(!r?.usd)throw new Error("Token price not found");return new S(A).dividedBy(r.usd).decimalPlaces(o.data.decimals).toString()}break;case"crypto":switch(t){case"buy":return new S(A).decimalPlaces(i.data.decimals).toString();case"sell":return new S(A).decimalPlaces(o.data.decimals).toString()}break}}function TG(e,A){if(!Oe(e)||A.type!=="firstQuoteReceived"&&A.type!=="quoteProcessed")return;let j=A.quote,{sellToken:t,buyToken:r,sellTokenPrice:o,buyTokenPrice:i}=e;return{buyAmount:new S(j.buyAmount).shiftedBy(-r.data.decimals),buyAmountUsd:i?.usd?new S(j.buyAmount).shiftedBy(-r.data.decimals).multipliedBy(i.usd):void 0,sellAmount:new S(j.sellAmount).shiftedBy(-t.data.decimals),sellAmountUsd:o?.usd?new S(j.sellAmount).shiftedBy(-t.data.decimals).multipliedBy(o.usd):void 0}}n();s();var Eh=q(P());n();s();n();s();function Od(e){switch(e.type){case"SLIPPAGE_EXCEEDED":return T.t("swapTxConfirmationSwapFailedSlippageLimit");case"INSUFFICIENT_FUNDS":return T.t("swapTxConfirmationSwapFailedInsufficientBalance");case"INSUFFICIENT_GAS":return T.t("swapTxConfirmationSwapFailedInsufficientGas");case"ACCOUNT_FROZEN":return T.t("swapTxConfirmationSwapFailedAcountFrozen");case"SIMULATION_TIMEOUT":return T.t("swapTxConfirmationSwapFailedSimulationTimeout");case"STALE_QUOTE":return T.t("swapTxConfirmationSwapFailedStaleQuote");case"UNKNOWN_ERROR":return T.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return T.t("swapTxConfirmationSwapFailedTryAgain")}}n();s();var Gj=q(P());n();s();var Md=class{format(A,j){return`${_e(A)} ${j}`}},Rd=class{format(A,j){return`${Ba(A,{compact:!0})} ${j}`}},_d=class{format(A){return Ba(A,{compact:!0})}};function zr(e){switch(e){case"full":return new Md;case"compact":return new Rd;case"compactNoSymbol":return new _d}}var Dd=class{format(A,j,t){return`${_e(Ij(Number(A),t,j.data?.decimals??0))} ${j.data.symbol??""}`}},z6=class{format(A,j,t){return Ba(Ij(Number(A),t,j.data?.decimals??0),{compact:!0})}},Nd=class{noSymbolDisplayStrategy;constructor(A){this.noSymbolDisplayStrategy=A}format(A,j,t){return`${this.noSymbolDisplayStrategy.format(A,j,t)} ${j.data?.symbol??""}`}};function Ld(e){switch(e){case"full":return new Dd;case"compact":return new Nd(new z6);case"compactNoSymbol":return new z6}}n();s();var X6=class{async fetch(A){return await Va(A)}stopFetching(){}getFetchInterval(A){return A}};n();s();n();s();var Bn=class{constructor(A){this.streamedQuoteLogger=A}onStateChange(A,j,t){t.type==="transactionSubmitted"&&this.streamedQuoteLogger.logState(t.txReceipt.id)}};n();s();n();s();n();s();var W6=(e,A,j)=>{if(j)return mA(e,A).times(S(j)).toNumber()},yh=(e,A)=>A&&e?A>e?A:e:A??e;function hh({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,slippageType:m,sellSwapFilter:B,isRetry:k,analyticsContext:f}){if(A&&t){let g=W6(r,A.data.decimals,e),E=W6(o,t.data.decimals,j),h=yh(g,E);return{networkId:t.data.chain.id,chainId:I.getChainID(t.data.chain.id),toNetworkId:A.data.chain.id,toChainId:I.getChainID(A.data.chain.id),isBridge:t.data.chain.id!==A.data.chain.id,marketName:`${t.data.symbol}/${A.data.symbol}`,tradeDirection:"sell",swapSource:u,baseProvider:c,priceImpact:a,fromAssetSymbol:t.data.symbol??"",fromAssetAddress:t.data.tokenAddress,fromAssetAmount:mA(o,t.data.decimals),fromAssetUsdPrice:j,fromAssetUsdVolume:E,toAssetSymbol:A.data.symbol??"",toAssetAddress:A.data.tokenAddress,toAssetAmount:mA(r,A.data.decimals),toAssetUsdPrice:e,toAssetUsdVolume:g,totalUsdVolume:h,feeUsd:i,slippageTolerance:l,slippageType:m,sellSwapFilter:B,isRetry:k,analyticsContext:f}}return null}function li({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,quote:r,slippageTolerance:o,slippageType:i,sellSwapFilter:a,isRetry:u,analyticsContext:c,baseProvider:l}){if(A&&t){let{buyAmount:m,sellAmount:B}=r,k="priceImpact"in r?r.priceImpact:0,f="sources"in r?IA(r.sources):"",g=("fees"in r?r.fees.find(F=>F.type==="phantom")?.amount.toString():"")??"",E=W6(m,A.data.decimals,e),h=W6(B,t.data.decimals,j),y=yh(E,h);return{chainId:t.data.chain.id??A.data.chain.id,swap:{marketName:`${t.data.symbol}/${A.data.symbol}`,tradeDirection:"sell",swapSource:f,priceImpact:k,fromAssetSymbol:t.data.symbol??"",fromAssetAddress:t.data.tokenAddress??"",fromAssetAmount:mA(B,t.data.decimals),fromAssetUsdPrice:j??0,fromAssetUsdVolume:h??0,toAssetSymbol:A.data.symbol??"",toAssetAddress:A.data.tokenAddress??"",toAssetAmount:mA(m,A.data.decimals),toAssetUsdPrice:e,toAssetUsdVolume:E,totalUsdVolume:y??0,feeUsd:Number(g),slippageTolerance:o,slippageType:i,sellSwapFilter:a,isRetry:u,analyticsContext:c,baseProvider:l}}}return null}function J6({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,transactionId:m,slippageType:B,sellSwapFilter:k,isRetry:f,analyticsContext:g}){let E=hh({buyAssetUsdValue:e,buyToken:A,sellAssetUsdValue:j,sellToken:t,buyAmount:r,sellAmount:o,phantomFeeUiAmount:i,priceImpact:a,provider:u,baseProvider:c,slippageTolerance:l,slippageType:B,sellSwapFilter:k,isRetry:f,analyticsContext:g});return E?{data:{...E,id:m}}:{}}n();s();var Y6=({txReceipt:e,networkID:A,amountType:j,swapAnalytics:t})=>{let r=Nt(A);b.addBreadcrumb("swapper","submittedTransaction","info",{...r,txReceipt:e.id,method:r.chainType==="solana"?"signAndSendTransaction":r.chainType==="eip155"?"eth_sendRawTransaction":r.chainType==="sui"?"signAndExecuteTransaction":"UNKNOWN"}),r.chainType==="solana"?t.submittedTransaction(e.id,{...r,method:"signAndSendTransaction",swapType:j==="sell"?"exactIn":"exactOut"}):r.chainType==="eip155"?t.submittedTransaction(e.id,{...r,method:"eth_sendRawTransaction",swapType:j==="sell"?"exactIn":"exactOut"}):r.chainType==="sui"&&t.submittedTransaction(e.id,{...r,method:"signAndExecuteTransaction",swapType:j==="sell"?"exactIn":"exactOut"})};n();s();var Fh=q(P());var PG={calculate(e){let A=(e?.fees??[]).find(j=>j.type==="phantom");return{amount:new S(A?.amount??0),amountUsd:null,pct:A?.percentage??0}}},GG={calculate(e){let A=e.steps.flatMap(j=>j.feeCosts).find(j=>j.name==="phantom");return{amount:new S(A?.amount??0),amountUsd:null,pct:parseFloat(A?.percentage??"0")}}},Sh=()=>{let{currentQuote:e}=aA();return{phantomFee:(0,Fh.useMemo)(()=>Kd(e),[e])}};function Kd(e){return Wj(e)?PG.calculate(e):dA(e)?GG.calculate(e):rr}n();s();var sr=e=>e?dA(e)?void 0:e.priceImpact:0;n();s();var wh=UA(e=>({lastFailedSwap:void 0,setLastFailedSwap:A=>{e({lastFailedSwap:A})}}));function bh(){return wh.getState().lastFailedSwap}function Ud(e){wh.getState().setLastFailedSwap(e)}var fn=class{constructor(A,j,t="swapperClassic",r){this.swapAnalytics=A;this.analytics=j;this.uiContext=t;this.additionalAnalyticsTags=r}captureEvent(A,j){let t={...j,data:{...j?.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}onStateChange(A,j,t,r){switch(A.type){case"executeSwapStarted":this.captureEvent("swapperSwap",{data:{...this.createAnalyticsPayload(t.executingQuote).data,uiContext:this.uiContext}});let o=li({buyAssetUsdValue:t.executingQuote.buy.data.usd,buyToken:t.executingQuote.buy,sellAssetUsdValue:t.executingQuote.sell.data.usd,sellToken:t.executingQuote.sell,quote:t.executingQuote.quote,slippageTolerance:this.parseSlippageTolerance(t.executingQuote.slippageType,t.executingQuote.quote,t.executingQuote.response),slippageType:t.executingQuote.slippageType,sellSwapFilter:$.getState().swapFilter,isRetry:this.isRetry(t.executingQuote),analyticsContext:t.executingQuote.quote.analyticsContext,baseProvider:t.executingQuote.quote.baseProvider?.id??""});o&&(b.addBreadcrumb("swapper","approved","info",Rt(o.swap)),this.swapAnalytics.approved(o));break;case"simulationFailed":A.error.type!=="SLIPPAGE_EXCEEDED"&&b.captureError(A.error,"swapper"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:CG(A.error)}});break;case"transactionSubmissionFailed":b.captureError(A.error,"swapper"),A.error.type==="noSignature"&&this.captureEvent("swapperSwapFailureNoSignature"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:A.error.message,uiContext:this.uiContext}});break;case"transactionSubmissionSuccess":Y6({txReceipt:A.txReceipt,networkID:A.txReceipt.networkID,amountType:t.executingQuote.amount.perspective==="buy"?"buy":"sell",swapAnalytics:this.swapAnalytics});break;case"transactionConfirmationFailed":let i=Ar(A.error);b.captureError(A.error,"swapper"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(t.executingQuote).data,error:i.message,uiContext:this.uiContext}});let a=Nt(A.txReceipt.networkID),u={chainId:I.getChainID(A.txReceipt.networkID),networkId:A.txReceipt.networkID},c=A.txReceipt;switch(this.captureEvent("waitForTransactionConfirmationError",{data:{...u,errorMessage:i.message}}),a.chainType){case"eip155":case"solana":case"sui":b.addBreadcrumb("swapper","transactionStatus","error",{...a,txReceipt:c.id}),this.swapAnalytics.transactionStatus(c.id,{...a,status:{type:"error"}});break}break;case"transactionConfirmed":this.captureEvent("swapperSwapSuccess",{data:{...this.createAnalyticsPayload(t.executingQuote,A.txReceipt).data,uiContext:this.uiContext}});let l=Nt(A.txReceipt.networkID);switch(b.addBreadcrumb("swapper","transactionStatus","info",{...l,txReceipt:A.txReceipt.id}),l.chainType){case"eip155":case"solana":case"sui":this.swapAnalytics.transactionStatus(A.txReceipt.id,{...l,status:{type:"confirmed"}});break}break}this.isFailureEvent(A)?Ud(t.executingQuote):A.type==="transactionSubmissionSuccess"&&Ud(void 0)}createAnalyticsPayload(A,j){let t=A.quote,r=$.getState(),o=J6({buyToken:A.buy,sellToken:A.sell,buyAmount:t.buyAmount.toString(),sellAmount:t.sellAmount.toString(),phantomFeeUiAmount:Kd(t).amountUsd?.toString()??"",priceImpact:sr(t),provider:IA(OA(t)),buyAssetUsdValue:r.buyUsdValue,sellAssetUsdValue:r.sellUsdValue,slippageTolerance:this.parseSlippageTolerance(A.slippageType,t,A.response),transactionId:j?.id??"",slippageType:A.slippageType,sellSwapFilter:r.swapFilter,isRetry:this.isRetry(A),analyticsContext:A.quote.analyticsContext,baseProvider:A.quote.baseProvider?.id??""}),i=A.quoteInput;return i?{data:{...o.data,...U6(i,t)}}:o}parseSlippageTolerance(A,j,t){switch(A){case"fixed":return t.slippageTolerance;case"auto":return Wj(j)?j.slippageTolerance:t.slippageTolerance}}isRetry(A){let j=bh();if(!j)return!1;let t=M(V(j.buy)),r=M(V(j.sell)),o=M(V(A.buy)),i=M(V(A.sell));return t===o&&r===i}isFailureEvent(A){switch(A.type){case"simulationFailed":case"transactionSubmissionFailed":case"transactionConfirmationFailed":return!0;default:return!1}}};function CG(e){switch(e.type){case"SLIPPAGE_EXCEEDED":return"slippageToleranceExceeded";case"INSUFFICIENT_FUNDS":return"INSUFFICIENT_FUNDS";case"INSUFFICIENT_GAS":return"INSUFFICIENT_GAS";case"ACCOUNT_FROZEN":return"AccountFrozen";case"STALE_QUOTE":return"STALE_QUOTE";case"SIMULATION_TIMEOUT":return"SIMULATION_TIMEOUT";case"UNKNOWN_ERROR":return"SimulationUnknownError";case"SIMULATION_FAILED":return"SIMULATION_FAILED";default:return"Scan results are not valid"}}n();s();n();s();var OG=20;function Z6(e,A){let j=uA.optimisticUpdates(),t=e.getQueryData(j)??[];e.setQueryData(j,[...t.filter(r=>r.id!==A.id),A])}function Ih(e,A){let j=uA.optimisticUpdates(),t=e.getQueryState(j);if(t){let r=A??Date.now(),o=t.dataUpdatedAt,i=Q({seconds:OG});return r-o>i?(e.removeQueries({queryKey:j}),[]):t?.data??[]}else return[]}function gn(e){return`${e.type}-${e.data.key}`}var MG=Q({seconds:3}),En=class{constructor(A,j,t){this.queryClient=A;this.storage=j;this.authRepository=t}onStateChange(A,j,t,r){let{sell:o,quote:i,account:a}=t.executingQuote;if(A.type==="transactionConfirmed"){this.storage.set("priorityFee",null),this.storage.set("priorityFeeSettings",{type:"auto"}),this.queryClient.setQueryData(uA.priorityFee(),null),this.queryClient.setQueryData(uA.priorityFeeSettings(),{type:"auto"}),this.storage.set("tipAmount",null),this.storage.set("tipSettings",{type:"auto"}),this.queryClient.setQueryData(uA.tipAmount(),null),this.queryClient.setQueryData(uA.tipSettings(),{type:"auto"});let u=new U(o.data.amount),c=new U(i.sellAmount),l=u.minus(c).toString();Z6(this.queryClient,{id:gn(o),amount:l}),this.queryClient.invalidateQueries({queryKey:AB.tokens(a.addresses)}),this.queryClient.invalidateQueries({queryKey:eB.tokenBalance({wallets:a.addresses,encodedCaip19:M(V(o))})}),(async()=>{let m=await this.authRepository.getUser(),B=V(o);_l(this.queryClient,M(B),c.negated()),await new Promise(k=>setTimeout(k,MG)),await Promise.all([vl(this.queryClient,m?.userID),ql(this.queryClient)])})()}}};n();s();n();s();var Xr=class{#A;constructor(A){this.#A=A}onScannedMessageByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"message",status:"success"}}})};onFailedScannedMessageByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"message",status:"error"}}})};onScannedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"success"}}})};onFailedScannedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"error"}}})};onSkippedTransactionByUser=A=>{this.#A.capture("simulation",{data:{simulation:{...A,type:"transaction",status:"skipped"}}})}};var vh="swap-validation",yn=class{simulationAnalytics;constructor(A){this.simulationAnalytics=new Xr(A)}onStateChange(A,j,t){switch(A.type){case"simulationPassed":let r=A.scannedTransactionResult;this.simulationAnalytics.onScannedTransactionByUser({networkId:A.networkId,warnings:r.warnings.map(i=>i.severity),shouldBlock:!!r.block,errorCode:r.error??""});break;case"simulationFailed":let o=A.error.scannedTransactionResult;if(o){this.simulationAnalytics.onScannedTransactionByUser({networkId:A.networkId,warnings:o.warnings.map(i=>i.severity),shouldBlock:!!o.block,errorCode:o.error??""}),o?.error&&b.addBreadcrumb(vh,`Simulation error: ${JSON.stringify({error:o.error})}`,"info");return}this.simulationAnalytics.onFailedScannedTransactionByUser({networkId:A.networkId,url:A.url}),b.addBreadcrumb("simulation",`networkID: ${A.networkId}, url: ${A.url}, type: transaction`,"info");break;case"simulationSkipped":this.simulationAnalytics.onSkippedTransactionByUser({networkId:A.networkId}),b.addBreadcrumb(vh,`Simulation skipped for networkID: ${A.networkId}`,"info");break}}};n();s();n();s();n();s();var RG=10,_G=UA(e=>({transitions:[],addTransition:(A,j)=>e(t=>{let r=DG(j,A);return r?{transitions:[r,...t.transitions].slice(0,RG)}:t})}));function ep(e,A){_G.getState().addTransition(e,A)}function DG(e,A){switch(A.type){case"idle":return;case"fetchingQuote":return;case"quote":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,timestamp:Date.now()};case"simulationRequestErrored":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,error:A.error,quoteTransactionData:Ap(A.quote),timestamp:Date.now()};case"simulated":return;case"simulationFailed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,simulationError:A.simulationError,stateType:A.type,eventType:e.type,simulationWarning:A.scannedTransactionResult?.warnings,quoteTransactionData:Ap(A.quote),simulationHumanReadableError:A.scannedTransactionResult?.simulationError?.humanReadableError,simulationRequestId:A.scannedTransactionResult?.advancedDetails?.requestId,timestamp:Date.now()};case"transactionSubmissionFailed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,error:A.error,stateType:A.type,eventType:e.type,quoteTransactionData:Ap(A.quote),timestamp:Date.now()};case"transactionNotConfirmed":return{sell:st(A.response,A.sell,"sell"),buy:st(A.response,A.buy,"buy"),sellAmount:A.quote.sellAmount,buyAmount:A.quote.buyAmount,provider:di(A.quote),slippage:A.response.slippageTolerance,stateType:A.type,eventType:e.type,quoteTransactionData:Ap(A.quote),timestamp:Date.now(),error:A.error};default:return}}var di=e=>{let A=OA(e);return IA(A)},st=(e,A,j)=>{switch(j){case"sell":return{caip19:e.sellToken,symbol:A.data.symbol??void 0};case"buy":return{caip19:e.buyToken,symbol:A.data.symbol??void 0}}},Ap=e=>{if(!dA(e))return e.transactionData};n();s();var hn=class{onStateChange(A,j,t,r){let o=this.toLegacyTransition(A,t);o&&ep(o.nextState,o.event)}toLegacyTransition(A,j){let{buy:t,sell:r,quote:o,response:i}=j.executingQuote;switch(A.type){case"simulationFailed":return{event:{type:"simulationRequestError",error:A.error},nextState:{type:"simulationFailed",buy:t,sell:r,response:i,quote:o,scannedTransactionResult:A.error.scannedTransactionResult,simulationError:A.error.message}};case"transactionSubmissionFailed":return{event:{type:"transactionSubmissionFailed",error:A.error},nextState:{type:"transactionSubmissionFailed",buy:t,sell:r,response:i,quote:o,error:A.error}};case"transactionConfirmationFailed":return{event:{type:"transactionConfirmationFailed",error:A.error,txReceipt:A.txReceipt},nextState:{type:"transactionNotConfirmed",buy:t,sell:r,response:i,quote:o,error:A.error,txReceipt:A.txReceipt}};default:return}}};n();s();n();s();n();s();n();s();n();s();var jp,NG=new Uint8Array(16);function Qd(){if(!jp&&(jp=typeof self.crypto<"u"&&self.crypto.getRandomValues&&self.crypto.getRandomValues.bind(self.crypto),!jp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jp(NG)}n();s();var ye=[];for(let e=0;e<256;++e)ye.push((e+256).toString(16).slice(1));function qh(e,A=0){return ye[e[A+0]]+ye[e[A+1]]+ye[e[A+2]]+ye[e[A+3]]+"-"+ye[e[A+4]]+ye[e[A+5]]+"-"+ye[e[A+6]]+ye[e[A+7]]+"-"+ye[e[A+8]]+ye[e[A+9]]+"-"+ye[e[A+10]]+ye[e[A+11]]+ye[e[A+12]]+ye[e[A+13]]+ye[e[A+14]]+ye[e[A+15]]}n();s();n();s();var LG=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),Vd={randomUUID:LG};function KG(e,A,j){if(Vd.randomUUID&&!A&&!e)return Vd.randomUUID();e=e||{};let t=e.random||(e.rng||Qd)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,A){j=j||0;for(let r=0;r<16;++r)A[j+r]=t[r];return A}return qh(t)}var kj=KG;n();s();n();s();var xh=e=>{let A,j=new Set,t=(l,m)=>{let B=typeof l=="function"?l(A):l;if(!Object.is(B,A)){let k=A;A=m??(typeof B!="object"||B===null)?B:Object.assign({},A,B),j.forEach(f=>f(A,k))}},r=()=>A,u={setState:t,getState:r,getInitialState:()=>c,subscribe:l=>(j.add(l),()=>j.delete(l)),destroy:()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),j.clear()}},c=A=e(t,r,u);return u},Th=e=>e?xh(e):xh;var Uh=q(P(),1),Hh=q(Nh(),1),{useDebugValue:s1}=Uh.default,{useSyncExternalStoreWithSelector:i1}=Hh.default,Lh=!1,a1=e=>e;function p1(e,A=a1,j){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&j&&!Lh&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Lh=!0);let t=i1(e.subscribe,e.getState,e.getServerState||e.getInitialState,A,j);return s1(t),t}var Kh=e=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let A=typeof e=="function"?Th(e):e,j=(t,r)=>p1(A,t,r);return Object.assign(j,A),j},c1=e=>e?Kh(e):Kh,Qh=e=>((import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),c1(e));n();s();var l1=3e3,QA=Qh(e=>({toast:void 0,toastId:void 0,visible:!1,currentTimer:null,hideToast(A){e(j=>A&&j.toastId!==A?j:(j.currentTimer&&clearTimeout(j.currentTimer),{visible:!1,currentTimer:null}))},removeToast(){e(A=>(A.currentTimer&&clearTimeout(A.currentTimer),{toast:void 0,toastId:void 0,visible:!1,currentTimer:null}))},success(A){e(j=>{j.currentTimer&&clearTimeout(j.currentTimer);let t=setTimeout(()=>{e({visible:!1,currentTimer:null})},l1);return{toast:{type:"Success",...A},toastId:A.id??kj(),visible:!0,currentTimer:t}})},failed(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Failed",...A},toastId:A.id??kj(),visible:!0,currentTimer:null}))},progress(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Progress",...A},toastId:A.id??kj(),visible:!0,currentTimer:null}))},message(A){e(j=>(j.currentTimer&&clearTimeout(j.currentTimer),{toast:{type:"Default",...A},toastId:A.id??kj(),visible:!0,currentTimer:null}))}}));n();s();var ki=e=>{let A=nt(e);return rj(A)};n();s();function Yd(e,A,j,t){let r=HA(e),o=r?e:A,i=r?A:e,a=r?j.sellAmount:j.buyAmount,u=mA(a,o.data.decimals),c=ra(u,!0),l=i.data.symbol,m="";return t?m=r?"swapTokenConfirmationBuyToast":"swapTokenConfirmationSellToast":m=r?"swapSwappingCashBuyToast":"swapSwappingCashSellToast",T.t(m,{amount:c,symbol:l})}n();s();n();s();function Vh({sell:e,buy:A,onBuyFungiblePress:j}){let t=`${T.t("swapTxConfirmationSwapFailed")} ${e.data.symbol} \u2192 ${A.data.symbol}`,r=I.getChainDefinition(e.data.chain.id).tokenSymbol,o=T.t("buyAssetInterpolated",{tokenSymbol:r});return{title:t,message:T.t("swapTabInsufficientFunds"),onPress:j,buttonText:o}}function zh(e,A,j,t,r,o){let{sell:i,buy:a}=A,u=d1(e,i,a,r,t,j,o);return u||{title:`${T.t("swapTxConfirmationSwapFailed")} ${i.data.symbol} \u2192 ${a.data.symbol}`,message:Od(e),onPress:()=>{QA.getState().hideToast(),t()},buttonText:T.t("commandRetry")}}function d1(e,A,j,t,r,o,i){if(!(e.type&&!i.includes(e.type)))switch(e.type){case"INSUFFICIENT_FUNDS":return Vh({sell:A,buy:j,onBuyFungiblePress:()=>{QA.getState().hideToast(),o()}});case"SLIPPAGE_EXCEEDED":return t.selectedSetting.type==="auto"?void 0:{title:T.t("swapEnableAutoSlippageTitleToast",{sellSymbol:A.data.symbol,buySymbol:j.data.symbol}),buttonText:T.t("swapEnableAutoSlippageButtonToast"),message:"",onPress:()=>{t.setSlippageSetting({type:"auto"}),r(),QA.getState().hideToast()}}}}n();s();n();s();var m1=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],k1="Ledger user rejected action",B1="Ledger Sign Error";function Xh(e){return m1.some(j=>e.message.includes(j))?T.t("swapTxConfirmationSwapFailedLedgerConnectionError"):e.message.includes(k1)?T.t("swapTxConfirmationSwapFailedLedgerReject"):e.message.includes(B1)?T.t("swapTxConfirmationSwapFailedLedgerSignError"):e.message.toLowerCase().includes("ledger")?T.t("swapTxConfirmationSwapFailedLedgerError"):null}function Wh({sellSymbol:e,buySymbol:A,error:j,onPress:t}){let r=T.t("unknownToken"),o=`${T.t("swapTxConfirmationSwapFailed")} ${e??r} \u2192 ${A??r}`,i=T.t("commandRetry"),a=T.t("swapTxConfirmationSwapFailedUnknownError"),u=Xh(j);return u&&(a=u),{title:o,message:a,onPress:t,buttonText:i}}var wn=class{constructor(A,j,t,r,o,i=E1){this.showFungibleDetails=A;this.showBuyFungibleScreen=j;this.slippageSettings=t;this.supportedCustomSimulationToastErrorTypes=r;this.retryAndNavigateToSwapper=o;this.toastMessageParser=i}onStateChange(A,j,t,r){let{sell:o,buy:i,quote:a}=t.executingQuote;switch(A.type){case"executeSwapStarted":let u;dA(a)?u=T.t("swapInitiatingBridgeToast",{sellSymbol:o.data.symbol,sellChain:o.data.chain.name,buySymbol:i.data.symbol,buyChain:i.data.chain.name}):HA(o)||HA(i)?u=Yd(o,i,a,!1):u=T.t("swapSwappingToast",{sellSymbol:o.data.symbol,buySymbol:i.data.symbol}),f1(u);break;case"transactionConfirmed":g1(this.toastMessageParser.parseTransactionConfirmed(o,i,a),()=>this.showFungibleDetails(i));break;case"simulationFailed":Jh(zh(A.error,t.executingQuote,this.showBuyFungibleScreen,()=>this.handleRetryPress(t.executingQuote),this.slippageSettings,this.supportedCustomSimulationToastErrorTypes));break;case"transactionSubmissionFailed":case"transactionConfirmationFailed":Jh(Wh({sellSymbol:o.data.symbol,buySymbol:i.data.symbol,error:A.error,onPress:()=>this.handleRetryPress(t.executingQuote)}));break}}handleRetryPress(A){QA.getState().hideToast(),this.retryAndNavigateToSwapper(A)}};function f1(e){QA.getState().progress({message:e,onPress:()=>{QA.getState().hideToast()}})}function g1(e,A){QA.getState().success({id:"swap-success",message:e,onPress:()=>{QA.getState().hideToast(),A()}})}function Jh(e){QA.getState().failed(e)}var E1={parseTransactionConfirmed(e,A,j){return dA(j)?T.t("swapBridgeInitiatedToast",{sellSymbol:e.data.symbol,sellChain:e.data.chain.name,buySymbol:A.data.symbol,buyChain:A.data.chain.name,estimatedTime:ki(j)}):T.t("swapSwappedToast",{sellSymbol:e.data.symbol,buySymbol:A.data.symbol})}};var rp=class{intercept(A){let{swapper:j,connection:t,storage:r,vaultProxy:o,locale:i,analytics:a,resetSwapper:u,queryClient:c,showFungibleDetails:l,showBuyFungibleScreen:m,swapAnalytics:B,gasEstimation:k,slippageSettings:f,supportedCustomSimulationToastErrorTypes:g,navigateToSwapper:E,storePairs:h,isMobile:y,enableExtSwapCommands:F,authRepository:w,isSimulationKilled:x}=A;if(j.getAccount()?.type==="ledger"||!y&&!F)return"continue";let v=j.getState();if(v.type!=="quote")return"continue";let{quote:_,sell:C,buy:O}=v;return this.isSupportedQuote(_)&&(async()=>{h(C,O);let D=await a.getDeviceId(),H=new wn(l,m,f,g,rA=>{E(rA)}),z=new En(c,r,w),L=new fn(B,a),R=new yn(a),W=new hn,K=new Bn(xj);try{j.subscribeExecution(z),j.subscribeExecution(R),j.subscribeExecution(L),j.subscribeExecution(H),j.subscribeExecution(W),j.subscribeExecution(K),await j.swap({signer:o,storage:r,locale:i,deviceId:D,connection:t,authRepository:w,isSimulationKilled:x,gasEstimation:k}),u()}catch{}finally{j.unsubscribeExecution(z),j.unsubscribeExecution(R),j.unsubscribeExecution(L),j.unsubscribeExecution(H),j.unsubscribeExecution(W),j.unsubscribeExecution(K)}})(),"continue"}isSupportedQuote(A){return Ke(A)||Ze(A)||kt(A)||dA(A)}};n();s();var op=class{constructor(A,j){this.swapper=A;this.queryClient=j}queryKey;quoteProcessorListener={onStateChange:(A,j)=>{if(!this.queryKey){console.error("queryKey is not set");return}j.type==="quoteProcessed"&&this.queryClient.setQueryData(this.queryKey,j.response)}};async fetch(A,j){return this.queryKey=j,this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener),new Promise((t,r)=>{let o=y1(A.amount,A.sell,A.buy),i={onStateChange:(a,u)=>{switch(u.type){case"firstQuoteReceived":t(u.response),this.swapper.unsubscribeQuoteProcessor(i);break;case"error":r(u.error),this.swapper.unsubscribeQuoteProcessor(i),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener);break}}};this.swapper.subscribeQuoteProcessor(this.quoteProcessorListener),this.swapper.subscribeQuoteProcessor(i),this.swapper.setPair(Zh(A.buy),Zh(A.sell),o),this.swapper.setAmount(o,{slippageTolerance:A.slippageTolerance,slippageType:A.enableAutoSlippage?"auto":"fixed",priorityFee:A.priorityFee,tipAmount:A.tipAmount,preferredProvider:A.preferredProvider})})}stopFetching(){this.swapper.getQuoteProcessorState().type!=="idle"&&(this.swapper.stopProcessingQuotes(),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener))}getFetchInterval(A){return!1}};function y1(e,A,j){let t=e.type==="sell"?A:j;return{amount:new S(e.value).shiftedBy(-t.data.decimals).toString(),perspective:e.type}}function Zh(e){return{...e,data:{...e.data,walletAddress:""}}}n();s();n();s();var np=class{intercept({hasViewedAutoSlippageOptIn:A,selectedSetting:j,setHasViewedAutoSlippageOptIn:t,showOverlay:r}){return!A&&j!=="auto"?(r("autoSlippageOptIn"),t(!0),"interrupt"):"continue"}};n();s();var A7=q(P());n();s();var A0=q(P());n();s();var F1=p.object({swapper:p.number(),review:p.number().nullish().default(null)}),sp={swapper:Ts.Short,review:null},Zd=()=>{let e=Te.getMultivariateAssignment("swapper-poll-interval-json");if(!e)return sp;try{let A=JSON.parse(e);return F1.parse(A)}catch{return sp}};var Pj=()=>{let e=Bi(r=>r.intervalMs),A=Bi(r=>r.state),j=Bi(r=>r.setState),t=(0,A0.useCallback)(r=>{j("resumed",r??e0())},[j]);return{state:A,pause:()=>j("paused"),resume:t,intervalMs:e}},bn=e=>{Bi.getState().setState("resumed",e??e0())},ip=()=>{Bi.getState().setState("paused")},e0=()=>Zd().swapper,Bi=UA(e=>({state:"resumed",intervalMs:sp.swapper,setState(A,j){e(j?{state:A,intervalMs:j}:{state:A})}}));var j0=()=>{let e=(0,A7.useCallback)(()=>{bn()},[]),A=(0,A7.useCallback)(()=>{ip()},[]);return{onSwapTabEnter:e,onSwapTabExit:A}};var t0=(0,Gj.createContext)(void 0),S1=({children:e})=>{let A=["auto","fixed"],j=["SLIPPAGE_EXCEEDED"],t=(0,Gj.useMemo)(()=>[new np,new rp],[]),r=!0,o=qA(),i=cA(),a=(0,Gj.useMemo)(()=>Sj?new op(o,i):new X6,[o,i]),{onSwapTabEnter:u,onSwapTabExit:c}=j0(),l=is("trade-hub-variant"),m=PA("enable-replace-classic-ngs"),B=(0,Gj.useMemo)(()=>{if(m||l==="remove-buy-sell")return"remove-buy-sell";if(l==="swapper-modal")return"swapper-modal";if(l==="trade-menu")return"trade-menu"},[l,m]),k=(0,Gj.useMemo)(()=>Je?zr("full"):zr("compactNoSymbol"),[]);return Gj.default.createElement(t0.Provider,{value:{slippageSettingTypes:A,reviewInterceptors:t,showStickyCTAButton:r,getSwapQuotesStrategy:a,supportedCustomSimulationToastErrorTypes:j,onSwapTabEnter:u,onSwapTabExit:c,balanceDisplayStrategy:k,tradeHubVariant:B}},e)},fi=()=>{let e=(0,Gj.useContext)(t0);if(!e)throw new Error("useSwapTab must be used within a SwapTabProvider");return e};n();s();var Wr=q(P());n();s();n();s();var w1=p.enum(["pumpFun","moonshot"]),b1=p.object({type:w1,programId:p.string(),name:p.string(),iconUrl:p.string()}),I1=p.object({programs:p.array(b1)}),r0=e=>{try{return I1.parse(e)}catch{return}};var $1={type:"pumpFun",programId:"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P",name:"Pump.fun",iconUrl:"https://dhc7eusqrdwa0.cloudfront.net/assets/pumpfun.svg"},e7=[],bt=()=>{try{let e=Te.getMultivariateAssignment("enabled-ugc-programs");if(!e)return Te.isFeatureEnabled("enabled-ugc-programs")?[$1]:e7;let A=JSON.parse(e);return r0(A)?.programs??e7}catch{return e7}};var v1=p.object({programId:p.string(),complete:p.boolean(),progress:p.string()}),q1=p.object({bondingCurves:p.record(p.string(),v1)});function x1(e){let A=o0(e),t=cA().getQueryData(A.queryKey),{data:r,isFetching:o,isError:i}=X({...A,initialData:t,staleTime:0}),a=(0,Wr.useMemo)(()=>bt(),[]);return(0,Wr.useMemo)(()=>{let u=t===r;if(o&&!u)return{type:"Loading"};if(i)return{type:"Error"};let c=q1.safeParse(r);if(!c.success)return{type:"Error"};let l=c.data.bondingCurves[e];if(!l)return{type:"NoBondingCurve"};let m=a.find(k=>k.programId===l.programId);if(!m)return{type:"NoBondingCurve"};let B=G1(l.progress);return B?l.complete?{type:"Graduated",ugcProgram:m}:{type:u&&o?"BondingCurveRefreshing":"BondingCurve",progressPercentage:B,ugcProgram:m}:{type:"Error"}},[t,e,r,i,o,a])}var T1=e=>{let A=cA(),j=o0(e);return(0,Wr.useCallback)(async()=>{await A.refetchQueries({queryKey:j.queryKey,type:"active"})},[A,j.queryKey])},o0=e=>{let A=(0,Wr.useMemo)(()=>bt(),[]),j=(0,Wr.useMemo)(()=>A.map(r=>r.programId),[A]);return{queryKey:["bonding-curve",e,j],queryFn:()=>P1(e,j)}},P1=async(e,A)=>{let j=encodeURIComponent(e),t=encodeURIComponent(A.join(","));return(await N.api().get(`/ugc/v1/bonding-curve/${j}/${t}`)).data},G1=e=>{let A=Number(e);if(!isNaN(A))return Math.round(A*100)};n();s();var C1="https://help.phantom.com/hc/en-us/articles/33745013398675";n();s();n();s();var n0=q(P());n();s();var j7=q(P());n();s();function ir(){return NA.supportedChains}var It=()=>{let{data:e}=pA(),A=ir(),j=(0,j7.useMemo)(()=>A.map(t=>I.getMainnetNetworkID(t)),[A]);return(0,j7.useMemo)(()=>O1(e,j),[e,j])},O1=(e,A)=>[...new Set((e?.addresses??[]).map(j=>j.networkID).filter(j=>A.includes(j)))];var ap=()=>{let e=It();return(0,n0.useCallback)(A=>!!A&&e.includes(A),[e])};n();s();var d0=q(P());n();s();n();s();n();s();n();s();var M1=e=>{let A=yA(),j=J(),{data:t,isPending:r}=X({gcTime:0,queryKey:["originIsBlocklisted",e],queryFn:async()=>{let{result:o}=await Tk(A,j,e);return o}});return e===void 0?{isLoading:!1,originIsBlocklisted:!1}:{isLoading:r,originIsBlocklisted:t??!1}};n();s();var t7=q(P());function R1(e,A){let{data:j}=pA(),{params:t,networkID:r}=e,[o,i]=(0,t7.useState)(null),a=["scan-message",{url:e.url,message:t.message}],u=j?.addresses.find(f=>f.networkID===r)?.address,c=me(T.language)??"en",l=J(),m=new Xr(l),B=i0(),k=X({queryKey:a,queryFn:async()=>{try{let f=await Hk(c,await l.getDeviceId(),{...e,userAccount:u});return i(null),m.onScannedMessageByUser({networkId:r,warnings:f.warnings.map(g=>g.severity),shouldBlock:!!f.block,errorCode:f.error??""}),f}catch(f){i(f),m.onFailedScannedMessageByUser({networkId:r,url:e.url}),b.addBreadcrumb("simulation",`networkID: ${r}, url: ${e.url}, type: message`,"info"),b.captureError(k.error,"simulation")}},enabled:!!u&&!!e.url&&!!t.message&&!A?.disabled,refetchInterval:A?.disableRefetch?!1:B,staleTime:1e3*10,...Yc()});return{isFetched:k.isFetched,isFetching:k.isFetching,data:k.data,isLoading:k.isPending&&!A?.disabled,isError:k.isError||!!o,error:k.error||o}}function gi(e,A){let{params:j}=e,[t,r]=(0,t7.useState)(null),o=J(),i=["scan-transaction",e.networkID,e.url,j?j.transactions??j.transaction:""],a=i0(),u=!1;I.isEVMNetworkID(e.networkID)||I.isSolanaNetworkID(e.networkID)?u=!!j&&j.transactions.length>0&&!!e.userAccount:I.isBitcoinNetworkID(e.networkID)?u=!!j&&!!j.transaction&&!!j.userAddresses&&j.userAddresses.length>0:I.isSuiNetworkID(e.networkID)&&(u=!!j&&!!e.userAccount);let c=me(T.language)??"en",l=new Xr(o),m=u&&!A?.disabled,B=X({queryKey:i,queryFn:async()=>{try{let k=await la(c,await o.getDeviceId(),e);return l.onScannedTransactionByUser({networkId:e.networkID,warnings:k.warnings.map(f=>f.severity),shouldBlock:!!k.block,errorCode:k.error??""}),r(null),A?.onSettled?.(k,void 0),k}catch(k){l.onFailedScannedTransactionByUser({networkId:e.networkID,url:e.url}),b.addBreadcrumb("simulation",`networkID: ${e.networkID}, url: ${e.url}, type: transaction`,"info"),r(k),A?.onSettled?.(void 0,k),b.captureError(k,"simulation")}},enabled:m,refetchInterval:A?.disableRefetch?!1:a,staleTime:1e3*10,...Yc()});return{isFetched:B.isFetched,isFetching:B.isFetching,data:B.data,isLoading:B.isPending&&m,isError:B.isError||!!t,error:B.error||t}}var s0=5e3;function i0(){let e=Te.getMultivariateAssignment("transactions-simulation-interval-ms");if(!e)return s0;let A=parseInt(e,10);return Number.isNaN(A)?s0:A}var Ei=q(P());n();s();n();s();var pp=class{onStateChange(A,j,t){ep(t,A)}};n();s();var cp=class{constructor(A){this.listeners=A}transition(A,j){try{let t=this.detectNextState(A,j);return this.listeners.forEach(r=>r.onStateChange(j,A,t)),t}catch{return A}}detectNextState(A,j){switch(j.type){case"quoteRequestStarted":return{type:"fetchingQuote",buy:j.buy,sell:j.sell,amount:j.amount};case"quoteResponseReceived":switch(A.type){case"fetchingQuote":case"quote":case"simulated":case"simulationRequestErrored":case"transactionSubmissionFailed":case"transactionNotConfirmed":let t=j.response.quotes[j.quoteIndex];if(!t)throw new Error("Quote index out of bounds");return{type:"quote",response:j.response,buy:A.buy,sell:A.sell,quote:t};default:throw new Error("Can't transition from this state")}case"quoteSelected":switch(A.type){case"quote":let t=A.response.quotes[j.quoteIndex];if(!t)throw new Error("Quote index out of bounds");return{type:"quote",quote:t,buy:A.buy,sell:A.sell,response:A.response};default:throw new Error("Can only transition to QuoteChanged from Quote")}case"simulationResponseReceived":switch(A.type){case"quote":return j.scannedTransactionResult.error?{type:"simulationFailed",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:j.scannedTransactionResult,simulationError:j.scannedTransactionResult.error}:{type:"simulated",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:j.scannedTransactionResult};default:throw new Error("Can only transition to Simulated from Simulating")}case"simulationRequestError":switch(A.type){case"quote":return{type:"simulationRequestErrored",buy:A.buy,sell:A.sell,quote:A.quote,response:A.response,error:j.error};default:throw new Error("Can only transition to SimulationRequestErrored from Simulating")}case"transactionSubmissionFailed":switch(A.type){case"simulated":case"simulationFailed":return{type:"transactionSubmissionFailed",quote:A.quote,buy:A.buy,sell:A.sell,response:A.response,scannedTransactionResult:A.scannedTransactionResult,error:j.error};default:throw new Error("Can only transition to SwapSubmitFailed from SubmittingSwap")}case"transactionConfirmationFailed":switch(A.type){case"simulated":return{type:"transactionNotConfirmed",quote:A.quote,buy:A.buy,sell:A.sell,txReceipt:j.txReceipt,response:A.response,scannedTransactionResult:A.scannedTransactionResult,error:j.error};default:throw new Error("Can only transition to TransactionNotConfirmed from ConfirmingTransaction")}}}};var _1=new cp(new Set([new pp])),a0=UA(e=>({state:{type:"idle"},transition:A=>{e(j=>{let t=j.state;return{state:_1.transition(t,A)}})}}));var $t=()=>{let e=a0(j=>j.state),A=a0(j=>j.transition);return{state:e,transition:A}};n();s();var D1="swap-priority-fee",N1=async(e,A,j)=>{let t=pe(e,"bs58");return await co(t,j),{networkFeeEstimation:await ca(A,[t.message])}};function p0({swapTransactions:e,chainId:A,solanaConnection:j,enabled:t=!0}){return X({queryKey:[D1],queryFn:async()=>{if(!e)throw new Error("No swap transactions");if(e.type!=="solana")throw new Error("Trying to estimate network fee for non-solana txs");if(!A)throw new Error("Trying to execute swap with no chain id.");try{let r=e.transactions.map(a=>N1(a,A,j));return(await Promise.all(r)).map(a=>a.networkFeeEstimation.value)}catch{return[0]}},staleTime:0,enabled:t&&!!e&&e.transactions.length>0&&e.type==="solana"&&!!A})}n();s();var L1="swap-priority-fee";function c0({swapTransactions:e,chainId:A,estimatedFee:j,enabled:t=!0}){return X({queryKey:[L1,e],queryFn:async()=>{if(!e)throw new Error("No swap transactions");if(e.type!=="sui")throw new Error("Trying to estimate network fee for non-sui txs");if(!A)throw new Error("Trying to execute swap with no chain id.");if(j&&j.length===e.transactions.length)return j;try{return(await Promise.all(e.transactions.map(o=>aa({networkID:A,transaction:bo.deserializeTransactionString(o)})))).map(o=>o.gasBudget.toNumber())}catch{return[0]}},enabled:t&&!!e&&e.transactions.length>0&&e.type==="sui"&&!!A})}n();s();var u0={estimateGas:({solanaNetworkFees:e,networkID:A})=>e.map(j=>({networkID:A,value:j}))};n();s();var l0={estimateGas:({suiGasBudget:e,networkID:A})=>e.map(j=>({networkID:A,gasBudget:new S(j)}))};var K1=2e4,r7=({includeGasBuffer:e=!1}={})=>{let{currentQuote:A,quoteResponse:j}=aA(),t=$(O=>O.sellFungible),r=t?.data.chain.id??oA.Solana.Mainnet,{data:o}=Er(t?{address:t.data.walletAddress,networkID:t.data.chain.id}:void 0),i=o?.address??"",a=I.isEVMNetworkID(r),u=I.isSolanaNetworkID(r),c=I.isSuiNetworkID(r),l=$(O=>O.isFetchingQuote),{data:m,isFetching:B}=Jj({callerAddress:i,sellFungible:t,quote:A}),k={type:"transaction",userAccount:i,params:void 0,url:"https://phantom.com",networkID:r};m?.type==="evm"&&a&&(k.params={transactions:m.transactions});let{transition:f}=$t(),g=(0,Ei.useCallback)((O,D)=>{D&&f({type:"simulationRequestError",error:D}),O&&f({type:"simulationResponseReceived",scannedTransactionResult:O})},[f]),{data:E,isFetching:h}=gi(k,{disabled:u,onSettled:g}),{connection:y}=cj(),{data:F}=rB({networkID:a?r:oA.Ethereum.Mainnet,transactionSpeed:"standard",gasLimit:new U(1),refetchInterval:K1,enabled:a}),{data:w,isLoading:x}=p0({swapTransactions:m,chainId:u?r:oA.Solana.Mainnet,solanaConnection:y,enabled:u}),{data:G,isFetching:v}=c0({swapTransactions:m,chainId:c?r:oA.Sui.Mainnet,estimatedFee:j?.estimateGasFee,enabled:c}),_=(0,Ei.useMemo)(()=>{if(!(l||!A)){if(a&&(Ze(A)||dA(A))&&F&&m)return zt.estimateGas({swapTransactions:m,evmGasEstimation:F,currentQuote:A,scanResult:E,includeGasBuffer:e,networkID:r,gasBuffer:j?.gasBuffer});if(u&&w!==void 0)return u0.estimateGas({solanaNetworkFees:w,networkID:r});if(c&&G!==void 0)return l0.estimateGas({suiGasBudget:G,networkID:r})}},[l,A,F,r,w,E,e,j?.gasBuffer,a,u,c,G,m]),C=!1;return u?C=x:c?C=B||h||v:a&&(C=B||h),(0,Ei.useMemo)(()=>({gasEstimation:_,isFetching:C,isError:F===void 0}),[_,C,F])};function U1(){let e=$(o=>o.setGasEstimation),{state:A}=Pj(),{gasEstimation:j}=r7(),{gasEstimation:t,isFetching:r}=r7({includeGasBuffer:!0});(0,d0.useEffect)(()=>{if(A==="paused"){e({isFetching:!1});return}e({isFetching:r,estimate:j,estimateWithBuffer:t})},[A,e,j,t,r])}n();s();var B0=q(P());n();s();var H1="swap",m0=e=>new Vk(e,H1),ar=yo(J,e=>m0(e));n();s();function pr(e,A,j){if(!j)return;if(A==="fixed")return j.slippageTolerance;let t=j.quotes[e];if(t)return dA(t)?j.slippageTolerance:Wj(t)?t.slippageTolerance:j.slippageTolerance}n();s();var up=q(P());var ze=()=>{let{data:e,isFetching:A}=ne({key:"lastSubmittedPairsV2",queryKey:uA.lastSubmittedPairs()}),j=(0,up.useMemo)(()=>e??null,[e]),{mutateAsync:t}=ce({key:"lastSubmittedPairsV2",queryKey:uA.lastSubmittedPairs()}),r=(0,up.useCallback)(async(o,i)=>{await t({sellFungible:k0(o),buyFungible:k0(i)})},[t]);return{pairs:j,isLoading:A,storePairs:r}};function k0(e){return{...e,data:{...e.data,walletAddress:""}}}var lp=({goToConfirmation:e})=>{let A=$(E=>E.sellUsdValue),j=$(E=>E.buyUsdValue),{currentQuote:t,quoteResponse:r,selectedProviderIndex:o,selectedBaseProvider:i}=aA(),a=$(E=>E.sellFungible),u=$(E=>E.buyFungible),c=$(E=>E.swapFilter),{selectedSetting:l}=MA(),{storePairs:m}=ze(),B=J(),k=ar(),{pause:f}=Pj();return(0,B0.useCallback)(()=>{if(!t||!a||!u)return;let E=pr(o,l.type,r);B.capture("swapperSwap");let h=li({buyToken:u,sellToken:a,sellAssetUsdValue:A,buyAssetUsdValue:j,quote:t,slippageTolerance:E,slippageType:l.type,sellSwapFilter:c,baseProvider:i});h&&(b.addBreadcrumb("swapper","approved","info",Rt(h.swap)),k.approved(h)),f(),e(),I.compareNetworkID(a.data.chain.id,u.data.chain.id)===0&&m(a,u)},[t,a,u,o,l.type,r,B,A,j,f,e,k,m,c,i])};n();s();n();s();n();s();n();s();n();s();var Q1=p.object({type:p.literal("fungible"),data:Zk}),f0=p.object({results:p.array(p.any()).transform(e=>e.reduce((A,j)=>{let t=Q1.safeParse(j);return t.success&&A.push(t.data),A},[])),prevCursor:p.string().nullish().default(null),nextCursor:p.string().nullish().default(null),hasMore:p.boolean()});async function g0(e){let{query:A,networkIds:j,searchContext:t,supportedNetworkIds:r,pageSize:o=50,cursor:i}=e,a=await N.api().headers({"Content-Type":"application/json"}).get("/search/v1",{params:{query:A.trim(),chainIds:j.join(","),platform:Fj,pageSize:o.toString(),searchTypes:"fungible",searchContext:t,...i&&{cursor:i},...r&&{supportedNetworkIds:r.join(",")}}});if(!eA(a))throw new DA({key:"UnknownError"});let u=f0.safeParse(a.data);if(u.success)return u.data;throw new DA({key:"UnknownError"})}n();s();var o7=e=>{let A=e.data,j=tu(A)??void 0;return{type:A.type,data:{...A.data,tokenAddress:tu(A)??void 0,key:j}}};n();s();var V1="search",E0={searchResults:(e,A,j,t,r)=>[V1,{query:e,networkIds:A,supportedNetworkIds:t,chainAddresses:j,cursor:r}]};n();s();var n7=(o=>(o[o.Always=1/0]="Always",o[o.Short=Q({minutes:5})]="Short",o[o.Medium=Q({minutes:30})]="Medium",o[o.Long=Q({hours:1})]="Long",o[o.Never=0]="Never",o))(n7||{}),s7=(r=>(r[r.Immediate=0]="Immediate",r[r.Short=Q({minutes:5})]="Short",r[r.Medium=Q({minutes:30})]="Medium",r[r.Long=Q({hours:1})]="Long",r))(s7||{});var z1=async e=>(await g0(e)).results.map(j=>o7(j)),Jr=({query:e,networkIds:A,enableQuery:j=!0,keepPreviousData:t=!1,searchContext:r,supportedNetworkIds:o,chainAddresses:i,pageSize:a})=>{let u=E0.searchResults(e,A,i,o);return X({queryKey:u,gcTime:n7.Short,staleTime:s7.Short,enabled:j,placeholderData:t?jk:void 0,queryFn:()=>z1({query:e,networkIds:A,searchContext:r,supportedNetworkIds:o,pageSize:a})})};var Bj=q(P());n();s();n();s();function i7(e,A){return e.localeCompare(A,void 0,{sensitivity:"base"})===0}n();s();function y0(e,A){if(!e||A.length===0)return null;let j=new Set(A),t=1/0,r=null;for(let o of e){let i=new S(o.data.amount??0).gt(0);if(!j.has(o.data.chain.id)||!i)continue;let a=A.indexOf(o.data.chain.id);if(a<t&&(t=a,r=o.data.chain.id,a===0))break}return r}var h0=(e,A,j)=>{let t=A.length?y0(e,A):null;return!t||!j.includes(t)?qd:NA.get(t).nativeFungible},F0=e=>e?NA.get(e).usdcFungible:si,yi=(e,A)=>{let j=hr(A);return e.find(t=>{if(ZA(j)&&j===t.type)return!0;if(A.resourceType==="address"){let r=sB(t);return gr(A)?i7(A.address,r):A.address===r}})},dp=(e,A,j)=>{let t=yi(j,e);if(!t){if(ZA(hr(e)))t=NA.get(e.chainId).nativeFungible;else if(A&&A.chainId===e.chainId){let r=ZA(hr(A)),{usdcFungible:o,nativeFungible:i}=NA.get(A.chainId);t=r?o:i}}return t},a7=e=>{let{usdcFungible:A,nativeFungible:j}=NA.get(e.chainId),t=M(e),r=M(V(A));return ZA(hr(e))?A:(i7(t,r),j)};n();s();var S0=q(P());n();s();var p7=q(P());n();s();function Yr(e,A){return e.data.key===A.data.key}function Zr({enablePrices:e,enableSorting:A}){let{fungibles:j,isLoadingTokens:t,tokensError:r,refetch:o}=uj({enablePrices:e,enableSorting:A}),i=ap(),a=$(l=>l.sellFungible),u=j.filter(l=>i(l.data.chain.id)&&l.type!=="CompressedSPL"),c=(0,p7.useMemo)(()=>{if(a){let l=u.findIndex(B=>Yr(B,a)),m=u[l];m&&m.data.amount!==a.data.amount&&(u[l]=a)}return u.filter(l=>l.data.amount!=="0")},[u,a]);return(0,p7.useMemo)(()=>({assets:c,isLoading:t,error:r,refetchTokens:o}),[c,t,r,o])}var w0=e=>{let A=Eo(),{pairs:j}=ze(),{assets:t}=Zr({enablePrices:!1,enableSorting:!1});return(0,S0.useMemo)(()=>{let r=F0(e?.data.chain.id),a=((j?A.includes(j.buyFungible.data.chain.id):!1)?j?.buyFungible:void 0)??r;return a?yi(t,V(a))??a:void 0},[e,j,A,t])};n();s();var b0=q(P());var mp=()=>{let e=Eo(),A=It(),{pairs:j}=ze(),{assets:t}=Zr({enablePrices:!1,enableSorting:!1}),{fungibles:r}=uj();return(0,b0.useMemo)(()=>{let o=h0(r,e,A),i=j?V(j?.sellFungible):void 0,a=j?V(j?.buyFungible):void 0;return((i?e.includes(i.chainId):!1)&&i&&a?dp(i,a,t):void 0)??o},[e,j,t,A,r])};var I0=e=>{if(e)try{return TA(e)}catch{return}},$0=e=>Fr(e)??[];function X1({paramsSellFungible:e,paramsSellAmount:A,paramsBuyFungible:j,navRef:t}){let{isLoading:r}=ze(),o=(0,Bj.useMemo)(()=>I0(e),[e]),i=(0,Bj.useMemo)(()=>I0(j),[j]),a=A,[u,c]=(0,Bj.useState)(!1),[l,m]=(0,Bj.useState)(!1),{data:B}=pA(),{assets:k,isLoading:f}=Zr({enablePrices:!1,enableSorting:!1}),{data:g,isPending:E}=Jr({query:i?.resourceType==="address"?i.address:i?.slip44??"",enableQuery:!!i,networkIds:[i?.chainId??I.solana.mainnetID],searchContext:"swapper"}),h=(0,Bj.useMemo)(()=>{let R=[];return o&&R.push(...$0(o)),i&&R.push(...$0(i)),R},[o,i]),{fungibles:y,isLoadingTokens:F,isRefetchingTokens:w,tokensError:x}=uj({keys:h,enablePrices:!1,enableSorting:!1}),G=mp(),v=$(R=>R.sellFungible),_=w0(v),C=$(R=>R.setBuyFungible),O=$(R=>R.setSellFungible),D=$(R=>R.setUiSellAmountCryptoInput),H=$(R=>R.setSellAmount),z=$(R=>R.setSwapFilter);return(0,Bj.useEffect)(()=>{O(void 0),c(!1),C(void 0),m(!1)},[o,i,O,C,B?.identifier,r,t]),(0,Bj.useEffect)(()=>{if(u)return;let R;if(o){if(f)return;R=dp(o,i,k)}else!o&&i?R=a7(i):R=G;c(!0),O(R)},[o,i,G,k,O,f,u]),(0,Bj.useEffect)(()=>{if(l)return;let R;if(i){if(E)return;if(R=yi(g??[],i),!R){let{usdcFungible:W,nativeFungible:K}=NA.get(i.chainId);R=ZA(hr(i))?K:W}}else!i&&o?R=a7(o):R=_;if(!F&&!w&&!x&&y&&R){let W=M(V(R)),K=y.find(rA=>M(V(rA))===W);K&&(R=K)}m(!0),C(R)},[i,o,g,E,C,l,_,y,F,w,x]),(0,Bj.useEffect)(()=>{a?(H(a),D(a)):(H(""),D("")),z(void 0)},[a,t,D,H,z]),{isLoading:(!!o||!!i)&&(!l||!u)||r}}n();s();var Cj=q(P()),P0=q(In());n();s();var q0=({sellToken:e,buyToken:A,taker:j,takerDestination:t,amount:r,slippageTolerance:o,pollInterval:i,pollerState:a,enableAutoSlippage:u,priorityFee:c,tipAmount:l,getSwapQuotesStrategy:m})=>{let B=J(),k=e?V(e):void 0,f=A?V(A):void 0,g=e?iB(e,r.value).toString():r.value,E=Tj(x=>x.preferredProvider),h=!!r.value&&!!A&&!!e&&!!j&&a==="resumed";h||m.stopFetching();let y=Q6(),F=uA.quotes({sellTokenCaip19:k,buyTokenCaip19:f,taker:j,amountValue:g,amountType:r.type,takerDestination:t,slippageTolerance:o,enableAutoSlippage:u,priorityFee:c,tipAmount:l,preferredProvider:E,phantomCashAccount:y}),w=m.getFetchInterval(i);return X({queryKey:F,enabled:h,gcTime:0,staleTime:0,refetchInterval:w,async queryFn({signal:x}){if(!r||!f||!k||!A||!e||!j)throw new Error("missing necessary args");let G=await m.fetch({sellTokenCaip19:k,buyTokenCaip19:f,taker:j,takerDestination:t,sellAmount:g,exactOut:r.type==="buy",slippageTolerance:o,signal:x,enableAutoSlippage:u,priorityFee:c,tipAmount:l,sell:e,buy:A,amount:{value:g,type:r.type},sellAmountUsd:S(g).times(e.data.price??0).toString(),preferredProvider:E,phantomCashAccount:y??!1},F);return B.capture("swapperQuotesResult",{data:{numQuotes:G.quotes.length,sellToken:e,buyToken:A,fromNetworkId:k.chainId,toNetworkId:f.chainId}}),G}})};n();s();var x0=q(P());var T0=()=>{let e=$(r=>r.sellAmount),A=$(r=>r.sellFungible),j=$(r=>r.buyFungible),t=$(r=>r.setSelectedBaseProvider);(0,x0.useEffect)(()=>{t($e)},[e,A,j,t])};n();s();var $n=()=>{let e=$(m=>m.sellFungible),A=$(m=>m.buyFungible),j=$(m=>m.sellAmount),t=e?V(e):null,{data:r}=be({query:t?{data:t}:void 0}),o=e?.data.chain.id,i=A?.data.chain.id,a=r?.usd;if(!o||!i||!j||!a||I.compareNetworkID(o,i)===0)return!0;let u=Ae(Number(j),a),c=NA.get(o).bridgeMinimumUsdAmounts,l=NA.get(i).bridgeMinimumUsdAmounts;return c<=u&&l<=u};function J1({skipInitialBuyFungible:e,getSwapQuotesStrategy:A}){let j=$(jA=>jA.sellAmount),t=$(jA=>jA.amountType),o=$(jA=>jA.buyFungible)??(e?void 0:si),i=$(jA=>jA.sellFungible),{data:a}=Qe(),{selectedSetting:u}=Vr(),{data:c}=Ve(),{selectedSetting:l}=kn(),{state:m,intervalMs:B}=Pj(),k=$(jA=>jA.resetQuote),f=$(jA=>jA.setHasNoRoutes),g=$(jA=>jA.setError),E=$(jA=>jA.setIsFetchingQuote),h=$(jA=>jA.setQuoteResponse),y=$(jA=>jA.setSelectedProviderIndex),{data:F}=wt(),{mutateAsync:w}=V6(),{selectedSetting:x}=MA(),G=x.type==="auto",v=l.type==="auto",_=u.type==="auto",C=$n(),O=(0,P0.default)(C),D=(0,Cj.useMemo)(()=>{let jA=t==="sell"?{amount:j,fungible:i}:{amount:j,fungible:o};return new U(jA.amount).isGreaterThan(0)&&jA.fungible?dB(jA.amount,jA.fungible.data.decimals).toString():(k(),"")},[t,o,k,j,i]),H=vA(i?.data?.chain.id,o?.data.chain.id),{data:z}=Er(i?.data?.chain.id),{data:L}=Er(o?.data.chain.id),R=(0,Cj.useMemo)(()=>{if(z)return{chainId:z.networkID,address:z.address,resourceType:"address"}},[z]),W=(0,Cj.useMemo)(()=>{if(H)return{chainId:L?.networkID,address:L?.address,resourceType:"address"}},[H,L?.address,L?.networkID]),{data:K,error:rA,isLoading:Y}=q0({sellToken:i,buyToken:o,taker:R,takerDestination:W,amount:{value:C?D:"",type:t},slippageTolerance:G?void 0:F??void 0,enableAutoSlippage:G,priorityFee:_?void 0:a??void 0,tipAmount:v?void 0:c??void 0,pollInterval:B,pollerState:m,getSwapQuotesStrategy:A}),fA=$(jA=>jA.selectedProviderIndex);(0,Cj.useEffect)(()=>{!Y&&K&&xj.addQuoteResponse(K,fA.toString())},[fA]);let AA=(0,Cj.useCallback)(jA=>{g(null),y(0),E(!1),f(!1),h(jA),xj.addQuoteResponse(jA,"0");let sA=pr(0,x.type,jA);sA&&F!==sA&&w(sA)},[g,f,E,h,y,w,F,x.type]),nA=(0,Cj.useCallback)(jA=>{k(),E(!1),f(!0),g(jA)},[k,g,f,E]);(0,Cj.useEffect)(()=>{m!=="paused"&&(Y?E(!0):K?AA(K):rA&&nA(rA))},[rA,K,Y,AA,nA,E,m,C]),(0,Cj.useEffect)(()=>{C?O===!1&&C&&(g(null),f(!1)):(g(new DA({key:"InsufficientSellAmount"})),f(!0))},[C,O,g,f]),T0()}n();s();var kp=q(P());n();s();var Y1=5*60,G0=e=>{if(dA(e))return IA(Qo(e));let{sources:A}=e;return IA(A)},C0=({quotes:e,buyTokenNetworkId:A,buyTokenDecimals:j,buyTokenSymbol:t})=>e.map(r=>{let{buyAmount:o}=r,i=bj.get(A).formDisplayPrecision;return{name:G0(r),amount:`${_e(mA(o,j),i)} ${t}`}}),O0=({quotes:e,buyTokenNetworkId:A,buyTokenDecimals:j,buyTokenSymbol:t,networkIDForFees:r,networkFee:o,priceMap:i})=>e.filter(dA).map(a=>{let{buyAmount:u,executionDuration:c,steps:l}=a,B=K6(a).plus(o),k=l.find(g=>!!g.tool.logoURI),f=bj.get(A).formDisplayPrecision;return{name:G0(a),feeUsd:r&&i?ej(r,B,i):null,amount:`${_e(mA(u,j),f)} ${t}`,time:{text:rj(c),isFast:c<=Y1},logoURI:k?.tool.logoURI??""}});n();s();var Z1={aggregate(e){return e.reduce((A,j)=>({...A,gasLimit:A.gasLimit.plus(j.gasLimit)}),{networkID:I.ethereum.mainnetID,gasLimit:new U(0),maxFeePerGas:e[0].maxFeePerGas,maxPriorityFeePerGas:e[0].maxPriorityFeePerGas})}},AC={aggregate(e){return e.reduce((A,j)=>({...A,value:A.value+j.value}),{networkID:I.solana.mainnetID,value:0})}},eC={aggregate(e){return e.reduce((A,j)=>({...A,gasBudget:A.gasBudget.plus(j.gasBudget)}),{networkID:I.sui.mainnetID,gasBudget:new U(0)})}},hi=e=>{if(!(!e||e.length===0)){if(sa(e[0]))return Z1.aggregate(e);if(Mk(e[0]))return AC.aggregate(e);if(Rk(e[0]))return eC.aggregate(e)}};function jC({selectQuote:e}){let{quoteResponse:A,isFetchingQuote:j,quotes:t,selectedProviderIndex:r}=aA(),o=$(F=>F.setSelectedProviderIndex),i=$(F=>F.gasEstimation.estimateWithBuffer),a=$(F=>F.sellFungible),u=$(F=>F.buyFungible),c=a?.data.chain.id,{data:l}=cs(c,hi(i)),B=ir().map(F=>Re(F)),{data:k={}}=lt({query:{data:B}}),f=A?.type==="xchain",g=(0,kp.useMemo)(()=>u?f?O0({quotes:t,buyTokenNetworkId:u.data.chain.id,buyTokenDecimals:u.data.decimals,buyTokenSymbol:u.data.symbol,networkIDForFees:c,networkFee:l?.gasEstimationAmount??new U(0),priceMap:k}):C0({quotes:t,buyTokenNetworkId:u.data.chain.id,buyTokenDecimals:u.data.decimals,buyTokenSymbol:u.data.symbol}):[],[u,f,t,c,l?.gasEstimationAmount,k]),E=J(),{transition:h}=$t(),y=(0,kp.useCallback)(F=>{let w=g[F];E.capture("swapperProviderSelected",{data:{provider:w.name}}),o(F),e(t,F),h({type:"quoteSelected",quoteIndex:F})},[o,g,E,h,t,e]);return{rows:g,selectedProviderIndex:r,isLoadingProviders:j,setSelectedProviderIndex:y}}n();s();var M0=q(P());var vt=()=>{let{resume:e}=Pj(),A=$(j=>j.resetSwapper);return(0,M0.useCallback)(()=>{e(),A()},[A,e])};n();s();var fp=q(P());n();s();var _0=q(P());n();s();var R0=q(P());var Bp=()=>{let e=cA();return{cancelQuotes:(0,R0.useCallback)(async()=>{await e.cancelQueries({queryKey:uA.quotesScope()}),await pk(1)},[e])}};function u7(){let e=J(),A=$(r=>r.setBuyFungible),j=$(r=>r.buyFungible),{cancelQuotes:t}=Bp();return(0,_0.useCallback)(async r=>{if(j&&Yr(r,j))return;await t();let o=Ft(r);e.capture("swapperUpdateToAsset",{data:o}),A(r)},[e,j,t,A])}n();s();var D0=e=>{l7.getState().setAsset(e)},l7=UA(e=>({asset:void 0,setAsset(A){e({asset:A})}}));var tC=({onClose:e})=>{let A=qA(),j=u7(),t=l7(i=>i.asset),r=(0,fp.useMemo)(()=>bt().find(a=>a.programId===t?.data?.ugcTokenMeta?.programId),[t]),o=(0,fp.useCallback)(async()=>{t&&(A.changeToken(t,"buy"),await j(t),e())},[j,A,t,e]);return{asset:t,program:r,handleConfirmPress:o}};n();s();n();s();var d7=()=>{let e=cA(),A=$();return{clearQuotes:async()=>{A.resetQuote(),await e.invalidateQueries({queryKey:uA.quotesScope()})}}};n();s();var m7=({accountIdentifier:e,networkID:A})=>{let j=yA(),t=wj();return wA({mutationFn:async o=>{let{swapTransactions:i,type:a}=o;if(i.type==="evm"&&a==="eip155"){let{gasEstimation:u,pendingApprovalActivityRows:c,pendingSwapActivityRows:l}=o,{signature:m,error:B}=await b.startSpan("Process EVM Swap Txns",()=>Za({transactions:i.transactions,transactionTypes:i.transactionTypes,networkID:A,gasEstimation:u,pendingSwapActivityRows:l,pendingApprovalActivityRows:c,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:m,error:B}}else if(i.type==="solana"&&a==="solana"){let{callerAddress:u,connection:c,pendingSwapActivityRows:l}=o;if(!c)throw new Error("missing connection");let{signature:m,error:B}=await b.startSpan("Process Solana Swap Txns",()=>j6({callerAddress:u,connection:c,networkID:A,transactions:i.transactions,pendingSwapActivityRows:l,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:m,error:B}}else if(i.type==="sui"&&a==="sui"){let{callerAddress:u,pendingSwapActivityRows:c}=o,{signature:l,error:m}=await b.startSpan("Process Sui Swap Txns",()=>n6({callerAddress:u,networkID:A,transactions:i.transactions,pendingSwapActivityRows:c,accountIdentifier:e,accountSigner:t,storage:j}));return{networkID:A,chainType:a,id:l,error:m}}throw new Error("unsupported")}})};n();s();n();s();var qn=q(P());n();s();n();s();var Xe=(e,A=9)=>{let j=(e.match(/\./g)||[]).length;return e.endsWith(".")&&j>1?e.substring(0,e.length-1):e.length===0||e.endsWith(".")||e.endsWith("0")?e:new S(e).decimalPlaces(A).toString()};var N0=q(P());function L0(){let e=$(r=>r.setUiBuyAmountCryptoInput),A=$(r=>r.setUiBuyAmountLocalFiatInput),j=$(r=>r.primaryCurrency),{fromUsd:t}=bA();return(0,N0.useCallback)(({amount:r,decimals:o,usdPrice:i})=>{if(j==="crypto")if(r===void 0)e("");else{let a=mA(r,o).toString(),u=Xe(a);e(u)}else if(j==="fiat"&&i)if(r===void 0)A("");else{let a=mA(r,o).toString(),u=Ae(Number(a),i),c=t(u);A(c.toString())}},[t,j,A,e])}n();s();n();s();var cr=q(P());function vn(e,A,j=100){let[t,r]=(0,cr.useState)(()=>e),o=(0,cr.useRef)(void 0),i=(0,cr.useCallback)(a=>{r(a),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{A(a),o.current=void 0},j)},[j,A]);return(0,cr.useEffect)(()=>{o.current&&(clearTimeout(o.current),o.current=void 0),r(e)},[e]),[t,i]}var K0=q(P());function U0(){let e=$(a=>a.setAmountType),A=$(a=>a.setSellAmount),j=$(a=>a.sellAmount),t=$(a=>a.setUiBuyAmountCryptoInput),r=J(),[o,i]=vn(j,A,un);return(0,K0.useCallback)(async({fungibleValue:a,shouldUpdateQuote:u,decimals:c})=>{let l=De(a.substring(0,Hr)),m=Xe(l,c);e("buy"),t(m),await r.capture("swapperChangeReceiveCryptoAmount",{data:{amount:m}}),u&&i(m)},[r,e,t,i])}n();s();var H0=q(P());function gp(e){return(0,H0.useMemo)(()=>e===void 0?void 0:V(e),[e])}n();s();var Ao=q(P());var Q0=()=>{let e=J(),A=$(y=>y.primaryCurrency),j=$(y=>y.sellFungible),t=$(y=>y.buyFungible),r=$(y=>y.uiSellAmountLocalFiatInput),o=$(y=>y.uiBuyAmountLocalFiatInput),i=$(y=>y.amountType),a=$(y=>y.setUiSellAmountCryptoInput),u=$(y=>y.setUiBuyAmountCryptoInput),c=$(y=>y.switchTokensForBuy),l=$(y=>y.switchTokensForSell),{data:m}=be({query:j?{data:V(j)}:void 0}),{data:B}=be({query:t?{data:V(t)}:void 0}),{toUsd:k}=bA(),f=(0,Ao.useMemo)(()=>({localFiatValue:r,decimals:j?.data.decimals??0,usdPrice:m?.usd}),[j?.data.decimals,r,m?.usd]),g=(0,Ao.useMemo)(()=>({localFiatValue:o,decimals:t?.data.decimals??0,usdPrice:B?.usd}),[t?.data.decimals,B?.usd,o]),E=(0,Ao.useCallback)(({localFiatValue:y,decimals:F,usdPrice:w})=>{let x=y?"":_e(0,F);if(w&&y){let G=k(y);x=Ij(Number(G),w,F).toString()}return x},[k]),h=(0,Ao.useCallback)(()=>{e.capture("swapperSwitchTokensClicked",{data:{sell:j?M(V(j)):"",buy:t?M(V(t)):""}})},[e,j,t]);return(0,Ao.useCallback)(()=>{if(A==="fiat"){let y=E(f);a(y);let F=E(g);u(F)}i==="sell"?l():c(),h()},[i,g,A,f,u,a,c,l,E,h])};var oC={chainId:oA.Solana.Mainnet,slip44:"501",resourceType:"nativeToken"};function k7(){let e=$(x=>x.buyFungible),A=gp(e),j=$(x=>x.sellFungible),t=$(x=>x.primaryCurrency),r=$(x=>x.uiBuyAmountCryptoInput),o=$(x=>x.uiBuyAmountLocalFiatInput),i=$(x=>x.amountType),a=$(x=>x.setAmountType),u=$(x=>x.setSellAmount),c=$(x=>x.uiSellAmountCryptoInput),l=$(x=>x.uiSellAmountLocalFiatInput),m=e?.data.decimals??0,{currentQuote:B}=aA(),k=e?V(e):oC,{data:f}=be({query:{data:k}}),g=Q0(),E=L0(),h=U0(),{toUsd:y}=bA();(0,qn.useEffect)(()=>{i==="sell"&&A&&E({amount:B?.buyAmount,decimals:m,usdPrice:f?.usd})},[i,A,B?.buyAmount,m,f?.usd,E]),(0,qn.useEffect)(()=>{if(vA(j?.data.chain.id,e?.data.chain.id)&&i==="buy"){if(a("sell"),t==="crypto")u(c);else if(f?.usd){let x=y(l),G=Ij(x,f.usd,m);u(G.toString())}}},[i,e,m,f,t,j,a,u,y,c,l]);let F=(0,qn.useCallback)(x=>{h({fungibleValue:x,decimals:m,shouldUpdateQuote:!0})},[m,h]),w=(0,qn.useCallback)(()=>{g()},[g]);return{cryptoAmountInputValue:r,handleCryptoAmountInputChange:F,localFiatAmountInputValue:o,handleSwitchTokensClick:w}}n();s();var Mj=q(P());n();s();var V0=q(P());function z0(){let e=$(c=>c.primaryCurrency),A=$(c=>c.setUiSellAmountLocalFiatInput),j=$(c=>c.setUiBuyAmountLocalFiatInput),t=$(c=>c.setAmountType),r=$(c=>c.setPrimaryCurrency),o=$(c=>c.setUiSellAmountCryptoInput),i=$(c=>c.setSellAmount),a=$(c=>c.setUiBuyAmountCryptoInput),{fromUsd:u}=bA();return(0,V0.useCallback)(({buyAmountFromQuote:c,buyFungibleDecimals:l,buyFungibleUsdPrice:m,sellAmountFromQuote:B,sellFungibleUsdPrice:k})=>{if(e==="crypto"){if(t("sell"),k&&B){let f=Ae(Number(B),k),g=u(f);A(g.toString()),i(B.toString())}if(m&&c){let f=mA(c,l).toString(),g=Ae(Number(f),m),E=u(g);j(E.toString())}r("fiat")}if(e==="fiat"){if(B&&o(B),m&&c){let f=mA(c,l).toString();a(f)}r("crypto")}},[u,e,i,t,a,j,r,o,A])}n();s();var X0=q(P());function W0(){let e=$(r=>r.primaryCurrency),A=$(r=>r.setUiSellAmountCryptoInput),j=$(r=>r.setUiSellAmountLocalFiatInput),{fromUsd:t}=bA();return(0,X0.useCallback)(({amount:r,decimals:o,usdPrice:i})=>{if(e==="crypto")if(r===void 0)A("0");else{let a=mA(r,o).toString();A(a)}else if(e==="fiat"&&i)if(r===void 0)j("0");else{let a=mA(r,o).toString(),u=Ae(Number(a),i),c=t(u);j(c.toString())}},[t,e,A,j])}n();s();var J0=q(P());function Y0(){let e=$(i=>i.setAmountType),A=$(i=>i.setUiSellAmountCryptoInput),j=$(i=>i.setSellAmount),t=$(i=>i.sellAmount),[r,o]=vn(t,j,un);return(0,J0.useCallback)(({fungibleValue:i,decimals:a,shouldUpdateQuote:u,shouldTrimLength:c=!0})=>{let l=De(c?i.substring(0,Hr):i),m=Xe(l,a);e("sell"),A(m),u&&o(m)},[e,A,o])}n();s();var Z0=q(P());function AF(){let e=$(a=>a.setAmountType),A=$(a=>a.setSellAmount),j=$(a=>a.sellAmount),t=$(a=>a.setUiSellAmountLocalFiatInput),{toUsd:r}=bA(),[o,i]=vn(j,A,un);return(0,Z0.useCallback)(({localFiatValue:a,shouldUpdateQuote:u,decimals:c,priceData:l})=>{let m=De(a.substring(0,Hr)),B=Xe(m,2);if(e("sell"),t(B),u&&l?.usd){let k=r(a),f=Ij(k,l.usd,c);i(f.toString())}},[e,t,i,r])}n();s();var uF=q(P());n();s();var eF=q(P());var nC={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"},jF=()=>{let{currentQuote:e}=aA(),{destinationNetworkFee:A,liquidityFee:j}=(0,eF.useMemo)(()=>{function t(o){return o?{amount:new S(o.amount??0),amountUsd:o.amountUSD?parseFloat(o.amountUSD):null,pct:parseFloat(o.percentage??"0")}:rr}let r=new Map([]);return e&&dA(e)&&(r=e.steps.flatMap(o=>o.includedFeeCosts).reduce((o,i)=>{if(!i)return o;let a=nC[i.name];return a&&o.set(a,i),o},r)),{destinationNetworkFee:t(r.get("destinationNetwork")),liquidityFee:t(r.get("liquidityProvider"))}},[e]);return{destinationNetworkFee:A,liquidityFee:j}};n();s();var tF=q(P());var sC={calculate({currentQuote:e,gasEstimationPriceData:A}){return{amount:(e&&A?.gasEstimationAmount)??new S(0),amountUsd:(e&&A?.gasEstimationPriceUSDNumber)??null,pct:0}}},iC={calculate({currentQuote:e,gasEstimationPriceData:A,priceMap:j,networkID:t}){let r=(e?.fees??[]).find(a=>a.type==="tips"||a.type==="network"&&a.name!=="Token account deposits"),o=(e&&A?.gasEstimationAmount)??new S(0),i=(e&&A?.gasEstimationPriceUSDNumber)??null;if(r&&r.amount&&(o=o.plus(new S(r.amount)),i)){let a=ej(t,new S(r.amount),j);a&&(i+=a)}return{amount:o,amountUsd:i,pct:0}}},aC={calculate({currentQuote:e,gasEstimationPriceData:A,maxGasEstimationPriceData:j}){return{amount:(e&&A?.gasEstimationAmount)??new S(0),amountUsd:(e&&A?.gasEstimationPriceUSDNumber)??null,maxAmount:(e&&j?.gasEstimationAmount)??new S(0),maxAmountUsd:(e&&j?.gasEstimationPriceUSDNumber)??null,pct:0}}},rF=({priceMap:e})=>{let{currentQuote:A}=aA(),j=$(c=>c.sellFungible),t=$(c=>c.gasEstimation),r=j?.data.chain.id??oA.Solana.Mainnet,{data:o,isLoading:i}=cs(r,hi(t.estimate)),{data:a}=cs(r,hi(t.estimateWithBuffer));return{networkFee:(0,tF.useMemo)(()=>I.isEVMNetworkID(r)?aC.calculate({currentQuote:A,gasEstimationPriceData:o,maxGasEstimationPriceData:a}):I.isSolanaNetworkID(r)?iC.calculate({currentQuote:A,gasEstimationPriceData:o,networkID:r,priceMap:e}):sC.calculate({currentQuote:A,gasEstimationPriceData:o}),[A,o,a,r,e]),isFetchingGasEstimationPrice:i}};n();s();var oF=q(P());var pC={calculate(){return rr}},cC={calculate({currentQuote:e,networkID:A,priceMap:j}){let t=K6(e);return{amount:t,amountUsd:ej(A,t,j),pct:0}}},nF=({priceMap:e})=>{let{currentQuote:A}=aA(),t=$(o=>o.sellFungible)?.data.chain.id??oA.Solana.Mainnet;return{nonIncludedFees:(0,oF.useMemo)(()=>A&&dA(A)?cC.calculate({currentQuote:A,networkID:t,priceMap:e}):pC.calculate(),[t,A,e])}};n();s();var sF=q(P());var uC={calculate({currentQuote:e,networkID:A,priceMap:j}){let t=(e?.fees??[]).find(r=>r.name==="Token account deposits");return{amount:new S(t?.amount??0),amountUsd:t?.amount?ej(A,new S(t.amount),j):null,pct:t?.percentage??0}}},lC={calculate(){return rr}},iF=({priceMap:e})=>{let{currentQuote:A}=aA(),t=$(o=>o.sellFungible)?.data.chain.id??oA.Solana.Mainnet;return{tokenAccountFee:(0,sF.useMemo)(()=>Wj(A)?uC.calculate({currentQuote:A,networkID:t,priceMap:e}):lC.calculate(),[A,t,e])}};n();s();var aF=q(P());var pF={calculate:({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r})=>{let o=e.amount.plus(A.amount).plus(j.amount);return{amount:o,amountUsd:ej(t,o,r),pct:0}}},dC={calculate:({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r})=>{let o=pF.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:t,priceMap:r}),i=e.amount.plus(A.maxAmount??0).plus(j.amount);return{...o,maxAmount:i,maxAmountUsd:ej(t,i,r)}}},cF=({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,priceMap:t})=>{let o=$(a=>a.sellFungible)?.data.chain.id??oA.Solana.Mainnet;return{totalFees:(0,aF.useMemo)(()=>I.isEVMNetworkID(o)?dC.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:o,priceMap:t}):pF.calculate({tokenAccountFee:e,networkFee:A,nonIncludedFees:j,networkID:o,priceMap:t}),[A,o,j,t,e])}};var Oj=()=>{let e=$(B=>B.gasEstimation.isFetching),A=ir(),{data:j={}}=lt({query:{data:A.map(B=>Re(B))}}),{networkFee:t,isFetchingGasEstimationPrice:r}=rF({priceMap:j}),o=e||r,{phantomFee:i}=Sh(),{tokenAccountFee:a}=iF({priceMap:j}),{nonIncludedFees:u}=nF({priceMap:j}),{totalFees:c}=cF({tokenAccountFee:a,networkFee:t,nonIncludedFees:u,priceMap:j}),{destinationNetworkFee:l,liquidityFee:m}=jF();return(0,uF.useMemo)(()=>({phantomFee:i,networkFee:t,tokenAccountFee:a,totalFees:c,nonIncludedFees:u,destinationNetworkFee:l,liquidityFee:m,isFetchingFees:o}),[i,t,a,c,u,l,m,o])};n();s();var B7=q(P());var mC=.05,kC=({sellNetworkId:e,buyNetworkId:A,destinationMinRequiredBalance:j,priceMap:t})=>{if(!e||!A||!t)return new S(0);let r=M(Re(I.getChainID(e))),o=M(Re(I.getChainID(A))),i=t[r]?.usd,a=t[o]?.usd;if(!i||!a)return new S(0);let u=mA(j.toNumber(),I.getTokenDecimals(A)),c=Ae(u.toNumber(),a),l=Ij(c,i,I.getTokenDecimals(e));return new S(l).times(1+mC)},ur=({sellFungible:e,buyFungible:A})=>{let j=e?.data.chain.id,t=A?.data.chain.id,r=t??j,o=vA(j,t),{fungible:i}=$j({key:A?.data.key}),{data:a}=pA(),u=(0,B7.useMemo)(()=>a?.addresses.find(k=>k.networkID===r),[a,r]),l=ir().map(k=>Re(k)),{data:m}=lt({query:{data:l},queryOptions:{refetchInterval:!1}}),{data:B=0}=Sr(u);return(0,B7.useMemo)(()=>{if(i)return new S(0);let k=new S(B);return o?kC({sellNetworkId:j,buyNetworkId:t,destinationMinRequiredBalance:k,priceMap:m}):k},[i,B,o,j,t,m])};n();s();var f7=q(P()),lr=e=>{let A=e?.data.chain.id,{data:j}=pA(),t=(0,f7.useMemo)(()=>j?.addresses.find(o=>o.networkID===A),[j,A]),{data:r=0}=Sr(t);return(0,f7.useMemo)(()=>new S(r),[r])};function g7(){let e=cA(),A=mp(),j=$(lA=>lA.sellFungible)??A,t=$(lA=>lA.buyFungible),r=$(lA=>lA.primaryCurrency),o=$(lA=>lA.isFetchingQuote),i=$(lA=>lA.sellAmount),a=$(lA=>lA.uiSellAmountCryptoInput),u=$(lA=>lA.setSellFungible),c=$(lA=>lA.uiSellAmountLocalFiatInput),l=$(lA=>lA.amountType),m=$(lA=>lA.setSwapFilter),{data:B}=Qe(),{data:k}=Ve(),f=gp(j),g=j?.data.key,{fungible:E}=$j({key:g}),h=j?.data.chain.id,y=t?.data.chain.id,{totalFees:F}=Oj(),{data:w}=$o({networkID:h}),x=vA(h,y),G=lr(j),v=ur({sellFungible:j,buyFungible:t}),_=j?.data.amount,C=j?j.data.decimals:0,O=(0,Mj.useMemo)(()=>mn({sellFungible:j,totalFees:F.amount,transactionSpeedsToUnitCost:I.isEVMNetworkID(j.data.chain.id)?w:void 0,isBridge:x,minRequiredBalance:{source:G,destination:v},customPriorityFee:St(B??0),customTip:St(k??0)}),[j,F.amount,w,x,v,G,B,k]),D=(0,Mj.useMemo)(()=>l==="buy"?new S(a).isLessThanOrEqualTo(new S(O)):i===""?!0:new S(i).isLessThanOrEqualTo(new S(O)),[l,O,i,a]),{currentQuote:H}=aA(),{data:z}=be({query:{data:V(j)}}),L=z?.usd,{data:R}=be({query:t?{data:V(t)}:void 0}),W=z0(),K=Y0(),rA=AF(),Y=W0(),fA=(0,Mj.useCallback)(()=>{let lA=H?.sellAmount?mA(H?.sellAmount,C).toString():i,re=H?.buyAmount,YA=t?.data.decimals??0,qe=R?.usd;W({buyAmountFromQuote:re,buyFungibleDecimals:YA,buyFungibleUsdPrice:qe,sellAmountFromQuote:lA,sellFungibleUsdPrice:L})},[H?.sellAmount,H?.buyAmount,C,i,t?.data.decimals,R?.usd,W,L]),AA=(0,Mj.useCallback)(lA=>{K({fungibleValue:lA,decimals:C,shouldUpdateQuote:!0})},[C,K]),nA=(0,Mj.useCallback)(lA=>{rA({priceData:z,localFiatValue:lA,decimals:C,shouldUpdateQuote:!0})},[C,z,rA]),{fromUsd:jA}=bA(),sA=(0,Mj.useCallback)(lA=>{m(lA);let re=S(O).multipliedBy(lA);if(r==="crypto")K({fungibleValue:re.toString(),decimals:C,shouldUpdateQuote:!0,shouldTrimLength:!1});else if(L){let YA=Ae(Number(re),L),qe=jA(YA).toString();rA({priceData:z,localFiatValue:qe,decimals:C,shouldUpdateQuote:!0})}},[m,O,r,L,K,C,rA,z,jA]);(0,Mj.useEffect)(()=>{let lA=Ih(e);if(E){let re={...E},YA=lA.find(qe=>qe.id===gn(E));YA&&E.data.amount!==YA.amount&&(re.data={...re.data,amount:YA.amount}),re.data.amount!==_&&u(re)}},[E,_,u,e]),(0,Mj.useEffect)(()=>{l==="buy"&&f&&Y({amount:H?.sellAmount,decimals:C,usdPrice:L})},[l,H?.sellAmount,C,z?.usd,f,L,Y]);let CA=$n();return{maxSellAmount:O,sellFungible:j,notEnoughAssets:!D,uiSellAmountCryptoInput:a,uiSellAmountLocalFiatInput:c,hasMinimumSellAmount:CA,isFetchingQuote:o,handleToggleCurrencyClick:fA,handleFiatAmountInputChange:nA,handleCryptoAmountInputChange:AA,handleSwapFilterClick:sA}}n();s();var EC=q(P());n();s();n();s();var BC=q(BI());var $FA={network:{id:I.solana.mainnetID,name:I.solana.name,symbol:I.solana.tokenSymbol,imageUrl:I.solana.iconUrl},tokenType:"SolanaNative",symbol:"",logoUri:"",tokenAddress:"",amount:"",amountUsd:0};n();s();var oj=q(P());n();s();var yC=50,lF=({includeOwnedAssets:e,sellAsset:A,sellCaip19:j,ownedAssets:t,searchAssets:r})=>{if(!e||!A)return r;let o=B=>M(V(B)),i=o(A)??j,a=A.data.chain.id??(j&&TA(j).chainId),u=t.filter(B=>o(B)!==i&&I.compareNetworkID(a,B.data.chain.id)===0&&B.type!=="CompressedSPL").slice(0,yC-1),c=u.map(B=>[o(B),B]),l=new Map(c),m=r.filter(B=>!l.has(o(B)));return[...u,...m]};function dF({enableQuery:e=!0,chainFilter:A,sellCaip19:j}={}){let t=(0,oj.useMemo)(()=>j?TA(j):void 0,[j]),{sellFungible:r,searchQuery:o,setSearchQuery:i,setNumSearchResults:a}=$(),u=na(o,150),{fungibles:c,isLoadingTokens:l,isRefetchingTokens:m,tokensError:B}=uj(),k=It(),[f,g]=(0,oj.useState)(""),{data:E}=pA(),h=(0,oj.useMemo)(()=>E?.addresses??[],[E]),{data:y,isSuccess:F,isFetching:w,error:x}=Jr({query:u,networkIds:A?[A]:[t?.chainId??r?.data.chain.id??I.solana.mainnetID],enableQuery:e,keepPreviousData:!0,searchContext:"swapper",supportedNetworkIds:k,chainAddresses:h}),G=!F&&w,v=(0,oj.useMemo)(()=>c.filter(z=>z.type!=="CompressedSPL").map(z=>[M(V(z)),z]),[c]),_=(0,oj.useMemo)(()=>{let z=zm(v.map(([R])=>R).join("~")),L=Yi(z);return uo(L)},[v]),C=(0,oj.useMemo)(()=>new Map(v),[_]),O=(0,oj.useMemo)(()=>{if(!y||y.length===0)return[];g(Aj());let z=y.reduce((L,R)=>{let W="";if(ZA(R.type)){if(r&&ZA(r.type)&&R.data.chain.id===r.data.chain.id||t&&t.chainId===R.data.chain.id&&t.resourceType==="nativeToken")return L;W=M(Re(I.getChainID(R.data.chain.id)))}else{if(r&&R.data.tokenAddress===r.data.tokenAddress&&!A||t&&t.chainId===R.data.chain.id&&t.resourceType==="address"&&t.address===R.data.tokenAddress)return L;W=M(V(R))}let K,rA=C.get(W);return rA&&rA.data.balance?K=rA:K=R,K&&L.push(K),L},[]);return a(z.length),z},[C,y,r,a,A,t]),D=J();(0,oj.useEffect)(()=>{F&&O.length===0&&D.capture("swapperNullSearchResult",{data:{searchQuery:u}})},[F,O,u,D]);let H=(0,oj.useMemo)(()=>lF({includeOwnedAssets:!u,sellAsset:r,sellCaip19:j,ownedAssets:c,searchAssets:O}),[u,c,O,r,j]);return(0,oj.useMemo)(()=>({assets:H,initialFilterKey:A??r?.data.chain.id??t?.chainId,isLoading:l||G,isFetching:l||G||m,error:B??x,searchRef:f,setSearchQuery:i,searchQuery:o}),[H,l,G,m,B,x,r,f,i,t?.chainId,A,o])}n();s();var le=q(P()),kF=q(In());n();s();var Ep="https://help.phantom.com/hc/en-us/articles/27085326202515";var hC=[.3,.5,1],FC=hC.map(e=>`${e}%`),SC=[...FC,"custom"],xn=[.5,1,2],wC=xn.map(e=>`${e}%`),bC=[...wC,"custom"],BF=SC.length-1,IC=5,$C=2,E7=.1,y7=30,vC=2,mF=(e,A)=>{if(!e)return;let j=parseFloat(e);if(isNaN(j))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(j>y7)return{message:A("swapSlippageSettingsCustomMaxError",{maxSlippage:y7}),severity:"critical"};if(j>vC)return{message:A("swapSlippageSettingsHighSlippageWarning"),severity:"warning"};if(j<E7)return{message:A("swapSlippageSettingsCustomMinError",{minSlippage:E7}),severity:"critical"}},qC=e=>e&&xn.indexOf(e)!==-1?xn.indexOf(e):e?BF:1,xC=e=>e&&xn.indexOf(e)===-1?`${e}`:"",TC=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=wt(),{mutateAsync:o}=V6(),{selectedSetting:i,isFetched:a,setSlippageSetting:u}=MA(),[c,l]=(0,le.useState)(i.type),m=(0,kF.default)(a),[B,k]=(0,le.useState)(!1),[f,g]=(0,le.useState)(0),[E,h]=(0,le.useState)(),[y,F]=(0,le.useState)(""),[w,x]=(0,le.useState)(),G=c==="auto",v=f===BF,_=G?!1:w?.severity==="critical"||v&&!y;(0,le.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let C=(0,le.useCallback)(R=>{if(f===R)return;x(void 0),g(R);let W=xn;W[R]?(h(W[R]),F("")):h(void 0)},[f]),O=(0,le.useCallback)(R=>{let W=De(R.substring(0,IC)),K=Xe(W,$C),rA=parseFloat(K);if(isNaN(rA)){x(void 0),F("");return}F(K),x(mF(K,A))},[A]),D=(0,le.useCallback)(()=>{if(G)j.capture("slippageChanged",{data:{slippageType:"auto"}});else if(v){let R=parseFloat(y??"");o(R),j.capture("slippageChanged",{data:{slippageValue:R,slippageType:"custom"}}),h(void 0)}else E&&(o(E),j.capture("slippageChanged",{data:{slippageValue:E,slippageType:"preset"}}),F(""));u({type:c}),e()},[G,u,c,e,v,E,y,o,j]),H=(0,le.useCallback)(()=>{let R=qC(t),W=xC(t),K=xn;g(R),h(K[R]),F(W),x(mF(W,A)),l(i.type)},[t,A,i.type]),z=(0,le.useCallback)(()=>{l(c==="auto"?"fixed":"auto")},[c,l]),L=(0,le.useMemo)(()=>({title:A("swapSlippageSettingsTitle"),subtitle:A("swapSlippageSettingsSubtitle",{minSlippage:E7,maxSlippage:y7}),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapSlippageSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,le.useEffect)(()=>{!B&&r&&(H(),k(!0))},[r,B,H]),{options:bC,selectedIndex:f,customSlippageValue:y,i18nStrings:L,error:w,submitDisabled:_,isAutoEnabled:G,autoLearnMoreUrl:Ep,onConfirm:D,onDismiss:e,onSelectOption:C,onChangeCustomSlippage:O,onResetToDefault:H,onToggleAutoSlippage:z}};n();s();var se=q(P()),gF=q(In());var h7={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},fF=(e,A,j)=>{let t=parseFloat(e);if(isNaN(t))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(t>j.max)return{message:A("swapPriorityFeeSettingsCustomMaxError",{maxPriorityFee:j.max}),severity:"critical"};if(t<j.min)return{message:A("swapPriorityFeeSettingsCustomMinError",{minPriorityFee:j.min}),severity:"critical"};if(t>j.high)return{message:A("swapPriorityFeeSettingsHighFeeWarning"),severity:"warning"};if(t<j.low)return{message:A("swapPriorityFeeSettingsLowFeeWarning"),severity:"warning"}},PC=()=>{let[e,A]=(0,se.useState)(h7.bounds);return(0,se.useEffect)(()=>{(async()=>{try{let t=await ia({accounts:[],transactionType:"Swap"});A({min:t.min,low:t.low,high:t.high,max:t.max})}catch(t){b.captureError(t instanceof Error?t:new Error("Unable to fetch priority fee bounds."),"swapper")}})()},[]),e},GC=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=Qe(),{mutateAsync:o}=nh(),{selectedSetting:i,isFetched:a,setPriorityFeeSetting:u}=Vr(),[c,l]=(0,se.useState)(i.type),m=(0,gF.default)(a),[B,k]=(0,se.useState)(!1),[f,g]=(0,se.useState)(""),[E,h]=(0,se.useState)("$0"),[y,F]=(0,se.useState)(),w=c==="auto",x=w?!1:y?.severity==="critical"||!f,G=PC(),v=Re("solana"),{data:_}=be({query:{data:v}}),C=_?.usd;(0,se.useEffect)(()=>{if(!C)return;let R=Ae(Number(f),C);h(`$${R.toString()}`)},[f,C]),(0,se.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let O=(0,se.useCallback)(R=>{let W=De(R.substring(0,h7.input.maxLength)),K=Xe(W,h7.input.maxDecimals);if(isNaN(parseFloat(K))){F(void 0),g("");return}g(K),F(fF(K,A,G))},[A,G]),D=(0,se.useCallback)(()=>{if(w)o(null),b.addBreadcrumb("swapper","Priority fee setting changed to auto.","info"),j.capture("swapperPriorityFeeChanged",{data:{priorityFeeType:"auto"}});else if(f){let R=parseFloat(f??"");o(R),b.addBreadcrumb("swapper",`Priority fee setting changed to custom: ${R} SOL`,"info"),j.capture("swapperPriorityFeeChanged",{data:{priorityFeeValue:R,priorityFeeType:"custom"}})}u({type:c}),e()},[w,u,c,e,f,o,j]),H=(0,se.useCallback)(()=>{let R=t?`${t}`:"";g(R),F(fF(R,A,G)),l(i.type)},[t,A,i.type,G]),z=(0,se.useCallback)(()=>{l(c==="auto"?"fixed":"auto"),g("")},[c,l]),L=(0,se.useMemo)(()=>({title:A("swapPriorityFeeSettingsTitle"),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapPriorityFeeSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,se.useEffect)(()=>{!B&&r&&(H(),k(!0))},[r,B,H]),{customPriorityFeeValue:f,customPriorityFeeValueInDollars:E,i18nStrings:L,error:y,submitDisabled:x,isAutoEnabled:w,onConfirm:D,onDismiss:e,onChangeCustomPriorityFee:O,onResetToDefault:H,onToggleAutoPriorityFee:z}};n();s();var ie=q(P()),yF=q(In());var F7={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},EF=(e,A,j)=>{let t=parseFloat(e);if(isNaN(t))return{message:A("swapSettingsCustomInvalidValue"),severity:"critical"};if(t>j.max)return{message:A("swapTipSettingsCustomMaxError",{maxTip:j.max}),severity:"critical"};if(t<j.min)return{message:A("swapTipSettingsCustomMinError",{minTip:j.min}),severity:"critical"};if(t>j.high)return{message:A("swapTipSettingsHighFeeWarning"),severity:"warning"};if(t<j.low)return{message:A("swapTipSettingsLowFeeWarning"),severity:"warning"}},CC=()=>{let[e,A]=(0,ie.useState)(F7.bounds);return(0,ie.useEffect)(()=>{(async()=>{try{let t=await ia({accounts:[],transactionType:"Swap"});A({min:t.min,low:t.low,high:t.high,max:t.max})}catch(t){b.captureError(t instanceof Error?t:new Error("Unable to fetch tip bounds."),"swapper")}})()},[]),e},OC=({onDismiss:e})=>{let{t:A}=hA(),j=J(),{data:t,isFetched:r}=Ve(),{mutateAsync:o}=sh(),{selectedSetting:i,isFetched:a,setTipSetting:u}=kn(),[c,l]=(0,ie.useState)(i.type),m=(0,yF.default)(a),[B,k]=(0,ie.useState)(!1),[f,g]=(0,ie.useState)(""),[E,h]=(0,ie.useState)("$0"),[y,F]=(0,ie.useState)(),w=c==="auto",x=w?!1:y?.severity==="critical"||!f,G=CC(),v=Re("solana"),{data:_}=be({query:{data:v}}),C=_?.usd;(0,ie.useEffect)(()=>{if(!C)return;let R=Ae(Number(f),C);h(`$${R.toString()}`)},[f,C]),(0,ie.useEffect)(()=>{m!==a&&c!==i.type&&l(i.type)},[m,a,i.type,c]);let O=(0,ie.useCallback)(R=>{let W=De(R.substring(0,F7.input.maxLength)),K=Xe(W,F7.input.maxDecimals);if(isNaN(parseFloat(K))){F(void 0),g("");return}g(K),F(EF(K,A,G))},[A,G]),D=(0,ie.useCallback)(()=>{if(w)o(null),b.addBreadcrumb("swapper","Tip setting changed to auto.","info"),j.capture("swapperTipChanged",{data:{tipType:"auto"}});else if(f){let R=parseFloat(f??"");o(R),b.addBreadcrumb("swapper",`Tip setting changed to custom: ${R} SOL`,"info"),j.capture("swapperTipChanged",{data:{tipValue:R,tipType:"custom"}})}u({type:c}),e()},[w,u,c,e,f,o,j]),H=(0,ie.useCallback)(()=>{let R=t?`${t}`:"";g(R),F(EF(R,A,G)),l(i.type)},[t,A,i.type,G]),z=(0,ie.useCallback)(()=>{l(c==="auto"?"fixed":"auto"),g("")},[c,l]),L=(0,ie.useMemo)(()=>({title:A("swapTipSettingsTitle"),custom:A("swapSettingsCustom"),auto:A("swapSettingsAuto"),autoSubtitle:A("swapTipSettingsAutoSubtitle"),learnMore:A("commandLearnMore"),button:A("commandConfirm")}),[A]);return(0,ie.useEffect)(()=>{!B&&r&&(H(),k(!0))},[r,B,H]),{customTipValue:f,customTipValueInDollars:E,i18nStrings:L,error:y,submitDisabled:x,isAutoEnabled:w,onConfirm:D,onDismiss:e,onChangeCustomTip:O,onResetToDefault:H,onToggleAutoTip:z}};n();s();var eo=q(P());n();s();var FF=q(P());n();s();function hF(){return[new S7,new b7,new w7]}var S7=class{isEditable({sellAsset:A}){return!!A&&I.isSolanaNetworkID(A.data.chain.id)}},w7=class{isEditable({currencyDenomination:A}){return A==="crypto"}},b7=class{isEditable({sellAsset:A,buyAsset:j}){return!vA(A?.data.chain.id,j?.data.chain.id)}};var Fi=({sellAsset:e,buyAsset:A,currencyDenomination:j})=>{let t=PA("enable-swapper-exact-out"),r=(0,FF.useMemo)(()=>hF(),[]);return!A||!t?!1:r.every(o=>o.isEditable({sellAsset:e,buyAsset:A,currencyDenomination:j}))};n();s();var SF=q(P());n();s();var I7=class{isSupported(A,j,t,r,o){switch(A){case"sell":return!!(t&&o);case"buy":return!1}}},$7=class{isSupported(A){return A!=="buy"}};function yp(){return[new I7,new $7]}var hp=(e,A,j,t,r)=>(0,SF.useMemo)(()=>yp(),[]).every(i=>i.isSupported(e,A,j,t,r));var MC=Je?[.25,.5,1]:[.5,1],wF=Je?zr("full"):zr("compactNoSymbol"),bF=Je?Ld("full"):Ld("compact"),RC={chainId:oA.Solana.Mainnet,slip44:"501",resourceType:"nativeToken"},_C=()=>{let A=$(sA=>sA.amountType)==="sell"?"sell":"buy",j=$(sA=>sA.primaryCurrency),{currencySymbol:t,toUsd:r}=bA(),o=j==="fiat"?t:void 0,i=$(sA=>sA.swapFilter),a=$(sA=>sA.setSwapFilter),u=oa(),{handleCryptoAmountInputChange:c,handleFiatAmountInputChange:l,sellFungible:m,uiSellAmountCryptoInput:B,isFetchingQuote:k,notEnoughAssets:f,hasMinimumSellAmount:g,handleToggleCurrencyClick:E,uiSellAmountLocalFiatInput:h,handleSwapFilterClick:y,maxSellAmount:F}=g7(),w=$(sA=>sA.buyFungible),x=w?V(w):RC,G=vF(x),v=vF(V(m)),_=hp("sell",m,v,w,G),C=(0,eo.useMemo)(()=>({fungible:m,perspective:"sell",amount:j==="crypto"?B:h,secondaryCryptoSubtitle:j==="fiat"?IF(r(h),m,bF,v):void 0,balance:$F(m,wF,u,F),isAmountLoading:k&&A!=="sell",isSecondaryCryptoSubtitleLoading:k,isWarning:f||!g,isAmountEditable:!0,supportsCurrencyDenominationSwitching:_,amountPrefix:o,filters:MC,selectedFilter:i,warnings:[],usdAmount:v?Ae(Number(B),v):0}),[m,j,B,h,v,u,F,k,A,f,g,_,o,i,r]),{handleSwitchTokensClick:O,cryptoAmountInputValue:D,localFiatAmountInputValue:H,handleCryptoAmountInputChange:z}=k7(),L=hp("buy",m,v,w,G),R=Fi({sellAsset:m,buyAsset:w,currencyDenomination:j}),W=vA(m?.data.chain.id,w?.data.chain.id),K=w?.data.chain.id,{fungible:rA}=$j({key:K?qo(K,void 0):void 0}),Y=(0,eo.useMemo)(()=>{if(w)return{fungible:w,perspective:"buy",balance:$F(w,wF,u),amount:j==="crypto"?D:H,secondaryCryptoSubtitle:j==="fiat"?IF(r(H),w,bF,G):void 0,isAmountLoading:k&&A!=="buy",isSecondaryCryptoSubtitleLoading:k,isWarning:!1,isAmountEditable:R,supportsCurrencyDenominationSwitching:L,amountPrefix:o,filters:[],selectedFilter:void 0,warnings:Qr(w,W?rA:void 0),usdAmount:G?Ae(Number(D),G):0}},[w,u,j,D,H,G,k,A,R,L,o,r,W,rA]),fA=(0,eo.useCallback)((sA,CA)=>{switch(a(void 0),sA){case"sell":j==="crypto"?c(CA):l(CA);break;case"buy":if(j==="fiat")return;z(CA);break}},[a,j,c,l,z]),AA=J(),nA=(0,eo.useCallback)(async()=>{A==="sell"&&(E(),await AA.capture("swapperToggleQuoteCurrency",{data:{value:j==="fiat"?"native":"fiat"}}))},[A,AA,j,E]),jA=(0,eo.useCallback)((sA,CA)=>{CA==="sell"&&y(sA)},[y]);return{switchPerspective:O,sell:C,buy:Y,setAmount:fA,switchCurrencyDenomination:nA,setFilter:jA,currencyDenomination:j}};function IF(e,A,j,t){let r=A.data?.symbol??"",o=Number(e);return t?j.format(o,A,t):`0 ${r}`}function $F(e,A,j,t){let r=t?S(t):e.data?.balance;if(!(!r||j))return A.format(r,e.data?.symbol??"")}var vF=e=>{let{data:A}=be({query:{data:e}});return A?.usd};n();s();var DC=["lastSubmittedPairsV2","slippageTolerance"],v7=e=>{let A=String(e.queryKey[1]);return DC.includes(A)};n();s();var NC=q(P());n();s();var qF=q(P());function q7(e){let{t:A}=hA();return(0,qF.useMemo)(()=>{let{networkFee:j,phantomFee:t,tokenAccountFee:r,nonIncludedFees:o,destinationNetworkFee:i,liquidityFee:a}=e;return{networkFee:{label:A("swapQuoteNetwork"),valueUsd:j.amountUsd,maxValueUsd:j.maxAmountUsd},bridgeFee:{label:A("swapQuoteBridgeFee"),valueUsd:o.amountUsd,maxValueUsd:o.maxAmountUsd},tokenAccountFee:{label:A("swapQuoteOneTimeTokenAccount"),valueUsd:r.amountUsd},phantomFeePercent:{label:t.pct?A("swapQuoteFeeDisclaimer",{feePercentage:us(t.pct)}):"",value:t.pct?`${t.pct}`:""},destinationNetworkFee:{label:A("swapQuoteDestinationNetwork"),valueUsd:i.amountUsd},liquidityProviderFee:{label:A("swapQuoteLiquidityProvider"),valueUsd:a.amountUsd}}},[e,A])}n();s();var xF=q(P());function LC(){let e=J(),A=$(m=>m.buyFungible),j=$(m=>m.sellFungible),t=$(m=>m.setBuyFungible),r=$(m=>m.setSellFungible),o=$(m=>m.setSellAmount),i=$(m=>m.setUiSellAmountCryptoInput),a=$(m=>m.resetQuote),u=$(m=>m.setSwapFilter),c=j?.data.amount,{cancelQuotes:l}=Bp();return(0,xF.useCallback)(async m=>{if(j&&Yr(m,j)){m&&m.data.amount!==c&&(r(m),u(void 0));return}await l();let B=Ft(m);e.capture("swapperUpdateFromAsset",{data:B}),r(m),u(void 0),A&&j&&Yr(m,A)&&t(j),m&&j?.data.chain.id!==m.data.chain.id&&(a(),t(void 0),o(""),i(""))},[e,A,l,c,a,j,t,o,r,u,i])}n();s();var MF=q(P());n();s();var dr=q(P());n();s();n();s();n();s();var Fp=class{sections(A){let j=bt().map(o=>o.programId),t=A.reduce((o,i)=>{if(da({minimum:"VERIFIED",spamStatus:i.data.spamStatus}))return o.verified.push(i),o;if(i.type!=="SPL"||!i.data.ugcTokenMeta||i.data.ugcTokenMeta.status==="graduated"||!j.includes(i.data.ugcTokenMeta.programId))return o.unverified.push(i),o;let a=i.data.ugcTokenMeta.programId,u=o[a]??[];return u.push(i),o[a]=u,o},{verified:[],unverified:[]}),r=bt().map(o=>{let i=t[o.programId]??[];return{id:o.programId,header:{title:T.t("swapSectionTitleTokens",{section:o.name}),iconUrl:o.iconUrl},data:i,behavior:"collapsible"}});return[{id:"verified",data:t.verified,behavior:"static"},{id:"unverified",header:{title:T.t("swapUnverifiedTokens")},data:t.unverified,behavior:"collapsible"},...r]}};function TF(){return new Fp}n();s();var GF=q(P());n();s();var Sp=q(P());var PF=()=>{let{data:e}=ne({key:"lastSelectedTokens",queryKey:uA.lastSelectedTokens()}),A=(0,Sp.useMemo)(()=>e?JSON.parse(e):{},[e]),{mutateAsync:j}=ce({key:"lastSelectedTokens",queryKey:uA.lastSelectedTokens()}),t=(0,Sp.useCallback)(async r=>{let o={...A,[r]:!0};await j(JSON.stringify(o))},[A,j]);return{lastSelectedTokens:A,storeSelectedToken:t}};n();s();var wp=class{constructor(A,j){this.lastSelectedTokens=A;this.storeSelectedToken=j}intercept(A){let j=M(V(A));return this.lastSelectedTokens[j]||this.storeSelectedToken(j),"continue"}};n();s();n();s();var bp=class{constructor(A){this.lastSelectedTokens=A}intercept(A,j){switch(A.type){case"SPL":{let t=M(V(A)),r=this.lastSelectedTokens[t];return A.data.ugcTokenMeta?.status==="preDeploy"&&!r?(D0(A),j("ugcWarning"),"interrupt"):"continue"}default:return"continue"}}};function QC({lastSelectedTokens:e,storeSelectedToken:A}){return[new wp(e,A),new bp(e)]}function CF(){let{lastSelectedTokens:e,storeSelectedToken:A}=PF();return(0,GF.useMemo)(()=>QC({lastSelectedTokens:e,storeSelectedToken:A}),[e,A])}var OF=(0,dr.createContext)(void 0),VC=({children:e})=>{let A=(0,dr.useMemo)(()=>TF(),[]),j=CF();return dr.default.createElement(OF.Provider,{value:{buyAssetSectionAdapter:A,interceptors:j}},e)},Si=()=>{let e=(0,dr.useContext)(OF);if(!e)throw new Error("useSwapAssetSelect must be used within a SwapAssetSelectProvider");return e};var zC=()=>{let{interceptors:e}=Si();return{executeInterceptors:(0,MF.useCallback)((j,t)=>{for(let r of e)if(r.intercept(j,t)==="interrupt")return"interrupt";return"continue"},[e])}};n();s();var jo=q(P());var RF=3;function x7(e){return{id:e.id,data:e.data,...e.header?{header:e.header}:{}}}var XC=e=>{let[A,j]=(0,jo.useState)({}),t=(0,jo.useCallback)((i,a)=>j(u=>({...u,[i]:a})),[]),{buyAssetSectionAdapter:r}=Si(),o=(0,jo.useMemo)(()=>r.sections(e),[r,e]);return(0,jo.useMemo)(()=>o.map(i=>{switch(i.behavior){case"static":return x7(i);case"collapsible":{if(i.data.length<=RF)return x7(i);let a=A[i.id],u=a?i.data:i.data.slice(0,RF),c=()=>t(i.id,!a),l=x7(i);return{...l,header:{...l.header,title:l.header?.title||"",button:{label:a?T.t("commandShowLess"):T.t("commandShowMore"),onClick:c}},data:u}}}}),[o,A,t])};n();s();n();s();var wi=({networkID:e,txReceipt:A,preferredExplorers:j})=>{let t=A?.id??"";if(!t)return;let r=j?.explorers[e];return vk({networkID:e,endpoint:"transaction",explorerType:r,param:t})};n();s();n();s();var qt=q(P());n();s();function _F(e,A){if(A){let j=JC(e),t=ZC(e,A),r=AO(e,A);return{notEnoughSol:A.message==="NotEnoughSol",txErrorTitle:j,txErrorMessage:t,txErrorHelpButtonLink:r}}return{notEnoughSol:!1,txErrorTitle:"",txErrorMessage:"",txErrorHelpButtonLink:""}}var JC=e=>e?T.t("swapTxBridgeFailed"):T.t("swapTxConfirmationSwapFailed"),YC=e=>{switch(e.message){case"LedgerConnectionError":return T.t("swapTxConfirmationSwapFailedLedgerConnectionError");case"LedgerRejectAction":return T.t("swapTxConfirmationSwapFailedLedgerReject");case"LedgerUnknownSignError":return T.t("swapTxConfirmationSwapFailedLedgerSignError");case"LedgerUnknownError":return T.t("swapTxConfirmationSwapFailedLedgerError");default:return null}},ZC=(e,A)=>{let j=YC(A);if(j!==null)return j;if(e)switch(A.message){case"slippageToleranceExceeded":return T.t("swapTxConfirmationSwapFailedSlippageLimit");default:return T.t("swapTxBridgeFailedDescription")}else switch(A.message){case"INSUFFICIENT_FUNDS":return T.t("swapTxConfirmationSwapFailedInsufficientBalance");case"slippageToleranceExceeded":return T.t("swapTxConfirmationSwapFailedSlippageLimit");case"EmptyRoute":return T.t("swapTxConfirmationSwapFailedEmptyRoute");case"AccountFrozen":return T.t("swapTxConfirmationSwapFailedAcountFrozen");case"SIMULATION_TIMEOUT":return T.t("swapTxConfirmationSwapFailedSimulationTimeout");case"INSUFFICIENT_GAS":return T.t("swapTxConfirmationSwapFailedInsufficientGas");case"Scan results are not valid":return T.t("swapTxConfirmationSwapFailedUnknownError");case"STALE_QUOTE":return T.t("swapTxConfirmationSwapFailedStaleQuote");case"SimulationUnknownError":return T.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return T.t("swapTxConfirmationSwapFailedTryAgain")}},AO=(e,A)=>e?D6:A.message==="AccountFrozen"?zy:D6;n();s();var DF=({sellAmount:e,sellFungible:A,buyAmount:j,buyFungible:t,txStatus:r,txReceipt:o,swapTransactions:i,isReadyToExecute:a,uiEstimatedTime:u,isBridge:c,isLedger:l,notEnoughSol:m,txError:B,txErrorTitle:k,txErrorMessage:f,explorerUrl:g,txErrorHelpButtonLink:E,addressType:h})=>{let y=mA(e,A?.data.decimals??0).toNumber(),F=mA(j,t?.data.decimals??0).toNumber(),w=r==="success",x=r==="error",G=!!o,v=i?.transactions.length||0;return{sellAsset:{amount:y,symbol:A?.data.symbol??"",networkID:A?.data.chain.id??oA.Solana.Mainnet},buyAsset:{amount:F,symbol:t?.data.symbol??"",networkID:t?.data.chain.id??oA.Solana.Mainnet},estimatedTime:u,isBridge:c,isSuccess:w,isFailure:x,isLedger:l,isClosable:G,notEnoughSol:m,txError:B,txErrorTitle:k,txErrorMessage:B?.detailMessage?`${f}

${B?.detailMessage}`:f,txLink:g??"",txErrorHelpButtonLink:E,numberOfTransactions:v,isReadyToExecute:a,addressType:h}};var T7=({sellFungible:e,txReceipt:A,swapTransactions:j,isBridge:t,txError:r,txStatus:o,isReadyToExecute:i,isLedger:a})=>{let u=e?.data.chain.id??oA.Solana.Mainnet,{notEnoughSol:c,txErrorTitle:l,txErrorMessage:m,txErrorHelpButtonLink:B}=(0,qt.useMemo)(()=>_F(t,r),[t,r]),k=(0,qt.useMemo)(()=>I.getAddressType(u),[u]),{currentQuote:f}=aA(),[g]=(0,qt.useState)(f),{buyAmount:E,sellAmount:h}=g??{buyAmount:"0",sellAmount:"0"},y=$(v=>v.buyFungible),{data:F}=xk(),w=(0,qt.useMemo)(()=>wi({txReceipt:A,networkID:u,preferredExplorers:F}),[A,u,F]),x=(0,qt.useMemo)(()=>ki(g),[g]);return(0,qt.useCallback)(()=>DF({sellFungible:e,txReceipt:A,addressType:k,swapTransactions:j,isBridge:t,txError:r,sellAmount:h,buyAmount:E,buyFungible:y,txStatus:o,isReadyToExecute:i,uiEstimatedTime:x,isLedger:a,notEnoughSol:c,txErrorTitle:l,txErrorMessage:m,explorerUrl:w,txErrorHelpButtonLink:B}),[e,A,k,j,t,r,h,E,y,o,i,x,a,c,l,m,w,B])()};n();s();var nj=q(P());n();s();var Tn=q(P());var to=()=>{let e=J(),A=ar(),{currentQuote:j,quoteResponse:t,selectedProviderIndex:r,selectedBaseProvider:o}=aA(),{analyticsContext:i}=j??{analyticsContext:void 0},a=$(v=>v.buyFungible),u=$(v=>v.sellFungible),c=$(v=>v.buyUsdValue),l=$(v=>v.sellUsdValue),m=$(v=>v.swapFilter),{selectedSetting:B}=MA(),k=$.getState().amountType,f=u?.data.chain.id??oA.Solana.Mainnet,g=Oj(),{transition:E}=$t(),h=(0,Tn.useCallback)(v=>{let _=pr(r,B.type,t);return J6({buyToken:a,sellToken:u,buyAmount:j?.buyAmount.toString()??"",sellAmount:j?.sellAmount.toString()??"",phantomFeeUiAmount:g.phantomFee.amountUsd?.toString()??"",priceImpact:sr(j),provider:IA(OA(j)),baseProvider:o,buyAssetUsdValue:c,sellAssetUsdValue:l,slippageTolerance:_,transactionId:v??"",slippageType:B.type,sellSwapFilter:m,analyticsContext:i})},[a,u,j,g.phantomFee.amountUsd,c,l,t,r,B.type,m,i,o]),y=(0,Tn.useCallback)(v=>{Y6({txReceipt:v,networkID:f,amountType:k,swapAnalytics:A})},[f,k,A]),F=(0,Tn.useCallback)((v,_)=>{E({type:"transactionSubmissionFailed",error:v}),v.message!=="Scan results are not valid"&&v.message!=="slippageToleranceExceeded"&&b.captureError(v,"swapper");let C=h(_);e.capture("swapperSwapFailure",{data:{...C.data,error:v.message}})},[e,h,E]),w=()=>{e.capture("swapperSwapFailureNoSignature")},x=(0,Tn.useCallback)(v=>{let _=h(v.id);e.capture("swapperSwapSuccess",_);let C=Nt(v.networkID);b.addBreadcrumb("swapper","transactionStatus","info",{...C,txReceipt:v.id}),(C.chainType==="eip155"||C.chainType==="solana"||C.chainType==="sui")&&A.transactionStatus(v.id,{...C,status:{type:"confirmed"}})},[e,h,A]),G=(0,Tn.useCallback)((v,_)=>{let C=v?.networkID?Nt(v.networkID):null;(C?.chainType==="eip155"||C?.chainType==="solana"||C?.chainType==="sui")&&v?.id&&(b.addBreadcrumb("swapper","transactionStatus","error",{...C,txReceipt:v.id}),A.transactionStatus(v.id,{...C,status:{type:"error"}}),E({type:"transactionConfirmationFailed",error:_,txReceipt:v}))},[A,E]);return{logTransactionSubmitted:y,logTransactionSubmissionError:F,logSwapFailureNoSignature:w,logTransactionConfirmed:x,logTransactionConfirmationFailed:G}};n();s();var KF=q(P());n();s();var bi=()=>{let{selectedSetting:e}=MA(),{selectedProviderIndex:A,quoteResponse:j}=aA(),t=pr(A,e.type,j),{data:r}=wt();return{slippageSetting:e,slippageTolerance:t??r??void 0}};n();s();n();s();var Ip=q(P());n();s();var P7="swap-validation",NF=({scanResult:e,scanResultError:A,quote:j,sellToken:t,buyToken:r})=>{if(A)return"valid";if(!j||!t||!r)return b.addBreadcrumb(P7,`Missing necessary args: ${JSON.stringify({quote:!!j,scanResult:!!e,sellToken:t,buyToken:r})}`,"info"),new SA("MissingArgument");if(e?.error===ut.SIMULATION_FAILED)return"valid";if(e?.error){if(b.addBreadcrumb(P7,`Simulation error: ${JSON.stringify({error:e.error})}`,"info"),e.error===ut.SLIPPAGE_EXCEEDED)return new SA("slippageToleranceExceeded");if(e.error===ut.INSUFFICIENT_FUNDS)return new SA("INSUFFICIENT_FUNDS");if(e.error===ut.INSUFFICIENT_GAS)return new SA("INSUFFICIENT_GAS");if(e.error===ut.ACCOUNT_FROZEN)return new SA("AccountFrozen");if(e.error===ut.SIMULATION_TIMEOUT)return new SA("SIMULATION_TIMEOUT");if(e.error===ut.STALE_QUOTE)return new SA("STALE_QUOTE");if(e.error===ut.UNKNOWN_ERROR){let o=eO(e);return new SA("SimulationUnknownError",o)}return new SA("Scan results are not valid")}return e?"valid":(b.addBreadcrumb(P7,`Missing necessary args: ${JSON.stringify({quote:!!j,scanResult:!1,sellToken:t,buyToken:r})}`,"info"),new SA("MissingArgument"))};function eO(e){return e.simulationError?e.simulationError.humanReadableError:e.warnings[0]?.message}var LF=({swapTransactions:e})=>{let A=$(g=>g.sellFungible),j=$(g=>g.buyFungible),t=A?.data.chain.id??oA.Solana.Mainnet,{selectedSetting:r}=MA(),{currentQuote:o,quoteResponse:i}=aA(),a=IA(OA(o)),u=vA(A?.data.chain.id,j?.data.chain.id),c=i?.buyToken?M(i?.buyToken):void 0,l=i?.sellToken?M(i?.sellToken):void 0,m={type:"transaction",userAccount:A?.data.walletAddress??"",params:void 0,url:"https://phantom.com",networkID:t,context:u?"bridge":"swap",provider:a,slippageType:r.type,metadata:{swapper:{quoteOutputAmount:o?.buyAmount,quoteOutputToken:c,quoteInputAmount:o?.sellAmount,quoteInputToken:l}}};e?.type==="evm"&&I.isEVMNetworkID(t)&&(m.params={transactions:e.transactions}),e?.type==="solana"&&I.isSolanaNetworkID(t)&&(m.params={transactions:e.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}});let{transition:B}=$t(),k=(0,Ip.useCallback)((g,E)=>{E&&B({type:"simulationRequestError",error:E}),g&&B({type:"simulationResponseReceived",scannedTransactionResult:g})},[B]),f=gi(m,{disableRefetch:!0,onSettled:k,disabled:e?.type==="sui"});return(0,Ip.useMemo)(()=>{if(f.isLoading)return{isLoading:!0,state:"loading"};if(e?.type==="sui")return{isLoading:!1,state:"valid"};let g=NF({scanResult:f.data,scanResultError:f.isError,quote:o,sellToken:i?.sellToken,buyToken:i?.buyToken,simulationTolerance:i?.simulationTolerance});return{isLoading:f.isLoading,state:g}},[f,o,i,e?.type])};function UF({isBridge:e,addressType:A,isSwapSimulationDisabled:j,onTransactionReceiptReceived:t,onTransactionSubmissionError:r,resetToInitialState:o,sender:i}){let{logTransactionSubmitted:a,logSwapFailureNoSignature:u}=to(),{connection:c}=cj(),{data:l}=pA(),{currentQuote:m,quoteResponse:B}=aA(),{slippageTolerance:k}=bi(),f=$(O=>O.gasEstimation.estimateWithBuffer),g=$(O=>O.sellFungible),E=g?.data.chain.id??oA.Solana.Mainnet,{data:h,isSuccess:y}=Jj({callerAddress:i,quote:m,sellFungible:g}),F=LF({swapTransactions:h}),{pendingActivityRows:w}=jE({sender:i}),{mutateAsync:x}=m7({accountIdentifier:l?.identifier??"",networkID:E}),[G,v]=(0,KF.useState)(!1),_=async()=>(v(!0),qy({isBridge:e,addressType:A,isSwapSimulationDisabled:j,sender:i,currentQuote:m,quoteResponse:B,gasEstimation:f,swapTransactions:h,scanResults:F,pendingActivityRows:w,connection:c,slippageTolerance:k,logSwapFailureNoSignature:u,logTransactionSubmitted:a,swapFungibles:x,onTransactionSubmissionError:r,onTransactionReceiptReceived:t,resetToInitialState:o}));return{isReadyToExecute:G||(!F.isLoading||j)&&y,executeSwap:_}}n();s();var $p=q(P());var HF=({goToSwapTab:e,goToActivityTab:A})=>{let{resume:j}=Pj(),{clearQuotes:t}=d7(),r=vt(),o=(0,$p.useCallback)(()=>{j(),t(),e()},[e,j,t]),i=(0,$p.useCallback)(()=>{j()},[j]),a=(0,$p.useCallback)(()=>{r(),A()},[A,r]);return{onClose:o,onRetry:i,onSwapSuccess:a}};n();s();function QF(){let{data:[e]}=_A(["kill-swapper-simulation"]);return e}n();s();var Pn=q(P());var VF=({onTransactionConfirmationSuccess:e,onTransactionConfirmationError:A,txReceipt:j})=>{let t=cA(),{data:r}=pA(),o=(0,Pn.useMemo)(()=>r?.addresses??[],[r]),i=pB(o),a=vt(),{logTransactionConfirmed:u,logTransactionConfirmationFailed:c,logTransactionSubmissionError:l}=to(),m=$(F=>F.sellFungible),{currentQuote:B}=aA(),{sellAmount:k}=B??{sellAmount:"0"},f=aB({wallets:o,encodedCaip19:m?M(V(m)):""}),g=(0,Pn.useCallback)(async F=>{if(u(F),a(),m){let w=new U(m.data.amount),x=new U(k),G=w.minus(x).toString();Z6(t,{id:gn(m),amount:G})}i(),f()},[u,a,k,m,i,f,t]),{isSuccess:E,isError:h,error:y}=nB(g,j);(0,Pn.useEffect)(()=>{if(E)e();else if(h){let F=Ar(y);A(F),c(j,F),l(F,j?.id)}},[E,h,y,j,c,e,A,l])};function zF({isLedger:e,goToSwapTab:A,goToActivityTab:j}){let{currentQuote:t}=aA(),r=$(K=>K.buyFungible),o=$(K=>K.sellFungible),i=vt(),a=QF(),{logTransactionSubmissionError:u}=to(),[c]=(0,nj.useState)(vA(o?.data.chain.id,r?.data.chain.id)),l=o?.data.chain.id??oA.Solana.Mainnet,{data:m}=pA(),B=(0,nj.useMemo)(()=>m?.addresses??[],[m]),k=(0,nj.useMemo)(()=>B.find(K=>K.networkID===o?.data.chain.id)?.address??"",[B,o]),f=(0,nj.useMemo)(()=>I.getAddressType(l),[l]),{data:g}=Jj({callerAddress:k,quote:t,sellFungible:o}),[E,h]=(0,nj.useState)(),[y,F]=(0,nj.useState)("loading"),[w,x]=(0,nj.useState)(),G=()=>{F("loading"),x(void 0),h(void 0)},v=K=>{h(K)},_=(0,nj.useCallback)((K,rA)=>{F("error"),x(K),u(K,rA)},[u]),C=(0,nj.useCallback)(()=>{F("success")},[]),O=(0,nj.useCallback)(K=>{F("error"),x(Ar(K))},[]);VF({onTransactionConfirmationSuccess:C,onTransactionConfirmationError:O,txReceipt:y==="error"?void 0:E});let{executeSwap:D,isReadyToExecute:H}=UF({isBridge:c,addressType:f,isSwapSimulationDisabled:a,onTransactionSubmissionError:_,onTransactionReceiptReceived:v,resetToInitialState:G,sender:k}),{onClose:z,onRetry:L,onSwapSuccess:R}=HF({goToSwapTab:A,goToActivityTab:j});return{...T7({sellFungible:o,txReceipt:E,swapTransactions:g,isBridge:c,txStatus:y,isReadyToExecute:H,isLedger:e,txError:w}),executeSwap:D,resetSwapper:i,onClose:z,onRetry:L,onSwapSuccess:R}}n();s();n();s();var XF=q(P()),WF=()=>{let{data:[e]}=_A(["enable-custom-tips"]);return(0,XF.useMemo)(()=>e?"autoWithPriorityFeesAndTips":"autoWithPriorityFees",[e])};n();s();n();s();var JF=q(P());var jO=()=>{let e=qA();return{selectQuote:(0,JF.useCallback)((j,t)=>{let r=j[t];r&&e.selectQuote(r)},[e])}};n();s();var YF=q(P());var tO=async(e,A,j)=>{try{await N.api().post("/swap/v2/presence",{caip19:e,visitorId:A,source:j})}catch(t){throw t instanceof Error&&b.captureError(t,"swapper"),t}},rO=(e,A)=>{let j=J(),t=PA("enable-swapper-presence"),r=(0,YF.useCallback)(async()=>{if(!e||!t)return null;let o=await j.getDeviceId();return await tO(e,o,A),{success:!0,timestamp:Date.now()}},[e,A,j,t]);return X({queryKey:[...uA.presence(e),"post",A],queryFn:r,enabled:!!e&&t,refetchInterval:5e3,gcTime:0,staleTime:0})};n();s();n();s();n();s();n();s();n();s();var lxA=UA(e=>({quoteSpan:void 0,previousBuyAmount:void 0,previousSellAmount:void 0,setQuoteSpan(A){e({quoteSpan:A})},setPreviousBuyAmount(A){e({previousBuyAmount:A})},setPreviousSellAmount(A){e({previousSellAmount:A})}}));n();s();var gxA=UA(e=>({initialLoadSpan:void 0,setInitialLoadSpan(A){e({initialLoadSpan:A})}}));n();s();var nO=q(P());var wxA=["simulationRequestErrored","simulationFailed","transactionSubmissionFailed","transactionNotConfirmed"];n();s();var ZF=q(P());var sO=()=>{},G7=e=>{let A=qA(),{connection:j}=cj(),t=yA(),r=wj(),o=T.language,i=J(),a=cA(),u=ar(),c=MA(),l=Lj(),m=Mt("kill-swapper-simulation")??!1;return(0,ZF.useCallback)(async({showFungibleDetails:k,showBuyFungibleScreen:f=sO,showRetrySwap:g,executeSwapStateListeners:E,toastMessageParser:h,uiContext:y="swapperInterstitial",preprocessor:F})=>{let w=new wn(k,f,c,["SLIPPAGE_EXCEEDED"],g,h),x=new En(a,t,l),G=new fn(u,i,y,e),v=new yn(i),_=new hn,C=new Bn(xj);try{A.subscribeExecution(x),A.subscribeExecution(v),A.subscribeExecution(G),A.subscribeExecution(w),A.subscribeExecution(_),A.subscribeExecution(C),E.forEach(D=>A.subscribeExecution(D));let O=await i.getDeviceId();await A.swap({signer:r,storage:t,locale:o,deviceId:O,connection:j,authRepository:l,isSimulationKilled:m,preprocessor:F})}catch{}finally{A.unsubscribeExecution(x),A.unsubscribeExecution(v),A.unsubscribeExecution(G),A.unsubscribeExecution(w),A.unsubscribeExecution(_),A.unsubscribeExecution(C),E.forEach(O=>A.unsubscribeExecution(O))}},[c,a,u,i,A,r,t,o,j,l,m,e])};n();s();n();s();function AS(e,A){return{takerCaip19:iO(e,A),takerDestinationCaip19:aO(e,A)}}function iO(e,A){if(e.type==="buy")return A.data.walletAddress?M(vo(A)):void 0;if(e.type==="swap")return e.takerCaip19}function aO(e,A){if(e.type==="sell")return A.data.walletAddress?M(vo(A)):void 0;if(e.type==="swap")return e.takerDestinationCaip19}var C7=class{getNavigationParams({initiatingSwapMode:A,selectedToken:j,initialSwapAmount:t}){let{takerCaip19:r,takerDestinationCaip19:o}=AS(A,j);return{swapMode:{type:A.type,buyCaip19:A.type==="buy"?A.buyCaip19:M(V(j)),sellCaip19:A.type==="sell"?A.sellCaip19:M(V(j)),takerCaip19:r,takerDestinationCaip19:o},initialSwapAmount:t}}captureAnalytics(A,j,t){new nr(A).swapperUpdateAsset(t,j)}};var O7=class{selectToken({swapper:A,selectedToken:j,currentTokens:t,perspective:r,navigateToSwapper:o,dismiss:i}){let a=r==="sell"?t.buyCaip19:t.sellCaip19;if(this.isSameSelectedToken(a,j))return this.handleTokenSwitch(A,i);if(this.shouldNavigateToNewChain(r,t.sellCaip19,j))return o({sellFungible:j});let c=HA(j)?M(vo(j)):void 0;A.changeToken(j,r,c),i()}shouldNavigateToNewChain(A,j,t){return A!=="sell"?!1:TA(j).chainId!==t.data.chain.id}handleTokenSwitch(A,j){A.switchTokens(),j()}isSameSelectedToken(A,j){let t=M(V(j));return A!==t?!1:!HA(j)}},pO=new C7,cO=new O7;n();s();var vp=class{constructor(A,j){this.analytics=A;this.additionalAnalyticsTags=j}captureEvent(A,j){let t={...j,data:{...j.data,...this.additionalAnalyticsTags}};this.analytics.capture(A,t)}tradeHubSelectOpen(A){this.captureEvent("tradeHubSelectOpen",{data:{action:A}})}tradeHubAssetSelected(A,j){this.captureEvent("tradeHubAssetSelected",{data:{...Ft(A),assetCaip19:M(V(A)),action:j}})}tradeHubSearchPress(){this.captureEvent("tradeHubSearchPress",{data:{}})}},uO=yo(J,e=>new vp(e));n();s();n();s();var xTA=p.object({visitors:p.number()});n();s();n();s();n();s();var eS=q(P());n();s();var _j=q(P());n();s();n();s();var he=p.string().regex(/^\d*\.?\d+$/,"Invalid numeric string"),qp=p.string().regex(/^-?\d*\.?\d+$/,"Invalid signed numeric string"),tS=p.object({accountValue:qp,totalMarginUsed:he,totalNtlPos:he,totalRawUsd:qp}),yGA=p.object({marginSummary:tS,withdrawable:he,assetPositions:p.array(p.any()).optional(),crossMaintenanceMarginUsed:he.optional(),crossMarginSummary:tS.optional(),guaranteedUntil:p.number().optional(),isAccountSolvent:p.boolean().optional(),pendingCashAdjusts:p.array(p.any()).optional(),totalCrossCollateral:he.optional(),totalIsolatedCollateral:he.optional(),totalMaintenanceMarginUsed:he.optional()}),rS=p.object({coin:p.string(),side:p.enum(["B","A"]),limitPx:he,sz:he,oid:p.number(),timestamp:p.number(),origSz:he,cloid:p.string().optional()}),hGA=p.array(rS),lO=p.object({position:rS,status:p.string(),statusTimestamp:p.number()}),FGA=p.array(lO),dO=p.object({status:p.literal("ok"),response:p.object({type:p.string()}).optional()}),oS=p.object({error:p.string()}),SGA=p.union([dO,oS]),mO=p.enum(["withdraw","deposit"]),kO=p.object({id:p.string(),type:mO,timestamp:p.string(),delta:p.object({usdAmount:qp,token:p.object({caip19:p.string(),symbol:p.string(),image:p.string(),amount:qp})})}),wGA=p.array(kO),BO=p.object({resting:p.object({oid:p.number()})}),fO=p.object({filled:p.object({totalSz:he,avgPx:he,oid:p.number()})}),gO=p.object({error:p.string()}),EO=p.union([BO,fO,gO]),yO=p.object({status:p.literal("ok"),response:p.object({type:p.literal("order"),data:p.object({statuses:p.array(EO)})})}),bGA=p.union([yO,oS]),nS=p.array(p.object({t:p.number(),T:p.number(),s:p.string(),i:p.string(),o:he,h:he,l:he,c:he,v:he,n:p.number()}));n();s();n();s();var XA=p.string().regex(/^\d*\.?\d+$/,"Invalid numeric string"),de=p.string().regex(/^-?\d*\.?\d+$/,"Invalid signed numeric string");var hO=p.object({accountValue:XA,availableBalance:XA,availableToTrade:XA}),sS=p.object({accountValue:XA,availableBalance:XA,availableToTrade:XA,dexs:p.record(p.string(),hO).optional()});n();s();var FO=p.enum(["withdrawal","deposit"]),SO=p.object({id:p.string(),type:FO,timestamp:p.number(),usdcAmount:de}),iS=p.object({depositAndWithdrawals:p.array(p.any()).transform(e=>e.reduce((A,j)=>{let t=SO.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();n();s();var Gn=Ak.extend({chainId:Wm,address:p.string()}),Ii=p.object({symbol:p.string(),name:p.string(),token:Gn,logoUri:p.string(),szDecimals:p.number(),maxLeverage:p.number(),price:de,priceChange24h:p.object({amount:de,percentage:de}),volume24h:XA,openInterest:XA,fundingRate:de,assetId:p.number(),isAtOpenInterestCap:p.boolean().optional()}),aS=p.object({markets:p.array(Ii).transform(e=>e.reduce((A,j)=>{let t=Ii.safeParse(j);return t.success&&(A[M(t.data.token)]=t.data),A},{}))}),VGA=p.object({id:p.string(),name:p.string(),logoUri:p.string(),currentPrice:p.number(),maxLeverage:p.number(),szDecimals:p.number(),assetId:p.number(),symbol:p.string()});var A1A=p.enum(["success","failed"]),e1A=p.enum(["close","liquidation","take_profit","stop_loss"]),j1A=p.literal("open"),pS=p.object({id:p.string(),market:p.object({token:Gn,logoUri:p.string(),szDecimals:p.number().optional()}),type:p.string(),timestamp:p.number(),price:XA,size:de,tradeValue:XA,fee:de,closedPnl:p.optional(de)}),cS=p.object({tradeHistory:p.array(pS).transform(e=>e.reduce((A,j)=>{let t=pS.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();var lS=p.enum(["long","short"]),xp=p.object({direction:lS,leverage:XA,size:de,margin:XA,entryPrice:XA,fundingPayments:de,market:p.object({token:Gn,logoUri:p.string()}),value:XA,unrealizedPnl:p.object({amount:de,percentage:de}),liquidationPrice:de}),dS=p.object({positions:p.array(xp).transform(e=>e.reduce((A,j)=>{let t=xp.safeParse(j);return t.success&&A.push(t.data),A},[]))}),uS=p.object({id:p.string(),market:p.object({token:Gn,logoUri:p.string()}),isTrigger:p.boolean(),direction:lS,type:p.enum(["take_profit_market","stop_market"]),reduceOnly:p.boolean(),triggerPrice:XA,limitPrice:XA,timestamp:XA,size:de}),mS=p.object({positions:p.array(xp).transform(e=>e.reduce((A,j)=>{let t=xp.safeParse(j);return t.success&&A.push(t.data),A},[])),openOrders:p.array(uS).transform(e=>e.reduce((A,j)=>{let t=uS.safeParse(j);return t.success&&A.push(t.data),A},[]))});n();s();function WA(e,A){return e+Math.random()*A}n();s();var wO=p.object({address:p.string(),registered:p.boolean()}),bO=p.object({code:p.string(),registered:p.boolean()}).optional(),kS=p.object({providerFee:p.string(),phantomFee:p.string(),referral:bO.optional(),builder:wO.optional()});n();s();var BS=p.object({usdcPrice:p.string(),orderAssetId:p.number(),depositAddress:p.object({address:p.string()})}),IO=p.object({destinationAmount:p.string().optional(),sourceTxHash:p.string().optional(),state:p.enum(["done","sourceTxDiscovered","waitForSrcTxFinalization","buildingDstTx","signTx","broadcastTx","waitForDstTxFinalization","readyForWithdrawQueue","queuedForWithdraw","failure","additionalChecks"]),opCreatedAt:p.string().optional(),operationId:p.string().optional(),protocolAddress:p.string().optional(),sourceAddress:p.string().optional(),destinationAddress:p.string().optional(),sourceChain:p.string().optional(),destinationChain:p.string().optional(),sourceAmount:p.string().optional(),destinationFeeAmount:p.string().optional(),sweepFeeAmount:p.string().optional(),stateStartedAt:p.string().optional(),stateUpdatedAt:p.string().optional(),stateNextAttemptAt:p.string().optional(),destinationTxHash:p.string().optional(),asset:p.string().optional()}),fS=p.object({usdcPrice:p.string(),orderAssetId:p.number(),operations:p.array(IO)}),gS=p.discriminatedUnion("status",[p.object({status:p.literal("ok"),response:p.object({type:p.string()})}),p.object({status:p.literal("err"),response:p.string()})]),ES=p.object({status:p.enum(["ok","err"])}),yS=p.object({name:p.string(),midPx:p.string()}),$O=p.object({unixTime:p.number(),value:p.string(),open:p.string(),high:p.string(),low:p.string(),close:p.string(),volume:p.string()}),y1A=p.object({history:p.array($O)}),hS=p.object({role:p.enum(["missing","user"])}),FS=p.object({fundingCaip19Address:lo,spotAssetId:p.number(),spotTokenId:p.string(),spotTokenName:p.string(),spotSzDecimals:p.number(),eta:p.string(),fee:p.string(),minimumAmount:p.string()}),SS=p.object({tokens:p.array(xe)}),M7=(j=>(j.Hyperunit="hyperunit",j.Relay="relay",j))(M7||{}),wS=p.object({providers:p.array(p.object({name:p.nativeEnum(M7),max:p.number(),initializingCaip19Address:p.optional(lo)}))});var Tp=class{async getSpotBridgeInitialize(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/bridge-initialize",{params:A}),t=BS.safeParse(j.data);if(!t.success)throw new Error(`Failed to parse spot bridge initialize response: ${t.error}`);return t.data}async getOperations(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/bridge-operations",{params:A}),t=fS.safeParse(j.data);if(!t.success)throw new Error(`Failed to parse operations response: ${t.error}`);return t.data}async getAccountBalance(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/balance",{params:{user:M(A)}});if(!eA(j))throw new Error("Failed to get account balance: response is not okay");let t=j.data,r=sS.safeParse(t);if(!r.success)throw new Error("Failed to get account balance: schema validation failed");return r.data}async getUserFundingHistory(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/deposits-and-withdrawals",{params:{user:M(A)}});if(!eA(j))throw new Error("Failed to get deposits and withdrawals: response is not okay");let t=j.data,r=iS.safeParse(t);if(!r.success)throw new Error("Failed to get deposits and withdrawals: schema validation failed");return r.data.depositAndWithdrawals}async getPositions(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/positions",{params:{user:M(A)}});if(!eA(j))throw new Error("Failed to get positions: response is not okay");let t=j.data,r=dS.safeParse(t);if(!r.success)throw new Error("Failed to get positions: schema validation failed");return r.data.positions}async getPositionsAndOpenOrders(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/positions-and-open-orders",{params:{user:M(A)}});if(!eA(j))throw new Error("Failed to get positions: response is not okay");let t=j.data,r=mS.safeParse(t);if(!r.success)throw new Error("Failed to get positions: schema validation failed");return r.data}async getHistoricalOrders(A,j){let t={user:M(A)};j&&j.length>0&&(t.markets=j.join(","));let r=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/trade-history",{params:t});if(!eA(r))throw new Error("Failed to get historical orders: response is not okay");let o=r.data,i=cS.safeParse(o);if(!i.success)throw new Error("Failed to get historical orders: schema validation failed");return i.data.tradeHistory}async postSpotSend(A){let j=await N.api().retry(1,WA(1e3,1e3)).post("/swap/v2/spot/send",A);if(!eA(j))throw new Error("Failed to post spot send: response is not okay");let t=j.data,r=gS.safeParse(t);if(!r.success)throw new Error("Failed to post spot send: schema validation failed");return r.data}async postTransferUsdcSpotPerp(A){let j=await N.api().retry(1,WA(1e3,1e3)).post("/swap/v2/transfer-usdc-spot-perp",A);if(!eA(j))throw new Error("Failed to post spot send: response is not okay");let t=j.data,r=ES.safeParse(t);if(!r.success)throw new Error("Failed to post spot send: schema validation failed");return r.data}async getTokenDetails(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/token-details",{params:{tokenId:A.tokenId,type:"tokenDetails"}});if(!eA(j))throw new Error("Failed to get token info: response is not okay");let t=j.data,r=yS.safeParse(t);if(!r.success)throw new Error("Failed to get token info: schema validation failed");return r.data}async getUserRole(A){let j=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"userRole",user:A})});if(!j.ok)throw new Error("Failed to get token info");let t=await j.json(),r=hS.safeParse(t);if(!r.success)throw new Error("Failed to get user role: schema validation failed");return r.data}async postFunding(A){let j=await N.api().retry(1,WA(1e3,1e3)).post("/swap/v2/spot/funding",A);if(!eA(j))throw new Error("Failed to get funding");let t=j.data,r=FS.safeParse(t);if(!r.success)throw new Error("Failed to post funding: schema validation failed");return r.data}async getPriceHistory(A){let j={coin:A.coin,interval:A.interval,startTime:A.startTime.toString(),endTime:A.endTime.toString()};A.isTestnet&&(j.isTestnet="true");let t=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/candles",{params:j});if(!eA(t))throw new Error("Failed to get price history: response is not okay");let r=t.data,o=nS.safeParse(r);if(!o.success)throw new Error("Failed to get price history: schema validation failed");return o.data}async getSpotBalances(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/balances",{params:A});if(!eA(j))throw new Error("Failed to get spot balances: response is not okay");return j.data}async getPositionFees(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/perp/fees",{params:{user:M(A)}});if(!eA(j))throw new Error("Failed to get position fees: response is not okay");let t=j.data,r=kS.safeParse(t);if(!r.success)throw new Error("Failed to get position fees: schema validation failed");return r.data}async getBridgeableTokens(A){if(!A)throw new Error("No addresses provided to get bridgeable tokens");let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/bridgeable-tokens",{params:{addresses:A.join(",")}});if(!eA(j))throw new Error("Failed to get bridgeable tokens: response is not okay");let t=j.data,r=SS.safeParse(t);if(!r.success)throw new Error("Failed to get bridgeable tokens: schema validation failed");return r.data}async getPreferredBridges(){let A=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/preferred-bridges");if(!eA(A))throw new Error("Failed to get preferred bridge: response is not okay");let j=A.data,t=wS.safeParse(j);if(!t.success)throw new Error("Failed to get preferred bridge: schema validation failed");return t.data}};n();s();n();s();var ae=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];var Pp=[{name:"hyperliquidChain",type:"string"},{name:"maxFeeRate",type:"string"},{name:"builder",type:"address"},{name:"nonce",type:"uint64"}],sj=[{name:"source",type:"string"},{name:"connectionId",type:"bytes32"}];n();s();var vO=p.object({totalSz:p.string(),avgPx:p.string(),oid:p.number()}),qO=p.object({oid:p.number()}),xO=p.union([p.object({error:p.string()}),p.object({filled:vO}),p.literal("success"),p.object({resting:qO})]),TO=p.object({status:p.literal("ok"),response:p.object({type:p.string(),data:p.object({statuses:p.array(xO)}).optional()})}),PO=p.union([p.object({status:p.literal("err"),response:p.string()}),TO]),U1A=p.object({action:p.any(),nonce:p.number(),signature:p.object({r:p.string(),s:p.string(),v:p.number()}),isTestnet:p.boolean().optional()});var Cn=class{async postExchange(A){return await b.startSpan("hyperliquid.exchange.post",async()=>{let t=(await N.api().post("/swap/v2/exchange",A)).data,r=PO.safeParse(t);if(!r.success)throw new Error(`Invalid exchange response: ${r.error.message}`);return r.data})}};n();s();function R7(e){return e.map(A=>({time:A.t/1e3,open:Number(A.o),high:Number(A.h),low:Number(A.l),close:Number(A.c),volume:Number(A.v)}))}n();s();var Gp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingAccountBalanceStart":switch(this.state.type){case"accountBalance":return{type:"refreshing",accountBalance:this.state.accountBalance};case"refreshing":return{type:"refreshing",accountBalance:this.state.accountBalance};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let j=this.state;throw new Error(`Invalid state ${j.type} for fetchingAccountBalanceStart`)}}case"fetchingAccountBalanceSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"accountBalance",accountBalance:A.accountBalance};default:throw new Error(`Invalid state ${this.state.type} for fetchingAccountBalanceSuccess`)}case"fetchingAccountBalanceError":return{type:"error",error:A.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onAccountBalanceStateChange(this.state)})}};n();s();var Cp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingFundingHistoryStart":switch(this.state.type){case"history":return{type:"refreshing",history:this.state.history};case"refreshing":return{type:"refreshing",history:this.state.history};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistoryStart`)}case"fetchingFundingHistorySuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"history",history:A.history};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistorySuccess`)}case"fetchingFundingHistoryError":switch(this.state.type){case"history":case"refreshing":return{type:"history",history:this.state.history};default:return{type:"error",error:A.error}}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onFundingHistoryStateChange(this.state)})}};n();s();var Op=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingHistoricalOrdersStart":switch(this.state.type){case"historicalOrders":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"refreshing":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersStart`)}case"fetchingHistoricalOrdersSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"historicalOrders",historicalOrders:A.historicalOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersSuccess`)}case"fetchingHistoricalOrdersError":return{type:"error",error:A.error}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onHistoricalOrdersStateChange(this.state)})}};n();s();var Mp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingPositionsStart":switch(this.state.type){case"positions":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"refreshing":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let j=this.state;throw new Error(`Invalid state ${j.type} for fetchingPositionsStart`)}}case"fetchingPositionsSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positions",positions:A.positions,openOrders:A.openOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionsSuccess`)}case"fetchingPositionsError":return{type:"error",error:A.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPositionStateChange(this.state)})}};n();s();n();s();n();s();n();s();n();s();n();s();function bS(e){let A=e.length,j=0,t=0;for(;t<A;){let r=e.charCodeAt(t++);if(r&4294967168)if(!(r&4294965248))j+=2;else{if(r>=55296&&r<=56319&&t<A){let o=e.charCodeAt(t);(o&64512)===56320&&(++t,r=((r&1023)<<10)+(o&1023)+65536)}r&4294901760?j+=4:j+=3}else{j++;continue}}return j}function GO(e,A,j){let t=e.length,r=j,o=0;for(;o<t;){let i=e.charCodeAt(o++);if(i&4294967168)if(!(i&4294965248))A[r++]=i>>6&31|192;else{if(i>=55296&&i<=56319&&o<t){let a=e.charCodeAt(o);(a&64512)===56320&&(++o,i=((i&1023)<<10)+(a&1023)+65536)}i&4294901760?(A[r++]=i>>18&7|240,A[r++]=i>>12&63|128,A[r++]=i>>6&63|128):(A[r++]=i>>12&15|224,A[r++]=i>>6&63|128)}else{A[r++]=i;continue}A[r++]=i&63|128}}var CO=new TextEncoder,OO=50;function MO(e,A,j){CO.encodeInto(e,A.subarray(j))}function IS(e,A,j){e.length>OO?MO(e,A,j):GO(e,A,j)}var pCA=new TextDecoder;n();s();n();s();var ro=class{constructor(A,j){this.type=A,this.data=j}};n();s();n();s();var Rp=class e extends Error{constructor(A){super(A);let j=Object.create(e.prototype);Object.setPrototypeOf(this,j),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:e.name})}};n();s();function $S(e,A,j){let t=j/4294967296,r=j;e.setUint32(A,t),e.setUint32(A+4,r)}function _p(e,A,j){let t=Math.floor(j/4294967296),r=j;e.setUint32(A,t),e.setUint32(A+4,r)}function vS(e,A){let j=e.getInt32(A),t=e.getUint32(A+4);return j*4294967296+t}var RO=-1,_O=4294967296-1,DO=17179869184-1;function NO({sec:e,nsec:A}){if(e>=0&&A>=0&&e<=DO)if(A===0&&e<=_O){let j=new Uint8Array(4);return new DataView(j.buffer).setUint32(0,e),j}else{let j=e/4294967296,t=e&4294967295,r=new Uint8Array(8),o=new DataView(r.buffer);return o.setUint32(0,A<<2|j&3),o.setUint32(4,t),r}else{let j=new Uint8Array(12),t=new DataView(j.buffer);return t.setUint32(0,A),_p(t,4,e),j}}function LO(e){let A=e.getTime(),j=Math.floor(A/1e3),t=(A-j*1e3)*1e6,r=Math.floor(t/1e9);return{sec:j+r,nsec:t-r*1e9}}function KO(e){if(e instanceof Date){let A=LO(e);return NO(A)}else return null}function UO(e){let A=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:return{sec:A.getUint32(0),nsec:0};case 8:{let j=A.getUint32(0),t=A.getUint32(4),r=(j&3)*4294967296+t,o=j>>>2;return{sec:r,nsec:o}}case 12:{let j=vS(A,4),t=A.getUint32(0);return{sec:j,nsec:t}}default:throw new Rp(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${e.length}`)}}function HO(e){let A=UO(e);return new Date(A.sec*1e3+A.nsec/1e6)}var qS={type:RO,encode:KO,decode:HO};var On=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(qS)}register({type:A,encode:j,decode:t}){if(A>=0)this.encoders[A]=j,this.decoders[A]=t;else{let r=-1-A;this.builtInEncoders[r]=j,this.builtInDecoders[r]=t}}tryToEncode(A,j){for(let t=0;t<this.builtInEncoders.length;t++){let r=this.builtInEncoders[t];if(r!=null){let o=r(A,j);if(o!=null){let i=-1-t;return new ro(i,o)}}}for(let t=0;t<this.encoders.length;t++){let r=this.encoders[t];if(r!=null){let o=r(A,j);if(o!=null){let i=t;return new ro(i,o)}}}return A instanceof ro?A:null}decode(A,j,t){let r=j<0?this.builtInDecoders[-1-j]:this.decoders[j];return r?r(A,j,t):new ro(j,A)}};On.defaultCodec=new On;n();s();function QO(e){return e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer}function xS(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):QO(e)?new Uint8Array(e):Uint8Array.from(e)}var VO=100,zO=2048,Dp=class e{constructor(A){this.entered=!1,this.extensionCodec=A?.extensionCodec??On.defaultCodec,this.context=A?.context,this.useBigInt64=A?.useBigInt64??!1,this.maxDepth=A?.maxDepth??VO,this.initialBufferSize=A?.initialBufferSize??zO,this.sortKeys=A?.sortKeys??!1,this.forceFloat32=A?.forceFloat32??!1,this.ignoreUndefined=A?.ignoreUndefined??!1,this.forceIntegerToFloat=A?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new e({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(A){if(this.entered)return this.clone().encodeSharedRef(A);try{return this.entered=!0,this.reinitializeState(),this.doEncode(A,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(A){if(this.entered)return this.clone().encode(A);try{return this.entered=!0,this.reinitializeState(),this.doEncode(A,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(A,j){if(j>this.maxDepth)throw new Error(`Too deep objects in depth ${j}`);A==null?this.encodeNil():typeof A=="boolean"?this.encodeBoolean(A):typeof A=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(A):this.encodeNumber(A):typeof A=="string"?this.encodeString(A):this.useBigInt64&&typeof A=="bigint"?this.encodeBigInt64(A):this.encodeObject(A,j)}ensureBufferSizeToWrite(A){let j=this.pos+A;this.view.byteLength<j&&this.resizeBuffer(j*2)}resizeBuffer(A){let j=new ArrayBuffer(A),t=new Uint8Array(j),r=new DataView(j);t.set(this.bytes),this.view=r,this.bytes=t}encodeNil(){this.writeU8(192)}encodeBoolean(A){A===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(A){!this.forceIntegerToFloat&&Number.isSafeInteger(A)?A>=0?A<128?this.writeU8(A):A<256?(this.writeU8(204),this.writeU8(A)):A<65536?(this.writeU8(205),this.writeU16(A)):A<4294967296?(this.writeU8(206),this.writeU32(A)):this.useBigInt64?this.encodeNumberAsFloat(A):(this.writeU8(207),this.writeU64(A)):A>=-32?this.writeU8(224|A+32):A>=-128?(this.writeU8(208),this.writeI8(A)):A>=-32768?(this.writeU8(209),this.writeI16(A)):A>=-2147483648?(this.writeU8(210),this.writeI32(A)):this.useBigInt64?this.encodeNumberAsFloat(A):(this.writeU8(211),this.writeI64(A)):this.encodeNumberAsFloat(A)}encodeNumberAsFloat(A){this.forceFloat32?(this.writeU8(202),this.writeF32(A)):(this.writeU8(203),this.writeF64(A))}encodeBigInt64(A){A>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(A)):(this.writeU8(211),this.writeBigInt64(A))}writeStringHeader(A){if(A<32)this.writeU8(160+A);else if(A<256)this.writeU8(217),this.writeU8(A);else if(A<65536)this.writeU8(218),this.writeU16(A);else if(A<4294967296)this.writeU8(219),this.writeU32(A);else throw new Error(`Too long string: ${A} bytes in UTF-8`)}encodeString(A){let t=bS(A);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),IS(A,this.bytes,this.pos),this.pos+=t}encodeObject(A,j){let t=this.extensionCodec.tryToEncode(A,this.context);if(t!=null)this.encodeExtension(t);else if(Array.isArray(A))this.encodeArray(A,j);else if(ArrayBuffer.isView(A))this.encodeBinary(A);else if(typeof A=="object")this.encodeMap(A,j);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(A)}`)}encodeBinary(A){let j=A.byteLength;if(j<256)this.writeU8(196),this.writeU8(j);else if(j<65536)this.writeU8(197),this.writeU16(j);else if(j<4294967296)this.writeU8(198),this.writeU32(j);else throw new Error(`Too large binary: ${j}`);let t=xS(A);this.writeU8a(t)}encodeArray(A,j){let t=A.length;if(t<16)this.writeU8(144+t);else if(t<65536)this.writeU8(220),this.writeU16(t);else if(t<4294967296)this.writeU8(221),this.writeU32(t);else throw new Error(`Too large array: ${t}`);for(let r of A)this.doEncode(r,j+1)}countWithoutUndefined(A,j){let t=0;for(let r of j)A[r]!==void 0&&t++;return t}encodeMap(A,j){let t=Object.keys(A);this.sortKeys&&t.sort();let r=this.ignoreUndefined?this.countWithoutUndefined(A,t):t.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(let o of t){let i=A[o];this.ignoreUndefined&&i===void 0||(this.encodeString(o),this.doEncode(i,j+1))}}encodeExtension(A){if(typeof A.data=="function"){let t=A.data(this.pos+6),r=t.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(A.type),this.writeU8a(t);return}let j=A.data.length;if(j===1)this.writeU8(212);else if(j===2)this.writeU8(213);else if(j===4)this.writeU8(214);else if(j===8)this.writeU8(215);else if(j===16)this.writeU8(216);else if(j<256)this.writeU8(199),this.writeU8(j);else if(j<65536)this.writeU8(200),this.writeU16(j);else if(j<4294967296)this.writeU8(201),this.writeU32(j);else throw new Error(`Too large extension object: ${j}`);this.writeI8(A.type),this.writeU8a(A.data)}writeU8(A){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,A),this.pos++}writeU8a(A){let j=A.length;this.ensureBufferSizeToWrite(j),this.bytes.set(A,this.pos),this.pos+=j}writeI8(A){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,A),this.pos++}writeU16(A){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,A),this.pos+=2}writeI16(A){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,A),this.pos+=2}writeU32(A){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,A),this.pos+=4}writeI32(A){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,A),this.pos+=4}writeF32(A){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,A),this.pos+=4}writeF64(A){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,A),this.pos+=8}writeU64(A){this.ensureBufferSizeToWrite(8),$S(this.view,this.pos,A),this.pos+=8}writeI64(A){this.ensureBufferSizeToWrite(8),_p(this.view,this.pos,A),this.pos+=8}writeBigUint64(A){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,A),this.pos+=8}writeBigInt64(A){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,A),this.pos+=8}};function Rj(e,A){return new Dp(A).encodeSharedRef(e)}var TS=q(os()),Np=class{type="updateIsolatedMargin";asset;isBuy;ntli;constructor(A){this.asset=A.asset,this.isBuy=A.isBuy,this.ntli=A.ntli}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(XO(A),t.length+9)),`0x${(0,TS.keccak256)(o)}`}};function XO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function _7(e){switch(e.type){case"preparingTransaction":case"managingMargin":case"manageMarginSucceeded":return PS(e);case"manageMarginFailed":return{...PS(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var PS=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbol:e.market.symbol,assetId:e.market.assetId.toString(),positionDirection:e.position.direction,positionSize:e.position.size.toString(),currentMargin:e.position.margin.toString(),marginDelta:e.marginDelta.toString(),marginAction:e.marginDelta.isPositive()?"increase":"decrease",newMargin:new S(e.position.margin).plus(e.marginDelta).toString(),fee:e.fee?.toString()||"N/A"};n();s();var Lp=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in ManageMarginStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateManageMargin":{let{position:t,market:r,marginDelta:o,fee:i}=j.payload;return{type:"preparingTransaction",...{position:t,market:r,marginDelta:o,fee:i}}}case"ManageMarginInitiated":{if(A.type==="preparingTransaction")return{type:"managingMargin",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee};break}case"ManageMarginSuccess":{if(A.type==="managingMargin")return{type:"manageMarginSucceeded",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee};break}case"ManageMarginFailure":{if(A.type==="managingMargin")return{type:"manageMarginFailed",position:A.position,market:A.market,marginDelta:A.marginDelta,fee:A.fee,error:j.error};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onManageMarginStateChange(A,this.state)})}};var WO=6,Kp=class{stateMachine=new Lp;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManageMarginStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onManageMarginStateChange:(A,j)=>{switch(j.type){case"manageMarginSucceeded":b.addBreadcrumb("perps",`Manage margin succeeded: ${j.type}`,"info",_7(j));break;case"manageMarginFailed":b.addBreadcrumb("perps",`Manage margin failed: ${j.type}`,"error",_7(j));break;default:b.addBreadcrumb("perps",`Manage margin state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="manageMarginSucceeded"||j.type==="manageMarginFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateManageMargin":this.stateMachine.send({type:"ManageMarginInitiated"});break;case"ManageMarginInitiated":j.type==="managingMargin"&&await this.manageMargin(j);break}}async manageMargin(A){try{let{position:j,market:t,marginDelta:r}=A,o=r.multipliedBy(new S(10).pow(WO)).toNumber(),i=new Np({asset:t.assetId,isBuy:j.direction==="long",ntli:o}),a=Date.now(),u={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:i.hash(null,a)}},c=await this.perps.exchangeAction(i,u,a),l=c.response.data?.statuses?.find(B=>typeof B=="object"&&"error"in B);if(l&&typeof l=="object"&&"error"in l)throw new Error(l.error);let m=JSON.stringify(c.response.data?.statuses||"unknown");this.stateMachine.send({type:"ManageMarginSuccess",payload:m})}catch(j){this.stateMachine.send({type:"ManageMarginFailure",error:j})}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){return this.stateMachine.addListener(A),()=>this.stateMachine.removeListener(A)}removeListener(A){this.stateMachine.removeListener(A)}};n();s();n();s();var GS=q(os()),xt=class{type="order";orders;grouping;builder;constructor(A,j){this.orders=A,this.grouping="na",j&&(this.builder=j)}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(JO(A),t.length+9)),`0x${(0,GS.keccak256)(o)}`}};function JO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}var Up=class{hyperliquidChain;signatureChainId;amount;destination;time;token;type="spotSend";constructor(A){this.hyperliquidChain=A.hyperliquidChain,this.signatureChainId=A.signatureChainId,this.token=A.token,this.amount=A.amount,this.destination=A.destination,this.time=A.time}};n();s();var CS=q(os()),Mn=class{type="setReferrer";code;constructor(A){this.code=A.code}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(YO(A),t.length+9)),`0x${(0,CS.keccak256)(o)}`}};function YO(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();var fj=class{_order={};asset(A){return this._order.a=A,this}isBuy(A){return this._order.b=A,this}buy(){return this.isBuy(!0)}sell(){return this.isBuy(!1)}price(A){return this._order.p=A.toString(),this}size(A){return this._order.s=A.toString(),this}reduceOnly(A){return this._order.r=A,this}clientOrderId(A){return this._order.c=A,this}limitOrder(A="Gtc"){return this._order.t={limit:{tif:A}},this}postOnly(){return this.limitOrder("Alo")}immediateOrCancel(){return this.limitOrder("Ioc")}triggerOrder(A,j=!0,t="sl"){return this._order.t={trigger:{isMarket:j,triggerPx:A.toString(),tpsl:t}},this}stopLoss(A,j=!0){return this.triggerOrder(A,j,"sl")}takeProfit(A,j=!0){return this.triggerOrder(A,j,"tp")}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.b===void 0)throw new Error("Buy/sell direction is required");if(this._order.p===void 0)throw new Error("Price is required");if(this._order.s===void 0)throw new Error("Size is required");if(this._order.t===void 0)throw new Error("Order type is required");return this._order.r===void 0&&(this._order.r=!1),this._order}};n();s();function gj(e,A,j=!0,t=S.ROUND_HALF_UP){let r=new S(e);if(r.isInteger())return r.toString();let o=ZO(A,j);return r.precision(5,t).toFixed(o,t).replace(/\.?0+$/,"")}function ZO(e,A=!0){return Math.max((A?6:8)-e,0)}n();s();function Hp(e,A,j=S.ROUND_HALF_UP){return new S(e).toFixed(A,j).replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}n();s();var Qp=class{_order={};asset(A){return this._order.a=A,this}orderId(A){return this._order.o=A,this}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.o===void 0)throw new Error("Order ID is required");return this._order}};n();s();var OS=q(os()),Vp=class{type="cancel";cancels;constructor(A){this.cancels=A}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(AM(A),t.length+9)),`0x${(0,OS.keccak256)(o)}`}};function AM(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function D7(e){switch(e.type){case"preparingTransaction":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"managingPosition":case"managePositionSucceeded":return MS(e);case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":return{...MS(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var MS=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbols:e.markets.map(A=>A.symbol).join(", "),assetIds:e.markets.map(A=>A.assetId.toString()).join(", "),positionDirections:e.positions.map(A=>A.direction).join(", "),positionSizes:e.positions.map(A=>A.size.toString()).join(", "),updateType:e.update.type,fees:e.fees.map(A=>A.toString()).join(", "),...e.update.type==="close"&&{closeSize:e.update.size.toString()},...e.update.type==="addAutoClose"&&{tpTriggerPrice:e.update.autoClose.tp?.triggerPrice.toString()||"N/A",slTriggerPrice:e.update.autoClose.sl?.triggerPrice.toString()||"N/A"},...e.update.type==="removeAutoClose"&&{tpOrderId:e.update.autoClose.tp?.orderId?.toString()||"N/A",slOrderId:e.update.autoClose.sl?.orderId?.toString()||"N/A"}};n();s();var zp=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in ManagePositionStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateManagePosition":{let{positions:t,update:r,markets:o,fees:i,autoClose:a}=j.payload;return{type:"preparingTransaction",...{positions:t,update:r,markets:o,fees:i,autoClose:a}}}case"RegisterBuilderCodeInitiated":{if(A.type==="preparingTransaction")return{type:"registeringBuilder",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(A.type==="registeringBuilder")return{type:"builderRegistered",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterBuilderCodeFailure":{if(A.type==="registeringBuilder")return{type:"builderRegistrationFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralInitiated":{if(A.type==="builderRegistered")return{type:"registeringReferral",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(A.type==="registeringReferral")return{type:"referralRegistered",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"RegisterReferralFailure":{if(A.type==="registeringReferral")return{type:"referralRegistrationFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionInitiated":{if(A.type==="preparingTransaction"||A.type==="referralRegistered")return{type:"managingPosition",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionSuccess":{if(A.type==="managingPosition")return{type:"managePositionSucceeded",positions:A.positions,update:A.update,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"ManagePositionFailure":{if(A.type==="managingPosition")return{type:"managePositionFailed",positions:A.positions,update:A.update,error:j.error,markets:A.markets,fees:A.fees,autoClose:A.autoClose};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onManagePositionStateChange(A,this.state)})}};var Rn=.1,Xp=class{stateMachine=new zp;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManagePositionStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onManagePositionStateChange:(A,j)=>{switch(j.type){case"managePositionSucceeded":b.addBreadcrumb("perps",`Manage position succeeded: ${j.type}`,"info",D7(j));break;case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":b.addBreadcrumb("perps",`Manage position failed: ${j.type}`,"error",D7(j));break;default:b.addBreadcrumb("perps",`Manage position state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="managePositionSucceeded"||j.type==="managePositionFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateManagePosition":A.payload.update.type==="close"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"ManagePositionInitiated"});break;case"RegisterBuilderCodeInitiated":j.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":j.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":j.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":j.type==="referralRegistered"&&this.stateMachine.send({type:"ManagePositionInitiated"});break;case"ManagePositionInitiated":j.type==="managingPosition"&&await this.managePosition(j);break}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){this.stateMachine.addListener(A)}removeListener(A){this.stateMachine.removeListener(A)}async registerBuilder(){try{let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing"||!A.positionFees.builder)throw new Error("position fees not found");if(A.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let j=A.positionFees.builder.address,t=`${Number(A.positionFees.phantomFee.toString())*100}%`,r=Date.now(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:t,builder:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ae,"HyperliquidTransaction:ApproveBuilderFee":Pp},message:o},u=(await this.perps.exchangeAction(o,i,r)).response.data?.statuses?.find(c=>typeof c=="object"&&"error"in c);if(u&&typeof u=="object"&&"error"in u)throw new Error(u.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"})}catch(A){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:A})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing")throw new Error("position fees not found");if(!A.positionFees.referral||A.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let j=A.positionFees.referral.code,t=new Mn({code:j}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"RegisterReferralSuccess"})}catch(A){this.stateMachine.send({type:"RegisterReferralFailure",error:A})}}async managePosition(A){try{let{positions:j,update:t,markets:r}=A,o="",a=j.map(u=>u.direction==="long").map(u=>u);if(t.type==="removeAutoClose"){let u=await this.removeAutoClose(r[0].assetId,[t.autoClose.tp?.orderId,t.autoClose.sl?.orderId].filter(Boolean));if(!u)throw new Error("Failed to cancel auto close orders");o=u}else if(t.type==="close"||t.type==="closeAll")o=await this.closePositions(r.map(c=>c.assetId),t.size instanceof S?[t.size.abs().toString()]:t.size.map(c=>c.abs().toString()),a,r.map(c=>c.currentPrice.toString()),r.map(c=>c.szDecimals));else if(t.type==="addAutoClose"){let u={tp:t.autoClose.tp?.orderId,sl:t.autoClose.sl?.orderId},c=await this.createAutoClose(u,r[0].assetId,a[0],r[0].szDecimals,t.autoClose);if(!c)throw new Error("Failed to cancel auto close orders");o=c}this.stateMachine.send({type:"ManagePositionSuccess",payload:o})}catch(j){this.stateMachine.send({type:"ManagePositionFailure",error:j})}}async closePositions(A,j,t,r,o){let i=this.perps.getPositionFeesState();if(i.type!=="positionFees"&&i.type!=="refreshing"||!i.positionFees.builder)throw new Error("position fees not found");let a={b:i.positionFees.builder.address.toLowerCase(),f:Number(i.positionFees.phantomFee)*100*100*10},u=[];for(let g=0;g<A.length;g++){let E=gj(new S(r[g]).multipliedBy(t[g]?1-Rn:1+Rn),o[g]),h=Hp(new S(j[g]),o[g]),y=new fj().asset(A[g]).isBuy(!t[g]).price(E).size(h).reduceOnly(!0).immediateOrCancel().build();u.push(y)}let c=new xt(u,a),l=Date.now(),m={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:c.hash(null,l)}},B=await this.perps.exchangeAction(c,m,l),k=B.response.data?.statuses.find(g=>g==="error"||g?.error);if(k){let g=typeof k=="string"?"Operation failed":k.error;throw new Error(g)}let f=B.response.data?.statuses.find(g=>g==="filled"||g?.filled);if(f&&typeof f=="object"&&f.filled)return JSON.stringify(B.response.data?.statuses);throw new Error("No filled status found")}async createAutoClose(A,j,t,r,o){let i=[A.tp,A.sl].filter(Boolean).filter(F=>F!==-1);if(i.length>0&&!await this.removeAutoClose(j,i))throw new Error("Failed to cancel auto close orders");let a=this.perps.getPositionFeesState();if(a.type!=="positionFees"&&a.type!=="refreshing"||!a.positionFees.builder)throw new Error("position fees not found");let u={b:a.positionFees.builder.address.toLowerCase(),f:Number(a.positionFees.phantomFee)*100*100*10},c="0",l;if(o?.tp){let F=gj(new S(o.tp.triggerPrice).multipliedBy(t?1-Rn:1+Rn),r),w=gj(new S(o.tp.triggerPrice),r).toString();l=new fj().asset(j).isBuy(!t).price(F).size(c).reduceOnly(!0).triggerOrder(w,!0,"tp").build()}let m;if(o?.sl){let F=gj(new S(o.sl.triggerPrice).multipliedBy(t?1-Rn:1+Rn),r),w=gj(new S(o.sl.triggerPrice),r).toString();m=new fj().asset(j).isBuy(!t).price(F).size(c).reduceOnly(!0).triggerOrder(w,!0,"sl").build()}let B=[l,m].filter(Boolean),k=new xt(B,u),f=Date.now(),g={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:k.hash(null,f)}},E=await this.perps.exchangeAction(k,g,f),h=E.response.data?.statuses.find(F=>F==="error"||F?.error);if(h){let F=typeof h=="string"?"Operation failed":h.error;throw new Error(F)}let y=E.response.data?.statuses.find(F=>F==="resting"||F?.resting);if(y&&typeof y=="object"&&y.resting&&y.resting.oid)return JSON.stringify(E.response.data?.statuses);throw new Error("No order status found")}async removeAutoClose(A,j){let t=j.map(c=>new Qp().asset(A).orderId(Number(c)).build()),r=new Vp(t),o=Date.now(),i={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:r.hash(null,o)}},a=await this.perps.exchangeAction(r,i,o),u=a.response.data?.statuses.find(c=>c==="error"||c?.error);if(u){let c=typeof u=="string"?"Operation failed":u.error;throw new Error(c)}if(a.response.data?.statuses&&a.response.data?.statuses.length>0&&a.response.data?.statuses.every(c=>c==="success"||c?.success))return JSON.stringify({orderIds:t});throw new Error("Cancel operation failed")}};n();s();n();s();var RS=q(os()),Wp=class{type="updateLeverage";asset;isCross;leverage;constructor(A){this.asset=A.asset,this.isCross=A.isCross,this.leverage=A.leverage}hash(A,j){let t=Rj(this),r=A===null?9:29,o=new Uint8Array(t.length+r);o.set(t);let i=new DataView(o.buffer,o.byteOffset,o.byteLength);return i.setBigUint64(t.length,BigInt(j)),A===null?i.setUint8(t.length+8,0):(i.setUint8(t.length+8,1),o.set(eM(A),t.length+9)),`0x${(0,RS.keccak256)(o)}`}};function eM(e){let A=e.startsWith("0x")?e.substring(2):e;return Uint8Array.from(Buffer.from(A,"hex"))}n();s();function N7(e){switch(e.type){case"preparingTransaction":case"updatingLeverage":case"leverageUpdated":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"creatingPosition":case"orderSucceeded":return _S(e);case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":return{..._S(e),error:e.error instanceof Error?e.error.message:"Unknown error"};case"indeterminate":default:return{state:e.type}}}var _S=e=>e.type==="indeterminate"?{state:e.type}:{marketSymbol:e.market.symbol,assetId:e.market.assetId.toString(),direction:e.direction,margin:e.margin.toString(),leverage:e.leverage.toString(),size:e.size.toString(),sizeInCoin:e.sizeInCoin.toString(),estimatedLiquidationPrice:e.estimatedLiquidationPrice?.toString()||"N/A",fee:e.fee?.toString()||"N/A",action:e.action};n();s();var Jp=class{listeners=[];state={type:"indeterminate"};getState(){return this.state}send(A){try{let j=this.determineNextState(this.state,A);this.state=j,this.notifyListeners(A)}catch(j){console.error("Error processing event in OpenPositionStateMachine:",A,j)}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}determineNextState(A,j){switch(j.type){case"InitiateOpenPosition":{let{market:t,direction:r,margin:o,leverage:i,autoClose:a,estimatedLiquidationPrice:u,fee:c,action:l}=j.payload,m=new S(o).multipliedBy(i),B=new S(t.currentPrice),k=B.isGreaterThan(0)?m.dividedBy(B):new S(0);return{type:"preparingTransaction",...{market:t,direction:r,margin:o,leverage:i,autoClose:a,size:m,sizeInCoin:k,estimatedLiquidationPrice:u,fee:c,action:l}}}case"InitiateUpdateLeverage":{if(A.type==="preparingTransaction")return A;break}case"UpdateLeverageInitiated":{if(A.type==="preparingTransaction")return{type:"updatingLeverage",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"UpdateLeverageSuccess":{if(A.type==="updatingLeverage")return{type:"leverageUpdated",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferInitiated":{if(A.type==="leverageUpdated")return{type:"transferringToHip3Dex",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferNotRequired":case"Hip3TransferSuccess":{if(A.type==="transferringToHip3Dex")return{type:"hip3TransferCompleted",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Hip3TransferFailure":{if(A.type==="transferringToHip3Dex")return{type:"hip3TransferFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"UpdateLeverageFailure":{if(A.type==="updatingLeverage")return{type:"leverageUpdateFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"RegisterBuilderCodeInitiated":{if(A.type==="leverageUpdated"||A.type==="hip3TransferCompleted")return{type:"registeringBuilder",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(A.type==="registeringBuilder")return{type:"builderRegistered",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterBuilderCodeFailure":{if(A.type==="registeringBuilder")return{type:"builderRegistrationFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"RegisterReferralInitiated":{if(A.type==="builderRegistered")return{type:"registeringReferral",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(A.type==="registeringReferral")return{type:"referralRegistered",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"RegisterReferralFailure":{if(A.type==="registeringReferral")return{type:"referralRegistrationFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,error:j.error,action:A.action};break}case"PositionCreationInitiated":{if(A.type==="referralRegistered")return{type:"creatingPosition",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"PositionCreationSuccess":{if(A.type==="creatingPosition")return{type:"orderSucceeded",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"PositionCreationFailure":{if(A.type==="creatingPosition")return{type:"orderFailed",market:A.market,direction:A.direction,margin:A.margin,leverage:A.leverage,autoClose:A.autoClose,size:A.size,sizeInCoin:A.sizeInCoin,error:j.error,estimatedLiquidationPrice:A.estimatedLiquidationPrice,fee:A.fee,action:A.action};break}case"Reset":return{type:"indeterminate"}}return A}notifyListeners(A){this.listeners.forEach(j=>{j.onOpenPositionStateChange(A,this.state)})}};var _n=.1,Yp=class{stateMachine=new Jp;perps;constructor(A){this.perps=A,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onOpenPositionStateChange:(A,j)=>{this.handleStateChange(A,j)}};stateLogsListener={onOpenPositionStateChange:(A,j)=>{switch(j.type){case"orderSucceeded":b.addBreadcrumb("perps",`Open position succeeded: ${j.type}`,"info",N7(j));break;case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"hip3TransferFailed":case"orderFailed":b.addBreadcrumb("perps",`Open position failed: ${j.type}`,"error",N7(j));break;default:b.addBreadcrumb("perps",`Open position state change: ${A.type} -> ${j.type}`,"info");break}(j.type==="orderSucceeded"||j.type==="orderFailed")&&this.stateMachine.removeListener(this.stateLogsListener)}};async handleStateChange(A,j){switch(A.type){case"InitiateOpenPosition":await this.ensureSufficientBalance(A.payload.margin,A.payload.action),this.stateMachine.send({type:"InitiateUpdateLeverage",payload:{isCross:!1,leverage:A.payload.leverage}});break;case"InitiateUpdateLeverage":this.stateMachine.send({type:"UpdateLeverageInitiated"});break;case"UpdateLeverageInitiated":j.type==="updatingLeverage"&&await this.updateLeverage(j);break;case"UpdateLeverageSuccess":j.type==="leverageUpdated"&&this.stateMachine.send({type:"Hip3TransferInitiated"});break;case"Hip3TransferInitiated":j.type==="transferringToHip3Dex"&&await this.checkAndTransferToHip3Dex(j);break;case"Hip3TransferNotRequired":case"Hip3TransferSuccess":j.type==="hip3TransferCompleted"&&this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"InitiateRegisterBuilder":this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"RegisterBuilderCodeInitiated":j.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":j.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"InitiateRegisterReferral":this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":j.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":j.type==="referralRegistered"&&this.stateMachine.send({type:"PositionCreationInitiated"});break;case"PositionCreationInitiated":j.type==="creatingPosition"&&await this.createPosition(j);break}}getState(){return this.stateMachine.getState()}send(A){this.stateMachine.send(A)}addListener(A){this.stateMachine.addListener(A)}removeListener(A){this.stateMachine.removeListener(A)}async ensureSufficientBalance(A,j){let t=this.perps.getAccountBalanceState();if(t.type==="accountBalance"||t.type==="refreshing"){let i=new S(t.accountBalance.availableBalance);if(j==="reduce"||j==="reverse"||i.isGreaterThanOrEqualTo(A))return}this.perps.syncAccountBalance();let r=300,o=0;for(;o<r;){let i=this.perps.getAccountBalanceState();if((i.type==="accountBalance"||i.type==="refreshing")&&new S(i.accountBalance.availableBalance).isGreaterThanOrEqualTo(A))return;await new Promise(a=>setTimeout(a,10)),o++}throw new Error("Insufficient balance after consolidation attempt")}async updateLeverage(A){try{let j=A.market.assetId,t=new Wp({asset:j,isCross:!1,leverage:A.leverage.toNumber()}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"UpdateLeverageSuccess"})}catch(j){this.stateMachine.send({type:"UpdateLeverageFailure",error:j})}}async registerBuilder(){try{let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing"||!A.positionFees.builder)throw new Error("position fees not found");if(A.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let j=A.positionFees.builder.address,t=`${Number(A.positionFees.phantomFee.toString())*100}%`,r=Date.now(),o={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:t,builder:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ae,"HyperliquidTransaction:ApproveBuilderFee":Pp},message:o},u=(await this.perps.exchangeAction(o,i,r)).response.data?.statuses?.find(c=>typeof c=="object"&&"error"in c);if(u&&typeof u=="object"&&"error"in u)throw new Error(u.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"})}catch(A){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:A})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let A=this.perps.getPositionFeesState();if(A.type!=="positionFees"&&A.type!=="refreshing")throw new Error("position fees not found");if(!A.positionFees.referral||A.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let j=A.positionFees.referral.code,t=new Mn({code:j}),r=Date.now(),o={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:t.hash(null,r)}},a=(await this.perps.exchangeAction(t,o,r)).response.data?.statuses?.find(u=>typeof u=="object"&&"error"in u);if(a&&typeof a=="object"&&"error"in a)throw new Error(a.error);this.stateMachine.send({type:"RegisterReferralSuccess"})}catch(A){this.stateMachine.send({type:"RegisterReferralFailure",error:A})}}async checkAndTransferToHip3Dex(A){try{let j=A.market.symbol.split(":");if(j.length<2){this.stateMachine.send({type:"Hip3TransferNotRequired"});return}let t=j[0],r=A.margin;if(!this.perps.user)throw new Error("User address not set");let o=await this.perps.sendAsset({destination:this.perps.user.address.toLowerCase(),sourceDex:"",destinationDex:t,token:"USDC",amount:r});if(o.status==="ok")this.stateMachine.send({type:"Hip3TransferSuccess"});else throw new Error(JSON.stringify(o.response))}catch(j){this.stateMachine.send({type:"Hip3TransferFailure",error:j})}}async createPosition(A){try{let j=await this.createOrder(A.market.assetId,A.size.toString(),A.direction==="long",A.market.currentPrice.toString(),A.market.szDecimals,A.autoClose,A.action==="reduce");this.stateMachine.send({type:"PositionCreationSuccess",payload:j})}catch(j){this.stateMachine.send({type:"PositionCreationFailure",error:j})}}async createOrder(A,j,t,r,o,i,a){let u=gj(new S(r).multipliedBy(t?1+_n:1-_n),o),c=this.perps.getPositionFeesState();if(c.type!=="positionFees"&&c.type!=="refreshing"||!c.positionFees.builder)throw new Error("position fees not found");let l={b:c.positionFees.builder.address.toLowerCase(),f:Number(c.positionFees.phantomFee)*100*100*10},m=Hp(new S(j).dividedBy(new S(r)),o),B=new fj().asset(A).isBuy(t).price(u).size(m).reduceOnly(a??!1).immediateOrCancel().build(),k;if(i?.tp?.dollar){let G=gj(new S(i.tp.dollar),o).toString(),v=gj(new S(i.tp.dollar).multipliedBy(t?1+_n:1-_n),o);k=new fj().asset(A).isBuy(!t).price(v).size(m).reduceOnly(!0).triggerOrder(G,!0,"tp").build()}let f;if(i?.sl?.dollar){let G=gj(new S(i.sl.dollar),o).toString(),v=gj(new S(i.sl.dollar).multipliedBy(t?1+_n:1-_n),o);f=new fj().asset(A).isBuy(!t).price(v).size(m).reduceOnly(!0).triggerOrder(G,!0,"sl").build()}let g=[B,k,f].filter(Boolean),E=new xt(g,l),h=Date.now(),y={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:E.hash(null,h)}},F=await this.perps.exchangeAction(E,y,h),w=F.response.data?.statuses?.find(G=>typeof G=="object"&&"error"in G);if(w&&typeof w=="object"&&"error"in w)throw new Error(w.error);let x=F.response.data?.statuses.find(G=>typeof G=="object"&&"filled"in G);if(x&&typeof x=="object"&&"filled"in x)return JSON.stringify(F.response.data?.statuses);throw new Error("No filled status found")}};n();s();var Zp=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"fetchingPositionFeesStart":switch(this.state.type){case"positionFees":return{type:"refreshing",positionFees:this.state.positionFees};case"refreshing":return{type:"refreshing",positionFees:this.state.positionFees};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesStart`)}case"fetchingPositionFeesSuccess":switch(this.state.type){case"loading":case"refreshing":return{type:"positionFees",positionFees:A.fees};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesSuccess`)}case"fetchingPositionFeesError":return{type:"error",error:A.error}}}getState(){return this.state}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPositionFeesStateChange(this.state)})}};n();s();var L7=["1H","1D","1W","1M","YTD","ALL"],Ac=class{listeners=[];state={type:"indeterminate"};send(A){let j=this.detectNextState(A);this.state=j,this.notifyListeners()}detectNextState(A){switch(A.type){case"initiateSequentialFetch":return{type:"multiInterval",intervals:{"1H":{type:"idle"},"1D":{type:"idle"},"1W":{type:"idle"},"1M":{type:"idle"},YTD:{type:"idle"},ALL:{type:"idle"}},currentlyFetchingInterval:null,sequenceComplete:!1};case"fetchingIntervalStart":return this.state.type!=="multiInterval"?this.state:{...this.state,intervals:{...this.state.intervals,[A.interval]:{type:"loading"}},currentlyFetchingInterval:A.interval};case"fetchingIntervalSuccess":{if(this.state.type!=="multiInterval")return this.state;let j={...this.state.intervals,[A.interval]:{type:"loaded",candleSnapshots:A.candleSnapshots}},t=L7.every(r=>{let o=j[r];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",intervals:j,currentlyFetchingInterval:null,sequenceComplete:t}}case"fetchingIntervalError":{if(this.state.type!=="multiInterval")return this.state;let j={...this.state.intervals,[A.interval]:{type:"error",error:A.error}},t=L7.every(r=>{let o=j[r];return o.type==="loaded"||o.type==="error"});return{type:"multiInterval",intervals:j,currentlyFetchingInterval:null,sequenceComplete:t}}case"sequentialFetchComplete":return this.state.type!=="multiInterval"?this.state:{...this.state,sequenceComplete:!0};default:return this.state}}getState(){return this.state}getNextIntervalToFetch(){if(this.state.type!=="multiInterval")return null;for(let A of L7)if(this.state.intervals[A].type==="idle")return A;return null}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(){this.listeners.forEach(A=>{A.onPricingStateChange(this.state)})}};n();s();var ec=.98,jc=class{constructor(A,j){this.perps=A;this.perpsClient=j}async getSpotBalances(A){let j=M({address:A,chainId:"hypercore:mainnet",resourceType:"address"});return(await this.perpsClient.getSpotBalances({user:j})).balances}async buy(A,j,t){let r=new S(t).dividedBy(ec).decimalPlaces(2);return this.placeBuySellOrder(A,j,!0,r.toString())}async sell(A,j,t){let r=new S(t).multipliedBy(ec).decimalPlaces(2);return this.placeBuySellOrder(A,j,!1,r.toString())}async placeBuySellOrder(A,j,t,r){if(!this.perps.user?.address)throw new Error("User not found");let i=new fj().asset(A).isBuy(t).price(r).size(j).reduceOnly(!1).immediateOrCancel().build(),a=new xt([i]),u=Date.now(),c={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ae,Agent:sj},message:{source:this.perps.isTestnet?"b":"a",connectionId:a.hash(null,u)}},l=await this.perps.exchangeAction(a,c,u),m=l.response.data?.statuses.find(k=>typeof k=="object"&&"error"in k);if(m&&typeof m=="object"&&"error"in m)throw new Error(m.error);let B=l.response.data?.statuses.find(k=>typeof k=="object"&&"filled"in k);if(B&&typeof B=="object"&&"filled"in B)return{totalSz:B.filled.totalSz,avgPx:B.filled.avgPx};throw new Error("No filled status found")}async send(A,j,t,r){let o=`${A}:${j}`,i=Date.now(),a=new Up({hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",token:o,amount:t.toString(),destination:r.toLowerCase(),time:i}),u={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SpotSend",types:{EIP712Domain:ae,"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:a},{splitSignature:c}=await this.perps.sign(u),l=await this.perpsClient.postSpotSend({action:a,nonce:i,signature:c});if(l.status==="err")throw new Error(l.response);return l.response}async getTokenMidPrice(A){let j=await this.perpsClient.getTokenDetails({tokenId:A});return new S(j.midPx)}};var $i=class{client;accountBalanceStateMachine=new Gp;positionsStateMachine=new Mp;pricingStateMachine=new Ac;positionFeesStateMachine=new Zp;signer=void 0;fundingHistoryStateMachine=new Cp;historicalOrdersStateMachine=new Op;openPositionOrchestrator;managePositionOrchestrator;manageMarginOrchestrator;accountChangeListeners=[];account;user;isTestnet;spot;fundingPool;relayFundingTaskFactory;hyperunitFundingTaskFactory;sequentialPricingCoin=null;authRepository;constructor({client:A,isTestnet:j,fundingPool:t,relayFundingTaskFactory:r,hyperunitFundingTaskFactory:o,authRepository:i}){this.client=A,this.isTestnet=j,this.spot=new jc(this,this.client),this.fundingPool=t,this.fundingPool.addListener(this.fundingPoolListener),this.relayFundingTaskFactory=r,this.hyperunitFundingTaskFactory=o,this.openPositionOrchestrator=new Yp(this),this.managePositionOrchestrator=new Xp(this),this.manageMarginOrchestrator=new Kp(this),this.authRepository=i,this.pricingStateMachine.addListener({onPricingStateChange:this.handlePricingStateChange.bind(this)}),this.accountBalanceStateMachine.addListener({onAccountBalanceStateChange:a=>{this.consolidateDexBalances(a)}})}setSigner(A){this.signer=A}createRelayFundingTask(A,j,t,r){return this.relayFundingTaskFactory.createTask(this,A,this.authRepository,j,t,mr(this.signer),mr(this.user),r)}createHyperunitFundingTask(A,j,t,r){return this.hyperunitFundingTaskFactory.createTask(this,A,this.authRepository,j,t,mr(this.signer),mr(this.user),r)}executeFundingTask(A,j,t,r,o){this.fundingPool.submit(A,j,t,r,o)}fundingPoolListener={onFundingPoolStateChange:(A,j)=>{(A.type==="fundingCompleted"||A.type==="fundingStarted")&&(this.syncAccountBalance(),this.syncFundingHistory())}};setAccount(A){this.account=A;let{address:j}=A.addresses?.find(t=>I.isEVMNetworkID(t.networkID))??{addressType:"eip155",networkID:oA.Ethereum.Mainnet};j&&(this.user={resourceType:"address",chainId:this.isTestnet?"hypercore:testnet":I.hypercore.mainnetID,address:j},this.fundingPool.setAccountId(j)),this.accountChangeListeners.forEach(t=>t.onAccountChange(A))}getAccount(){return this.account}getUser(){return this.user}subscribeAccountChange(A){return this.accountChangeListeners.push(A),()=>this.unsubscribeAccountChange(A)}unsubscribeAccountChange(A){this.accountChangeListeners=this.accountChangeListeners.filter(j=>j!==A)}getAccountBalanceState(){return this.accountBalanceStateMachine.getState()}syncAccountBalance(){if(!this.user)return;let A=this.accountBalanceStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceStart"}),this.client.getAccountBalance(this.user).then(j=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceSuccess",accountBalance:j})}).catch(j=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceError",error:j}),b.addBreadcrumb("perps","Error fetching account balance","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribeAccountBalanceState(A){return this.accountBalanceStateMachine.addListener(A),()=>{this.unsubscribeAccountBalanceState(A)}}unsubscribeAccountBalanceState(A){this.accountBalanceStateMachine.removeListener(A)}getPositionFeesState(){return this.positionFeesStateMachine.getState()}syncPositionFees(){if(!this.user)return;let A=this.positionFeesStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.positionFeesStateMachine.send({type:"fetchingPositionFeesStart"}),this.client.getPositionFees(this.user).then(j=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesSuccess",fees:j})}).catch(j=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesError",error:j}),b.addBreadcrumb("perps","Error fetching position fees","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribePositionFees(A){return this.positionFeesStateMachine.addListener(A),()=>{this.unsubscribePositionFees(A)}}unsubscribePositionFees(A){this.positionFeesStateMachine.removeListener(A)}getPositionsState(){return this.positionsStateMachine.getState()}syncPositions(){if(!this.user)return;let A=this.positionsStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.positionsStateMachine.send({type:"fetchingPositionsStart"}),this.client.getPositionsAndOpenOrders(this.user).then(j=>{this.positionsStateMachine.send({type:"fetchingPositionsSuccess",positions:j.positions,openOrders:j.openOrders})}).catch(j=>{this.positionsStateMachine.send({type:"fetchingPositionsError",error:j}),b.addBreadcrumb("perps","Error fetching positions","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribePositions(A){return this.positionsStateMachine.addListener(A),()=>{this.unsubscribePositions(A)}}unsubscribePositions(A){this.positionsStateMachine.removeListener(A)}getFundingHistoryState(){return this.fundingHistoryStateMachine.getState()}syncFundingHistory(){if(!this.user)return;let A=this.fundingHistoryStateMachine.getState();A.type==="loading"||A.type==="refreshing"||(this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryStart"}),this.client.getUserFundingHistory(this.user).then(j=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistorySuccess",history:j})}).catch(j=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryError",error:j}),b.addBreadcrumb("perps","Error fetching funding history","error",{error:j instanceof Error?j.message:"Unknown error"})}))}subscribeFundingHistory(A){return this.fundingHistoryStateMachine.addListener(A),()=>{this.unsubscribeFundingHistory(A)}}unsubscribeFundingHistory(A){this.fundingHistoryStateMachine.removeListener(A)}getHistoricalOrdersState(){return this.historicalOrdersStateMachine.getState()}syncHistoricalOrders(A){if(!this.user)return;let j=this.historicalOrdersStateMachine.getState();j.type==="loading"||j.type==="refreshing"||(this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersStart"}),this.client.getHistoricalOrders(this.user,A).then(t=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersSuccess",historicalOrders:t})}).catch(t=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersError",error:t}),b.addBreadcrumb("perps","Error fetching historical orders","error",{error:t instanceof Error?t.message:"Unknown error",markets:A?.join(",")??"No markets"})}))}subscribeHistoricalOrders(A){return this.historicalOrdersStateMachine.addListener(A),()=>{this.unsubscribeHistoricalOrders(A)}}unsubscribeHistoricalOrders(A){this.historicalOrdersStateMachine.removeListener(A)}getPricingState(){return this.pricingStateMachine.getState()}syncPricing(A,j,t,r){if(!this.user)return;let o;switch(j){case"1m":o="1H";break;case"15m":o="1D";break;case"1h":o="1W";break;case"4h":o="1M";break;case"1d":o="ALL";break;default:o="1D"}this.pricingStateMachine.getState().type!=="multiInterval"&&this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:A}),this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:o,coin:A,apiInterval:j,startTime:t,endTime:r}),this.client.getPriceHistory({coin:A,interval:o,startTime:t,endTime:r,isTestnet:this.isTestnet}).then(a=>{let u=R7(a);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:o,candleSnapshots:u})}).catch(a=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:o,error:a}),b.addBreadcrumb("perps","Error fetching pricing","error",{error:a instanceof Error?a.message:"Unknown error",coin:A,interval:j,startTime:t,endTime:r})})}getTimeFrameDetails(A,j){let t=j,r,o;switch(A){case"1H":r=j-1e3*60*60*1,o="1m";break;case"1D":r=j-1e3*60*60*24,o="30m";break;case"1W":r=j-1e3*60*60*24*7,o="4h";break;case"1M":r=j-1e3*60*60*24*30,o="12h";break;case"YTD":r=new Date(new Date().getFullYear(),0,1).getTime(),o="1d";break;case"ALL":r=j-1e3*60*60*24*365*10,o="1d";break}return{startTime:r,endTime:t,apiInterval:o}}startSequentialPricingSync(A){this.sequentialPricingCoin=A,this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:A}),this.fetchNextInterval()}fetchNextInterval(){let A=this.pricingStateMachine.getNextIntervalToFetch();if(!A||!this.sequentialPricingCoin)return;let j=new Date().getTime(),{startTime:t,endTime:r,apiInterval:o}=this.getTimeFrameDetails(A,j);this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:A,coin:this.sequentialPricingCoin,apiInterval:o,startTime:t,endTime:r}),this.client.getPriceHistory({coin:this.sequentialPricingCoin,interval:o,startTime:t,endTime:r,isTestnet:this.isTestnet}).then(i=>{let a=R7(i);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:A,candleSnapshots:a})}).catch(i=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:A,error:i}),b.addBreadcrumb("perps","Error fetching next pricing interval","error",{error:i instanceof Error?i.message:"Unknown error",coin:this.sequentialPricingCoin,interval:A,apiInterval:o,startTime:t,endTime:new Date(r).toISOString()})})}handlePricingStateChange(A){A.type==="multiInterval"&&!A.currentlyFetchingInterval&&!A.sequenceComplete&&setTimeout(()=>{this.fetchNextInterval()},100)}isConsolidating=!1;async consolidateDexBalances(A){if(A.type!=="accountBalance")return;let j=A.accountBalance.dexs;if(!j||Object.keys(j).length===0||this.isConsolidating)return;let t=!1;for(let o of Object.values(j))if(new S(o.availableBalance).isGreaterThan(.01)){t=!0;break}if(!t||!this.user)return;let r=this.user.address.toLowerCase();this.isConsolidating=!0;try{let o=[];for(let[i,a]of Object.entries(j)){let u=new S(a.availableBalance);if(u.isGreaterThan(.01)){let c=this.sendAsset({destination:r,sourceDex:i,destinationDex:"",token:"USDC",amount:u}).catch(l=>{b.addBreadcrumb("perps","Failed to consolidate from DEX","error",{dexName:i,error:l instanceof Error?l.message:"Unknown error"})});o.push(c)}}o.length>0&&await Promise.all(o)}catch(o){b.addBreadcrumb("perps","Failed to auto-consolidate DEX balances","error",{error:o instanceof Error?o.message:"Unknown error"})}finally{this.isConsolidating=!1}}subscribePricing(A){return this.pricingStateMachine.addListener(A),()=>{this.unsubscribePricing(A)}}unsubscribePricing(A){this.pricingStateMachine.removeListener(A)}async sign(A){let j=mr(this.signer),t=mr(this.account),{signature:r}=await j.sign(t.identifier,{chainType:"eip155",signingType:"typedData",version:4,data:A});return{splitSignature:NS(r)}}async exchangeAction(A,j,t){let r=new Cn,o=mr(this.signer),i=mr(this.account),{signature:a}=await o.sign(i.identifier,{chainType:"eip155",signingType:"typedData",version:4,data:j}),u=NS(a),c=await r.postExchange({action:A,nonce:t,signature:{r:u.r,s:u.s,v:u.v},isTestnet:this.isTestnet});if(c.status==="err")throw new Error(c.response);if(c.status==="ok")return c;throw new Error("Unknown response status")}async transfer(A){let{toPerp:j,amount:t}=A,r=Date.now(),o={type:"usdClassTransfer",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:t.toString(),toPerp:j,nonce:r},i={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdClassTransfer",types:{EIP712Domain:ae,"HyperliquidTransaction:UsdClassTransfer":[{name:"hyperliquidChain",type:"string"},{name:"amount",type:"string"},{name:"toPerp",type:"bool"},{name:"nonce",type:"uint64"}]},message:o},{splitSignature:a}=await this.sign(i),c=await new Cn().postExchange({action:o,nonce:r,signature:a,isTestnet:this.isTestnet});if(c.status==="err")throw new Error(c.response);return c}async sendAsset(A){let{destination:j,sourceDex:t,destinationDex:r,token:o,amount:i,vaultAddress:a}=A,u=Date.now(),c={type:"sendAsset",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",destination:j.toLowerCase(),sourceDex:t,destinationDex:r,token:o,amount:i.toString(),fromSubAccount:a?a.toLowerCase():"",nonce:u},l={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SendAsset",types:{EIP712Domain:ae,"HyperliquidTransaction:SendAsset":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"sourceDex",type:"string"},{name:"destinationDex",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"fromSubAccount",type:"string"},{name:"nonce",type:"uint64"}]},message:c},{splitSignature:m}=await this.sign(l),k=await new Cn().postExchange({action:c,nonce:u,signature:m,isTestnet:this.isTestnet});if(k.status==="err")throw new Error(k.response);return k}openPosition(A){this.openPositionOrchestrator.send({type:"InitiateOpenPosition",payload:A})}resetOpenPosition(){this.openPositionOrchestrator.send({type:"Reset"})}getOpenPositionState(){return this.openPositionOrchestrator.getState()}subscribeOpenPosition(A){return this.openPositionOrchestrator.addListener(A),()=>{this.unsubscribeOpenPosition(A)}}unsubscribeOpenPosition(A){this.openPositionOrchestrator.removeListener(A)}managePosition(A){this.managePositionOrchestrator.send({type:"InitiateManagePosition",payload:A})}resetManagePosition(){this.managePositionOrchestrator.send({type:"Reset"})}getManagePositionState(){return this.managePositionOrchestrator.getState()}subscribeManagePosition(A){return this.managePositionOrchestrator.addListener(A),()=>{this.unsubscribeManagePosition(A)}}unsubscribeManagePosition(A){this.managePositionOrchestrator.removeListener(A)}manageMargin(A){this.manageMarginOrchestrator.send({type:"InitiateManageMargin",payload:A})}resetManageMargin(){this.manageMarginOrchestrator.send({type:"Reset"})}getManageMarginState(){return this.manageMarginOrchestrator.getState()}subscribeManageMargin(A){return this.manageMarginOrchestrator.addListener(A)}};function mr(e,A){if(e==null)throw new Error(A||"Required value is undefined or null");return e}function NS(e){let A=`0x${e.slice(2,66)}`,j=`0x${e.slice(66,130)}`,t=parseInt(e.slice(130,132),16);return{r:A,s:j,v:t}}n();s();var vi=q(P());var LS=()=>{let e=J(),A=(0,vi.useCallback)((o,i)=>{e.capture(o,{data:{...i}}),o==="perpsDepositFailed"&&b.captureError(new Error(`depositFailed: ${i.error}`),"perps"),o==="perpsWithdrawFailed"&&b.captureError(new Error(`withdrawalFailed: ${i.error}`),"perps")},[e]),j=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]),t=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]),r=(0,vi.useCallback)((o,i)=>{A(o,i)},[A]);return{reportDeposit:j,reportWithdraw:t,reportFundingUIState:r}};n();s();var tc=class{onFundingPoolStateChange(A,j,t){switch(A.type){case"fundingFailed":b.addBreadcrumb("perps",`FundingPool: ${j.type} funding failed`,"error",{error:A.error.message,fundingTaskState:j.getState().type});break;case"fundingStarted":case"fundingBridgingStarted":case"fundingCompleted":b.addBreadcrumb("perps",`FundingPool: ${j.type} ${A.type}`,"info");break}}};n();s();var rc=class{onFundingPoolStateChange(A,j,t){switch(j.type){case"deposit":this.onDepositEvent(A,j);break;case"withdraw":this.onWithdrawEvent(A,j);break}}onDepositEvent(A,j){switch(A.type){case"fundingStarted":this.progress(T.t("perpsToastInitiatingFunding"));break;case"fundingBridgingStarted":j.estimatedTime?this.success(T.t("perpsToastFundingInitiated",{time:j.estimatedTime})):this.success(T.t("perpsToastFundingInitiatedNoTime"));break;case"fundingCompleted":this.success(T.t("perpsToastFundsAdded"));break;case"fundingFailed":this.failed(T.t("perpsToastFundingFailed"),A.error.message,T.t("commandOK"),()=>{QA.getState().hideToast()});break}}onWithdrawEvent(A,j){switch(A.type){case"fundingStarted":this.progress(T.t("perpsToastInitiatingWithdrawal"));break;case"fundingBridgingStarted":this.success(T.t("perpsToastWithdrawalInitiated",{time:A.estimateTime}));break;case"fundingCompleted":this.success(T.t("perpsToastWithdrawalComplete"));break;case"fundingFailed":this.failed(T.t("perpsToastWithdrawalFailed"),A.error.message,T.t("commandOK"),()=>{QA.getState().hideToast()});break}}success(A){setTimeout(()=>{QA.getState().success({message:A,onPress:()=>{QA.getState().hideToast()}})},100)}failed(A,j,t,r){setTimeout(()=>{QA.getState().failed({title:A,message:j,buttonText:t,onPress:r})},100)}progress(A){setTimeout(()=>{QA.getState().progress({message:A,onPress:()=>{QA.getState().hideToast()}})},100)}};n();s();var KS="failedFundingEvents";var qi=class{storage;listeners=[];storageKey;accountId;constructor(A,j){this.storage=A,this.accountId=j,this.storageKey=this.generateStorageKey()}async setAccountId(A){if(this.accountId===A)return;this.accountId=A,this.storageKey=this.generateStorageKey();let j=await this.getEvents();this.notifyListeners(j)}generateStorageKey(){return this.accountId?`${KS}_${this.accountId}`:KS}async addEvent(A){let j=await this.getEvents(),t={id:`${A.type}_${A.startedAt}_${A.amountUsd}`,type:A.type,amountUsd:A.amountUsd||"0",timestamp:Date.now(),startedAt:A.startedAt,errorMessage:A.getState().type==="failed"?A.getState().error?.message:void 0};j.some(o=>o.id===t.id)||(j.unshift(t),j.length>25&&j.splice(25),await this.storage.set(this.storageKey,j),this.notifyListeners(j))}async getEvents(){let A=await this.storage.get(this.storageKey);return Array.isArray(A)?A:[]}async clear(){await this.storage.remove(this.storageKey),this.notifyListeners([])}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(A){for(let j of this.listeners)j.onFailedEventsChange(A)}};n();s();var xi=class{activeTasks=new Set;listeners=new Set;failedEventsCache;constructor(A){this.failedEventsCache=A}setFailedEventsCache(A){this.failedEventsCache=A}async setAccountId(A){await this.failedEventsCache?.setAccountId(A)}submit(A,j,t,r,o){A.addListener(this.taskListener),this.activeTasks.add(A),A.execute(j,t,r,o)}getActiveTasks(){return Array.from(this.activeTasks)}getFailedEventsCache(){return this.failedEventsCache}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}pauseTasks(){this.activeTasks.forEach(A=>A.pause())}resumeTasks(){this.activeTasks.forEach(A=>A.resume())}taskListener={onFundingTaskStateChange:(A,j,t)=>{switch(j.type){case"fundingStarted":break;case"fundingCompleted":this.activeTasks.delete(A),A.removeListener(this.taskListener);break;case"fundingFailed":A.removeListener(this.taskListener),this.failedEventsCache?.addEvent(A);break}this.listeners.forEach(r=>r.onFundingPoolStateChange(j,A,this.getActiveTasks()))}}};n();s();n();s();n();s();n();s();var jM="perps_deposit_step";var oc=class{storage;listeners=[];userAddress=null;constructor(A){this.storage=A}setUserAddress(A){this.userAddress=A}getKey(){if(!this.userAddress)throw new Error("User address not set");return`${jM}_${this.userAddress}`}set(A,j){(async()=>{let t={step:A,startedAt:j||Date.now()};await this.storage.set(this.getKey(),t),this.notifyListeners(t)})()}clear(){(async()=>(await this.storage.remove(this.getKey()),this.notifyListeners(null)))()}async get(){if(!this.userAddress)return null;let A=await this.storage.get(this.getKey());if(!A)return null;let j=A;return Date.now()-j.startedAt>12e5?(this.clear(),null):j}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}notifyListeners(A){for(let j of this.listeners)j.onDepositStepChange(A)}};n();s();function US(e){return e.type==="idle"?"idle":e.type==="streamOperations"?`${e.sourceTxHash}:${e.depositAddress}`:`${e.type}:${e.depositAddress}`}var K7=null;function tM(e){return K7||(K7=new oc(e)),K7}var nc=class{constructor(A,j,t){this.perps=A;this.cache=tM(j),this.perps.user&&this.cache.setUserAddress(M(this.perps.user)),this.analytics=t}cache;analytics;async getStuckDeposit(){this.perps.user&&this.cache.setUserAddress(M(this.perps.user));let A=await this.cache.get();return A?.step.type==="transfer"?(this.cache.clear(),null):A}async retry(A){if(A.type!=="streamOperations"){this.cache.clear();return}let j=US(A);try{let t=await this.pollForOperationCompletion(A);if(!t.destinationAmount)throw this.cache.clear(),new Error("Operation has no destination amount");let{destinationAmount:r}=t,o=await this.perps.spot.getTokenMidPrice(A.spotTokenId),{totalSz:i,avgPx:a}=await this.sellSpotAsset(new S(r),A.assetId,o,A.tokenDecimals,j);await this.transferToPerps(i,a,j),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.cache.clear()}catch{this.cache.clear();return}}async pollForOperationCompletion(A){let r=!1;for(let o=0;o<15;o++){let i=await this.perps.client.getOperations({taker:M(this.perps.user)}),a=`${A.sourceTxHash}:${A.depositAddress}`,u=i.operations.find(c=>c.sourceTxHash===a);if(u){if(r=!0,u.state==="failure")throw new Error("Operation failed");if(u.state==="done")return u}o<14&&await new Promise(c=>setTimeout(c,5e3))}throw r?new Error("Operation not done after maximum attempts"):new Error("Operation not found")}async sellSpotAsset(A,j,t,r,o){let i=A.shiftedBy(-r).decimalPlaces(3,S.ROUND_DOWN),a=await this.perps.spot.sell(j,i.toString(),t);return this.analytics.reportDeposit("perpsHyperunitDepositSellSpotCompleted",{depositId:o,assetId:j,assetLimitPriceUsd:t,tokenDecimals:r,adjustedDepositedAmount:i}),{totalSz:new S(a.totalSz),avgPx:new S(a.avgPx)}}async transferToPerps(A,j,t){let r=A.multipliedBy(j).decimalPlaces(2,S.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:r}),this.analytics.reportDeposit("perpsHyperunitDepositTransferToPerpCompleted",{depositId:t,totalSz:A,avgPx:j,transferUsdcAmount:r}),r}};n();s();var it=class{startedAt;type;minimumUiAmount;amount;amountUsd;estimatedTime;fee;withdrawAddress;withdrawAddressRole;state={type:"indeterminate"};listeners=new Set;constructor(A,j,t,r,o,i){this.startedAt=Date.now(),this.type=A,this.minimumUiAmount=j,this.estimatedTime=t,this.fee=r,this.withdrawAddress=o,this.withdrawAddressRole=i}getState(){return this.state}addListener(A){this.listeners.add(A)}removeListener(A){this.listeners.delete(A)}notify(A,j){this.listeners.forEach(t=>t.onFundingTaskStateChange(this,A,j))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};n();s();var sc=class{step={type:"idle"};listeners=[];setStep(A){this.step=A}completeStep(A){let j=this.step,t=this.detectNextStep(A);if(!t){this.listeners.forEach(r=>r.onStepCompleted(this.step,void 0)),this.listeners.forEach(r=>r.onDepositCompleted());return}this.step=t,this.listeners.forEach(r=>r.onStepCompleted(j,t))}detectNextStep(A){switch(A.stepType){case"idle":return{type:"transfer",depositAddress:A.depositAddress,depositAmount:A.amount};case"transfer":if(this.step.type!=="transfer")throw new Error("Invalid step: expected transfer, got "+this.step.type);return{...this.step,type:"streamOperations",senderAddress:A.senderAddress,networkId:A.networkId,tokenDecimals:A.tokenDecimals,sourceTxHash:A.txHash,assetId:A.assetId,spotTokenId:A.spotTokenId,assetLimitPriceUsd:A.assetLimitPriceUsd};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return{...this.step,type:"sellSpotAsset",destinationAmount:A.destinationAmount};case"sellSpotAsset":if(this.step.type!=="sellSpotAsset")throw new Error("Invalid step: expected sellSpotAsset, got "+this.step.type);return{...this.step,type:"transferToPerps",totalSz:A.totalSz,avgPx:A.avgPx};case"transferToPerps":if(this.step.type!=="transferToPerps")throw new Error("Invalid step: expected transferToPerps, got "+this.step.type);return}}failStep(A){this.listeners.forEach(j=>j.onDepositFailed(this.step,A))}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}getStep(){return this.step}};n();s();var U7=class{constructor(A,j,t){this.sourceAddress=A;this.networkId=j;this.account=t}async execute(A,j,t,r){let o=Dt(this.networkId),i=new Qm.Transaction().add(kA.SystemProgram.transfer({fromPubkey:new kA.PublicKey(this.sourceAddress),toPubkey:new kA.PublicKey(j),lamports:A.toNumber()}));i=await wo(i,{connection:o}),i.feePayer=new kA.PublicKey(this.sourceAddress),await Km(i,o);let a=await Io({accountIdentifier:this.account.identifier,feePayer:new kA.PublicKey(this.sourceAddress),connection:o,accountSigner:r,transaction:i,pendingTransactionInput:{ownerAddress:this.sourceAddress,networkID:this.networkId,data:{signature:""},type:"dappInteraction",display:{summary:{topLeft:{text:"Deposit"}}}},storage:t});return await Hj({connection:o,signature:a}),{senderAddress:this.sourceAddress,networkId:this.networkId,tokenDecimals:9,txHash:a}}},ic=class{create(A,j){let t=A.chainId,r=j.addresses.find(o=>o.networkID===t)?.address;if(!r)throw new Error(`No source address found for networkID: ${t}`);if(I.isSolanaNetworkID(t))return new U7(r,t,j);throw new Error(`Unsupported chain for deposit transfer: ${t}`)}};n();s();function H7(e){switch(e.type){case"transfer":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString()};case"streamOperations":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash};case"sellSpotAsset":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash,destinationAmount:e.destinationAmount.toString()};case"transferToPerps":return{depositAddress:e.depositAddress,amount:e.depositAmount.toString(),networkId:e.networkId,sourceTxHash:e.sourceTxHash,destinationAmount:e.destinationAmount.toString(),totalSz:e.totalSz.toString(),avgPx:e.avgPx.toString()};default:return{step:e.type}}}var Q7=e=>{switch(e.type){case"perpsToSpot":case"buyAsset":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString()};case"sendToWithdrawAddress":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString(),assetMidPrice:e.assetMidPrice.toString(),filledAmount:e.filledAmount.toString()};case"streamOperations":return{assetId:e.assetId.toString(),withdrawAddress:e.withdrawAddress,withdrawAmountUsd:e.withdrawAmountUsd.toString(),sendToWithdrawAmount:e.sendToWithdrawAmount.toString(),operationStartTime:e.operationStartTime.toISOString()};default:return{step:e.type}}};n();s();var Dn=class{constructor(A){this.perpsClient=A}streamOpen=!1;listeners=[];interval=2e3;startStream(A,j,t){this.streamOpen=!0,this.stream(M(A),j,t)}startWithdrawStream(A,j,t){this.streamOpen=!0,this.streamWithdraw(M(A),j,t)}stream(A,j,t){this.streamOpen&&(async()=>{try{let r=await this.perpsClient.getOperations({taker:A}),o=`${j}:${t}`,i=r.operations.find(a=>a.sourceTxHash===o);this.listeners.forEach(a=>{a.onOperation(r,i)}),this.streamOpen&&setTimeout(()=>this.stream(A,j,t),this.interval)}catch(r){this.listeners.forEach(o=>{o.onError(r)}),this.stopStream()}})()}streamWithdraw(A,j,t){this.streamOpen&&(async()=>{try{let r=await this.perpsClient.getOperations({taker:A}),o=this.findMatchingWithdrawOperation(r.operations,j,t);this.listeners.forEach(i=>{i.onOperation(r,o)}),this.streamOpen&&setTimeout(()=>this.streamWithdraw(A,j,t),this.interval)}catch(r){this.listeners.forEach(o=>{o.onError(r)}),this.stopStream()}})()}findMatchingWithdrawOperation(A,j,t){let r=A.filter(o=>{if(o.sourceChain!=="hyperliquid"||o.destinationChain!=="solana"||!o.opCreatedAt)return!1;let i=new Date(o.opCreatedAt).getTime(),a=Math.abs(i-j.getTime()),u=4*60*1e3;if(a>u)return!1;if(o.sourceAmount){let c=new S(o.sourceAmount).dividedBy(10**tr.data.decimals),l=t,m=c.minus(l).abs(),B=l.multipliedBy(.1);if(m.isGreaterThan(B))return!1}return!0});if(r.length!==0)return r.sort((o,i)=>new Date(i.opCreatedAt).getTime()-new Date(o.opCreatedAt).getTime())[0]}stopStream(){this.streamOpen=!1}subscribe(A){return this.listeners.push(A),()=>this.unsubscribe(A)}unsubscribe(A){this.listeners=this.listeners.filter(j=>j!==A)}};var ac=class e extends it{constructor(j,t,r,o,i,a,u,c,l,m,B,k,f){super("deposit",j,t,r);this.perps=o;this.assetId=i;this.spotTokenId=a;this.depositTokenCaip19=u;this.account=c;this.depositAddress=l;this.storage=m;this.signer=B;this.analytics=k,this.stateMachine.addListener(this.stateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new Dn(this.perps.client),this.depositRecoverer=new nc(this.perps,this.storage,this.analytics),this.perps.user&&this.depositRecoverer.cache.setUserAddress(M(this.perps.user)),this.depositId=f||kj(),this.reportAnalytics("perpsDepositInitialized",{})}stateMachine=new sc;depositTransferFactory=new ic;operationsStreamer;depositRecoverer;fundingState="active";analytics;depositId;reportAnalytics(j,t){let r={fundingType:"deposit",fundingRoute:"hyperunit",amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,assetId:this.assetId,spotTokenId:this.spotTokenId,depositTokenCaip19:M(this.depositTokenCaip19),depositAddress:this.depositAddress,depositId:this.depositId};this.analytics.reportDeposit(j,{...r,...t})}stateMachineListener={onStepCompleted:(j,t)=>{this.fundingState!=="paused"&&(j.type==="transfer"&&this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),t&&(this.depositRecoverer.cache.set(t,this.startedAt),this.executeStep(t)))},onDepositCompleted:()=>{this.depositRecoverer.cache.clear(),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics("perpsDepositCompleted",{})},onDepositFailed:(j,t)=>{console.error(`Deposit failed at step: ${j.type}`,t),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"failed",error:t},this.notify({type:"fundingFailed",error:t},this.state),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(t)})}};stateLogsListener={onStepCompleted:(j,t)=>{b.addBreadcrumb("perps",`Deposit step completed: ${j.type}`,"info",{...H7(j),amountUsd:this.amountUsd??""})},onDepositCompleted:()=>{this.stateMachine.removeListener(this.stateLogsListener)},onDepositFailed:(j,t)=>{b.addBreadcrumb("perps",`Deposit failed at step: ${j.type}`,"error",{error:t instanceof Error?t.message:"Unknown error",...H7(j),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)}};execute(j,t,r,o){if(this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),o){this.stateMachine.setStep(o.state),this.stateMachine.completeStep(o.completedStep);return}this.stateMachine.completeStep({stepType:"idle",depositAddress:this.depositAddress,amount:j})}pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics("perpsDepositPaused",{})}resume(){this.fundingState="active";let j=this.stateMachine.getStep();j.type==="streamOperations"&&((async()=>{try{if(!this.perps.user)return;let t=await this.perps.client.getOperations({taker:M(this.perps.user)}),r=`${j.sourceTxHash}:${j.depositAddress}`,o=t.operations.find(i=>i.sourceTxHash===r);o&&o.state==="done"?this.processOperation(o):this.executeStep(j)}catch{this.executeStep(j)}})(),this.reportAnalytics("perpsDepositResumed",{}))}executeStep(j){(async()=>{try{switch(j.type){case"transfer":this.reportAnalytics("perpsHyperunitDepositTransferStarted",{...j});let{senderAddress:t,networkId:r,tokenDecimals:o,txHash:i}=await this.transfer(j.depositAmount),a=await this.perps.spot.getTokenMidPrice(this.spotTokenId);this.stateMachine.completeStep({stepType:"transfer",senderAddress:t,networkId:r,tokenDecimals:o,txHash:i,assetId:this.assetId,spotTokenId:this.spotTokenId,assetLimitPriceUsd:a}),this.reportAnalytics("perpsHyperunitDepositTransferCompleted",{...j,senderAddress:t,networkId:r,tokenDecimals:o,txHash:i,assetLimitPriceUsd:a});break;case"streamOperations":this.reportAnalytics("perpsHyperunitDepositStreamOperationsStarted",{...j}),this.startOperationsStream(j.sourceTxHash,j.depositAddress),this.reportAnalytics("perpsHyperunitDepositStreamOperationsCompleted",{...j});break;case"sellSpotAsset":this.reportAnalytics("perpsHyperunitDepositSellSpotStarted",{...j});let u=await this.sellSpotAsset(j.depositAmount,j.tokenDecimals);this.stateMachine.completeStep({stepType:"sellSpotAsset",...u}),this.reportAnalytics("perpsHyperunitDepositSellSpotCompleted",{...j,...u});break;case"transferToPerps":this.reportAnalytics("perpsHyperunitDepositTransferToPerpStarted",{...j});let c=await this.transferToPerps(j.totalSz,j.avgPx);this.stateMachine.completeStep({stepType:"transferToPerps",transferUsdcAmount:c}),this.reportAnalytics("perpsHyperunitDepositTransferToPerpCompleted",{...j,transferUsdcAmount:c});break}}catch(t){this.stateMachine.failStep(t)}})()}async transfer(j){return await this.depositTransferFactory.create(this.depositTokenCaip19,this.account).execute(j,this.depositAddress,this.storage,this.signer)}startOperationsStream(j,t){if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startStream(this.perps.user,j,t)}operationsStreamListener={onOperation:(j,t)=>{t&&this.processOperation(t)},onError:j=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(j)}};processOperation(j){if(j.state==="failure"){this.stateMachine.failStep(new Error("Operation failed"));return}if(j.state==="done"){if(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),!j.destinationAmount)throw new Error("Destination amount is required");this.stateMachine.completeStep({stepType:"streamOperations",destinationAmount:new S(j.destinationAmount)})}}async sellSpotAsset(j,t){let r=j.shiftedBy(-t).decimalPlaces(3,S.ROUND_DOWN),o=await this.perps.spot.getTokenMidPrice(this.spotTokenId),i=await this.perps.spot.sell(this.assetId,r.toString(),o);return{totalSz:new S(i.totalSz),avgPx:new S(i.avgPx)}}async transferToPerps(j,t){let r=j.multipliedBy(t).decimalPlaces(2,S.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:r}),r}static create({minimumUiAmount:j,estimatedTime:t,fee:r,perps:o,assetId:i,spotTokenId:a,depositTokenCaip19:u,account:c,depositAddress:l,storage:m,signer:B,analytics:k,depositId:f}){return new e(j,t,r,o,i,a,u,c,l,m,B,k,f)}};n();s();n();s();var QS={1:7e-4,2:6e-4,3:5e-4,4:4e-4,5:35e-5,6:3e-4,7:.0025,8:.002};n();s();var pc=class{step;constructor(A){A?this.step=A:this.step={type:"idle"}}setStep(A){this.step=A}listeners=[];completeStep(A){let j=this.step,t=this.detectNextStep(A);if(!t){this.listeners.forEach(r=>r.onStepCompleted(this.step,void 0)),this.listeners.forEach(r=>r.onWithdrawCompleted());return}this.step=t,this.listeners.forEach(r=>r.onStepCompleted(j,t))}failStep(A){this.listeners.forEach(j=>j.onWithdrawFailed(this.step,A))}detectNextStep(A){switch(A.stepType){case"idle":return{type:"perpsToSpot",withdrawAddress:A.withdrawAddress,assetId:A.assetId,estimatedTime:A.estimatedTime,withdrawAmountUsd:A.withdrawAmountUsd};case"perpsToSpot":if(this.step.type!=="perpsToSpot")throw new Error("Invalid step: expected perpsToSpot, got "+this.step.type);return{...this.step,type:"buyAsset"};case"buyAsset":if(this.step.type!=="buyAsset")throw new Error("Invalid step: expected buyAsset, got "+this.step.type);return{...this.step,type:"sendToWithdrawAddress",assetMidPrice:A.assetMidPrice,filledAmount:A.filledAmount};case"sendToWithdrawAddress":if(this.step.type!=="sendToWithdrawAddress")throw new Error("Invalid step: expected sendToWithdrawAddress, got "+this.step.type);return{...this.step,type:"streamOperations",sendToWithdrawAmount:A.sendToWithdrawAmount,operationStartTime:new Date};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return}}addListener(A){this.listeners.push(A)}removeListener(A){this.listeners=this.listeners.filter(j=>j!==A)}getStep(){return this.step}};var cc=class extends it{constructor(j,t,r,o,i,a,u,c,l,m){super("withdraw",u,c,l);this.withdrawAddress=j;this.withdrawAddressRole=t;this.assetId=r;this.spotTokenName=o;this.spotTokenId=i;this.perps=a;this.analytics=m,this.stateMachine.addListener(this.withdrawStateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new Dn(this.perps.client),this.reportAnalytics("perpsWithdrawInitialized",{})}stateMachine=new pc;analytics;operationsStreamer;fundingState="active";reportAnalytics(j,t){let r={fundingType:"withdraw",amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole,assetId:this.assetId,spotTokenName:this.spotTokenName,spotTokenId:this.spotTokenId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(j,{...r,...t})}withdrawStateMachineListener={onStepCompleted:(j,t)=>{this.fundingState!=="paused"&&(j.type==="sendToWithdrawAddress"&&this.notify({type:"fundingBridgingStarted",estimateTime:"4"},this.state),t&&this.executeStep(t))},onWithdrawCompleted:()=>{this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics("perpsWithdrawCompleted",{})},onWithdrawFailed:(j,t)=>{console.error(`Withdraw failed at step: ${j.type}`,t),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"failed",error:t},this.notify({type:"fundingFailed",error:t},this.state),this.reportAnalytics("perpsWithdrawFailed",{error:JSON.stringify(t)})}};stateLogsListener={onStepCompleted:(j,t)=>{b.addBreadcrumb("perps",`Withdraw step completed: ${j.type}`,"info",{...Q7(j),amountUsd:this.amountUsd??""})},onWithdrawCompleted:()=>{this.stateMachine.removeListener(this.stateLogsListener)},onWithdrawFailed:(j,t)=>{b.addBreadcrumb("perps",`Withdraw failed at step: ${j.type}`,"error",{error:t instanceof Error?t.message:"Unknown error",...Q7(j),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)}};pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics("perpsWithdrawPaused",{})}resume(){this.fundingState="active";let j=this.stateMachine.getStep();j.type==="streamOperations"&&(this.perps.user&&this.executeStep(j),this.reportAnalytics("perpsWithdrawResumed",{}))}execute(j,t,r,o){if(this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),o){this.stateMachine.setStep(o.state),this.stateMachine.completeStep(o.completedStep);return}this.stateMachine.completeStep({stepType:"idle",withdrawAddress:this.withdrawAddress,assetId:this.assetId,estimatedTime:this.estimatedTime??"",withdrawAmountUsd:j})}executeStep(j){(async()=>{try{switch(j.type){case"perpsToSpot":this.reportAnalytics("perpsHyperunitWithdrawPerpsToSpotStarted",j),await this.transferToSpot(j.withdrawAmountUsd),this.reportAnalytics("perpsHyperunitWithdrawPerpsToSpotCompleted",j);break;case"buyAsset":this.reportAnalytics("perpsHyperunitWithdrawBuyAssetStarted",j),await this.buyAsset(j.assetId,j.withdrawAmountUsd),this.reportAnalytics("perpsHyperunitWithdrawBuyAssetCompleted",j);break;case"sendToWithdrawAddress":this.reportAnalytics("perpsHyperunitWithdrawSendToWithdrawAddressStarted",j),await this.sendToWithdrawAddress(this.spotTokenName,this.spotTokenId,j.filledAmount),this.reportAnalytics("perpsHyperunitWithdrawSendToWithdrawAddressCompleted",j);break;case"streamOperations":this.reportAnalytics("perpsHyperunitWithdrawStreamOperationsStarted",j),this.startOperationsStream(j),this.reportAnalytics("perpsHyperunitWithdrawStreamOperationsCompleted",j);break}}catch(t){this.stateMachine.failStep(t)}})()}async transferToSpot(j){let t=this.withdrawAddressRole==="missing"?new S(1):new S(0);await this.perps.transfer({toPerp:!1,amount:j.minus(t)}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.stateMachine.completeStep({stepType:"perpsToSpot"})}async buyAsset(j,t){let r=await this.perps.spot.getTokenMidPrice(this.spotTokenId),o=t.dividedBy(r.multipliedBy(ec)).decimalPlaces(3),i=await this.perps.spot.buy(j,o.toString(),r),a=QS[1];this.stateMachine.completeStep({stepType:"buyAsset",assetMidPrice:r,filledAmount:new S(i.totalSz).multipliedBy(1-a)})}async sendToWithdrawAddress(j,t,r){let o=this.fee.dividedBy(10**tr.data.decimals),i=r.minus(o).decimalPlaces(3,S.ROUND_DOWN);await this.perps.spot.send(j,t,i,this.withdrawAddress),this.stateMachine.completeStep({stepType:"sendToWithdrawAddress",sendToWithdrawAmount:i})}startOperationsStream(j){if(j.type!=="streamOperations")throw new Error("Invalid step type for operations stream");if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startWithdrawStream(this.perps.user,j.operationStartTime,j.sendToWithdrawAmount)}operationsStreamListener={onOperation:(j,t)=>{t&&this.processOperation(t)},onError:j=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(j)}};processOperation(j){if(j.state==="failure"){this.stateMachine.failStep(new Error("Withdrawal operation failed"));return}j.state==="done"&&(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),this.stateMachine.completeStep({stepType:"streamOperations"}))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var Nn=class{analytics;constructor(A){this.analytics=A}async createTask(A,j,t,r,o,i,a,u){switch(u.type){case"deposit":return this.createDepositTask(A,j,u.depositTokenCaip19,a,o,i,u.depositId);case"withdraw":return this.createWithdrawTask(A,u.withdrawNetworkId,j)}}async createDepositTask(A,j,t,r,o,i,a){let{fundingCaip19Address:u,spotAssetId:c,eta:l,minimumAmount:m,spotTokenId:B,fee:k}=await A.client.postFunding({type:"deposit",taker:M(r),originChain:t.chainId}),f=this.checkCaip19Address(u);return ac.create({minimumUiAmount:new S(m),estimatedTime:l,fee:new S(k),perps:A,assetId:c,spotTokenId:B,depositTokenCaip19:t,account:j,depositAddress:f,storage:o,signer:i,analytics:this.analytics,depositId:a})}async createWithdrawTask(A,j,t){let r=t.addresses.find(f=>f.networkID===j);if(!r)throw new Error("Couldn't find destination account address for network: "+j);let{fundingCaip19Address:o,spotAssetId:i,eta:a,minimumAmount:u,spotTokenName:c,spotTokenId:l,fee:m}=await A.client.postFunding({type:"withdraw",taker:M({resourceType:"address",chainId:r.networkID,address:r.address}),originChain:j}),B=this.checkCaip19Address(o),k=await A.client.getUserRole(B);return new cc(B,k.role,i,c,l,A,new S(u),a,new S(m),this.analytics)}checkCaip19Address(A){let j=TA(A);if(j.resourceType!=="address")throw new Error("Funding CAIP19 is not an address");return j.address}};n();s();var V7=class extends it{constructor(j,t=!1){super(j,new S(.01),"1m",new S(8471530));this.shouldFail=t}execute(j,t,r){this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),setTimeout(()=>{if(this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.shouldFail){setTimeout(()=>{this.state={type:"failed",error:new Error("Mock funding task failed")},this.notify({type:"fundingFailed",error:new Error("Mock funding task failed")},this.state)},3e3);return}setTimeout(()=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state)},3e3)},3e3)}pause(){}resume(){}},Ti=class{createTask(A,j,t,r,o,i,a,u){return Promise.resolve(new V7(u.type,!1))}};n();s();n();s();n();s();n();s();var Pi=class{account;authRepository;cashAccount;signer;solanaConnection;storage;constructor(A){this.account=A.account,this.authRepository=A.authRepository,this.cashAccount=A.cashAccount,this.signer=A.signer,this.solanaConnection=A.solanaConnection,this.storage=A.storage}getSolanaAddress(){let A=this.account.addresses.find(j=>j.addressType==="solana");if(!A)throw new Error("No Solana address found for account");return A.address}isCash(A){return A?.resourceType!=="address"||!this.cashAccount?!1:this.cashAccount.addressDetails.address===A.address}getTakerAddress(A){return A?.resourceType==="address"&&this.isCash(A)?A.address:this.getSolanaAddress()}getEvmAddress(){let A=this.account.addresses.find(j=>j.addressType==="eip155");if(!A)throw new Error("No EVM address found for account");return A.address}async fetchQuotes(A){let j=this.getTakerAddress(A.fromTokenOwner),t=this.getEvmAddress(),r=this.isCash(A.fromTokenOwner),o={sellToken:A.fromToken,buyToken:A.toToken,taker:{chainId:A.fromChain,address:j,resourceType:"address"},takerDestination:{chainId:A.toChain,address:t.toLowerCase(),resourceType:"address"},sellAmount:A.amount.toString(),slippageTolerance:(A.slippageBps??100)/100,phantomCashAccount:r};b.addBreadcrumb("perps","Fetching Relay quotes","info",{sellAmount:o.sellAmount,sellToken:M(o.sellToken),buyToken:M(o.buyToken),fromChain:o.sellToken.chainId,toChain:o.buyToken.chainId});try{let i=await N.api().retry(1,WA(1e3,1e3)).post("/swap/v2/quotes",o);if(i.status!==200)throw new Error(`Failed to fetch quotes: ${i.status}`);let a=i.data;return b.addBreadcrumb("perps","Relay quotes fetched","info",{quotesCount:a.quotes.length,firstQuoteBuyAmount:a.quotes[0]?.buyAmount}),a.quotes}catch(i){throw b.addBreadcrumb("perps","Failed to fetch Relay quotes","error",{error:i instanceof Error?i.message:"Unknown error"}),i}}async executeSwap(A,j,t="solana:101"){let r=this.getTakerAddress(j),o=this.isCash(j),i=await rM(r,A,this.solanaConnection);try{b.addBreadcrumb("perps","Executing Relay swap","info",{buyAmount:A.buyAmount,sellAmount:A.sellAmount});let a=kj(),u=await this.authRepository?.getUser();if(!u)throw new Error("User not found for swap");let{accessToken:c,userID:l}=u,m;return o?m=await xs({unsignedTransaction:Lm(i),vaultProxy:this.signer,accountIdentifier:this.account.identifier,signerAddress:r,idempotencyKey:a,isCash:!0,accessToken:c,userID:l,skipActivityRecording:!1,swapInfo:void 0,waitForActivityState:"completed"}):(m=await Io({accountIdentifier:this.account.identifier,accountSigner:this.signer,transaction:i,feePayer:new kA.PublicKey(r),connection:this.solanaConnection,storage:this.storage,pendingTransactionInput:{ownerAddress:r,networkID:t,data:{signature:""},type:"dappInteraction",display:{summary:{topLeft:{text:"Deposit"}}}}}),await Hj({connection:this.solanaConnection,signature:m})),b.addBreadcrumb("perps","Relay swap transaction sent","info",{signature:m}),m}catch(a){throw b.addBreadcrumb("perps","Failed to send Relay swap transaction","error",{error:a instanceof Error?a.message:"Unknown error"}),a}}};async function rM(e,A,j){let t=pe(A.steps[0]?.transactionData,"bs58");t=await wo(t,{connection:j});let r=new kA.PublicKey(e);return await co(t,j),Um(t,r),t}n();s();var oM=p.object({status:p.enum(["waiting","success","failure","refund","delayed","pending"]),requestId:p.string().optional()}),Gi=class{pollInterval=null;listeners=new Set;POLL_INTERVAL_MS=1e3;MAX_POLL_ATTEMPTS=45;pollAttempts=0;subscribe(A){this.listeners.add(A)}unsubscribe(A){this.listeners.delete(A)}startPolling(A){this.pollAttempts=0,this.poll(A)}stopPolling(){this.pollInterval&&(clearTimeout(this.pollInterval),this.pollInterval=null)}async poll(A){this.pollAttempts++;try{let j=await this.fetchBridgeStatus(A);if(this.listeners.forEach(t=>t.onStatusUpdate(j)),j.status==="success"){b.addBreadcrumb("perps",`Relay bridge completed for request: ${A}`,"info",{requestId:A}),this.listeners.forEach(t=>t.onCompleted(j)),this.stopPolling();return}if(j.status==="failure"||j.status==="refund"){let t=new Error(`Relay bridge failed with status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge failed","error",{requestId:A,status:j.status}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}if(j.status!=="waiting"&&j.status!=="pending"&&j.status!=="delayed"){let t=new Error(`Unexpected Relay bridge status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge unexpected status","error",{requestId:A,status:j.status}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}if(this.pollAttempts>=this.MAX_POLL_ATTEMPTS){let t=new Error(`Relay bridge status polling timed out with status: ${j.status} for request: ${A}`);b.addBreadcrumb("perps","Relay bridge polling timeout","error",{requestId:A,finalStatus:j.status,attempts:this.pollAttempts}),this.listeners.forEach(r=>r.onError(t)),this.stopPolling();return}this.pollInterval=setTimeout(()=>{this.poll(A)},this.POLL_INTERVAL_MS)}catch(j){b.addBreadcrumb("perps",`Error polling Relay bridge status for request: ${A}`,"error",{error:j instanceof Error?j.message:"Unknown error",requestId:A,attempts:this.pollAttempts}),this.listeners.forEach(t=>t.onError(j)),this.stopPolling()}}async fetchBridgeStatus(A){let j=await N.api().retry(1,WA(1e3,1e3)).get("/swap/v2/spot/get-intents-status",{params:{requestId:A}});if(!eA(j))throw new Error("Failed to get bridge status: response is not okay");let t=j.data,r=oM.safeParse(t);if(!r.success)throw new Error("Failed to get bridge status: schema validation failed");return r.data}};var VS=250,nM=.05,uc=class e extends it{constructor(j,t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y){super("deposit",j,"",t);this.perps=r;this.account=o;this.authRepository=i;this.cashAccount=a;this.signer=u;this.storage=c;this.fromToken=l;this.fromTokenOwner=m;this.fromTokenDecimals=B;this.toToken=k;this.toTokenDecimals=f;this.fromChain=g;this.toChain=E;this.analytics=h,this.depositId=y||kj(),this.connection=Dt("solana:101"),this.relayBridge=new Pi({account:o,authRepository:i,cashAccount:a,signer:u,solanaConnection:this.connection,storage:c}),this.statusPoller=new Gi,this.reportAnalytics("perpsDepositInitialized",{})}relayBridge;connection;bridgeListeners=new Set;quote;isFetchingQuote=!1;statusPoller;analytics;depositId;reportAnalytics(j,t){let r={fundingType:"deposit",fundingRoute:"relay",amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,fromToken:M(this.fromToken),toToken:M(this.toToken),fromChain:this.fromChain,toChain:this.toChain,depositId:this.depositId};this.analytics.reportDeposit(j,{...r,...t})}addBridgeListener(j){this.bridgeListeners.add(j)}removeBridgeListener(j){this.bridgeListeners.delete(j)}notifyBridgeListeners(j,...t){this.bridgeListeners.forEach(r=>{let o=r[j];typeof o=="function"&&o.call(r,...t)})}async fetchQuote(j,t){this.isFetchingQuote=!0;try{let r=j.shiftedBy(this.fromTokenDecimals),o=await this.relayBridge.fetchQuotes({amount:r.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:VS});return o.length===0?(this.isFetchingQuote=!1,null):(this.quote=o[0],this.fee=new S(this.quote.steps[0]?.feeCosts?.[0]?.value??nM),b.addBreadcrumb("perps","Relay quote fetched","info",{inputAmount:j.toString(),tokenPrice:t.toString(),inputUsd:j.toString(),outputUsd:j.toString(),feeUsd:this.fee.toString(),buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount,fromTokenDecimals:this.fromTokenDecimals,toTokenDecimals:this.toTokenDecimals}),this.notifyBridgeListeners("onQuoteFetched",this.quote),this.quote)}catch(r){return b.addBreadcrumb("perps","Failed to fetch Relay quote","info",{error:r instanceof Error?r.message:"Unknown error"}),this.isFetchingQuote=!1,null}finally{this.isFetchingQuote=!1}}async execute(j,t,r){this.startedAt=Date.now(),this.amount=r,this.amountUsd=t,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics("perpsDepositInitiated",{});try{b.addBreadcrumb("perps","Fetching Relay bridge quotes","info",{amount:r,fromChain:this.fromChain,toChain:this.toChain});let o=new S(r).shiftedBy(this.fromTokenDecimals),i=await this.relayBridge.fetchQuotes({amount:o.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:VS});if(i.length===0)throw new Error("No quotes available for bridge");this.quote=i[0],this.notifyBridgeListeners("onQuoteFetched",this.quote),this.notify({type:"fundingBridgingStarted"},this.state),this.notifyBridgeListeners("onBridgeStarted"),b.addBreadcrumb("perps","Executing Relay bridge swap","info",{buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount});let a=await this.relayBridge.executeSwap(this.quote,this.fromTokenOwner);b.addBreadcrumb("perps","Relay bridge transaction submitted","info",{txHash:a}),this.notifyBridgeListeners("onBridgeCompleted",a);let u=this.quote.steps[0].id;if(!u)throw new Error("No request ID found in Relay quote");this.startPollingForCompletion(u)}catch(o){let i=o;this.state={type:"failed",error:i},this.notify({type:"fundingFailed",error:i},this.state),this.notifyBridgeListeners("onBridgeFailed",i),b.addBreadcrumb("perps","Relay bridge failed","error",{error:i.message}),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(i)})}}pause(){this.statusPoller.stopPolling(),b.addBreadcrumb("perps","Relay bridge pause requested - stopped polling","info"),this.reportAnalytics("perpsDepositPaused",{})}resume(){b.addBreadcrumb("perps","Relay bridge resume requested (no-op)","info"),this.reportAnalytics("perpsDepositResumed",{})}getFee(){return this.fee}startPollingForCompletion(j){let t={onStatusUpdate:r=>{b.addBreadcrumb("perps","Relay bridge status update","info",{requestId:j,status:r.status})},onCompleted:r=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),b.addBreadcrumb("perps","Relay bridge funds received","info",{requestId:j}),this.reportAnalytics("perpsDepositCompleted",{}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(t)},onError:r=>{b.addBreadcrumb("perps","Relay bridge polling error","error",{error:r.message,requestId:j}),this.statusPoller.unsubscribe(t),this.reportAnalytics("perpsDepositFailed",{error:JSON.stringify(r)})}};this.statusPoller.subscribe(t),this.statusPoller.startPolling(j)}static create({minimumUiAmount:j,fee:t,perps:r,account:o,authRepository:i,cashAccount:a,signer:u,storage:c,fromToken:l,fromTokenOwner:m,fromTokenDecimals:B,toToken:k,toTokenDecimals:f,fromChain:g,toChain:E,analytics:h,depositId:y}){return new e(j,t,r,o,i,a,u,c,l,m,B,k,f,g,E,h,y)}};var sM=5,iM={chainId:"hypercore:mainnet",address:"0x00000000000000000000000000000000",resourceType:"address"},lc=class{hyperunitFactory;analytics;enableRelayBridgeSol;constructor(A,j){this.hyperunitFactory=new Nn(A),this.analytics=A,this.enableRelayBridgeSol=j}async fetchTokenInfo(A,j,t,r,o){let i=A.addresses.find(B=>B.networkID===t);if(!i)throw new Error("Couldn't find result address for network: "+t);let a=new jr,u={type:"swap",network:t,sellCaip19:M(r),buyCaip19:"solana:101/nativeToken:501",takerCaip19:o?M(o):void 0,takerDestinationCaip19:void 0},c=ai(j),l=await a.initialize(u,[i],c);if(!l.sellTokenPrice?.usd)throw new Error("No price available for token");let m=l.sellToken;return{priceUsd:new S(l.sellTokenPrice.usd),decimals:m.data.decimals}}async createTask(A,j,t,r,o,i,a,u){if(u.type!=="deposit")return this.hyperunitFactory.createTask(A,j,t,r,o,i,a,u);let{depositTokenCaip19:c,depositTokenWalletCaip19:l}=u;if(!this.enableRelayBridgeSol&&M(c)===cB)return this.hyperunitFactory.createTask(A,j,t,r,o,i,a,u);let{priceUsd:m,decimals:B}=await this.fetchTokenInfo(j,r,c.chainId,c,l),k=new S(sM).dividedBy(m);return uc.create({minimumUiAmount:k,estimatedTime:"5 seconds",fee:new S(0),perps:A,account:j,authRepository:t,cashAccount:r,signer:i,storage:o,fromToken:c,fromTokenOwner:l,fromTokenDecimals:B,toToken:iM,toTokenDecimals:18,fromChain:"solana:101",toChain:"hypercore:mainnet",analytics:this.analytics,depositId:u.depositId})}};var XS=(0,_j.createContext)(null),zS=!1;function aM({fundingPoolFactory:e,children:A}){let j=LS(),t=yA(),r=ta(),o=PA("enable-perps-relay-bridge-sol"),i=Lj(),a=(0,_j.useMemo)(()=>{let l;if(e)l=e.create();else{let k=new qi(t);l=new xi(k)}l.addListener(new rc),l.addListener(new tc);let m=zS?new Ti:new lc(j,o),B=zS?new Ti:new Nn(j);return new $i({client:new Tp,isTestnet:r,fundingPool:l,relayFundingTaskFactory:m,hyperunitFundingTaskFactory:B,authRepository:i})},[e,j,t,o,r,i]),{data:u}=pA();(0,_j.useEffect)(()=>{u&&a.setAccount(u)},[u,a]);let c=wj();return(0,_j.useEffect)(()=>{a.setSigner(c)},[c,a]),_j.default.createElement(XS.Provider,{value:a},A)}function Ci(){let e=(0,_j.useContext)(XS);if(!e)throw new Error("usePerps must be used within a PerpsProvider");return e}n();s();n();s();n();s();var JS=q(P());n();s();var WS=q(P()),Oi=()=>{let{data:[e]}=_A(["enable-perps"]),{data:A}=pA(),j=(0,WS.useMemo)(()=>A?.addresses.some(t=>I.isEVMNetworkID(t.networkID))??!1,[A]);return e&&j};n();s();var VA=q(P());var z7=()=>{let e=Ci(),A=(0,VA.useCallback)(()=>{e.syncAccountBalance()},[e]),[j,t]=(0,VA.useState)(e.getAccountBalanceState());(0,VA.useEffect)(()=>e.subscribeAccountBalanceState({onAccountBalanceStateChange:x=>{t(x)}}),[e]);let r=(0,VA.useCallback)(()=>{e.syncPositions()},[e]),[o,i]=(0,VA.useState)(e.getPositionsState());(0,VA.useEffect)(()=>e.subscribePositions({onPositionStateChange:x=>{i(x)}}),[e]);let a=(0,VA.useCallback)(()=>{e.syncPositionFees()},[e]),[u,c]=(0,VA.useState)(e.getPositionFeesState());(0,VA.useEffect)(()=>e.subscribePositionFees({onPositionFeesStateChange:x=>{c(x)}}),[e]);let l=(0,VA.useCallback)(()=>{e.syncFundingHistory()},[e]),[m,B]=(0,VA.useState)(e.getFundingHistoryState());(0,VA.useEffect)(()=>e.subscribeFundingHistory({onFundingHistoryStateChange:x=>{B(x)}}),[e]);let k=(0,VA.useCallback)(w=>{e.syncHistoricalOrders(w)},[e]),[f,g]=(0,VA.useState)(e.getHistoricalOrdersState());(0,VA.useEffect)(()=>e.subscribeHistoricalOrders({onHistoricalOrdersStateChange:x=>{g(x)}}),[e]);let E=(0,VA.useCallback)((w,x,G,v)=>{e.syncPricing(w,x,G,v)},[e]),h=(0,VA.useCallback)(w=>{e.startSequentialPricingSync(w)},[e]),[y,F]=(0,VA.useState)(e.getPricingState());return(0,VA.useEffect)(()=>e.subscribePricing({onPricingStateChange:x=>{F(x)}}),[e]),{isReady:e.getUser()!==void 0,accountBalanceState:j,syncAccountBalance:A,positionsState:o,syncPositions:r,positionFeesState:u,syncPositionFees:a,fundingHistoryState:m,syncFundingHistory:l,historicalOrdersState:f,syncHistoricalOrders:k,pricingState:y,syncPricing:E,startSequentialPricingSync:h}};n();s();var X7=q(P());n();s();var YS=3,GDA=Au(e=>{let A=e(ZS);return{isPerpsBalanceError:A.accountBalanceErrors>=YS,isPerpsPositionsError:A.positionsErrors>=YS}}),ZS=Au({accountBalanceErrors:0,positionsErrors:0});n();s();n();s();var oo="perps",dc={historicalOrders:(e,A)=>[oo,"historical-orders",e,A],market:e=>[oo,"market",e],markets:e=>[oo,"markets",e.sort()],defaultLeverage:()=>[oo,"default-leverage"],assetLeverage:()=>[oo,"asset-leverage"],permissions:()=>[oo,"config"],fungibleToPerpMap:()=>[oo,"fungible-to-perp-map"]};n();s();var pM={perp:6,spot:8};function Aw(e,A,j="perp",t=S.ROUND_HALF_UP){let r=new S(e);if(r.isInteger())return r.toString();let o=pM[j],i=Math.max(o-A,0);return r.precision(5,t).toFixed(i,t).replace(/\.?0+$/,"")}var cM=Q({days:1}),uM=Q({minutes:5});var W7=(e,A=!1)=>X({enabled:e.length>0,queryKey:dc.markets(e),gcTime:cM,staleTime:uM,async queryFn(){try{return await lM(e,A)}catch(j){throw b.addBreadcrumb("perps","Failed to get perp markets","error",{caip19s:e.join(","),error:j instanceof Error?j.message:"Unknown error"}),j}}});async function lM(e,A=!1){let j=await N.api().get("/swap/v2/perp/markets",{params:{tokens:e.join(",")}});if(!eA(j))throw new Error("Failed to get perp markets: response is not okay");let t=j.data,r=aS.safeParse(t);if(!r.success)throw new Error("Failed to get perp markets: schema validation failed");if(A){let o=r.data.markets,i={};for(let[a,u]of Object.entries(o))i[a]={...u,price:Aw(u.price,u.szDecimals),priceChange24h:{...u.priceChange24h,percentage:String(Number(u.priceChange24h.percentage)/100)}};return i}return r.data.markets}n();s();n();s();var dM=p.object({actions:p.boolean(),disableFunding:p.boolean().optional()}),mM=p.object({perps:dM}),i2A=p.enum(["open","close","funding","manage-position"]);var E2A=Q({minutes:1}),y2A=Q({minutes:1});n();s();var kM=q(P());n();s();var T2A=Q({days:1}),P2A=Q({minutes:15}),G2A=p.record(lo,lo);n();s();n();s();n();s();var ew=(r=>(r[r.Always=1/0]="Always",r[r.Short=Q({days:1})]="Short",r[r.Medium=Q({days:3})]="Medium",r[r.Long=Q({days:7})]="Long",r))(ew||{}),jw=(o=>(o[o.Immediate=0]="Immediate",o[o.Short=Q({minutes:1})]="Short",o[o.Medium=Q({minutes:2.5})]="Medium",o[o.Long=Q({minutes:60})]="Long",o[o.Never=1/0]="Never",o))(jw||{}),BM=(t=>(t[t.Short=Q({seconds:20})]="Short",t[t.Medium=Q({minutes:2.5})]="Medium",t[t.Long=Q({minutes:5})]="Long",t))(BM||{});n();s();n();s();n();s();var bNA=Q({minutes:10}),INA=Q({minutes:10});var mc=q(P());n();s();var uw=q(kI()),lw=q(dI());var gM=p.object({domain:p.string(),url:p.string(),name:p.string(),category:p.string(),imageUrl:p.string(),slug:p.string()}),dw=p.object({uuid:p.string(),data:p.array(gM)}),EM=p.object({type:p.literal("site"),url:p.string(),name:p.string(),category:p.string(),imageUrl:p.string(),description:p.string().optional()}),yM=p.object({type:p.literal("tokenCategory"),id:p.string(),name:p.string(),subtitle:p.string().optional(),imageUrl:p.string(),description:p.string().optional()}),mw=p.discriminatedUnion("type",[EM,yM]),tLA=e=>e.type==="site";var hM=p.object({chainId:Ot,address:p.string(),name:p.string(),symbol:p.string(),logoUrl:p.string(),marketCap:p.number(),price:p.number(),priceChange:p.number(),volume:p.number(),volumeChange:p.number(),spamStatus:Yk.optional().default("NOT_VERIFIED")}),rLA=p.object({id:p.string(),name:p.string(),imageUri:p.string()}),kw=p.object({items:p.array(hM)}),FM=p.object({paymentTokenId:p.string(),name:p.string(),symbol:p.string(),decimals:p.number()}),SM=p.object({verified:p.boolean(),collectionUrl:p.string(),marketplaceId:p.string(),marketplaceName:p.string(),marketplaceCollectionId:p.string()}),wM=p.object({marketplaceId:p.string(),paymentToken:FM,value:p.string()}),bM=p.object({id:p.string(),name:p.string(),volume:p.string().optional(),volumePercentChange:p.number(),marketplacePages:p.array(SM),floorPrices:p.array(wM),imageUrl:p.string()}),Bw=p.object({uuid:p.string(),data:p.array(bM)}),IM=["tokens","perps","sites","collections","learn","suggested-users-to-follow","suggested-users-to-follow-by-pnl","token-categories","tokens-for-you"],Dj=p.enum(["shortcuts","carousel",...IM]),$M=p.object({type:p.literal(Dj.enum.shortcuts)}),vM=p.object({type:p.literal(Dj.enum.carousel)}),qM=p.object({type:p.literal(Dj.enum["suggested-users-to-follow"]),limit:p.number()}),xM=["7d","30d"],tw=p.enum(xM),TM=p.object({type:p.literal(Dj.enum["suggested-users-to-follow-by-pnl"]),limit:p.number(),timeFrame:p.array(tw).refine(e=>new Set(e).size===e.length),timeFrameDefault:tw}),Mi="all_networks",Ln=p.union([Ot,p.literal(Mi)]),PM=["asc","desc"],fw=p.enum(PM),GM=["rank","volume","price","price-change","market-cap"],rw=p.enum(GM),CM=["1h","24h","7d","30d"],ow=p.enum(CM),OM=p.object({type:p.literal(Dj.enum.tokens),sortBy:p.array(rw).refine(e=>new Set(e).size===e.length),sortByDefault:rw,sortDirectionDefault:fw,network:p.array(Ln).refine(e=>new Set(e).size===e.length),networkDefault:Ln,timeFrame:p.array(ow).refine(e=>new Set(e).size===e.length),timeFrameDefault:ow,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),MM=p.object({type:p.literal(Dj.enum["token-categories"])}),RM=["volume","price-change","open-interest"],nw=p.enum(RM),_M=["1h","24h","7d","30d"],sw=p.enum(_M),DM=p.object({type:p.literal(Dj.enum.perps),sortBy:p.array(nw).refine(e=>new Set(e).size===e.length),sortByDefault:nw,sortDirectionDefault:fw,timeFrame:p.array(sw).refine(e=>new Set(e).size===e.length),timeFrameDefault:sw,limit:p.number(),listLimit:p.number()}),NM=["top","rank"],iw=p.enum(NM),LM=["24h","7d","30d"],aw=p.enum(LM),KM=p.object({type:p.literal(Dj.enum.sites),sortBy:p.array(iw).refine(e=>new Set(e).size===e.length),sortByDefault:iw,network:p.array(Ln).refine(e=>new Set(e).size===e.length),networkDefault:Ln,timeFrame:p.array(aw).refine(e=>new Set(e).size===e.length),timeFrameDefault:aw,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),UM=["top","rank"],pw=p.enum(UM),HM=["24h","7d","30d"],cw=p.enum(HM),QM=p.object({type:p.literal(Dj.enum.collections),sortBy:p.array(pw).refine(e=>new Set(e).size===e.length),sortByDefault:pw,network:p.array(Ln).refine(e=>new Set(e).size===e.length),networkDefault:Ln,timeFrame:p.array(cw).refine(e=>new Set(e).size===e.length),timeFrameDefault:cw,rankAlgo:p.string(),limit:p.number(),listLimit:p.number()}),VM=p.object({type:p.literal(Dj.enum.learn),limit:p.number()}),zM=p.object({type:p.literal(Dj.enum["tokens-for-you"]),limit:p.number(),listLimit:p.number()}),J7=p.discriminatedUnion("type",[$M,vM,qM,TM,OM,DM,KM,QM,VM,MM,zM]),gw=p.object({sections:p.array(J7).refine(e=>(0,uw.default)(e,(0,lw.default)(e,"type")))}),oLA=p.object({uuid:p.string(),data:p.array(Dm)}),nLA=p.object({tokenAddress:p.string(),bondingCurve:p.string(),migratedPool:p.string().optional(),name:p.string(),image:p.string(),symbol:p.string(),marketCap:p.coerce.number(),liquidity:p.coerce.number(),bondingCurvePercentage:p.coerce.number(),tokenCreatedAt:p.coerce.date(),twitter:p.string(),website:p.string(),telegram:p.string(),discord:p.string(),migratedAt:p.coerce.date().optional(),type:p.enum(["NEW","ABOUT_TO_MIGRATE","MIGRATED"]).optional(),slot:p.coerce.number().optional(),devHolding:p.coerce.number(),snipersHolding:p.coerce.number(),bundlersHolding:p.coerce.number(),top10Holding:p.coerce.number(),volume:p.coerce.number(),buysCount:p.coerce.number(),sellsCount:p.coerce.number(),uniqueHolders:p.coerce.number(),telegramCallCount:p.coerce.number(),bondingCurvePlatform:p.string()});var Ew=gw.parse({sections:[{type:"shortcuts"},{type:"carousel"},{type:"tokens",sortBy:["rank","volume","price","price-change","market-cap"],sortByDefault:"rank",sortDirectionDefault:"asc",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["1h","24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:100},{type:"perps",sortBy:["volume","price-change","open-interest"],sortByDefault:"volume",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"tokens-for-you",limit:3,listLimit:50},{type:"token-categories"},{type:"suggested-users-to-follow-by-pnl",limit:3,timeFrame:["7d","30d"],timeFrameDefault:"7d"},{type:"sites",sortBy:["rank","top"],sortByDefault:"rank",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:50},{type:"learn",limit:3}]}),XM=e=>{try{let A=JSON.parse(e??"");return A?.sections?{sections:A.sections.filter(t=>J7.safeParse(t).success)}:Ew}catch{return Ew}},Y7=()=>{let e=Te.getMultivariateAssignment("explore-config"),{data:[A]}=_A(["enable-fungible-categories"]),j=PA("enable-social-tokens-for-you"),t=Oi();return(0,mc.useMemo)(()=>{let r=XM(e);return Je||(r={...r,sections:r.sections.filter(o=>o.type!=="suggested-users-to-follow")}),(!j||!Je)&&(r={...r,sections:r.sections.filter(o=>o.type!=="tokens-for-you")}),A||(r={...r,sections:r.sections.filter(o=>o.type!=="token-categories")}),t||(r={...r,sections:r.sections.filter(o=>o.type!=="perps")}),r},[e,A,t,j])},Z7=()=>{let e=Y7();return(0,mc.useMemo)(()=>{let A=[];for(let j of e.sections)(j.type==="collections"||j.type==="tokens"||j.type==="perps"||j.type==="sites"||j.type==="learn"||j.type==="suggested-users-to-follow"||j.type==="suggested-users-to-follow-by-pnl"||j.type==="token-categories"||j.type==="tokens-for-you")&&A.push(j);return A},[e.sections])},Am=e=>{let A=Y7();return(0,mc.useMemo)(()=>A.sections.find(t=>t.type===e)??null,[A.sections,e])};n();s();n();s();n();s();n();s();var yw="@phantom/fungible-categories",kc={fungibleCategories:e=>[yw,"fungible-categories",e],fungibleCategoryById:e=>[yw,"fungible-category",e]};n();s();n();s();var hw=p.object({items:p.array(eu)}),Fw=p.object({id:p.string(),name:p.string(),imageUri:p.string().nullish().transform(e=>e??""),items:ju.array()});var em=({limit:e,searchQuery:A}={})=>{let{data:[j]}=_A(["enable-fungible-categories"]);return X({enabled:j,queryKey:kc.fungibleCategories({enabled:j,searchQuery:A}),queryFn:async()=>{let t=await N.api().get("/fungibles/v1/categories",{params:{limit:"100",...A?{query:A}:{}}});return hw.parse(t.data)},select:t=>e?t.items.slice(0,e):t.items})};n();s();var WM=({id:e})=>{let{data:[A]}=_A(["enable-fungible-categories"]);return X({enabled:A,queryKey:kc.fungibleCategoryById({id:e,enabled:A}),queryFn:async()=>{let j=await N.api().get(`/fungibles/v1/categories/${e}`,{params:{includePrices:"true"}});return Fw.parse(j.data)}})};var LA=q(P());n();s();n();s();n();s();var Sw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var ww={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var bw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var Iw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var $w={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};n();s();var vw={tokenSearchEnabled:()=>!1,trendingTokensEnabled:()=>!1};n();s();var qw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var xw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!0};n();s();var Tw={tokenSearchEnabled:()=>!0,trendingTokensEnabled:()=>!1};var JM=new Bo({solana:xw,ethereum:Iw,polygon:qw,base:ww,arbitrum:Sw,bitcoin:bw,monad:vw,sui:Tw,hypercore:$w}),jm=ko(JM);n();s();var tm=e=>["explore-dapp",e];var Bc=e=>e.addresses.map(A=>I.getMainnetNetworkID(A.networkID))??[];function Pw(e){try{return bj.get(e).nonNativeFungibleTokenType}catch{return"SolanaNative"}}n();s();n();s();var Ej="@phantom/explore",JA={RecentlyViewedSearchItems:[Ej,"RecentlyViewedSearchItems"],sitesV2({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o}){return[Ej,"sitesV2",xA,r,{sortBy:e,timeFrame:A,networkIDs:j,rankAlgo:o,limit:t}]},recommendedSites(e,A){return[Ej,"sites","recommended",xA,A,e]},featuredItems(e,A){return[Ej,"items","featured",xA,A,e]},tokensV2({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,limit:r,rankAlgo:o}){return[Ej,"tokensV2",{sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,rankAlgo:o,limit:r}]},collectionsV2({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o}){return[Ej,"collectionsV2",xA,r,{sortBy:e,timeFrame:A,networkIDs:j,rankAlgo:o,limit:t}]},featuredTransactions(e,A){return[Ej,"transactions","featured",xA,A,e]},learn(e,A){return[Ej,"learn",xA,A,e]},perpMarkets(e,A,j,t,r,o){return[Ej,"perp-markets",{chainId:e,sortBy:A,sortDirection:j,timeFrame:t,limit:r,search:o}]}};var YM=10,Cw="RecentlyViewedSearchItems";async function ZM(e){return await e.get(Cw)??[]}async function Ow(e,A){await e.set(Cw,A)}function rm(e){return X({queryKey:JA.RecentlyViewedSearchItems,queryFn:async()=>ZM(e),staleTime:0,enabled:!0})}function A8(e){let A=cA();return wA({mutationFn:async t=>{let r=Gw(t),i=(A.getQueryData(JA.RecentlyViewedSearchItems)??[]).filter(a=>Gw(a)!==r);i.unshift(t),i=i.slice(0,YM),await Ow(e,i),A.setQueryData(JA.RecentlyViewedSearchItems,i),await A.refetchQueries({queryKey:JA.RecentlyViewedSearchItems})}})}function e8(e){let A=cA();return wA({mutationFn:async()=>{await Ow(e,[]),A.setQueryData(JA.RecentlyViewedSearchItems,[]),await A.refetchQueries({queryKey:JA.RecentlyViewedSearchItems})}})}function Gw(e){return e.type==="token"||e.type==="perp"?M(V(e.data)):e.data.id}n();s();var sm=q(om()),nm=q(P());n();s();var Uw={fields:["domain","name","category","tags"],storeFields:["domain","name","category","tags","imageUrl"],searchOptions:{boost:{name:2},prefix:!0,fuzzy:e=>e.length>3?.2:!1}};var l8=e=>{let A={isRecommended:"true"};return e.networkIds&&(A.chainIds=e.networkIds.join(",")),`/dapps/v1?${new URLSearchParams(A).toString()}`},Hw=async e=>{let A=await N.api().get(l8(e));if(!eA(A))throw new Error("Error fetching recommended dapps from registry");if(!A?.data||!A?.data?.data)throw new Error("No data returned from registry");let j=A.data,t=(0,sm.default)(j.data??[],o=>o.id);return Object.values(t)},Qw=e=>{let A=cA();return X({queryKey:["dapps","recommended",e],queryFn:async()=>{try{let t=await Hw(e);return Vc.batch(()=>{for(let r of t){let o=tm(r.domain),i=A.getQueryState(o);A.setQueryData(o,()=>r??i?.data??null)}}),t}catch(t){throw b.captureError(t,"dappRegistry"),t}},gcTime:Q({days:1}),staleTime:Q({days:1})})},im=(e,A)=>{let{searchQuery:j,networkIds:t}=e,{data:r=[],...o}=Qw({networkIds:t}),i=(0,nm.useMemo)(()=>{let l=[...r||[],...A||[]],m=(0,sm.default)(l,B=>hl(B.domain));return Object.values(m)},[r,A]),a=hl(j),u=lB(i,a,Uw);return{data:(0,nm.useMemo)(()=>{let l=new Map(i.map(m=>[m.id,m]));return u.map(m=>l.get(m.id)).filter(m=>m!==void 0).sort((m,B)=>B.recommendationScore-m.recommendationScore)},[u,i]),...o}};n();s();n();s();var Vw=async({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:t,limit:r,rankAlgo:o,anonymousId:i})=>{let a=new URLSearchParams({timeFrame:j,sortBy:e,sortDirection:A,limit:r.toString(),rankAlgo:o,...i?{anonymousId:i}:{}});t.forEach(l=>{a.append("chainIds[]",l)});let u=await N.api().get("/explore/v2/trending-tokens",{params:a});if(!eA(u))throw new Error("Failed to fetch tokens");let c=kw.safeParse(u.data);if(!c.success)throw new Error("Failed to parse tokens");return c.data};n();s();var Kn=(e,A)=>{let j=go(),r=Z7().find(i=>i.type===A),o=[];return r&&"network"in r?r.network.forEach(i=>{i!==Mi&&j.includes(i)&&o.push(i)}):o=j,e!==Mi&&!o.includes(e)?[]:e===Mi?o:[e]};var d8=Q({minutes:1}),m8=Q({minutes:1}),k8=100,am=({sortBy:e,sortDirection:A,timeFrame:j,network:t,limit:r,rankAlgo:o,enableQuery:i=!0})=>{let{data:a}=pA(),u=J(),c=Kn(t,"tokens"),l=k8,m=me(T.language)??"en";return X({queryKey:JA.tokensV2({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:c,limit:l,rankAlgo:o}),enabled:!!a&&i,async queryFn(){if(!a)throw new Error("No account found");let B=await u.getDeviceId();return Vw({sortBy:e,sortDirection:A,timeFrame:j,networkIDs:c,locale:m,limit:l,rankAlgo:o,anonymousId:B})},gcTime:m8,staleTime:d8,retry:3,select:B=>r>=l?B:{...B,items:B.items.slice(0,r)}})};var Un=3,B8=15,fc=50,zw={TRUSTED:1,VERIFIED:2,NOT_VERIFIED:3,POSSIBLE_SPAM:4,SPAM:5},f8=(e,A=100)=>{let[j,t]=(0,LA.useState)(!1);return(0,LA.useEffect)(()=>{let r;return e?r=setTimeout(()=>t(!0),A):t(!1),()=>clearTimeout(r)},[e,A]),j},g8=e=>{let A=Pw(e.chainId),j=I.getChainDefinition(e.chainId),t={name:e.name,symbol:e.symbol,logoUri:e.logoUrl,spamStatus:e.spamStatus,chain:{id:e.chainId,symbol:j.tokenSymbol,name:j.name,imageUrl:j.iconUrl}};switch(A){case"SPL":return{type:A,data:{...t,mintAddress:e.address}};case"ERC20":return{type:A,data:{...t,contractAddress:e.address}};case"BRC20":return{type:A,data:{...t,firstCreatedInscriptionId:e.address}};default:return null}},E8=e=>e.reduce((A,j)=>{let t=g8(j);return t&&A.push(t),A},[]),y8=({searchQuery:e,networkIds:A,excludePlaceholderTokens:j=!1,extraDapps:t=[],actorSearchHook:r})=>{let[o,i]=(0,LA.useState)(!1),[a,u]=(0,LA.useState)(!1),[c,l]=(0,LA.useState)(!1),[m,B]=(0,LA.useState)(!1),[k,f]=(0,LA.useState)(!1),g=(0,LA.useMemo)(()=>A.filter(yj=>jm.get(yj).tokenSearchEnabled()),[A]);(0,LA.useEffect)(()=>{i(!1),u(!1),l(!1),B(!1),f(!1)},[e]);let{data:E=[],isLoading:h}=Jr({query:e,networkIds:g,searchContext:"explore",enableQuery:!!e}),{data:y,isLoading:F}=em({limit:e?void 0:10,searchQuery:e}),w=Am("tokens"),{data:x}=am({sortBy:w?.sortByDefault??"rank",sortDirection:w?.sortDirectionDefault??"asc",timeFrame:w?.timeFrameDefault??"24h",network:w?.networkDefault??"solana:101",limit:10,rankAlgo:w?.rankAlgo??"default",enableQuery:!e&&!j}),{tokens:G,perps:v}=(0,LA.useMemo)(()=>E.sort((Br,rs)=>zw[Br.data.spamStatus??"NOT_VERIFIED"]-zw[rs.data.spamStatus??"NOT_VERIFIED"]).reduce((Br,rs)=>(rs.type==="HypercoreAsset"?Br.perps.push(rs):Br.tokens.push(rs),Br),{tokens:[],perps:[]}),[E]),_=(0,LA.useMemo)(()=>x?.items?E8(x.items):[],[x?.items]),C=e.length===0?B8:Un,O=(0,LA.useMemo)(()=>G.slice(0,a?fc:C),[a,G,C]),D=(0,LA.useMemo)(()=>v.slice(0,c?fc:C),[c,v,C]),H=(0,LA.useMemo)(()=>[...O.map(yj=>M(V(yj))),..._.map(yj=>M(V(yj)))],[O,_]),{data:z={},isLoading:L}=lt({query:{data:H},enabled:H.length>0}),R=(0,LA.useMemo)(()=>D.map(yj=>M(V(yj))),[D]),{data:W,isPending:K}=W7(R,!0),{data:rA=[],isLoading:Y}=im({networkIds:g,searchQuery:e},t),fA=rA.slice(0,o?fc:Un),AA=r??(()=>({data:void 0,isLoading:!1})),{data:nA,isLoading:jA}=AA({query:e}),sA=!!e,CA=Y||h||F||jA,lA=sA&&!CA,re=yA(),{data:YA}=rm(re),{actorsAll:qe,actors:Om}=(0,LA.useMemo)(()=>{let yj=nA?.actors??[],Br=yj.slice(0,m?fc:Un);return{actorsAll:yj,actors:Br}},[m,nA?.actors]),Mm=(0,LA.useMemo)(()=>{if(y)return k?y:y.slice(0,C)},[y,k,C]),ts=(0,LA.useMemo)(()=>({actors:Om,dapps:rA,searchedDapps:fA,renderShowMoreDappsButton:sA&&rA.length>Un,isLoading:CA,tokens:O,perps:D,trendingTokens:_,renderShowMoreTokensButton:sA&&G.length>C,renderShowMorePerpsButton:sA&&v.length>C,renderShowMoreUsersButton:sA&&qe.length>Un,priceMap:z,isPriceMapLoading:L,showSearchResults:lA,showMoreTokens:a,setShowMoreTokens:u,showMorePerps:c,setShowMorePerps:l,showMoreDapps:o,setShowMoreDapps:i,showMoreUsers:m,setShowMoreUsers:B,recentlyViewedSearchItems:YA,categories:Mm,showMoreCategories:k,setShowMoreCategories:f,renderShowMoreCategoriesButton:sA&&y&&y?.length>Un,perpMarketMap:W,isPerpMarketMapLoading:K}),[Om,rA,fA,sA,CA,O,D,_,G.length,v.length,C,qe.length,z,L,lA,a,c,o,m,YA,Mm,k,y,W,K]),[Rm,nI]=(0,LA.useState)(null),sI=f8(CA);return(0,LA.useEffect)(()=>{ts.isLoading||nI(e?ts:null)},[ts.isLoading,e]),{...ts.isLoading&&Rm?Rm:ts,showSpinner:sI&&sA}};n();s();n();s();n();s();var h8=q(om());n();s();var F8=q(P());n();s();var X5A=Q({minutes:10}),W5A=Q({minutes:10});n();s();var Ww=q(P());n();s();var Xw=async(e,A)=>{let j=new URLSearchParams({appVersion:xA,limit:"6",locale:A,platform:Fj});e.forEach(i=>{j.append("chainIds[]",i)});let t=await N.api().get("/explore/v1/featured-items",{params:j});if(!eA(t))throw new Error("Failed to fetch featured items");let r=await t.data;if(!r.data||!Array.isArray(r.data))return[];let o=[];for(let i of r.data)try{let a=mw.parse(i);o.push(a)}catch{}return o};var S8=Q({minutes:10}),w8=Q({minutes:10}),b8=()=>{let{data:e}=pA(),A=(0,Ww.useMemo)(()=>e?Bc(e):[],[e]),j=me(T.language)??"en",t=async()=>{if(!e)throw new Error("No account found");return Xw(A,j)};return X({queryKey:JA.featuredItems(A,j),enabled:!!e,queryFn:t,gcTime:S8,staleTime:w8})};n();s();var I8=q(P());n();s();n();s();var RUA=Q({minutes:10}),_UA=Q({minutes:10});n();s();n();s();var $8={rank:"trending",top:"top"},Jw=async({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o})=>{let i=new URLSearchParams({appVersion:xA,limit:t.toString(),locale:r,platform:Fj,rankAlgo:o,rankBy:$8[e],timeframe:A});j.forEach(c=>{i.append("chainIds[]",c)});let a=await N.api().get("/explore/v1/trending-dapps",{params:i});if(!eA(a))throw new Error("Failed to fetch sites");let u=dw.safeParse(a.data);if(!u.success)throw new Error("Failed to parse sites");return u.data};var v8=Q({minutes:10}),q8=Q({minutes:10}),x8=({sortBy:e,timeFrame:A,network:j,limit:t,rankAlgo:r})=>{let{data:o}=pA(),i=Kn(j,"sites"),a=me(T.language)??"en";return X({queryKey:JA.sitesV2({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return Jw({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r})},gcTime:q8,staleTime:v8,retry:3})};n();s();n();s();var T8={rank:"trending",top:"volume"},P8=e=>e.floorPrices.length>0&&e.marketplacePages.length>0,Yw=async({sortBy:e,timeFrame:A,networkIDs:j,limit:t,locale:r,rankAlgo:o})=>{let i=new URLSearchParams({appVersion:xA,limit:t.toString(),locale:r,platform:Fj,rankAlgo:o,rankBy:T8[e],timeframe:A});j.forEach(c=>{i.append("chainIds[]",c.toString())});let a=await N.api().get("/explore/v1/trending-collections",{params:i});if(!eA(a))throw new Error("Failed to fetch collections");let u=Bw.safeParse(a.data);if(!u.success)throw new Error("Failed to parse collections");return{...u.data,data:u.data.data.filter(P8)}};var G8=Q({minutes:10}),C8=Q({minutes:10}),O8=({sortBy:e,timeFrame:A,network:j,limit:t,rankAlgo:r})=>{let{data:o}=pA(),i=Kn(j,"collections"),a=me(T.language)??"en";return X({queryKey:JA.collectionsV2({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r}),enabled:!!o,async queryFn(){if(!o)throw new Error("No account found");return Yw({sortBy:e,timeFrame:A,networkIDs:i,locale:a,limit:t,rankAlgo:r})},gcTime:C8,staleTime:G8,retry:3})};n();s();n();s();var Zw=async(e,A)=>{let j=new URLSearchParams({appVersion:xA,locale:A,platform:Fj});e.forEach(o=>{j.append("chainIds[]",o)});let t=await N.api().get("/explore/v1/learn-grid",{params:j});if(!eA(t))throw new Error("Failed to fetch learn grid");return t.data};var M8=Q({minutes:10}),R8=Q({minutes:10}),_8=()=>{let e=go(),A=me(T.language)??"en";return X({queryKey:JA.learn(e,A),enabled:e.length>0,async queryFn(){return Zw(e,A)},gcTime:R8,staleTime:M8})};n();s();n();s();var D8=p.object({trendingMarkets:p.array(Ii)}),Ab=async({chainId:e,sortBy:A,sortDirection:j,timeFrame:t,limit:r,search:o})=>{let i=new URLSearchParams({chainId:e,sortBy:A,sortDirection:j,timeFrame:t,...r?{limit:r.toString()}:{},...o?{search:o}:{}}),a=await N.api().get("/swap/v2/perp/trending-markets",{params:i});if(!eA(a))throw new Error("Failed to fetch perp markets");let u=D8.safeParse(a.data);if(!u.success)throw new Error("Failed to parse perp markets");return u.data};var N8=Q({minutes:1}),L8=Q({minutes:1}),K8=({sortBy:e,sortDirection:A,timeFrame:j,limit:t,search:r})=>{let o=ta(),i=o?"hypercore:testnet":I.hypercore.mainnetID,a=PA("enable-hip3-testnet-dogfood-filter");return X({queryKey:JA.perpMarkets(i,e,A,j,void 0,r),queryFn:()=>Ab({chainId:i,sortBy:e,sortDirection:A,timeFrame:j,search:r}),gcTime:L8,staleTime:N8,retry:3,select:u=>{let c=u.trendingMarkets;return a&&o&&(c=c.filter(l=>l.name.includes(":"))),t?{...u,trendingMarkets:c.slice(0,t)}:{...u,trendingMarkets:c}}})};n();s();n();s();var Yn=q(P());n();s();var zn=q(P());n();s();var pm={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"token.name",weight:.4},{name:"token.symbol",weight:.4},{name:"token.caip19.chainId",weight:.2}]};var Ri=30,U8=6,cm=3e4,um=5,lm=["100","500","1000"];n();s();n();s();var Hn="@phantom/fiat-ramp",_i=`${Hn}:fungibles`,H8=`${Hn}:payment-methods`,Q8=`${Hn}:providers`,V8=`${Hn}:recommended-quote`,z8=`${Hn}:status`,X8=`${Hn}:completed`,Tt={fiatRampTokens(e,A,j){return[_i,e,A,j]},fiatRampPaymentMethods(e,A,j){return[H8,e,A,j]},fiatRampProviders(e,A,j){return[Q8,e,A,j]},fiatRampRecommendedQuote(e,A,j){return[V8,e,A,j]},fiatRampStatus(e,A,j){return[z8,e,A,j]},fiatRampCompleted(e,A,j){return[X8,e,A,j]}};n();s();n();s();n();s();var eb=p.object({name:p.string().nullish().default(null),symbol:p.string().nullish().default(null),decimals:p.number(),caip19:xe,logoURI:p.string().nullish().default(null)}),jb=p.object({token:eb,addressType:Xm.optional()}),gc=p.object({id:p.string(),name:p.string(),tag:p.string(),logo:p.string(),quote:p.object({displaySourceAmount:p.string(),displayDestinationAmount:p.string(),displayFee:p.string()}).optional()}),tb=(o=>(o.CARD="CARD",o.MOBILE_WALLET="MOBILE_WALLET",o.BANK_TRANSFER="BANK_TRANSFER",o.EXCHANGE="EXCHANGE",o.LOCAL="LOCAL",o))(tb||{}),Ec=p.object({id:p.string(),type:p.nativeEnum(tb),name:p.string(),estimatedArrival:p.string(),assets:p.object({icon:p.string(),roundIcon:p.string()}),description:p.string().optional()}),W8=p.object({groups:p.array(p.object({groupName:p.string(),tokens:p.array(jb)}))}),J8=p.object({paymentMethods:p.array(Ec),provider:gc.optional()}),Y8=p.object({providers:p.array(gc),paymentMethod:Ec,token:xe}),Z8=p.object({provider:gc,paymentMethod:Ec,location:p.object({countryCode:p.string(),subdivision:p.string().optional()}).optional(),token:xe.optional(),tokenAmount:p.string().optional(),fiatAmount:p.string().optional(),fiatCurrencyCode:p.string().optional(),minPurchaseAmount:p.string().optional(),maxPurchaseAmount:p.string().optional(),quickSelectDenominations:p.array(p.string()).optional()}),AR=p.object({url:p.string(),sessionId:p.string()}),dm=(t=>(t.PENDING="PENDING",t.COMPLETED="COMPLETED",t.FAILED="FAILED",t))(dm||{}),GHA=p.object({status:p.nativeEnum(dm),tokenAmount:p.number().optional(),fiatCurrencyCode:p.string().optional(),usdFiatAmount:p.number().optional(),usdFiatFeeAmount:p.number().optional(),fiatFeeAmount:p.number().optional(),cryptoTransactionId:p.string().optional(),createdAt:p.date().optional(),updatedAt:p.date().optional()}),Fe=class extends Error{constructor(A){super(A),this.name="FiatRampError"}};var rb=new Fe("Failed to get FiatRampPaymentMethods"),ob=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/payment_methods",A);if(!eA(t))throw rb;return t.data}catch{throw rb}};var eR=Q({days:7}),jR=Q({hours:1}),yc=(e,A,j,t)=>{let r={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:o}=oe(),i=o?.userID,a=o?.accessToken;return X({queryKey:Tt.fiatRampPaymentMethods(r,t,i),queryFn:()=>ob(r,t,a),gcTime:eR,staleTime:jR})};n();s();n();s();var nb=new Fe("Failed to get FiatRampProviders"),sb=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/providers",A);if(!eA(t))throw nb;return t.data}catch{throw nb}};var tR=Q({seconds:Ri}),rR=Q({hours:1}),hc=(e,A,j,t)=>{let r={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:o}=oe(),i=o?.userID,a=o?.accessToken;return X({queryKey:Tt.fiatRampProviders(r,t,i),queryFn:()=>sb(r,t,a),gcTime:rR,staleTime:tR,enabled:!!t.destinationAddress})};n();s();n();s();var ib=new Fe("Failed to get FiatRampRecommendedQuote"),ab=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/recommended_quote",A);if(!eA(t))throw ib;return t.data}catch{throw ib}};var oR=Q({days:7}),nR=Q({hours:1}),Fc=(e,A,j,t,r=!0)=>{let o={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:i}=oe(),a=i?.userID,u=i?.accessToken;return X({queryKey:Tt.fiatRampRecommendedQuote(o,t,a),queryFn:()=>ab(o,t,u),gcTime:oR,staleTime:nR,enabled:r})};n();s();n();s();var pb=new Fe("Failed to get FiatRampTokens"),mm=async(e,A,j)=>{try{let t=await N.api().headers(e).bearer(j).post("/fiat_ramp/v2/onramp/tokens",A);if(!eA(t))throw pb;return t.data}catch{throw pb}};n();s();var Sc=e=>e.sort((A,j)=>I.compareNetworkID(A.token.caip19.chainId,j.token.caip19.chainId));var sR=Q({days:7}),iR=Q({hours:1}),Qn=(e,A,j,t=!0,r)=>{let{data:o}=pA(),i=Array.from(new Set(o?.addresses?.map(k=>k.networkID))),a=Array.from(new Set(o?.addresses?.map(k=>k.addressType))),u={chainIDs:i},c={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},{data:l}=oe(),m=l?.userID,B=l?.accessToken;return X({queryKey:Tt.fiatRampTokens(c,u,m),queryFn:()=>mm(c,u,B),gcTime:sR,staleTime:iR,enabled:t&&i.length>0,select:k=>{let f={...k,groups:k.groups.map(g=>({...g,tokens:Sc(g.tokens.filter(E=>E.addressType?a.includes(E.addressType):!0))}))};return r?r(f):f}})};n();s();n();s();var km=e=>{let A=e?.groups.flatMap(j=>j.tokens)??[];return Sc(A)};var Vn=(e,A,j,t=!0)=>Qn(e,A,j,t,km);n();s();n();s();var A9A=new Fe("Failed to get ramp status");var c9A=Q({seconds:Ri}),u9A=Q({hours:1});n();s();var Pt={onClose:()=>{},context:"modal",fungible:void 0,purchaseAmount:"0",purchaseType:"currency",isPurchaseAmountValid:!1,error:void 0,redirectErrorMessage:void 0,ownerPublicKey:"",price:0,minPurchaseAmountUsd:um,maxPurchaseAmountUsd:cm,quickSelectDenominations:lm,paymentMethod:void 0,provider:void 0,checkoutQuoteType:"recommended",redirectURL:void 0,stripePaymentMethod:void 0},ij=UA(e=>({...Pt,setState:A=>e(j=>({...j,...A})),reset:()=>{e(Pt)}}));var cb=({platform:e,version:A,onClosePress:j,onNextPress:t})=>{let r=J(),{i18n:o}=hA(),i=o.language,{setState:a}=ij(),{data:u}=pA(),c=Array.from(new Set(u?.addresses?.map(v=>v.addressType))),{data:l=[]}=Vn(e,A,i),{data:m,isPending:B,isFetching:k,isError:f}=Qn(e,A,i),g=m?.groups??[],E=B||k||f,[h,y]=(0,zn.useState)(""),F=na(h)??"",w=h.length>0,x=ru(l,F,pm),G=(0,zn.useCallback)(({tokenWithMetadata:v,ownerPublicKey:_})=>{let{token:C}=v,{name:O,symbol:D,caip19:H}=C,{chainId:z}=H;r.capture("fiatOnrampFungibleSelected",{data:{networkId:z,chainId:I.getChainID(z),asset:{name:O,symbol:D,type:"fungible"}}}),a({...Pt,onClose:j,ownerPublicKey:_,fungible:v.token}),t()},[r,j,t,a]);return(0,zn.useEffect)(()=>{r.capture("fiatOnrampInitiated")},[r]),{enabledAddressTypes:c,groupedTokens:g,isLoading:E,isSearching:w,searchedTokens:x,searchTerm:h,selectedAccount:u,onClosePress:j,onTokenPress:G,setSearchTerm:y}};n();s();var pj=q(P());n();s();var Wn=q(P());n();s();var Bm=q(P()),wc=({marginBottom:e=0})=>{let{t:A}=hA(),{data:[j]}=_A(["enable-buy-flow-warning"]);return j?Bm.default.createElement(gA,{marginBottom:e},Bm.default.createElement(Sk,{level:"4-error"},A("buyFlowHealthWarning"))):null};n();s();var no=q(P());n();s();var aj=q(P());n();s();var Nj=q(P()),bc=48,fm=Nj.default.memo(({networkId:e,logoURI:A,type:j})=>{let t=pR({disableBadge:!1,tokenType:j,chain:I.getChainID(e)});return Nj.default.createElement(gA,{size:bc,position:"relative"},A?Nj.default.createElement(ct,{src:A,height:bc,width:bc,borderRadius:"circle",fallback:Nj.default.createElement(ub,null)}):Nj.default.createElement(ub,null),t?Nj.default.createElement(cR,{networkId:e}):null)}),ub=()=>Nj.default.createElement(gA,{alignItems:"center",justifyContent:"center",size:bc,backgroundColor:"areaBase",borderRadius:"circle"},Nj.default.createElement(_t.Coin,{size:"50%",color:"borderBase"})),pR=({disableBadge:e,tokenType:A,chain:j})=>e?!1:bj.get(j).alwaysShowNetworkBadge?!0:!ZA(A),cR=({networkId:e})=>Nj.default.createElement(gA,{right:"-2",bottom:"-2",position:"absolute",borderColor:"elementBase",borderStyle:"solid",borderWidth:2,style:{borderRadius:9}},Nj.default.createElement(mB,{networkID:e,size:18}));n();s();var Xn=q(P()),lb=({image:e,name:A,symbol:j,onPress:t})=>Xn.default.createElement(gA,{backgroundColor:"elementBase",borderRadius:"row",padding:16,onPress:t},Xn.default.createElement(gA,{gap:12},e,Xn.default.createElement(gA,{gap:4,alignItems:"flex-start"},Xn.default.createElement(Pe,null,A),Xn.default.createElement(Pe,{color:"textDiminished"},j))));var Di=aj.default.memo(({enabledAddressTypes:e,selectedAccount:A,tokenWithMetadata:j,type:t,onPress:r})=>{let{token:o,addressType:i}=j,{caip19:a,logoURI:u,name:c,symbol:l}=o,{chainId:m}=a,B=Jk(a),{t:k}=hA(),f=c??k("assetDetailUnknownToken"),g=(0,aj.useMemo)(()=>{let h=A?.addresses.find(y=>i?y.addressType===i&&y.networkID===m:y.networkID===m)?.address??"";return I.isEVMNetworkID(m)?h.toLowerCase():h},[A,i,m]),E=(0,aj.useCallback)(()=>{r({tokenWithMetadata:j,ownerPublicKey:g})},[r,j,g]);return i&&!e.includes(i)?aj.default.createElement(aj.default.Fragment,null):t==="card"?aj.default.createElement(lb,{onPress:E,image:aj.default.createElement(fm,{logoURI:u,networkId:a.chainId,type:B}),name:f,symbol:l}):aj.default.createElement(ho,{onPress:E,start:aj.default.createElement(fm,{logoURI:u,networkId:a.chainId,type:B}),topLeft:{text:f,after:aj.default.createElement(kB,{networkID:a.chainId,address:g})},bottomLeft:l})});var db=({enabledAddressTypes:e,group:A,groupIndex:j,selectedAccount:t,onTokenPress:r})=>{let o=j===0;return no.default.createElement(gA,{key:A.groupName,marginTop:o?8:24},no.default.createElement(Pe,{font:Sj?"bodyMedium":"title3Semibold",color:"textDiminished",marginBottom:8},A.groupName),no.default.createElement(gA,{flexWrap:"wrap",direction:"row",gap:o?0:"list"},A.tokens.map((i,a)=>{let{token:u,addressType:c}=i,l=`${u.symbol}-${u.caip19.chainId}-${a}`;return c&&!e.includes(c)?null:o?no.default.createElement(gA,{key:l,flexBasis:"50%",paddingLeft:a%2===0?0:4,paddingRight:a%2===0?4:0,paddingBottom:a>=A.tokens.length-2?0:8},no.default.createElement(Di,{enabledAddressTypes:e,selectedAccount:t,tokenWithMetadata:A.tokens[a],type:"card",onPress:r})):no.default.createElement(Di,{key:l,tokenWithMetadata:A.tokens[a],enabledAddressTypes:e,selectedAccount:t,type:"row",onPress:r})})))};var mb=Wn.default.memo(({groupedTokens:e,enabledAddressTypes:A,selectedAccount:j,onTokenPress:t})=>Wn.default.createElement(Wn.default.Fragment,null,Wn.default.createElement(wc,{marginBottom:16}),e.map((r,o)=>Wn.default.createElement(db,{enabledAddressTypes:A,group:r,groupIndex:o,key:r.groupName,onTokenPress:t,selectedAccount:j}))));n();s();var Jn=q(P());var kb=Jn.default.memo(({enabledAddressTypes:e,searchedTokens:A,selectedAccount:j,onTokenPress:t})=>Jn.default.createElement(Jn.default.Fragment,null,A.map((r,o)=>Jn.default.createElement(gA,{key:`${r.token.symbol}-${r.token.caip19.chainId}-${o}`,marginBottom:8},Jn.default.createElement(Di,{enabledAddressTypes:e,selectedAccount:j,tokenWithMetadata:r,type:"row",onPress:t})))));var Bb=e=>{let{isLoading:A,isSearching:j,searchedTokens:t,selectedAccount:r,enabledAddressTypes:o,onTokenPress:i,groupedTokens:a}=e;return pj.default.createElement(pj.default.Fragment,null,A?pj.default.createElement(uR,null):j?pj.default.createElement(pj.default.Fragment,null,t.length>0?pj.default.createElement(kb,{searchedTokens:t,selectedAccount:r,enabledAddressTypes:o,onTokenPress:i}):pj.default.createElement(lR,null)):pj.default.createElement(mb,{enabledAddressTypes:o,groupedTokens:a,selectedAccount:r,onTokenPress:i}))},uR=()=>pj.default.createElement(gA,{gap:"list",paddingTop:"screen"},[...Array(3)].map((e,A)=>pj.default.createElement(Fo,{key:A,topRight:!1,bottomRight:!1}))),lR=()=>{let{t:e}=hA();return pj.default.createElement(gA,{flex:1,alignItems:"center",justifyContent:"center"},pj.default.createElement(Pe,{font:"body",color:"textDiminished",align:"center"},e("noBuyOptionsAvailableInCountry")))};var fb={container:Wc({display:"flex",flexDirection:"column",height:"100%"}),listContainer:Wc({overflow:"auto",minHeight:0,paddingTop:16,paddingBottom:80})},gb=({platform:e,navigateToForm:A,onBackPress:j})=>{let{t}=hA(),r=cb({platform:e,version:xA,onClosePress:j,onNextPress:A});return Yn.default.createElement(gA,{flex:1,className:fb.container},Yn.default.createElement(Fk,{id:"search",label:"Search",showLabel:!1,placeholder:t("assetListSearch"),setValue:r.setSearchTerm,value:r.searchTerm||""},Yn.default.createElement(_t.Search,{size:16,color:"textDiminished"})),Yn.default.createElement(gA,{flex:1,className:fb.listContainer},Yn.default.createElement(Bb,{...r})))};n();s();n();s();var yb=q(P());n();s();var Se=q(P());n();s();var Ni=q(P()),Ic=({assets:e,name:A,onClick:j,estimatedArrival:t})=>Ni.default.createElement(wk,{rows:[{type:"base",start:e.roundIcon?Ni.default.createElement(gA,{borderRadius:"circle",padding:8,backgroundColor:"black"},Ni.default.createElement(ct,{width:40,height:40,borderRadius:"circle",src:e.icon})):void 0,topLeft:A,bottomLeft:{before:Ni.default.createElement(_t.Clock,{color:"textDiminished",size:14}),text:t},onPress:j}]});var Eb=({platform:e,navigateToForm:A})=>{let{t:j}=hA(),t=J(),r=ij(),o=ij(h=>h.setState),{provider:i,fungible:a}=r,{currencyCode:u}=bA(),{data:c,isFetching:l,isPending:m}=yc(e,xA,T.language,{token:a?.caip19,fiatCurrencyCode:u,providerId:i?.id}),{provider:B,paymentMethods:k}=c??{},f=B||i,g=(0,Se.useCallback)(h=>{o({paymentMethod:h,provider:f,checkoutQuoteType:"selected"}),t.capture("fiatOnrampPaymentMethodSelected",{data:{paymentMethodId:h.id}}),A()},[t,A,f,o]),E=(0,Se.useMemo)(()=>l||m?Se.default.createElement(Se.default.Fragment,null,[...Array(3)].map((h,y)=>Se.default.createElement(Fo,{key:y,topRight:!1,bottomRight:!1}))):k?.length===0?Se.default.createElement(dR,null):Se.default.createElement(Se.default.Fragment,null,k?.map(h=>Se.default.createElement(Ic,{key:h.id,onClick:()=>g(h),...h}))),[l,m,g,k]);return Se.default.createElement(gA,{gap:12},Se.default.createElement(Pe,{font:"label",color:"textDiminished",children:j("buyThirdPartyScreenPaymentMethodDescription")}),Se.default.createElement(gA,{gap:8},E))},dR=()=>{let{t:e}=hA();return Se.default.createElement(gA,{flex:1,alignItems:"center",justifyContent:"center"},Se.default.createElement(Pe,{font:"body",color:"textDiminished",align:"center"},e("buyThirdPartyScreenPaymentMethodEmptyState")))};var hb=({platform:e,navigateToAllProviders:A,navigateToForm:j})=>yb.default.createElement(Eb,{platform:e,navigateToAllProviders:A,navigateToForm:j});n();s();var Sb=q(P());n();s();var ve=q(P());var Fb=({platform:e,navigateToPaymentMethods:A})=>{let{t:j}=hA(),t=J(),r=PA("enable-fiat-ramp-provider-quotes"),o=ij(),i=ij(F=>F.setState),{paymentMethod:a,purchaseType:u,purchaseAmount:c,fungible:l,ownerPublicKey:m}=o,{currencyCode:B}=bA(),{data:k,isFetching:f,isPending:g}=hc(e,xA,T.language,{...u==="currency"?{fiatAmount:c}:{tokenAmount:c},token:l?.caip19,fiatCurrencyCode:B,destinationAddress:m&&l?{address:m,chainId:l?.caip19.chainId,resourceType:"address"}:void 0}),E=k?.paymentMethod||a,h=(0,ve.useCallback)(F=>{t.capture("fiatOnrampProviderSelected",{data:{chainId:k?.token?.chainId,providerId:F.id,paymentMethodId:E?.id,destinationAmount:F.quote?.displayDestinationAmount,sourceAmount:F.quote?.displaySourceAmount,asset:k?.token,tag:F.tag}}),i({provider:F,paymentMethod:E,checkoutQuoteType:"selected"}),A?.()},[t,k?.token,i,E,A]),y=(0,ve.useMemo)(()=>k?.providers.map((F,w)=>{let x=F.id===o.provider?.id;return r?{type:"base",start:ve.default.createElement(ct,{width:48,height:48,borderRadius:6,src:F.logo}),topLeft:F.name,topRight:{text:F.quote?.displayDestinationAmount,color:"textBase"},bottomRight:F.quote?.displaySourceAmount?{text:`~${F.quote.displaySourceAmount}`}:void 0,bottomLeft:F.tag&&{text:F.tag,color:w===0?"spotPositive":"textDiminished"},onPress:()=>h(F)}:{type:"radio",active:x,start:ve.default.createElement(ct,{width:24,height:24,borderRadius:6,src:F.logo}),topLeft:F.name,topRight:F.tag,onPress:()=>h(F)}})??[],[o.provider?.id,r,h,k?.providers]);return ve.default.createElement(gA,{gap:16},ve.default.createElement(Pe,{font:"label",color:"textDiminished",children:j("buyThirdPartyScreenProvidersDescription")}),ve.default.createElement(gA,{gap:8},f||g?ve.default.createElement(kR,null):k?.providers.length===0?ve.default.createElement(mR,null):y.map(F=>ve.default.createElement(ho,{...F,key:F.topLeft}))))},mR=()=>{let{t:e}=hA();return ve.default.createElement(gA,{flex:1,alignItems:"center",justifyContent:"center"},ve.default.createElement(Pe,{font:"body",color:"textDiminished",align:"center"},e("buyThirdPartyScreenProvidersEmptyState")))},kR=()=>[...Array(3)].map((e,A)=>ve.default.createElement(Fo,{key:A,topRight:!1,bottomRight:!1}));var wb=({platform:e,navigateToPaymentMethods:A})=>Sb.default.createElement(Fb,{platform:e,navigateToPaymentMethods:A});n();s();var ER=q(P());n();s();var gR=q(P());n();s();var hR=q(P());n();s();var yR=q(P());n();s();var Zn=q(P()),bb=Zn.default.memo(e=>{let{name:A,tag:j,logo:t,quote:r,onClick:o,index:i}=e,a={start:Zn.default.createElement(ct,{width:44,height:44,borderRadius:"circle",src:t}),topLeft:A,bottomLeft:j&&{text:j,color:i===0?"spotPositive":"textDiminished"},onPress:()=>o(e)},u=r?{...a,topRight:r.displayDestinationAmount,bottomRight:`\u2248 ${r.displaySourceAmount}`}:{...a,end:Zn.default.createElement(gA,{direction:"row",alignItems:"center",gap:4},Zn.default.createElement(_t.ChevronRight,{color:"textDiminished",size:16}))};return Zn.default.createElement(ho,{...u})});n();s();n();s();n();s();var so=q(P());n();s();var $c=q(P());var vc=({clientPlatform:e,appVersion:A,locale:j,caip19:t,addressType:r,enabled:o=!0,destinationAddress:i})=>{let{data:a,isLoading:u,isError:c,isFetched:l}=pA(),{data:m=[],isLoading:B,isError:k,isFetched:f}=Vn(e,A,j,o),g=(0,$c.useMemo)(()=>{if(t)return m.find(h=>r&&I.getChainName(TA(t).chainId)===I.bitcoin.name?M(h.token.caip19)===t&&"addressType"in h&&h.addressType===r:M(h.token.caip19)===t)},[r,t,m]),E=(0,$c.useMemo)(()=>{if(!g)return"";if(i)return i;let h=a?.addresses.find(y=>g?.addressType?y.addressType===g.addressType&&y.networkID===g?.token.caip19.chainId:y.networkID===g?.token.caip19.chainId)?.address??"";return g?.token.caip19.chainId&&I.isEVMNetworkID(g.token.caip19.chainId)&&(h=h.toLowerCase()),h},[i,a?.addresses,g]);return(0,$c.useMemo)(()=>({tokenToBuy:g,destinationAddress:E,isLoading:u||B,isError:c||k,isFetched:l&&f}),[E,k,c,f,l,B,u,g])};var Ib=({caip19:e,amount:A,clientPlatform:j,redirectURL:t,addressType:r,destinationAddress:o,provider:i,paymentMethod:a,navigateToFiatRampForm:u,onClose:c,captureAnalyticsEvent:l})=>{let{setState:m}=ij(),{tokenToBuy:B,destinationAddress:k,isLoading:f,isError:g,isFetched:E}=vc({clientPlatform:j,appVersion:xA,locale:T.language,caip19:e,addressType:r,destinationAddress:o}),h=(0,so.useMemo)(()=>{if(B)return{token:B?.token.caip19,providerId:i,paymentMethodId:a,destinationAddress:{address:k,chainId:B?.token.caip19?.chainId,resourceType:"address"}}},[B,i,a,k]),{data:y,isLoading:F}=Fc(j,xA,T.language,h??{},!!h&&!!i&&!!a),w=(0,so.useMemo)(()=>e?F?!1:!!B&&!!k:!0,[e,F,k,B]),x=(0,so.useCallback)(()=>{!e||!B||!k||m({...Pt,onClose:c??(()=>{}),ownerPublicKey:k,fungible:B?.token,purchaseAmount:A??Pt.purchaseAmount,redirectURL:t,provider:y?.provider,paymentMethod:y?.paymentMethod})},[e,B,k,m,c,A,t,y?.provider,y?.paymentMethod]),G=(0,so.useCallback)(()=>{if(!e){l?.(),u?.();return}!B||!k||(x(),l?.(),u?.())},[e,l,k,u,x,B]);return(0,so.useMemo)(()=>({canBuy:w,openBuy:G,saturateState:x,resolvedDestinationAddress:k,token:B,isLoading:f,isError:g,isFetched:E}),[w,k,g,E,f,G,x,B])};n();s();var wR=new Fe("Failed to get FiatRampProviderUrl"),bR=async(e,A,j,t,r)=>{try{let o={"x-client-platform":e,"x-client-app-version":A,"x-client-locale":j},i=await N.api().headers(o).bearer(r).post("/fiat_ramp/v2/onramp/provider_url",t);if(!eA(i))throw new Fe(i.data.message);return i.data}catch(o){throw o instanceof Fe?o:wR}};n();s();n();s();var $b=q(P());var vb=3,IR=`v${vb}`,$R=p.string().regex(/^v?\d+$/),qc=()=>{let e=is("latest-terms-of-service-version-number")??IR;return(0,$b.useMemo)(()=>$R.safeParse(e).success?Number(e.replace("v","")):vb,[e])};var gm=()=>{let e=yA(),A=cA(),j=qc();return wA({mutationFn:async r=>{r?await $f(e,j):await qf(e),A.setQueryData(["termsHaveBeenAcknowledgedLastSeenVersion",j],j)}})};n();s();var Li=()=>{let e=yA(),A=qc(),j=async()=>await vf(e)>=A;return X({queryKey:["termsHaveBeenAcknowledgedLastSeenVersion",A],queryFn:j})};n();s();n();s();var TR=q(P());n();s();var qb=yo(J,e=>new Em(e)),Em=class{#A;constructor(A){this.#A=A}onOpen=()=>this.#A.capture("connectHardwareOpen");onSelectedChains=A=>{let j=new Set(A),t=[];for(let o of I.getAllChainIDs())j.has(o)&&t.push(o);let r={numChains:t.length,selectedChains:t.map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(", ")};this.#A.capture("connectHardwareSelectedChains",{data:r})};onDerivedAccounts=A=>{let j={};for(let[t,r]of Object.entries(A.derivedAddresses)){if(!vR(t))continue;let o={numberOfDerivedAccounts:r.addresses.length};r.duration!==void 0&&(o.derivationDuration=r.duration),j[t]=o}this.#A.capture("connectHardwareAccountsDerived",{data:{...j}})};onDiscoveredAccounts=A=>{let{discoveredAccounts:j}=A,t={};for(let r of j){if(r.status==="undiscovered")continue;let o=r.accounts.reduce((i,{derivationPathType:a,hasAccountActivity:u})=>{let c=fr.getAddressType(a);return i[c]={derivationPathType:a,hasAccountActivity:u},i},{});for(let{hasAccountActivity:i,derivationPathType:a}of Object.values(o)){if(!i)continue;let u=t[a]??0;t[a]=u+1}}this.#A.capture("connectHardwareAccountsDiscovered",{data:{numberOfActiveAccounts:t}})};onConnectedAccounts=A=>{let j={};for(let t of A.accounts){let r=[...t.addresses,...t.publicKeys].reduce((o,i)=>{let a=fr.getAddressType(i.pathType);return o[a]=i.pathType,o},{});for(let o of Object.values(r)){let i=j[o]??0;j[o]=i+1}}this.#A.capture("connectHardwareAccountsConnected",{data:{numberOfAccountsImported:A.accounts.length,numberOfAccountsImportedByDerivationPath:j}})}};function vR(e){return typeof e!="string"?!1:Object.keys(Jc).includes(e)}n();s();n();s();var IWA=["firstTimeOnboarding","isResettingApp"],xb=["seed","seedless","privateKey"],$WA="https://phantom-wallet.zendesk.com/hc/en-us/articles/33478025712531";n();s();n();s();var xc="@phantom/onboarding",Gt={firstTimeOnboarding:[`${xc}:first-time-onboarding`],isResettingApp:[`${xc}:is-resetting-app`],deriveLedgerAccounts:[`${xc}:derive-ledger-accounts`],discoverLedgerAccounts:[`${xc}:discover-ledger-accounts`]};n();s();n();s();n();s();n();s();var PR="/discover/v1",GR={Accept:"application/json"},CR=e=>{if(!e||!Array.isArray(e.accounts))return!1;for(let A of e.accounts)if(!(typeof A.address=="string"&&typeof A.amount=="string"&&(!A.lastActivityTimestamp||typeof A.lastActivityTimestamp=="number")&&A.chain&&typeof A.chain.id=="string"&&new Set(I.getAllNetworkIDs()).has(A.chain.id)&&typeof A.chain.name=="string"&&typeof A.chain.symbol=="string"&&typeof A.chain.imageUrl=="string"))return!1;return!0},OR=e=>!!e&&typeof e.message=="string",ym=async e=>{if(!e.accounts.length)throw new Error("Must send at least 1 account for discovery");let A=await N.api().headers(GR).post(PR,e),j=A.data;if(!eA(A))throw OR(j)?new Error(j.message):new Error(`Unable to discover accounts with args: ${JSON.stringify(e)}`);if(CR(j))return j;throw new Error(`Invalid discover accounts response: ${JSON.stringify(j)}`)};var MR="fetch-multi-chain-accounts-by-seed",RR=()=>["bitcoinTaproot","bitcoinNativeSegwit"],_R=()=>["bip44Change","bip44","deprecated"],DR=()=>["bip44Ethereum","bip44EthereumSecondary","bip44EthereumTertiary"],NR=()=>["bip44Sui"],LR=(e,A)=>RR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=fr.getAddressType(j),i=ss({publicKey:r,addressType:o});return{chainType:o,chainId:oA.Bitcoin.Mainnet,address:i,publicKey:Buffer.from(r).toString("hex"),pathParams:t}}),KR=(e,A)=>DR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=fr.getAddressType(j),i=ss({publicKey:r,addressType:"eip155"});return{chainType:o,pathType:j,address:i,publicKey:Buffer.from(r).toString("hex"),pathParams:t}}),UR=(e,A)=>_R().map(j=>{let t={pathType:j,index:e},r=A.derivePathType(j,e),o;switch(j){case"bip44Root":case"bip44":case"bip44Change":o=r.publicKey;break;case"deprecated":o=Jm(r.secretKey).publicKey;break}let i=ss({publicKey:o,addressType:"solana"});return{chainType:"solana",chainId:oA.Solana.Mainnet,address:i,publicKey:Buffer.from(o).toString("hex"),pathParams:t}}),HR=(e,A)=>NR().map(j=>{let t={pathType:j,index:e},{publicKey:r}=A.derivePathType(j,e),o=ss({publicKey:r,addressType:"sui"});return{chainType:"sui",chainId:oA.Sui.Mainnet,address:o,publicKey:Ym(r),pathParams:t}}),QR=1e4,Tb=async(e,A=!0)=>{let j=Object.assign({},...e);try{let t=Object.values(j).map(({account:m})=>({address:m.address,chainId:m.chainId})),r;A?r=(await fo(async()=>ck(ym({accounts:t}),QR),()=>!0,2)).accounts:r=(await ym({accounts:t})).accounts;let o={};for(let m of r){let{account:B}=j[`${m.chain.id}-${m.address}`],k=B.publicKey,f=B.chainType,g=Zi(B.pathParams),E={...m,publicKey:k,chainType:f,derivationPathType:B.pathParams.pathType,hasAccountActivity:!!m.lastActivityTimestamp||parseFloat(m.amount)>0};o[g]=[...o[g]||[],E]}Object.keys(o).forEach(m=>{o[m]=o[m].sort((B,k)=>I.compareNetworkID(B.chain.id,k.chain.id))});let i=Object.values(o),a=i.filter(m=>m.some(B=>B.hasAccountActivity)),u=!!a.length;return(u?a:i).map(m=>{let B=m[0];return{status:"discovered",seedIndex:j[`${B.chain.id}-${B.address}`].account.pathParams.index??-1,isSelectedByDefault:u,accounts:m}})}catch{let t=Object.values(j).map(({account:a})=>a),r={};for(let a of t){let{account:u}=j[`${a.chainId}-${a.address}`],c=Zi(u.pathParams),l={...a,chain:{id:a.chainId,name:I.getNetworkName(a.chainId),symbol:I.getTokenSymbol(a.chainId)},chainType:fr.getAddressType(u.pathParams.pathType),derivationPathType:u.pathParams.pathType,hasAccountActivity:!1};r[c]=[...r[c]||[],l]}return Object.keys(r).forEach(a=>{r[a]=r[a].sort((u,c)=>I.compareNetworkID(u.chain.id,c.chain.id))}),Object.values(r).map(a=>{let u=a[0];return{status:"undiscovered",seedIndex:j[`${u.chain.id}-${u.address}`].account.pathParams.index??-1,accounts:a,isSelectedByDefault:!1}})}},VR=async({hdWallet:e,startIndex:A,endIndex:j,enabledAddressTypes:t,enabledChains:r})=>{let o=[];for(let i=A;i<=j;++i){let a={};if(t.includes("bip122_p2wpkh"))for(let u of LR(i,e))a[`${oA.Bitcoin.Mainnet}-${u.address}`]={account:u};if(t.includes("eip155")){let u=KR(i,e),c=r.filter(l=>I.isEVMNetworkID(I[l].mainnetID));for(let l of c){let m=I[l];for(let{address:B,publicKey:k,chainType:f,pathParams:g}of u)a[`${m.mainnetID}-${B}`]={account:{chainType:f,chainId:m.mainnetID,address:B,publicKey:k,pathParams:g}}}}if(t.includes("solana"))for(let u of UR(i,e))a[`${u.chainId}-${u.address}`]={account:u};if(t.includes("sui"))for(let u of HR(i,e))a[`${u.chainId}-${u.address}`]={account:u};o.push(a)}return Tb(o)};function wJA({batchSize:e,hdWallet:A,enabledAddressTypes:j,enabledChains:t}){let r=!!A&&j.length!=0;return Ji({enabled:r,queryKey:[MR,e],queryFn:async({pageParam:u=0})=>{try{if(e<1)throw new Error(`Need positive batchSize: ${e}`);if(!A)throw new Error("Missing HDWallet");let c=[],l=[],m=u===0,B=u,k=!0;for(;k;){let f=B,g=B+e-1,h=(await VR({hdWallet:A,startIndex:f,endIndex:g,enabledAddressTypes:j,enabledChains:t})).flat(1);B+=e,k=!1;for(let y of h)c.push(y),(y.status==="undiscovered"||y.isSelectedByDefault)&&l.push(y),m&&y.status==="discovered"&&y.isSelectedByDefault&&(k=!0)}if(m&&l.length===0&&c.length>1){let f=c[0],g=f.accounts.map(h=>({...h,hasAccountActivity:!1})),E={status:"undiscovered",seedIndex:f.seedIndex,accounts:g,isSelectedByDefault:!1};l.push(E)}return l}catch(c){throw c instanceof Error&&b.captureError(c,"account"),c}},getNextPageParam:(u,c)=>{let l=c.length,m=l?c[0]:[],B=m.length?zR(m[m.length-1].seedIndex,e):0;return l===1?B:B+e*(l-1)},gcTime:0,staleTime:0,initialPageParam:0})}var zR=(e,A)=>Math.ceil(e/A)*A+A;n();s();n();s();var XR=()=>{let e=yA(),A=async()=>{let t=await e.get("firstTimeOnboarding");return t===null?!0:t.isFirstTimeOnboarding},{data:j}=X({queryKey:Gt.firstTimeOnboarding,queryFn:A});return j},WR=()=>{let e=yA(),A=cA();return wA({mutationFn:async t=>{await e.set("firstTimeOnboarding",{isFirstTimeOnboarding:t}),xf(e,t?void 0:Date.now()),A.setQueryData(Gt.firstTimeOnboarding,t)}})};n();s();var JR=()=>{let e=yA(),A=async()=>{let t=await e.get("isResettingApp");return t===null?{isResettingApp:!1,isFirstTimeResettingApp:!1}:t},{data:j}=X({queryKey:Gt.isResettingApp,queryFn:A});return j},YR=()=>{let e=yA(),A=cA();return wA({mutationFn:async t=>{let o=(await e.get("isResettingApp"))?.isFirstTimeResettingApp??!1;await e.set("isResettingApp",{isResettingApp:t,isFirstTimeResettingApp:o}),A.setQueryData(Gt.isResettingApp,{isResettingApp:t,isFirstTimeResettingApp:o})}})},ZR=()=>{let e=yA(),A=cA();return wA({mutationFn:async t=>{let o=(await e.get("isResettingApp"))?.isResettingApp??!1;await e.set("isResettingApp",{isResettingApp:o,isFirstTimeResettingApp:t}),A.setQueryData(Gt.isResettingApp,{isResettingApp:o,isFirstTimeResettingApp:t})}})};n();s();n();s();var A_=q(P());var e_=0,BYA=`v${e_}`,fYA=p.string().regex(/^v?\d+$/);n();s();n();s();var t_=q(aI()),r_=q(P());n();s();var io=q(P());function hm({userProfileError:e=void 0,userProfile:A,selectedAccount:j,accounts:t=[]}){b.addBreadcrumb("Auth","Checking whether user is eligible to claim a username","info");let r=e instanceof Bk;if(Xi()||!j||!!e&&!r)return b.addBreadcrumb("Auth","Skipping claim username eligibility check","info"),{isEligible:!1,publicAddresses:{},accounts:[]};let i={};j?.addresses.forEach(B=>{i[B.networkID]=B.address});let a=!!j&&xb.includes(j.type),u=Array.isArray(t)&&t.length>0,c=Object.keys(i).length>0,m=!A&&a&&(u&&c);return b.addBreadcrumb("Auth",`Eligible for Claim Username: ${m}`,"info"),{isEligible:m,publicAddresses:i,accounts:t}}var o_=({onSuccess:e,onError:A}={})=>{let{t:j}=hA(),{mutateAsync:t,isIdle:r,isPending:o,error:i}=kk(),a=ja(),u=Ek(F=>F.username),{data:c,error:l}=gk(),{data:m,refetch:B}=pA(),{data:k,refetch:f}=uk(),{isEligible:g}=(0,io.useMemo)(()=>hm({userProfileError:l,userProfile:c,selectedAccount:m,accounts:k}),[c,l,m,k]),E=(0,io.useCallback)(async()=>{try{let F=await a.getUserProfile(),{data:w}=await f(),{data:x}=await B(),{isEligible:G}=hm({userProfile:F,selectedAccount:x,accounts:w});return G}catch{return!1}},[f,B,a]),h=(0,io.useMemo)(()=>i instanceof Error&&i.message!=="Unknown error"?i.message:j("settingsClaimUsernameError"),[i,j]),y=(0,io.useCallback)(async()=>{let{isEligible:F,publicAddresses:w}=hm({userProfileError:l,userProfile:c,selectedAccount:m,accounts:k});if(!F)throw A?.(),new fk;t({username:u,icon:n_(),addresses:w}).then(()=>e?.()).catch(()=>A?.())},[k,c,l,t,A,e,m,u]);return(0,io.useMemo)(()=>({handleClaimUsername:y,getClaimUsernameEligibility:E,isClaimUsernameEligible:g,claimUsernameErrorMessage:h,isClaimingUsernamePending:o,isClaimUsernameIdle:r}),[y,E,g,h,r,o])},n_=()=>`https://assets.phantom.app/assets/phemojis/variant${s_(1,337)}.png`,s_=(e,A)=>(e=Math.ceil(e),A=Math.floor(A),Math.floor(Math.random()*(A-e)+e));n();s();var i_=(e,A)=>{let{data:j}=pA(),t=PA("enable-cash"),r=j?.isReadOnly,o=A&&parseFloat(A)>0;return e===0&&(!t||!o)&&!r};n();s();var a_=()=>{let{data:e,isLoading:A}=Li(),{mutate:j}=gm();return{shouldShowTermsOfServiceUpdateInterstitial:!A&&!e,setTermsAcknowledgement:j}};n();s();n();s();var u_=()=>{let{data:e}=du(),{data:A}=au({enabled:!!e?.expired}),{data:j=[]}=lk("recoverable-only");return{shouldShowVerifyPinPrompt:hk("SeedlessPinVerification","enable-seedless-pin-verification-interstitial",()=>!!A&&!!e&&e.expired&&j.length>0&&!Xi())}};n();s();n();s();var Tc=q(P());var l_=["enable","reject"],d_=({continueSwap:e,dismiss:A})=>{let j=J(),{setSlippageSetting:t}=MA(),r=(0,Tc.useCallback)(i=>{switch(A(),i){case"enable":j.capture("autoSlippageOptIn",{data:{step:"enabledAutoSlippage"}}),t({type:"auto"}),bn();break;case"reject":j.capture("autoSlippageOptIn",{data:{step:"rejectedAutoSlippage"}}),t({type:"fixed"}),e();break}},[e,A,t,j]),o=(0,Tc.useMemo)(()=>l_.map(i=>({label:T.t(i==="enable"?"swapSlippageOptInEnableOption":"swapSlippageOptInRejectOption"),variant:i==="enable"?"primary":"secondary",onPress:()=>r(i)})),[r]);return{title:T.t("swapSlippageOptInTitle"),description:T.t("swapSlippageOptInSubtitle"),learnMoreText:T.t("commandLearnMore"),learnMoreUrl:Ep,options:o}};n();s();var Pb=q(P());var m_=({goToAssetSelect:e})=>{let{setSearchQuery:A}=$();return(0,Pb.useCallback)(j=>{j==="buy"&&A(""),e(j)},[e,A])};n();s();var Ki=q(P());var Gb="auto-provider-defaulted-to-toast",k_=({showDefaultAutoProvider:e})=>{let{hasDefaultedToBestQuote:A}=aA(),{message:j,hideToast:t}=QA(),r=$(i=>i.setSelectedBaseProvider),o=(0,Ki.useRef)(A);(0,Ki.useEffect)(()=>{o.current=A},[A]),(0,Ki.useEffect)(()=>{A&&setTimeout(()=>{o.current&&(r($e),j({id:Gb,message:T.t("swapProviderAutoUpdateTitle"),icon:"info",onPress:()=>{t(Gb),e()}}))},2e3)},[A,j,t,e,r])};n();s();var Cb=q(P());n();s();var As=q(P());var B_=U(1);function Pc(e,A,j){let t=J(),[r,o]=(0,As.useState)(!1),i=(0,As.useCallback)(async()=>{await t.capture("swapperToggleBestPriceRatio",{data:{unitCurrency:r?"buy token":"sell token"}}),o(!r)},[t,r]),a=$(c=>c.sellFungible),u=$(c=>c.buyFungible);return(0,As.useMemo)(()=>{let c=!1,l="";if(A&&j){let m=u?.data,B=a?.data;if(m&&B){let{buyAmount:k,sellAmount:f}=j,g=mA(k,m.decimals),E=mA(f,B.decimals),h=g.dividedBy(E),y=`1 ${B.symbol} \u2248 ${Gr(h)} ${m.symbol}`,F=`1 ${m.symbol} \u2248 ${Gr(B_.dividedBy(h))} ${B.symbol}`;c=new U(j.buyAmount).isEqualTo(e),l=r?F:y}}return{isBestRate:c,rate:l,flip:i}},[e,j,r,A,a,u,i])}var f_=({selectProvider:e})=>{let{currentQuote:A,quoteResponse:j}=aA(),{currencySymbol:t,fromUsd:r}=bA(),o=A?.buyAmount??"",i=Pc(o,j,A),a=Uo(OA(A)),u=A?.baseProvider.name??"";return{details:(0,Cb.useMemo)(()=>A?dA(A)?E_({quote:A,selectProvider:e,exchangeRate:i,currencySymbol:t,fromUsd:r}):g_({provider:u,sources:a,exchangeRate:i,selectProvider:e}):[],[A,u,a,i,e,t,r]),footnote:T.t("swapProviderPricingFootnote")}},g_=({provider:e,sources:A,exchangeRate:j,selectProvider:t})=>[{label:T.t("swapProviderPricingProvider"),value:e,icon:"chevron-right",onPress:t},{label:T.t("swapProviderPricingMarket"),value:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip}],E_=({quote:e,selectProvider:A,exchangeRate:j,currencySymbol:t,fromUsd:r})=>{let o=e.baseProvider.name,i=ln(e).toString(),a=rj(nt(e));return[{label:T.t("swapProviderPricingProvider"),value:o,icon:"chevron-right",onPress:A},{label:T.t("swapProviderPricingPrice"),value:j.rate,icon:"swap",onPress:j.flip},{label:T.t("swapProviderPricingFees"),value:`${t}${r(Number(i),2)} ${T.t("swapProvidersFee")}`},{label:T.t("swapProviderPricingTime"),value:a}]};n();s();n();s();n();s();var es=q(P());n();s();var Rb=q(P());n();s();var Ob=q(P());var y_={status:!1,timestamp:""},Mb=()=>{let{data:e}=ne({key:"hasViewedAutoSlippageOptIn",queryKey:uA.hasViewedAutoSlippageOptIn()}),{mutateAsync:A}=ce({key:"hasViewedAutoSlippageOptIn",queryKey:uA.hasViewedAutoSlippageOptIn()}),j=(0,Ob.useCallback)(t=>void A({status:t,timestamp:new Date().toISOString()}),[A]);return{viewedOptInState:e??y_,setViewedOptInState:j}};var _b=()=>{let{viewedOptInState:e,setViewedOptInState:A}=Mb(),{selectedSetting:j}=MA(),{reviewInterceptors:t,supportedCustomSimulationToastErrorTypes:r}=fi(),o=qA(),{connection:i}=cj(),a=yA(),u=wj(),c=T.language,l=J(),m=vt(),B=cA(),k=ar(),f=$(x=>x.gasEstimation.estimateWithBuffer),g=MA(),{storePairs:E}=ze(),h=Lj(),{data:[y]}=_A(["enable-ext-swap-commands"]),F=Mt("kill-swapper-simulation")??!1;return{executeInterceptors:(0,Rb.useCallback)((x,G,v,_)=>{for(let C of t)if(C.intercept({hasViewedAutoSlippageOptIn:e.status,selectedSetting:j.type,setHasViewedAutoSlippageOptIn:A,showOverlay:x,swapper:o,connection:i,storage:a,vaultProxy:u,locale:c,analytics:l,resetSwapper:m,queryClient:B,showFungibleDetails:G,showBuyFungibleScreen:v,swapAnalytics:k,gasEstimation:f,slippageSettings:g,navigateToSwapper:_,supportedCustomSimulationToastErrorTypes:r,storePairs:E,isMobile:Je,enableExtSwapCommands:y,authRepository:h,isSimulationKilled:F})==="interrupt")return"interrupt";return"continue"},[t,e.status,j.type,A,o,i,a,u,c,l,m,B,k,f,g,r,E,y,h,F])}};n();s();var Fm=q(P());n();s();var Lb=q(P());n();s();function Db(e){if(e===void 0)return Kj.colors.legacy.textDiminished;let A=parseFloat(e.toFixed(2));switch(!0){case A>=5:return Kj.colors.legacy.spotNegative;case(A>=1&&e<5):return Kj.colors.legacy.spotWarning;case(e>=0&&e<1):return Kj.colors.legacy.spotPositive;default:return Kj.colors.legacy.textDiminished}}n();s();function Nb(e){if(e===void 0)return"-";switch(!0){case e>=1e3:return">1000%";case(e>=.01&&e<1e3):return`${e.toFixed(2)}%`;case(e>0&&e<.01):return"<0.01%";case e===0:return"0%";default:return"-"}}function Gc(e){return(0,Lb.useMemo)(()=>{let A="",j="";if(e===void 0)return;let t=e*100;return A=Db(t),j=Nb(t),{color:A,text:j,percentage:t}},[e])}n();s();var Cc=({priceImpact:e,slippage:A,transferFees:j,shouldShowFees:t,shouldShowPriceImpact:r,shouldShowSlippage:o})=>{let i=Sj?S_:F_;return[...h_({priceImpact:e,slippage:A,transferFees:j}),...i({shouldShowSlippage:o,shouldShowFees:t,shouldShowPriceImpact:r})]},h_=({priceImpact:e,slippage:A,transferFees:j})=>{let t=[];return e&&e.percentage>Id&&t.push("highPriceImpact"),A&&A.percentage>=$d&&t.push("highSlippage"),(j?.totalPercentFees??0)>0&&t.push("transferFees"),t},F_=({shouldShowSlippage:e,shouldShowFees:A,shouldShowPriceImpact:j})=>{let t=[];return t.push("providerPressable"),t.push("exchangeRate"),e&&t.push("slippagePressable"),A&&t.push("fees"),j&&t.push("priceImpact"),t},S_=({shouldShowSlippage:e,shouldShowFees:A,shouldShowPriceImpact:j})=>{let t=[];return t.push("pricing"),A&&t.push("fees"),j&&t.push("priceImpact"),e&&t.push("slippagePressable"),t};n();s();function Oc(e,A){let j="",t="";if(e===void 0)return;j=w_(e);let r=A==="auto"?`${T.t("swapSettingsAuto")} \u2022 `:"";return t=b_(e),{color:j,text:t,percentage:e,prefix:r}}function w_(e){let A=parseFloat(e.toFixed(2));switch(!0){case A>2:return Kj.colors.legacy.spotNegative;case(A>=1&&e<=2):return Kj.colors.legacy.spotWarning;default:return Kj.colors.legacy.textDiminished}}function b_(e){switch(!0){case e>=1e3:return">1000%";case(e>=.01&&e<1e3):return`${e.toFixed(2)}%`;case(e>0&&e<.01):return"<0.01%";case e===0:return"0%";default:return"-"}}var Kb=()=>{let{currentQuote:e,quoteResponse:A}=aA(),j=Gc(sr(e)),{selectedSetting:t}=MA(),r=(0,Fm.useMemo)(()=>Oc(A?.slippageTolerance,t.type),[A?.slippageTolerance,t.type]),o=$(c=>c.sellFungible),i=$(c=>c.buyFungible),a=(0,Fm.useMemo)(()=>An([o,i]),[o,i]);return{logSwapHomeState:()=>{let c=Cc({priceImpact:j,slippage:r,transferFees:a,shouldShowFees:!0,shouldShowPriceImpact:!!j,shouldShowSlippage:!!r}),l={slippage:JSON.stringify(r),priceImpact:JSON.stringify(j),rows:c};b.addBreadcrumb("swapper","swap-home","info",Rt(l))}}};n();s();var Ub=q(P());n();s();function Mc({sellFungible:e,totalFees:A,minRequiredBalance:j,currentQuote:t}){let r=e?.type?ZA(e?.type):!1,{source:o,destination:i}=j;if(r){let a=new S(t?.sellAmount??0);return A.plus(a)}else{let a=o.plus(i);return A.plus(a)}}var Hb=()=>{let{currentQuote:e}=aA(),{totalFees:A}=Oj(),j=$(a=>a.sellFungible),t=$(a=>a.buyFungible),r=lr(j),o=ur({sellFungible:j,buyFungible:t});return(0,Ub.useMemo)(()=>Mc({sellFungible:j,totalFees:A.maxAmount??A.amount,minRequiredBalance:{source:r,destination:o},currentQuote:e}),[j,A,r,o,e])};n();s();function Rc({sellFungible:e,sellNativeFungible:A,totalNativeRequirement:j}){let t=e?.data.chain.id,r=A?Ne(A.data.amount,A.data.decimals):"-",o=A?Ne(j,A.data.decimals):"-";return{networkId:t,balance:r,required:o}}n();s();function Qb({quoteResponse:e,hasInsufficientBalance:A,insufficientBalanceArgs:j,isTermsAcknowledged:t,logSwapHomeState:r,goToInsufficientBalance:o,goToSwapTermsOfService:i,onSwap:a,executeInterceptors:u}){if(e)A?o(j):(r(),t?u()==="continue"&&a():i());else return}var Sm=({goToSwapTermsOfService:e,goToInsufficientBalance:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i})=>{let{quoteResponse:a}=aA(),u=$(w=>w.sellFungible),c=u?.data.chain.id,{data:l}=Li(),{logSwapHomeState:m}=Kb(),{fungible:B}=$j({key:c?qo(c,void 0):void 0}),k=Hb(),f=(0,es.useMemo)(()=>new S(B?.data.amount??0).lt(k),[B,k]),g=(0,es.useMemo)(()=>Rc({sellFungible:u,sellNativeFungible:B,totalNativeRequirement:k}),[u,B,k]),E=lp({goToConfirmation:j}),{executeInterceptors:h}=_b(),y=(0,es.useCallback)(()=>h(t,r,o,i),[h,t,r,o,i]);return{onClick:(0,es.useCallback)(()=>Qb({quoteResponse:a,hasInsufficientBalance:f,insufficientBalanceArgs:g,isTermsAcknowledged:l,logSwapHomeState:m,goToInsufficientBalance:A,goToSwapTermsOfService:e,onSwap:E,executeInterceptors:y}),[a,f,g,l,m,A,e,E,y])}};n();s();var Ui=q(P()),wm=q(In());n();s();n();s();var Vb=({sellFungible:e,totalFees:A,transactionSpeedsToUnitCost:j,currentQuote:t,isBridge:r,minRequiredBalance:o,customPriorityFee:i,customTip:a})=>{let u=e?mn({sellFungible:e,totalFees:A.amount,transactionSpeedsToUnitCost:I.isEVMNetworkID(e.data.chain.id)?j:void 0,isBridge:r,minRequiredBalance:o,customPriorityFee:i,customTip:a}):"0",c=e?.data.decimals;return t?.sellAmount?new U(mA(t.sellAmount,c??0)).isLessThanOrEqualTo(new U(u)):!0};var zb=({sellFungible:e,isFetchingQuote:A,quoteResponse:j,currentQuote:t,gasEstimation:r,maxGasEstimation:o,hasNoRoutes:i,totalFees:a,transactionSpeedsToUnitCost:u,isBridge:c,minRequiredBalance:l,shouldSkipSwapReview:m,numTransactions:B,customPriorityFee:k,customTip:f})=>{let g=Vb({sellFungible:e,totalFees:a,transactionSpeedsToUnitCost:u,currentQuote:t,isBridge:c,minRequiredBalance:l,customPriorityFee:k,customTip:f});switch($_({quoteResponse:j,sellFungible:e,currentQuote:t,hasNoRoutes:i,hasEnoughAssets:g,isFetchingQuote:A,gasEstimation:r,maxGasEstimation:o,shouldSkipSwapReview:m,numTransactions:B})){case"notSwappable":return{title:T.t("swapReviewFlowActionButtonPrimary"),type:"secondary",disabled:!0};case"swappable":return{title:T.t("swapReviewFlowActionButtonPrimary"),type:"primary",disabled:!1};case"reviewable":return{title:T.t("swapFlowActionButtonText"),type:"primary",disabled:!1};case"notReviewable":return{title:T.t("swapFlowActionButtonText"),type:"secondary",disabled:!0};case"insufficientBalance":return{title:T.t("swapReviewInsufficientBalance"),type:"alert",disabled:!0};case"noRoutes":return{title:T.t("swapNoQuotesFound"),type:"secondary",disabled:!0}}},I_=({sellFungible:e})=>{let A=e?.data.chain.id??oA.Solana.Mainnet;return I.isEVMNetworkID(A)};function $_({quoteResponse:e,sellFungible:A,currentQuote:j,hasNoRoutes:t,hasEnoughAssets:r,isFetchingQuote:o,gasEstimation:i,maxGasEstimation:a,shouldSkipSwapReview:u,numTransactions:c}){if(!r)return"insufficientBalance";if(t)return"noRoutes";let l=I_({sellFungible:A}),m=!!(i&&(i??[]).length>=c&&(a??[]).length>=c);return!e||!A||!j||l&&!m||o?u?"notSwappable":"notReviewable":u?"swappable":"reviewable"}function v_({goToInsufficientBalance:e,goToSwapTermsOfService:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i}){let{currentQuote:a,isFetchingQuote:u,quoteResponse:c}=aA(),l=$(AA=>AA.hasNoRoutes),m=$(AA=>AA.sellFungible),B=m?.data.chain.id,{estimate:k,estimateWithBuffer:f}=$(AA=>AA.gasEstimation),g=$(AA=>AA.buyFungible),E=g?.data.chain.id,h=vA(B,E),{totalFees:y}=Oj(),{data:F}=$o({networkID:B}),w=lr(m),x=ur({sellFungible:m,buyFungible:g}),G=$(AA=>AA.sellAmount),v=$(AA=>AA.setIsFetchingQuote),_=$n(),C=(0,wm.default)(_),O=(0,wm.default)(G);(0,Ui.useEffect)(()=>{G!==O&&G&&_&&C&&v(!0)},[G,O,v,_,C]);let{data:D}=pA(),H=(0,Ui.useMemo)(()=>D?.addresses??[],[D]),z=(0,Ui.useMemo)(()=>H.find(AA=>AA.networkID===m?.data.chain.id)?.address??"",[H,m]),{data:L}=Jj({callerAddress:z,quote:a,sellFungible:m}),{data:R}=Qe(),{data:W}=Ve(),{title:K,type:rA,disabled:Y}=zb({sellFungible:m,currentQuote:a,quoteResponse:c,isFetchingQuote:u,isBridge:h,gasEstimation:k,maxGasEstimation:f,hasNoRoutes:l,totalFees:y,transactionSpeedsToUnitCost:F,minRequiredBalance:{source:w,destination:x},shouldSkipSwapReview:!0,numTransactions:L?.transactions?.length??0,customPriorityFee:St(R??0),customTip:St(W??0)}),{onClick:fA}=Sm({goToInsufficientBalance:e,goToSwapTermsOfService:A,goToConfirmation:j,showOverlay:t,showFungibleDetails:r,showBuyFungibleScreen:o,navigateToSwapper:i});return{disabled:Y,title:K,type:rA,onClick:fA}}n();s();n();s();var Hi=q(P());n();s();var Xb=({buyNetwork:e,sellNetwork:A,executionDuration:j,priceImpact:t,slippage:r})=>{let o=[];return o.push("provider"),o.push("exchangeRate"),e&&A&&e!==A&&o.push("network"),r&&o.push("slippage"),o.push("fees"),j>0&&o.push("executionDuration"),t&&o.push("priceImpact"),o};function q_({isSwapReview:e,showProviders:A,showSwapSettings:j,showSwapPricing:t}){let{bestBuyAmount:r,currentQuote:o,hasNoRoutes:i,quoteResponse:a,quotes:u,isFetchingQuote:c}=aA(),l=Pc(r,a,o),m=Gc(sr(o)),{slippageSetting:B,slippageTolerance:k}=bi(),f=(0,Hi.useMemo)(()=>Oc(k,B.type),[k,B.type]),g=Uo(OA(o)),E=nt(o),h=rj(E),[y]=(0,Hi.useState)(h),F=a?.sellToken?.chainId?I.getChainName(a.sellToken.chainId):void 0,w=a?.buyToken?.chainId?I.getChainName(a.buyToken.chainId):void 0,x=Oj(),G=q7(x),v=$(L=>L.sellFungible),_=$(L=>L.buyFungible),C=(0,Hi.useMemo)(()=>An([v,_]),[v,_]),O=!!x.phantomFee.pct,H={exchangeRate:l,priceImpact:m,slippage:f,provider:g,fees:x,executionDuration:E,uiEstimatedTime:y,isFetchingQuote:c,sellNetwork:F,buyNetwork:w,feeBreakdown:G,selectProviderEnabled:!e&&!!g,isSwapReview:e,showProviders:A,showSwapSettings:j,showSwapPricing:t,transferFees:C},z=e?Xb({exchangeRate:l,priceImpact:m,slippage:f,buyNetwork:w,sellNetwork:F,executionDuration:E}):Cc({priceImpact:m,slippage:f,transferFees:C,shouldShowFees:!0,shouldShowPriceImpact:!!m,shouldShowSlippage:!!f});return{exchangeRate:l,hasNoRoutes:i,priceImpact:m,slippage:f,provider:g,fees:x,nrOfQuotes:u.length,executionDuration:E,isFetchingQuote:c,sellNetwork:F,buyNetwork:w,rows:z,sharedRowProps:H,displayPhantomFeeRow:O}}n();s();var at=q(P());n();s();n();s();var _c=class{getRow({quote:A,buyToken:j}){let t=`${_e(mA(A.buyAmount,j.decimals),bj.get(j.networkId).formDisplayPrecision)} ${j.symbol}`;return{type:"standard",key:A.baseProvider.id,logoUri:A.baseProvider.logoUri,topLeft:{text:A.baseProvider.name},topRight:{text:t,color:"textDiminished"}}}getAutoRow(){return{type:"standard",key:$e,topLeft:{text:T.t("selectSwapProviderAutoLabel")},topRight:{text:T.t("selectSwapProviderAutoDescription"),color:"textDiminished"}}}},bm=class extends _c{getRow(A){let{quote:j,currencySymbol:t,fromUsd:r}=A;if(!dA(j))throw new Error("Quote is not a bridge quote");let o=super.getRow(A),i=rj(nt(j)),a=ln(j).toString();return{...o,type:"bridge",bottomLeft:{text:i},bottomRight:{text:`${t}${r(Number(a),2)} ${T.t("swapProvidersFee")}`}}}getAutoRow(){return{type:"bridge",key:$e,topLeft:{text:T.t("selectSwapProviderAutoLabel")},topRight:{text:T.t("selectSwapProviderAutoDescription"),color:"textDiminished"},bottomLeft:{text:T.t("selectSwapProviderAutoTBD")},bottomRight:{text:T.t("selectSwapProviderAutoTBD")}}}},Im=new _c,$m=new bm;var Dc=({quoteResponse:e,buyToken:A,currencySymbol:j,setSelectedProvider:t,fromUsd:r})=>{let o=e.type==="xchain",i=o?$m.getAutoRow():Im.getAutoRow(),a={...i,onPress:()=>t(i.key)},u=e.quotes.reduce((c,l)=>{let B=(o?$m:Im).getRow({quote:l,buyToken:A,currencySymbol:j,fromUsd:r});return[...c,{...B,onPress:()=>t(l.baseProvider.id)}]},[]);return[a,...u]};var x_=({dismiss:e})=>{let{fromUsd:A,currencySymbol:j}=bA(),t=J(),r=qA(),o=Tj(f=>f.setPreferredProvider),i=Tj(f=>f.preferredProvider),[a,u]=(0,at.useState)(i??$e),[c,l]=(0,at.useState)(r.getQuoteProcessorState());(0,at.useEffect)(()=>{let f=r.subscribeQuoteProcessor({onStateChange(g,E){l(E)}});return()=>f()},[r]);let m=(0,at.useMemo)(()=>{let f=c.type;if(f!=="firstQuoteReceived"&&f!=="quoteProcessed")return[];let{response:g,input:E}=c,{buy:h}=E;return Dc({quoteResponse:g,buyToken:{networkId:h.data.chain.id,decimals:h.data.decimals,symbol:h.data.symbol??""},currencySymbol:j,setSelectedProvider:u,fromUsd:A})},[c,j,A]),B=(0,at.useCallback)(()=>{let f=a===$e?void 0:a;o(f),t.capture("swapperProviderSelected",{data:{provider:f}}),e()},[a,o,e,t]),k=(0,at.useMemo)(()=>[{theme:"secondary",disabled:!1,label:T.t("commandCancel"),onPress:e},{theme:"primary",disabled:a===(i??$e),label:T.t("commandApply"),onPress:B}],[B,e,a,i]);return{selectedProvider:a,rows:m,buttons:k}};n();s();var ao=q(P());var T_=({dismiss:e})=>{let{fromUsd:A,currencySymbol:j}=bA(),t=J(),r=$(f=>f.quoteResponse),o=$(f=>f.buyFungible),i=$(f=>f.selectedBaseProvider),a=$(f=>f.setSelectedBaseProvider),u=Tj(f=>f.setPreferredProvider),[c,l]=(0,ao.useState)(i),m=(0,ao.useMemo)(()=>!r||!o?[]:Dc({quoteResponse:r,buyToken:{networkId:o.data.chain.id,decimals:o.data.decimals,symbol:o.data.symbol??""},currencySymbol:j,setSelectedProvider:l,fromUsd:A}),[r,o,j,A,l]),B=(0,ao.useCallback)(()=>{a(c),u(c),t.capture("swapperProviderSelected",{data:{provider:c}}),e()},[c,a,u,e,t]),k=(0,ao.useMemo)(()=>[{background:"element",disabled:!1,label:T.t("commandCancel"),onPress:e},{background:"spot",disabled:c===i,label:T.t("commandApply"),onPress:B}],[B,e,c,i]);return{selectedProvider:c,rows:m,buttons:k}};n();s();var js=q(P());var Qi=UA(e=>({isInitializeComplete:!0,swapMode:void 0,setSwapMode:A=>e({swapMode:A,isInitializeComplete:!1}),setIsInitializeComplete:A=>e({isInitializeComplete:A})})),P_=Qi.getState().setSwapMode,G_=()=>Qi(e=>e.isInitializeComplete===!1),C_=()=>{let e=qA(),A=Eo(),j=It(),{pairs:t}=ze(),r=(0,js.useMemo)(()=>A.find(c=>j.includes(c))??"solana:101",[A,j]),o=Qi(c=>c.swapMode),i=Qi(c=>c.setSwapMode),a=Qi(c=>c.setIsInitializeComplete);(0,js.useEffect)(()=>e.subscribeToken({onStateChange:l=>{l.type==="initializeCompleted"&&a(!0)}}),[e,a]);let u=(0,js.useMemo)(()=>{if(!t)return{sellCaip19:void 0,buyCaip19:void 0};let c=B=>B&&A.includes(B.data.chain.id)&&j.includes(B.data.chain.id),l=c(t.sellFungible)?t.sellFungible:void 0,m=c(t.buyFungible)?t.buyFungible:void 0;return{sellCaip19:l?M(V(l)):void 0,buyCaip19:m?M(V(m)):void 0}},[t,A,j]);return(0,js.useMemo)(()=>{if(o)return o;let c,l=O_(u);return l?c=l:c={type:"swap",network:r,takerCaip19:void 0,takerDestinationCaip19:void 0},i(c),c},[r,u,o,i])},O_=e=>e.sellCaip19&&e.buyCaip19?{type:"swap",network:TA(e.sellCaip19).chainId,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:void 0,takerDestinationCaip19:void 0}:null;function M_(e,A){if(e||A)return{type:"swap",network:TA(e??A).chainId,...e&&{sellCaip19:e},...A&&{buyCaip19:A},takerCaip19:void 0,takerDestinationCaip19:void 0}}n();s();var KA=q(P());n();s();function Nc(e,A,j,t){if(j==="sell")return t.includes("insufficientBalance");let r=e?.sellAmount,o=A.find(i=>i.percentage===1)?.amount.toString();return!!r&&!!o&&new S(r).gt(o)}var R_=e=>{let{tokenState:A,quotedAmounts:j,quoteProcessorState:t,sellPercentages:r,inputErrors:o,setAmount:i}=e,a=PA("enable-be-swapper-max-amount"),[u,c]=(0,KA.useState)(void 0),[l,m]=(0,KA.useState)(""),[B,k]=(0,KA.useState)("crypto"),[f,g]=(0,KA.useState)("sell"),E=(0,KA.useRef)(!1),{currencySymbol:h,toUsd:y,fromUsd:F}=bA(),w=oa(),{balanceDisplayStrategy:x}=fi(),G=pi(),v=ui(),_=qA(),C=(0,KA.useCallback)((AA,nA,jA)=>{if(c(void 0),AA===""){m(AA),i({amount:"0",denomination:B,perspective:nA,tokenStateOverride:jA});return}let sA=De(AA);z_(sA)&&(m(sA),i({amount:B==="fiat"?String(y(sA)):sA,denomination:B,perspective:nA,tokenStateOverride:jA}))},[B,m,i,y]),O=(0,KA.useCallback)((AA,nA)=>{f==="buy"&&g("sell"),c(AA);let jA=AA.getAmountForDenomination(B),sA=F(jA.toString());m(X_(new U(sA),B,nA)),i({amount:jA.toString(),denomination:B,perspective:"sell"})},[c,f,B,i,F]),D=(0,KA.useCallback)(()=>{_.switchTokens()},[_]),H=(0,KA.useCallback)(AA=>{let nA=H_({perspective:f,currencyDenomination:B,quotedAmounts:j,fromUsd:F});nA&&C(nA.toString(),f,AA)},[B,f,C,j,F]);(0,KA.useEffect)(()=>_.subscribeToken({onStateChange:(nA,jA,sA)=>{nA.type==="switchTokens"&&(H(sA),E.current=!0,a&&_.refreshPair({swapMode:nA.mode,cashAddresses:G,settings:v})),a&&nA.type==="changeToken"&&(E.current=!0,_.refreshPair({swapMode:nA.mode,cashAddresses:G,settings:v}))}}),[_,H,G,v,a]),(0,KA.useEffect)(()=>{E.current&&(E.current=!1,C(l,f))},[r]);let z=(0,KA.useCallback)(()=>{let AA=B==="crypto"?"fiat":"crypto";if(k(AA),!!j)switch(AA){case"crypto":let nA=qm(f,j);m(nA.toString());break;case"fiat":let jA=vm(f,j)?.toFixed(2)??"0",sA=F(jA);m(String(sA));break}},[B,f,j,F]),L=(0,KA.useMemo)(()=>yp(),[]),{sellAsset:R,buyAsset:W}=Wb(A),K=Fi({sellAsset:R,buyAsset:W,currencyDenomination:B}),rA=(0,KA.useMemo)(()=>U_(["sell","buy"],AA=>__({perspective:AA,tokenState:A,quoteProcessorState:t,currencyDenomination:B,currentPerspective:f,inputAmount:l,inputErrors:o,isBalanceHidden:w,balanceDisplayStrategy:x,sellPercentages:r,currencyDenominationSupportRules:L,isBuyAmountEditable:K,quotedAmounts:j,currencySymbol:h,fromUsd:F})),[B,l,o,w,x,r,f,t,j,A,L,K,h,F]),Y=(0,KA.useCallback)(()=>{C("",f)},[C,f]);(0,KA.useEffect)(()=>{let AA=_.subscribeToken({onStateChange(nA,jA,sA){!Oe(jA)||!Oe(sA)||nA.type==="changeToken"&&jA.sellToken.data.tokenAddress!==sA.sellToken.data.tokenAddress&&Y()}});return()=>AA()},[_,Y]),(0,KA.useEffect)(()=>_.subscribeAccountChange({onAccountChange:nA=>{Y(),_.stopQuoteProcessor();let jA=_.getTokenState(),sA=nA.addresses[0];Oe(jA)&&sA&&_.initializeSwap({swapMode:{type:"swap",network:sA.networkID,takerCaip19:void 0,takerDestinationCaip19:void 0},cashAddresses:G,settings:v})}}),[_,Y,G,v]);let fA=(0,KA.useCallback)(AA=>{if(g(AA),!j||!Oe(A))return;let{sellAsset:nA,buyAsset:jA}=Wb(A);if(!(AA==="sell"?nA:jA))return;let CA,lA;switch(B){case"crypto":CA=qm(AA,j).toString(),lA=CA;break;case"fiat":let YA=vm(AA,j)?.toFixed(2)??"0";CA=String(F(YA)),lA=YA;break}m(CA),i({amount:lA,denomination:B,perspective:AA})},[B,j,A,F,m,i]);return{inputAmount:l,tokens:rA,currencyDenomination:B,inputPerspective:f,tokenState:A,quotedAmounts:j,quoteProcessorState:t,inputErrors:o,currentSellPercentage:u,sellPercentages:r,switchTokens:D,setInputAmount:C,switchCurrencyDenomination:z,setSellPercentage:O,clearInput:Y,setInputPerspective:fA}};function __({perspective:e,tokenState:A,quoteProcessorState:j,currencyDenomination:t,currentPerspective:r,inputAmount:o,inputErrors:i,isBalanceHidden:a,balanceDisplayStrategy:u,sellPercentages:c,currencyDenominationSupportRules:l,isBuyAmountEditable:m,quotedAmounts:B,currencySymbol:k,fromUsd:f}){if(!Oe(A))return;let g=L_(e,B),E=K_(e,r,A,o,B),h=t==="crypto"?g:new U(f(E)).toFixed(2),y=V_(o);e===r?h=o:y.gt(0)||(h="");let F=l.every(O=>O.isSupported(e,A.sellToken,A.sellTokenPrice?.usd,A.buyToken,A.buyTokenPrice?.usd)),w=e==="sell"?A.sellToken:A.buyToken,x=t==="crypto"?`${k}${new U(f(E)).toFixed(2)}`:N_(g,w),G=c.find(O=>O.percentage===1)?.amount.toString(),v=e==="sell"?G:void 0,_=D_(B,c,r,i);return{perspective:e,fungible:w,balance:Q_(w,u,a,v),amount:h,secondaryAmount:y.gt(0)?x:"",isAmountLoading:j.type==="starting"&&e!==r,isSecondaryAmountLoading:j.type==="starting",hasAmountWarning:_,isAmountEditable:e==="sell"?!0:m,supportsCurrencyDenominationSwitching:F,amountPrefix:t==="fiat"?k:void 0,percentages:e==="sell"?c:[],warnings:e==="buy"?A.warnings:[]}}function D_(e,A,j,t){return Nc(e,A,j,t)?!0:t.length>0}function N_(e,A){let j=bj.get(A.data.chain.id).formDisplayPrecision;return`${_e(new U(e),j)} ${A.data.symbol??""}`}function L_(e,A){return A?qm(e,A).toString():"0"}function K_(e,A,j,t,r){if(r)return vm(e,r)?.toString()??"0";{if(e!==A||!Oe(j))return"0";let o=e==="sell"?j.sellTokenPrice:j.buyTokenPrice;return o?.usd?new U(t).times(o.usd).toString():"0"}}function vm(e,A){switch(e){case"sell":return A?.sellAmountUsd;case"buy":return A?.buyAmountUsd}}function qm(e,A){switch(e){case"sell":return A.sellAmount;case"buy":return A.buyAmount}}function U_(e,A){return e.reduce((j,t,r)=>{let o=A(t,r,e);return o!=null&&j.push(o),j},[])}function H_({perspective:e,currencyDenomination:A,quotedAmounts:j,fromUsd:t}){if(j)switch(e){case"sell":return A==="crypto"?j.buyAmount:j.buyAmountUsd?new U(t(j.buyAmountUsd.toString(),2)):void 0;case"buy":return A==="crypto"?j.sellAmount:j.sellAmountUsd?new U(t(j.sellAmountUsd.toString(),2)):void 0}}function Q_(e,A,j,t){let r=t?U(t):e.data?.balance;if(!(!r||j))return HA(e)?ra(r):A.format(r,e.data?.symbol??"")}function V_(e){return e==null?new U(0):e===""?new U(0):new U(e)}function z_(e){try{let A=new U(e);return A.isFinite()?!A.isNegative():!1}catch{return!1}}function Wb(e){return Oe(e)?{sellAsset:e.sellToken,buyAsset:e.buyToken}:{sellAsset:void 0,buyAsset:void 0}}var X_=(e,A,j)=>A==="fiat"?e.gte(.01)?e.decimalPlaces(2).toString():e.decimalPlaces(5,U.ROUND_UP).toString():e.decimalPlaces(j.data.decimals).toString();n();s();var AI=q(P());n();s();var Tm=q(P());n();s();var Uc=q(P());n();s();n();s();var Lc=class{constructor(A,j){this.gaslessSwapFeeResult=A;this.insufficientFundsInterceptor=j}intercept(A){return this.gaslessSwapFeeResult.success?"continue":this.insufficientFundsInterceptor.intercept(A)}};n();s();var Kc=class{intercept({hasInsufficientFunds:A,showInsufficientFunds:j}){return A?(j(),"interrupt"):"continue"}};var Jb=e=>{let A=new Kc,j=W_(e);return j?[new Lc(j,A)]:[A]},W_=e=>{if(e.type!=="firstQuoteReceived"&&e.type!=="quoteProcessed")return;let A=e.quote;if(Ke(A))return A.gaslessSwapFeeResult};var Yb=e=>{let A=(0,Uc.useMemo)(()=>Jb(e.quoteProcessorState),[e.quoteProcessorState]);return{executeSwapInterceptors:(0,Uc.useCallback)(()=>{for(let t of A){let r=t.intercept(e);if(r==="interrupt")return r}return"continue"},[A,e])}};n();s();var xm=q(P());var Zb=(e,A)=>{let{sellFungible:j,buyFungible:t}=J_(e),r=Z_(A),o=lr(j),i=ur({sellFungible:j,buyFungible:t}),a=(0,xm.useMemo)(()=>Y_(A),[A]),u=j?.data.chain.id,{fungible:c}=$j({key:u?qo(u,void 0):void 0,enableSorting:!1,enablePrices:!1});return(0,xm.useMemo)(()=>{if(!j||!c||!t||!r)return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:void 0};if(HA(j)||HA(t))return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:Td(A)};let l=Mc({sellFungible:j,totalFees:a,minRequiredBalance:{source:o,destination:i},currentQuote:r}),m=Td(A);return{hasInsufficientFunds:new S(c?.data.amount??0).lt(l),insufficientFundsArgs:Rc({sellFungible:j,sellNativeFungible:c,totalNativeRequirement:l}),analyticsFields:m}},[j,t,r,a,o,i,c,A])};function J_(e){return e.type!=="pair"?{sellFungible:void 0,buyFungible:void 0}:{sellFungible:e.sellToken,buyFungible:e.buyToken}}function Y_(e){return e.type!=="quoteProcessed"?new S(0):e.nextProcessedQuote.fees.fees.reduce((A,j)=>A.plus(j.amount),new S(0))}function Z_(e){if(e.type==="quoteProcessed")return e.quote}var Pm=({performSwap:e,goToInsufficientFunds:A,tokenState:j,quoteProcessorState:t})=>{let{hasInsufficientFunds:r,insufficientFundsArgs:o,analyticsFields:i}=Zb(j,t),a=(0,Tm.useCallback)(()=>o&&A(o,i),[A,o,i]),{executeSwapInterceptors:u}=Yb({hasInsufficientFunds:r,showInsufficientFunds:a,quoteProcessorState:t});return{swap:(0,Tm.useCallback)(()=>{u()==="continue"&&e()},[u,e])}};var Gm=class{constructor(A,j){this.resetSwapper=A;this.storePairs=j}onStateChange(A,j,t,r){A.type==="executeSwapStarted"&&(this.resetSwapper(),this.storePairs(A.executingQuote.sell,A.executingQuote.buy))}},Cm=class{constructor(A){this.swapper=A}onStateChange(A,j,t,r){let{sell:o,quote:i}=t.executingQuote;if(A.type==="transactionConfirmed"){let a=o.data.balance?new S(o.data.balance):void 0;if(!a)return;let u=new S(i.sellAmount).shiftedBy(-o.data.decimals),c=a.minus(u);this.swapper.updateBalances({sellTokenBalance:c,sellTokenCaip19:M(V(o))})}}},AD=({swapMode:e,quotedAmounts:A,tokenState:j,inputErrors:t,quoteProcessorState:r,currentPerspective:o,sellPercentages:i,showFungibleDetails:a,showBuyFungibleScreen:u,retryAndNavigateToSwapper:c,resetSwapper:l,goToInsufficientFunds:m,preprocessor:B})=>{let k=qA(),f=G7(),{storePairs:g}=ze(),E=(0,AI.useCallback)(()=>{f({showFungibleDetails:a,showBuyFungibleScreen:u,showRetrySwap:c,swapMode:e,executeSwapStateListeners:[new Gm(l,g),new Cm(k)],quotedAmounts:A,uiContext:"swapperClassic",preprocessor:B})},[f,a,u,c,e,l,g,A,k,B]),{swap:h}=Pm({performSwap:E,goToInsufficientFunds:m,tokenState:j,quoteProcessorState:r});return{buttonState:eD(j,t,A,r,o,i),swap:h}},eD=(e,A,j,t,r,o)=>e.type!=="pair"?{type:"untradable",label:""}:t.type==="error"?{type:"untradable",label:T.t("swapNoQuotesFound")}:Nc(j,o,r,A)?{type:"insufficientBalance",label:T.t("swapReviewInsufficientBalance")}:t.type!=="quoteProcessed"?{type:"loading",label:T.t("swapReviewFlowActionButtonPrimary")}:j?{type:"tradable",label:T.t("swapReviewFlowActionButtonPrimary")}:{type:"untradable",label:T.t("swapReviewFlowActionButtonPrimary")};n();s();var Hc=q(P());n();s();var kr=()=>!0,eI={tokens:kr,prices:tB,collectibles:uB,currency:qk,staking:BB,swapper:v7,transferFungibleLoggingContext:kr,user:mk,[Pk]:kr,[yk]:kr,[_i]:kr,[fB]:kr,[Ss]:kr,[Ej]:kr,"test-debug-query":ns},jI=e=>{if(e.queryKey.length===0)return!1;let A=String(e.queryKey[0]);return e.state.status!=="success"?!1:eI[A]?eI[A](e):!1};var tI=new tk({defaultOptions:{mutations:{retry:!1,networkMode:"offlineFirst"},queries:{retry:!1,staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,networkMode:"offlineFirst"}}}),jD=ek({underlyingStorage:new Qk,throttleMs:1e3,enableDebugLogs:ns()}),tD=({children:e})=>(mg([[Wk,tI]]),e),Cne=e=>Hc.default.createElement(rk,{client:tI,persistOptions:{persister:jD,dehydrateOptions:{shouldDehydrateQuery:jI},buster:rD,maxAge:1/0}},Hc.default.createElement(Xk,null,Hc.default.createElement(tD,null,e.children))),rD="25.2.0";n();s();var Vi=q(_m()),rI=q(P()),te=q(pI());var oD=async(e,A,j)=>{let t=A.fold(i=>Buffer.from(i.buffer).toString("base64")),r=ee("importPrivateKeyAccount",[e,t,j]),o=await b.startSpan("importPrivateKeyAccount",()=>Ct(te.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importPrivateKeyAccount: Invalid response from background script")},zne=async(e,A,j)=>{let t=e.getEntropy(),r=ee("importSeedAccount",[Vi.default.encode(t),A,j]);t.fill(0);let o=await b.startSpan("importSeedAccount",()=>Ct(te.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importS*edAccount: Invalid response from background script")},Xne=async(e,A,j)=>{let t=e.getEntropy(),r=ee("importSocialSeedAccount",[Vi.default.encode(t),A,j]);t.fill(0);let o=await b.startSpan("importSeedlessAccount",()=>Ct(te.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("importS*edlessAccount: Invalid response from background script")},Wne=async e=>{let A=e.getEntropy(),j=ee("isExistingSeed",Vi.default.encode(A));A.fill(0);let t=await b.startSpan("isExistingSeed",()=>Ct(te.default.runtime,j));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="boolean"||t.result===null)return t.result;throw new Error("isExistingS*ed: Invalid response from background script")},nD=async e=>{let A=ee("addAccountForSeed",[e]),j=await b.startSpan("addAccountForSeed",async()=>Me(await te.default.runtime.sendMessage(We(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addAccountForS*ed: Invalid response from background script")},sD=async e=>{let A=ee("addAccountForSeedless",[e]),j=await b.startSpan("addAccountForSeedless",async()=>Me(await te.default.runtime.sendMessage(We(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addAccountForS*ed: Invalid response from background script")},iD=async(e,A)=>{let j=ee("addLedgerAccounts",[e,A]),t=await b.startSpan("connectLedgerAccounts",async()=>Me(await te.default.runtime.sendMessage(We(j))));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="string")return JSON.parse(t.result);throw new Error("connectLedgerAccounts: Invalid response from background script")},aD=async e=>{let A=ee("importReadOnlyAccount",e),j=await b.startSpan("addReadonlyAccount",async()=>Me(await te.default.runtime.sendMessage(We(A))));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("addReadonlyAccount: Invalid response from background script")},Jne=async(e,A,j)=>{let t=ee("exportPrivateKey",[e,A,j]),r=await b.startSpan("exportPrivateKey",async()=>Me(await te.default.runtime.sendMessage(We(t))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return we.from(Buffer.from(r.result,"hex"));throw new Error("exportPrivateKey: Invalid response from background script")},Yne=async(e,A)=>{let j=ee("exportEntropy",[e,A]),t=await b.startSpan("exportEntropy",async()=>Me(await te.default.runtime.sendMessage(We(j))));if("error"in t)throw new Error(t.error.message);if(typeof t.result=="string")return we.from(Buffer.from(t.result,"hex"));throw new Error("exportEntropy: Invalid response from background script")},pD=async()=>{let e=ee("deriveAddresses",void 0),A=await Ct(te.default.runtime,e);if("error"in A)throw new Error(A.error.message);return A.result},cD=async e=>{let A=ee("removeAccount",e),j=await Ct(te.default.runtime,A);if("error"in j)throw new Error(j.error.message);return j.result},uD=async(e,A)=>{let j=ee("reorderAccount",{identifier:e,toIndex:A}),t=await Ct(te.default.runtime,j);if("error"in t)throw new Error(t.error.message);return t.result},lD=async()=>{let e=ee("getAllAccounts",void 0),A=Me(await te.default.runtime.sendMessage(We(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string"){let j=JSON.parse(A.result);return sk({accounts:j}).accounts}throw new Error("fetchAllAccounts: Invalid response from background script")},dD=async()=>{let e=ee("getAllSeeds",void 0),A=Me(await te.default.runtime.sendMessage(We(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string")return JSON.parse(A.result);throw new Error("fetchAllSe*dMetas: Invalid response from background script")},mD=async()=>{let e=ee("getAllSeedlessSeeds",void 0),A=Me(await te.default.runtime.sendMessage(We(e)));if("error"in A)throw new Error(A.error.message);if(typeof A.result=="string")return JSON.parse(A.result);throw new Error("fetchAllSe*dlessMetas: Invalid response from background script")},kD=async e=>{let A=ee("getAuthenticationPublicKey",{secretIdentifier:e}),j=Me(await te.default.runtime.sendMessage(We(A)));if("error"in j)throw new Error(j.error.message);if(typeof j.result=="string")return JSON.parse(j.result);throw new Error("getAuthenticationPublicK*y: Invalid response from background script")},BD=async()=>{let e=ee("checkVaultIntegrity",void 0),A=Me(await te.default.runtime.sendMessage(We(e)));if("error"in A)throw new Error(A.error.message);return A.result},fD=async(e,A)=>{let j=ak.parse(A);"chainType"in j&&j.chainType==="solana"&&j.signingType==="transaction"&&typeof j.message!="string"&&(j.message=Vi.default.encode(j.message));let t=ee("sign",{accountIdentifier:e,params:j}),r=Me(await te.default.runtime.sendMessage(We(t)));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return Me(r.result);throw new Error("sign: Invalid response from background script")},oI={addAccountForSeed:nD,addReadonlyAccount:aD,importPrivateKeyAccount:oD,connectLedgerAccounts:iD,fetchAllAccounts:lD,fetchAllSeedMetas:dD,fetchAllSeedlessMetas:mD,connectSolanaSeedVaultAccounts:()=>{throw new Error("Solana Seed Vault is not supported on browser extension.")},deriveAddresses:pD,removeAccount:async e=>{if(!await cD(e))throw new Error("Error while removing account")},reorderAccount:async(e,A)=>{if(!await uD(e,A))throw new Error("Error while reordering account")},sign:fD,getAuthenticationPublicKey:kD,addAccountForSeedless:sD,checkVaultIntegrity:BD,getCashAddress:async()=>{throw new Error("getCashAddress: Not implemented on browser extension")},getAgentAddress:async()=>{throw new Error("getAgentAddress: Not implemented on browser extension")},getCashKMSAccount:async()=>{throw new Error("getCashKMSAccount: Not implemented on browser extension")},getKMSInstance:()=>{throw new Error("getKMSInstance: Not implemented on browser extension")}},Zne=()=>oI;function Ase({children:e}){return rI.default.createElement(nk,{vault:oI},e)}export{IWA as a,$WA as b,Tb as c,wJA as d,SI as e,wI as f,wB as g,su as h,fI as i,au as j,bI as k,pu as l,IB as m,II as n,$B as o,cu as p,qI as q,ks as r,zj as s,ku as t,Oo as u,PI as v,gu as w,Eu as x,yu as y,GI as z,F$ as A,Xu as B,u_ as C,R$ as D,Ie as E,yl as F,Ne as G,$r as H,kl as I,L$ as J,K$ as K,U$ as L,jg as M,ev as N,V$ as O,ug as P,hl as Q,tLA as R,Mi as S,b8 as T,em as U,WM as V,Oi as W,sS as X,xp as Y,uS as Z,gj as _,Hp as $,kj as aa,QA as ba,$e as ca,$ as da,fv as ea,dA as fa,MA as ga,Vr as ha,aA as ia,kn as ja,cG as ka,qA as la,Oe as ma,Qe as na,nh as oa,Ve as pa,sh as qa,wt as ra,V6 as sa,qG as ta,lG as ua,Od as va,S1 as wa,fi as xa,x1 as ya,T1 as za,C1 as Aa,VC as Ba,d7 as Ca,Xe as Da,It as Ea,ap as Fa,Zr as Ga,M1 as Ha,R1 as Ia,gi as Ja,U1 as Ka,lp as La,X1 as Ma,dF as Na,xn as Oa,IC as Pa,$C as Qa,mF as Ra,TC as Sa,h7 as Ta,fF as Ua,PC as Va,GC as Wa,F7 as Xa,EF as Ya,CC as Za,OC as _a,J1 as $a,_C as ab,jC as bb,q7 as cb,vt as db,u7 as eb,LC as fb,zC as gb,tC as hb,XC as ib,wi as jb,zF as kb,WF as lb,jO as mb,cO as nb,rO as ob,aM as pb,z7 as qb,GDA as rb,Y7 as sb,Z7 as tb,Am as ub,A8 as vb,e8 as wb,am as xb,y8 as yb,x8 as zb,O8 as Ab,_8 as Bb,K8 as Cb,U8 as Db,cm as Eb,um as Fb,lm as Gb,ij as Hb,Fc as Ib,Ib as Jb,gb as Kb,hb as Lb,wb as Mb,bR as Nb,XR as Ob,WR as Pb,JR as Qb,YR as Rb,ZR as Sb,gm as Tb,Li as Ub,o_ as Vb,i_ as Wb,a_ as Xb,v_ as Yb,q_ as Zb,d_ as _b,m_ as $b,k_ as ac,x_ as bc,T_ as cc,f_ as dc,P_ as ec,G_ as fc,C_ as gc,M_ as hc,R_ as ic,AD as jc,jI as kc,tI as lc,Cne as mc,zne as nc,Xne as oc,Wne as pc,Jne as qc,Yne as rc,mD as sc,Zne as tc,Ase as uc};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.development.js:
  (**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.development.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=chunk-QY5YIVDQ.js.map
